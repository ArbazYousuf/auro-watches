!function e(t,n,r){function s(o,u){var a,f,l;if(!n[o]){if(!t[o]){if(a="function"==typeof require&&require,!u&&a)return a(o,!0);if(i)return i(o,!0);throw f=new Error("Cannot find module '"+o+"'"),f.code="MODULE_NOT_FOUND",f}l=n[o]={exports:{}},t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var o,i="function"==typeof require&&require;for(o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var AutosuggestionListZView,ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),_=requirejs("utils"),Stylesheet=(require("../events"),require("../stylesheet")),Promise=require("korbutJS/src/Promise").Promise,std_transition=Stylesheet.std_transition,getCompat=Stylesheet.getCompat,ss=Stylesheet.stylesheet,CSS_TRANSITION_PROPERTY=(Stylesheet.COMPUTED_STYLE_COMPAT,Stylesheet.CSS_TRANSITION_COMPAT,Stylesheet.CSS_TRANSITION_PROPERTY),AutosuggestionCommonItemZView=(Stylesheet.CSS_TRANSITIONEND_EVENT,module.exports.AutosuggestionCommonItemZView=ZView.extend(function(Super,statics,items){return items={},statics.getByUid=function(uid){return items[uid]&&items[uid].instance},statics.ACTIVE_CLASS=" rlx-autosuggestion__list-item--active",{constructor:function(dict,args){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},args[0]=dict,Super.apply(this,args),void function(self){items[self.uid()]={instance:self},self._model.on("change",function(k,v){switch(k){case"active":v?self.root().className+=statics.ACTIVE_CLASS:self.root().className=self.root().className.replace(statics.ACTIVE_CLASS,"")}})}(this)},_template:"li#$uid.rlx-autosuggestion__list-item{$text}",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},highlight:function(){this._model.set("active",1)},unhighlight:function(){this._model.set("active",0)},kill:function(){this.recover()}}}));module.exports.AutosuggestionItemZView=AutosuggestionCommonItemZView.extend(function(Super,statics){return statics.ACTIVE_CLASS=" rlx-autosuggestion__list-item--active",{constructor:function(){Super.apply(this,arguments),void function(self){function clickhandler(e){e.preventDefault(),self.trigger("click",[self._model.expand()])}self.root().addEventListener("click",self._clickhandler=clickhandler)}(this)},_template:"li.rlx-autosuggestion__list-item{$text}",kill:function(){Super.prototype.kill.call(this),this.root().removeEventListener("click",this._clickhandler)}}});module.exports.AutosuggestionAnchorZView=AutosuggestionCommonItemZView.extend(function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){function clickhandler(e){window.location=self._model.get("href")}self.root().addEventListener("click",self._clickhandler=clickhandler)}(this)},_template:"li.rlx-autosuggestion__list-item>a.rlx-autosuggestion__list-anchor[href=$href]{$text}",kill:function(){Super.prototype.kill.call(this),this.root().removeEventListener("click",this._clickhandler)}}}),AutosuggestionListZView=module.exports.AutosuggestionListZView=ZView.extend(function(Super,statics,sections){return sections={},statics.getByUid=function(uid){return sections[uid]&&sections[uid].instance},{constructor:function(dict,args){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},"undefined"!=typeof dict.className?dict.className=" "+dict.className:dict.className="",args[0]=dict,Super.apply(this,args),void function(self){sections[self.uid()]={instance:self},self.items=[]}(this)},_template:"div.rlx-autosuggestion__section.rlx-autosuggestion__section--$type$className>p.rlx-autosuggestion__section-header{$name}+ul.rlx-autosuggestion__section-list@list",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},addItem:function(uid){this.items.push(uid)},kill:function(){this.recover()}}}),module.exports.AutosuggestionZView=ZView.extend(function(Super,statics){var autosugs={};return statics.CHANGE_EVT="autosuggestion/change",statics.READY_EVT="autosuggestion/ready",statics.EMPTY_EVT="autosuggestion/empty",statics.SHOW_EVT="autosuggestion/show",statics.SHOWN_EVT="autosuggestion/shown",statics.HIDE_EVT="autosuggestion/hide",statics.HIDDEN_EVT="autosuggestion/hidden",statics.FOCUS_EVT="autosuggestion/focus",statics.BLUR_EVT="autosuggestion/blur",statics.CLOSE_STATE=0,statics.OPEN_STATE=1,statics.REQUESTING_CLASS="rlx-autosuggestion--requesting",statics.FOCUS_CLASS="rlx-autosuggestion--focus",statics.KEYCODE_ENTER=13,statics.KEYCODE_UP=38,statics.KEYCODE_DOWN=40,statics.KEYCODES_ARROWS=[statics.KEYCODE_UP,statics.KEYCODE_DOWN,statics.KEYCODE_LEFT,statics.KEYCODE_RIGHT],statics.getByUid=function(uid){return autosugs[uid]&&autosugs[uid].instance},statics.mesureContent=function(view,cb,clone){clone=view.$query("container").clone(!0),clone.css({position:"absolute",top:"-9999px",left:"-9999px",visibility:"hidden",opacity:0,height:"auto"}),clone.appendTo(view.$root()),_.requestAnimationFrame(function(height){cb(clone.height()),clone.remove()})},statics.makeItemList=function(self,list){return list=[],"object"==typeof self.sections&&self.sections.forEach(function(section){section=AutosuggestionListZView.getByUid(section.uid),section&&(list=list.concat(section.items))}),list},statics.emptyItemList=function(self,list){return list=[],"object"==typeof self.sections&&self.sections.forEach(function(section){section=AutosuggestionListZView.getByUid(section.uid),section&&(section.items=[])}),list},{constructor:function(dict,args){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},"undefined"!=typeof dict.className?dict.className=" "+dict.className:dict.className="",dict.charlimit=dict.charlimit||this._charlimit,args[0]=dict,Super.apply(this,args),void function(self){function onfocus(){self.trigger(statics.FOCUS_EVT),self.focus()}function onblur(){document.removeEventListener("keyup",self._onctrlkeyup),self.trigger(statics.BLUR_EVT)}function onkeyhandler(e){clearTimeout(self._timerkeyup),self._timerkeyup=setTimeout(function(val){val=self.query("input").value.trim(),val.length>=self._model.get("charlimit")&&self._prev!=val&&void function(val){self.trigger(statics.CHANGE_EVT,[val])}(self._prev=val)},self._keyuptime)}autosugs[self.uid()]={instance:self},self.sections=[],self.items=[],self.cursor=-1,self._timerkeyup=null,self._model.on("change",function(k,v){switch(k){case"state":v==statics.OPEN_STATE?self.trigger(statics.SHOW_EVT):self.trigger(statics.HIDE_EVT)}}),self._cssReady=new Promise(function(resolve){getCompat(function(table){ss.rule("#"+self.uid()+" .rlx-autosuggestion__container{}",function(container){container.property(CSS_TRANSITION_PROPERTY,std_transition(self._transitiontime.toString()+"ms height ease-in-out",table.transform)),self.on(statics.SHOW_EVT,function(){statics.mesureContent(self,function(h){container.property("height",h+"px"),setTimeout(function(){container.property("height","auto"),self.trigger(statics.SHOWN_EVT)},self._transitiontime)})}),self.on(statics.HIDE_EVT,function(){container.property("height","0px"),setTimeout(function(){self.trigger(statics.HIDDEN_EVT)},self._transitiontime)}),self.on(statics.CHANGE_EVT,function(){self.$root().addClass(statics.REQUESTING_CLASS)}),self.on(statics.EMPTY_EVT,function(){self.$root().removeClass(statics.REQUESTING_CLASS)}),self.on(statics.READY_EVT,function(){self.open(),self.$root().removeClass(statics.REQUESTING_CLASS)})}),resolve()})}),self.query("input").addEventListener("keyup",self._onkeyhandler=onkeyhandler),self.query("input").addEventListener("focus",self._onfocushandler=onfocus),self.query("input").addEventListener("blur",self._onblurhandler=onblur)}(this)},_keyuptime:300,_transitiontime:225,_charlimit:3,_prev:null,_template:"#$uid.rlx-autosuggestion$className>            input@input.rlx-autosuggestion__input[type=text][placeholder=$placeholder]          + .rlx-autosuggestion__container@container>.rlx-autosuggestion__lists@lists",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},addSection:function(div,idx){return div=document.createElement("div"),idx=this.sections.push({root:div}),this.query("lists").appendChild(div),idx-1},getSection:function(idx){return this.sections[idx]},focus:function(){this.$root().addClass(statics.FOCUS_CLASS),document.removeEventListener("keyup",this._onctrlkeyup),document.addEventListener("keyup",this._onctrlkeyup=function(e){~statics.KEYCODES_ARROWS.indexOf(e.keyCode)?void function(self,direction,list,item){list=statics.makeItemList(self),self._activeitem&&AutosuggestionCommonItemZView.getByUid(self._activeitem).unhighlight(),self.cursor=(self.cursor+direction)%list.length,self.cursor<0&&(self.cursor=self.cursor+list.length),item=AutosuggestionCommonItemZView.getByUid(list[self.cursor]),item&&(item.highlight(),self._activeitem=list[self.cursor])}(this,e.keyCode==statics.KEYCODE_UP?-1:1,[]):e.keyCode==statics.KEYCODE_ENTER&&this._activeitem&&void function(item){item.root().click()}(AutosuggestionCommonItemZView.getByUid(this._activeitem))}.bind(this))},open:function(self){self=this,self._model.set("state",statics.OPEN_STATE),document.addEventListener("keyup",self._onkeyup=function _onkeyup(e){27==e.keyCode&&(document.removeEventListener("keyup",_onkeyup),self.close())}),document.addEventListener("ontouchstart"in document.documentElement?"touchstart":"click",self._ondocclick=function _ondocclick(e){var start,delta,onmove,onend;jQuery.contains(self.root(),e.target)||("ontouchstart"in document.documentElement?(start=e.touches[e.touches.length-1].clientY,delta=0,onmove=function(e){delta=Math.abs(e.touches[e.touches.length-1].clientY-start)},onend=function(e){window.removeEventListener("touchmove",onmove),window.removeEventListener("touchend",onend),delta<10&&(document.removeEventListener("ontouchstart"in document.documentElement?"touchstart":"click",_ondocclick),self.close())},window.addEventListener("touchmove",onmove),window.addEventListener("touchend",onend)):(document.removeEventListener("ontouchstart"in document.documentElement?"touchstart":"click",_ondocclick),self.close()))})},close:function(self){self=this,self.query("input").value="",self.query("input").blur(),self._prev="",self.$root().removeClass(statics.FOCUS_CLASS),self._model.set("state",statics.CLOSE_STATE)},empty:function(){statics.emptyItemList(this),this.cursor=-1,clearTimeout(this._timerkeyup),this.trigger(statics.EMPTY_EVT)},kill:function(){clearTimeout(this._timerkeyup),this.query("input").removeEventListener("onkyeup",this._onkeyhandler),this.query("input").addEventListener("focus",this._onfocushandler),this.query("input").addEventListener("blur",this._onblurhandler),this.recover()}}})},{"../events":36,"../stylesheet":56,"korbutJS/src/Promise":60}],2:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),Promise=require("korbutJS/src/Promise").Promise,_=requirejs("utils"),Stylesheet=(_.requestAnimationFrame,require("../stylesheet")),stylesheet=Stylesheet.stylesheet,std_transition=Stylesheet.std_transition,CSS_TRANSITION_PROPERTY=(Stylesheet.CSS_TRANSITION_COMPAT,Stylesheet.CSS_TRANSITION_PROPERTY),cssCompat=(Stylesheet.CSS_TRANSITIONEND_EVENT,stylesheet.cssCompat);module.exports.OverlayZView=ZView.extend(function(Super,statics,overlays){return overlays={},statics._SHOW_EVENT="overlay/show",statics._HIDE_EVENT="overlay/hide",statics._SHOWN_EVENT="overlay/shown",statics._HIDDEN_EVENT="overlay/hidden",statics.getByUid=function(uid){return overlays[uid]&&overlays[uid].instance},{constructor:function(dict,args){dict=dict||{},dict.className=" "+(dict.className||this._className),dict.transition=dict.transition||this._transition,dict.transition_time=dict.transition_time||this._transition_time,dict.opacity=dict.opacity||this._opacity,dict.background=dict.background||this._background,this.parent=dict.parent||null,delete dict.parent,args=Array.prototype.slice.call(arguments),args[0]=dict,Super.apply(this,args),void function(self){overlays[self.uid()]={instance:self},self._cssReady=new Promise(function(resolve){cssCompat(function(compatTable){stylesheet.rule(["#",self.uid(),"{}"].join(""),function(mainCSS,node){node=self.root(),mainCSS.property(CSS_TRANSITION_PROPERTY,std_transition(dict.transition_time.toString()+"ms "+dict.transition,compatTable.transform)),mainCSS.property("background",dict.background),mainCSS.property("opacity","0"),self.on(module.exports.OverlayZView._SHOW_EVENT,function(){function onend(){clearTimeout(self._failtimer),self.trigger(module.exports.OverlayZView._SHOWN_EVENT)}clearTimeout(self._failtimer),self._failtimer=setTimeout(onend,+dict.transition_time+16),mainCSS.property("opacity",dict.opacity)}),self.on(module.exports.OverlayZView._HIDE_EVENT,function(){function onend(){clearTimeout(self._failtimer),self.trigger(module.exports.OverlayZView._HIDDEN_EVENT)}clearTimeout(self._failtimer),self._failtimer=setTimeout(onend,+dict.transition_time+16),mainCSS.property("opacity","0")}),self._model.on("change",function(k,v,old){switch(k){case"state":v?void function(){if(!self.parent)throw new Error("OverlayZView: Call show with a given parent at instanciation");self.parent.appendChild(self.borrow()),self.trigger(module.exports.OverlayZView._SHOW_EVENT)}():void function(){self.on(module.exports.OverlayZView._HIDDEN_EVENT,function onhidden(){self.off(module.exports.OverlayZView._HIDDEN_EVENT,onhidden),self.recover()}),self.trigger(module.exports.OverlayZView._HIDE_EVENT)}()}}),resolve()})})})}(this)},_template:".rlx-overlay-v55$className[id=$uid]",_background:"white",_className:"",_opacity:".4",_transition_time:400,_transition:"opacity ease-in-out",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},show:function(){this._model.set("state",1)},hide:function(){this._model.set("state",0)},kill:function(){this.on(module.exports.OverlayZView._HIDDEN_EVENT,function onhidden(){this.off(module.exports.OverlayZView._HIDDEN_EVENT,onhidden),this.recover(),delete overlays[this.uid()]}.bind(this)),this._model.set("state",0)}}})},{"../stylesheet":56,"korbutJS/src/Promise":60}],3:[function(require,module,exports){"use strict";var _=requirejs("utils"),ZView=requirejs("lib/ZenView"),geoloc=requirejs("modules/rlx-geolocation"),Model=requirejs("lib/Model"),Collection=requirejs("lib/Collection"),i18n=(requirejs("lib/Iterator"),requirejs("i18n")),popin=requirejs("modules/rlx-popins"),klass=_.classMaker,env=(jQuery,require("../environment")),events=require("../userland/events"),locales=require("../userland/locales");module.exports.SharePopinZView=klass(ZView,function(Super,statics){return{constructor:function(){ZView.apply(this,arguments),void function(self){self._model.get("standalone")?self.query("content").appendChild(new module.exports.SharePopinStandAloneFigureZView(self._model).borrow()):self.query("content").appendChild(new module.exports.SharePopinFigureZView(self._model).borrow()),self.query("content").appendChild(new module.exports.SharePopinContentZView(self._model).borrow())}(this)},_template:".rlx-popin-box.rlx-my-profile-form.rlx-popin-model-share.rlx-activated.rlx-popin-model-share-by-js > .rlx-pop.rlx-pop-wide.rlx-pop-form > .rlx-pop-content@content",show:function(buffer){buffer=document.createElement("div"),buffer.appendChild(this.borrow()),popin.open(buffer.innerHTML,{popinScrollinterval:1}).then(function(self){return function(){self.recover()}}(this))},close:function(){popin.close()}}}),module.exports.WishlistSharePopinZView=klass(module.exports.SharePopinZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments)}}}),module.exports.SharePopinFigureZView=klass(ZView,function(Super,statics){return{constructor:function(){ZView.apply(this,arguments)},_template:"figure > img[src=$productImgWishlist] + figcaption > h2{$collection} + h3{$modelName}"}}),module.exports.SharePopinStandAloneFigureZView=klass(ZView,function(Super,statics){return{constructor:function(){ZView.apply(this,arguments)},_template:"figure.rlx-share-this-page__standalone-figure > img[src=$productImgWishlist]"}}),module.exports.SharePopinContentZView=klass(ZView,function(Super,statics){return{constructor:function(){ZView.apply(this,arguments),void function(self){try{env.isAuthor?self._model.set("sharebyemail",self._model.get("modelPageUrl").replace(/\.html\//,".sharebyemail.html/")):self._model.set("sharebyemail",self._model.get("modelPageUrl").replace(/\.html$/,".sharebyemail.html"))}catch(e){self._model.set("sharebyemail","/error")}self.query("content").appendChild(new module.exports.SharePopinHGroupZView(self._model).borrow()),self.query("content").appendChild(new module.exports.SharePopinStep1ZView(self._model).borrow()),self.query("content").appendChild(new module.exports.SharePopinStep2ZView(self._model).borrow()),self.query("content").appendChild(new module.exports.SharePopinStep3ZView(self._model).borrow())}(this)},_template:".rlx-model-share > .rlx-textblock.rlx-textblock-medium@content"}}),module.exports.SharePopinHGroupZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments)},_template:"hgroup > h1{$shareTitle}"}),module.exports.SharePopinStep1ZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments),void function(self){self.root().appendChild(new module.exports.SharePopinDescriptionZView(self._model).borrow()),self.root().appendChild(new module.exports.SharePopinLinkListZView(self._model).borrow())}(this)},_template:".rlx-section.rlx-steps.rlx-active[data-step=1]"}),module.exports.SharePopinDescriptionZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments)},_template:"p{$short_introduction}"}),module.exports.SharePopinLinkListZView=klass(ZView,{constructor:function(data){ZView.apply(this,[data]),void function(self,collection,i,l){collection=new Collection(self._model.get("social_network_links")||[]),l=Math.floor((collection.length()+1)/2),i=0,collection.forEach(function(model,ul){model.set("name",i18n("networks/"+model.get("platform"))),model.set("rmc",self._model.get("rmc")),model.set("family",self._model.get("family")),self._model.get("rmc")?self.query("ul").appendChild(new module.exports.SharePopinLinkZView(model).borrow()):self.query("ul").appendChild(new module.exports.SharePagePopinLinkZView(model).borrow())}),self.query("ul").appendChild((new module.exports.SharePopinLinkEmailZView).borrow())}(this)},_template:"div.rlx-share-links > ul.social@ul"}),module.exports.SharePopinLinkZView=klass(ZView,{constructor:function(data){ZView.apply(this,[data]),void function(self){self._model.get("rmc")&&self._model.set("rmc",self._model.get("rmc").toUpperCase())}(this)},_template:"li.rlx-popup > a.wa-tracking-share.wa-share-product[href=$href][data-platform=$platform-key][data-product-category=$family][data-product-id=$rmc]{$name}"}),module.exports.SharePagePopinLinkZView=klass(ZView,{constructor:function(data){ZView.apply(this,[data]),void function(self){self._model.get("rmc")&&self._model.set("rmc",self._model.get("rmc").toUpperCase())}(this)},_template:"li.rlx-popup > a.wa-tracking-share[href=$href][data-platform=$platform-key]{$name}"}),module.exports.SharePopinLinkEmailZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments),void function(self){function ondisplay(){}function onwillrender(){events.bus.off(events.wishlist.socialdisplay,ondisplay),events.bus.off(events.wishlist.willrender,onwillrender)}events.bus.on(events.wishlist.socialdisplay,ondisplay),events.bus.on(events.wishlist.willrender,onwillrender)}(this)},_Model:Model.extend({constructor:function(){Model.apply(this)},_defaults:{name:locales.sharepopin.email}}),_template:"li.shareemail_ > a.rlx-step-forward[href=#]{$name}"}),module.exports.SharePopinStep2ZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments),void function(self){self.query("fields").appendChild(new module.exports.SharePopinFormInputZView({name:"acc_name",label:i18n("share/addressee-name"),placeholder:i18n("share/addressee-name"),validate:"empty"}).borrow()),self.query("fields").appendChild(new module.exports.SharePopinFormInputZView({name:"acc_email",label:i18n("share/addressee-email"),placeholder:i18n("share/addressee-email"),validate:"empty"}).borrow()),self.query("fields").appendChild(new module.exports.SharePopinFormInputZView({name:"acc_yourname",label:i18n("share/sender-name"),placeholder:i18n("share/sender-name"),validate:"empty"}).borrow()),self.query("fields").appendChild(new module.exports.SharePopinFormInputZView({name:"acc_youremail",label:i18n("share/sender-email"),placeholder:i18n("share/sender-email"),className:"rlx-email",validate:"empty",disabled:!0}).borrow()),setTimeout(function(){self.$query(".rlx-send-email").on("click",function(e){e.preventDefault()})},150)}(this)},_template:[".rlx-steps.rlx-form[data-step=2] > form@form[action=$sharebyemail][method=POST].rlx-my-detail-wrap.rlx-share-email.rlx-step-form > fieldset >","(.rlx-fields@fields > input[type=hidden][name=model-rmc][value=$rmc] + input[type=hidden][name=zone][value=",geoloc.zone(),"] + input[type=hidden][name=_charset_][value=UTF-8] )","+ (p.rlx-my-profile-form-disabled.rlx-checkbox > input#rlx-share-model-copy.rlx-share-model-copy[type=checkbox][name=rlx-share-model-copy]+label[for=rlx-share-model-copy]{",i18n("share/send-a-copy"),"})","+ (.rlx-share-controls > a.rlx-step-back[href=javascript:void(0)]{",i18n("share/back"),"} + button.rlx-send-email@sendButton{",i18n("share/send-email"),"})","+ p.rlx-terms{",i18n("share/share-disclaimer"),"}"].join("")}),module.exports.SharePopinFormInputZView=klass(ZView,{constructor:function(data){ZView.apply(this,arguments),void function(self){data.className&&(self.root().className+=" "+data.className),data.disabled&&(self.query("input").className+=" rlx-my-profile-form-disabled"),data.placeholder&&self.query("input").setAttribute("placeholder",data.placeholder),data.validate&&void function(validates){for(self.query("input").setAttribute("data-rlx-validation",data.validate);validates.length;)self.root().appendChild(new module.exports.SharePopinFormErrorMSGZView({name:validates[0],msg:locales.sharepopin.validation[validates.shift()]}).borrow())}(data.validate.split(","))}(this)},_template:".rlx-input.rlx-my-profile-form-fieldset > label[for=$name]{$label} + input@input[type=text][id=$name][name=$name].rlx-my-profile-form-text"}),module.exports.SharePopinFormErrorMSGZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments)},_template:"span.rlx-error.rlx-my-profile-form-msg[data-rlx-validation=$name]{$msg}"}),module.exports.SharePopinStep3ZView=klass(ZView,{constructor:function(){ZView.apply(this,arguments)},_template:[".rlx-steps rlx-step-msg[data-step=3] > .rlx-column.rlx-row.rlx-h-left.rlx-v-top > .rlx-wrapper >","(.rlx-align.success > h2.rlx-popin-heading{",i18n("share/email-form-title-success"),"} + p{",i18n("share/email-sent-form"),"} + a.rlx-step-back[href=#]{",i18n("share/send-another-message"),"})","+ (.rlx-align.error > h2.rlx-popin-heading{",i18n("share/email-form-title-error"),"} + p{",i18n("share/email-not-sent-form"),"} + a.rlx-step-back[href=#]{",i18n("share/back"),"})"].join("")})},{"../environment":35,"../userland/events":57,"../userland/locales":58}],4:[function(require,module,exports){"use strict";var contentSidebarPriceZView,contentPriceSideBarClose,contentPriceSideBarAsset,contentPriceSideBarTitles,contentPriceSideBarTextContent,singleton=requirejs("utils").singleton,klass=requirejs("utils").classMaker,ui=requirejs("modules/rlx-ui"),UiRouter=ui.router,SideBar=ui.SideBar,ZView=(ui.NavPane,requirejs("lib/ZenView")),events=require("../../events"),env=require("../../environment"),cssCompat=require("../../stylesheet").getCompat,stylesheet=require("../../stylesheet").stylesheet;module.exports.sidebarPrice=singleton(SideBar,function(Super,statics){return{constructor:function(model){Super.call(this,{},model),void function(self){cssCompat(function(compatTable){stylesheet.rule("#"+self.uid()+"{overflow:hidden;}","#"+self.uid()+" > .rlx-ui-pane-wrap{overflow-x:hidden;overflow-y:scroll;left:0;position:relative;}")}),self.query("wrap").innerHTML="",self.query("wrap").appendChild(new contentSidebarPriceZView(self._model._data).borrow()),UiRouter.when("/ui/nav/close",function(next,vars){self.hide(),next()})}(this)},refresh:function(data,self){self=this,data&&(self.query("wrap").innerHTML="",self.query("wrap").appendChild(new contentSidebarPriceZView(data).borrow()))}}}),contentSidebarPriceZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self._model.set("text_line_1",self._model.get("locales.pricenotice")),self._model.set("text_line_2",self._model.get("locales.price_policies_text")),self._model.set("onDemandText",self._model.get("locales.price_onDemand")),self.query("content").appendChild(new contentPriceSideBarClose(self._model).borrow()),(self._model.get("asset")||self._model.get("asset_retina"))&&self.query("content").appendChild(new contentPriceSideBarAsset(self._model).borrow()),self.query("content").appendChild(new contentPriceSideBarTitles(self._model).borrow()),self.query("content").appendChild(new contentPriceSideBarTextContent(self._model).borrow())}(this)},_template:"div.rlx-sidebar_price-bar@content"}}),contentPriceSideBarClose=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){function onwillrender(next,vars){return events.eventRouter.off(events.appWillRender,onwillrender),next()}function closeSideBar(e){e.preventDefault(),UiRouter.dispatch("/ui/nav/close")}self.$query("close").on("click",closeSideBar),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"button.rlx-sidebar_price-bar--close-button.rlx-nav__close@close{$close}"}}),contentPriceSideBarAsset=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:env.mobile?"div.rlx-price-sidebar___price-bar--asset >                                     img[src=$asset]":"div.rlx-price-sidebar___price-bar--asset >                                     img[src=$asset][srcset=$asset_retina]"}}),contentPriceSideBarTitles=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:"h2.rlx-sidebar_price-bar--subtitle {$subtitle} + h1.rlx-sidebar_price-bar--title {$title}"}}),contentPriceSideBarTextContent=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self._model.get("hasPrice")||self._model.set("text_line_1",self._model.get("onDemandText"))}(this)},_template:"div.rlx-sidebar_price--text >                               (p {$text_line_1} + p {$text_line_2}"}})},{"../../environment":35,"../../events":36,"../../stylesheet":56}],5:[function(require,module,exports){"use strict";var ContainerMobilePopinSocialFeedZView,ItemSocialFeedZView,OverlaySocialFeedZView,TextSocialFeedItemZView,ImageSocialFeedItemZView,ShowMoreButtonZview,ChangeBoxFeedZView,ItemChangeBoxZView,ZView=requirejs("lib/ZenView"),klass=requirejs("utils").classMaker,events=require("../../events"),locales=require("./locales"),env=require("../../environment"),Animate=require("../../core/Animate").Animate,underscore=requirejs("require/hbs/underscore"),all=require("korbutJS/src/Promise").Promise.all,PromiseK=require("korbutJS/src/Promise").Promise,helpers=require("./utils").utils,ApiRequestEngine=require("./utils").ApiRequestEngine,ApiModelbyRMC=require("./utils").ApiModelbyRMC,Popins=requirejs("modules/rlx-popins"),PopinView=requirejs("views/PopinView"),PopinContent=require("./PopinSocialFeedZView").PopinSocialFeedZView,PopinMobileContent=require("./PopinSocialFeedZView").PopinMobileSocialFeedZView,IframePopinSocialFeedZView=require("./PopinSocialFeedZView").IframePopinSocialFeedZView,VideoPopinSocialFeedZView=require("./PopinSocialFeedZView").VideoPopinSocialFeedZView,sessionStorage=new requirejs("modules/rlx-storage").sessionStorage;module.exports.ContainerSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,popinView,mediaContainer,checkPopinHeight){function onkillApp(next,vars){return events.eventRouter.off(events.socialFeedLoadData,onload),events.eventRouter.off(events.socialFeedLoadMore,onloadmore),events.eventRouter.off(events.socialFeedRemoveMoreButton,onoversize),events.eventRouter.off(events.socialFeedButtonSpinner,onloadspinner),events.eventRouter.off(events.socialFeedButtonRemoveSpinner,removespinnner),events.eventRouter.off(events.socialFeedOpenPopin,onopenpopin),events.eventRouter.off(events.socialFeedCloseMobilePopin,onclosemobilepopin),events.eventRouter.off(events.socialFeedLoadWatchData,onloaddata),events.eventRouter.off(events.socialFeedSwapLoaderPopin,onswaploader),events.eventRouter.off(events.socialFeedToggleDisableClick,ontogglepointerevents),events.eventRouter.off(events.socialFeedLoadVideoAfterPopinCreation,onAddVideoElement),events.eventRouter.off(events.appWillRender,onkillApp),next()}function onloaddata(next,vars,data){return next()}function onoversize(next,vars){return self.$query("buttonContainer").remove(),next()}function onloadspinner(next,vars){return self.$query("buttonContainer").addClass("loading"),next()}function removespinnner(next,vars){return self.$query("buttonContainer").removeClass("loading"),next()}function onloadmore(next,vars,startOffset,config){return config=require("./config"),startOffset=sessionStorage.getItem("lastOffset"),new ApiRequestEngine(config.name,config.sizeNewLoad,startOffset),next()}function onload(next,vars,newDATA,data){data=newDATA?newDATA._models:self._model.get("data");for(var k in data)self.query("container").appendChild(new ItemSocialFeedZView(data[k]).borrow());return events.eventRouter.trigger(events.socialFeedDomReady),events.eventRouter.trigger(events.socialFeedButtonRemoveSpinner),next()}function onopenpopin(next,vars,popinData){return env.mobile||window.addEventListener("resize",checkPopinHeight),sessionStorage.setItem("pageYBlock",window.pageYOffset),env.tablet&&lockScroll(),self.createPopin(popinData),next()}function ontogglepointerevents(socialImageGridLinks){var i,isPointerEventEnabled;for(socialImageGridLinks=document.querySelectorAll(".rlx-social-feed__mosaic-link"),i=0;i<socialImageGridLinks.length;i++)isPointerEventEnabled=!(""!==socialImageGridLinks[i].style.pointerEvents),isPointerEventEnabled?socialImageGridLinks[i].style.pointerEvents="none":socialImageGridLinks[i].style.pointerEvents=""}function onclosemobilepopin(Anim,overlayActived){Anim=new Animate,mediaContainer&&mediaContainer.querySelector("video")&&mediaContainer.querySelector("video").pause(),Anim.fadeOut(self.query("mobile"),".5").then(function(){events.eventRouter.trigger(events.socialFeedToggleDisableClick),self.query("container").style.zIndex="2",self.query("buttonContainer").style.zIndex="2",self.query("mobile").style.zIndex="-1",document.getElementsByTagName("html")[0].style.overflow="auto"}),overlayActived=jQuery(".rlx-social-feed__list").find("a[overlay=true]").get(),overlayActived.length&&(overlayActived[0].removeAttribute("overlay"),Anim.fadeOut(overlayActived[0].children[0]))}function onswaploader(next,vars,data,popinContent,arrowPrev,arrowNext,Anim){return Anim=new Animate,arrowPrev=document.querySelector(".rlx-social-feed-popin__arrow-prev"),arrowNext=document.querySelector(".rlx-social-feed-popin__arrow-next"),popinContent=document.querySelector(".rlx-social-feed__popin"),data.active?(popinContent.classList.add("loading"),Anim.fadeOut(arrowPrev,"0.3s",.2),Anim.fadeOut(arrowNext,"0.3s",.2),Anim.fadeOut(popinContent,"0.1s",.2).then(function(){})):(popinContent.classList.remove("loading"),Anim.fadeIn(arrowPrev,"0.3s"),Anim.fadeIn(arrowNext,"0.3s"),Anim.fadeIn(popinContent,"0.1s").then(function(){})),next()}function onWindowResize(bodyHeight,popinHeight,popinContainer){
bodyHeight=document.body.clientHeight,popinHeight=document.querySelector(".rlx-popin-content").clientHeight,popinContainer=document.querySelector(".rlx-popin-container"),bodyHeight<=popinHeight?popinContainer.classList.add("rlx-social-feed__popin--scroll-control"):bodyHeight>popinHeight&&popinContainer.classList.remove("rlx-social-feed__popin--scroll-control")}function lockScroll(app,offset){offset=sessionStorage.getItem("pageYBlock"),app=document.documentElement,app.style.position="fixed",app.style.top=-offset+"px"}function unlockScroll(app,offset){offset=sessionStorage.getItem("pageYBlock"),app=document.documentElement,app.style.position=null,app.style.top=null,window.scrollTo(0,offset)}function onAddVideoElement(next,vars,data){if(mediaContainer=document.querySelector(".rlx-social-feed__popin-media"),data)switch(data.case){case 1:mediaContainer.appendChild(new VideoPopinSocialFeedZView(data).borrow());break;case 2:mediaContainer.appendChild(new IframePopinSocialFeedZView(data).borrow())}return jQuery(document).on("popin-trigger:close",onPopinCloseJq),next()}function onPopinCloseJq(e){mediaContainer&&mediaContainer.querySelector("video")&&mediaContainer.querySelector("video").pause()}self.query("buttonContainer").appendChild(new ShowMoreButtonZview({text:locales.loadMore}).borrow()),popinView=new PopinView,checkPopinHeight=underscore.debounce(onWindowResize,300),popinView.on("close",function(){events.eventRouter.trigger(events.socialFeedRemovePopinEvents),document.querySelector("html").style.overflow="auto","none"===document.querySelector(".rlx-social-feed__mosaic-link").style.pointerEvents&&events.eventRouter.trigger(events.socialFeedToggleDisableClick),env.mobile||window.removeEventListener("resize",checkPopinHeight),env.tablet&&unlockScroll(),document.querySelector(".rlx-popin-container")&&document.querySelector(".rlx-social-feed__popin--scroll-control").classList.remove("rlx-social-feed__popin--scroll-control"),jQuery(document).off("popin-trigger:close",onPopinCloseJq)}),popinView.on("open",function(){var Anim,overlayActived;jQuery(".rlx-social-feed__popin").find("video").length&&jQuery(".rlx-social-feed__popin").find("video")[0].play(),env.tablet&&(Anim=new Animate,overlayActived=jQuery(".rlx-social-feed__list").find("a[overlay=true]").get(),overlayActived.length&&(overlayActived[0].removeAttribute("overlay"),Anim.fadeOut(overlayActived[0].children[0])))}),events.eventRouter.on(events.socialFeedLoadData,onload),events.eventRouter.on(events.socialFeedLoadMore,onloadmore),events.eventRouter.on(events.socialFeedRemoveMoreButton,onoversize),events.eventRouter.on(events.socialFeedButtonSpinner,onloadspinner),events.eventRouter.on(events.socialFeedButtonRemoveSpinner,removespinnner),events.eventRouter.on(events.socialFeedOpenPopin,onopenpopin),events.eventRouter.on(events.socialFeedCloseMobilePopin,onclosemobilepopin),events.eventRouter.on(events.socialFeedLoadWatchData,onloaddata),events.eventRouter.on(events.socialFeedSwapLoaderPopin,onswaploader),events.eventRouter.on(events.socialFeedToggleDisableClick,ontogglepointerevents),events.eventRouter.on(events.socialFeedLoadVideoAfterPopinCreation,onAddVideoElement),events.eventRouter.on(events.appWillRender,onkillApp),events.eventRouter.trigger(events.socialFeedLoadData)}(this)},_template:env.mobile?"div.rlx-social-feed__changeBox@head                                                   + ul.rlx-social-feed__list@container                                                   + div.rlx-social-feed__button-container@buttonContainer                                                   + div.rlx-social-feed__popin-mobile@mobile":"div.rlx-social-feed__changeBox@head                                                   + ul.rlx-social-feed__list@container                                                   + div.rlx-social-feed__button-container@buttonContainer",preloadPic:function(urlToLoad){return new PromiseK(function(resolve,reject,img){img=new Image,img.onload=function(){resolve(null)},img.onerror=function(){resolve(null)},img.src=urlToLoad})},constructS7Url:function(model,type,self,base,main,preset){switch(self=this,base=model.get("watch.scene7.main_url"),main=model.get("watch.watch.s7_url_main"),type){case"main":preset=model.get("watch.scene7.grid_img");break;case"retina":preset=model.get("watch.scene7.grid_img_r");break;case"mobile":preset=model.get("watch.scene7.grid_img_m")}return[base,main,preset].join("")},createPopin:function(Model,self,xhrWatchWS,tagRMC,watchData){function onwatchsuccess(response){response&&(watchData=JSON.parse(JSON.stringify(response)))}function onloadpopin(url_image){watchData&&watchData.hasOwnProperty("watch")?(Model.set("watch",watchData),url_image=self.constructS7Url(Model,env.mobile?"mobile":window.devicePixelRatio>1?"retina":"main"),self.preloadPic(url_image).then(openPopin,onerror)):openPopin(),document.getElementsByTagName("html")[0].style.overflow="hidden"}function openPopin(mobilePopinContainer,Anim,buffer){env.mobile?(Anim=new Animate,mobilePopinContainer=self.query("mobile"),mobilePopinContainer.innerHTML="",self.query("container").style.zIndex="-1",mobilePopinContainer.appendChild(new ContainerMobilePopinSocialFeedZView(Model).borrow()),Anim.fadeIn(mobilePopinContainer,".8"),mobilePopinContainer.style.zIndex="9999",document.querySelector(".rlx-social-feed-popin-loading").classList.remove("rlx-social-feed-popin-loading")):(buffer=document.createElement("div"),buffer.appendChild(new PopinContent(Model).borrow()),Popins.open(buffer).then(function(self){document.querySelector(".rlx-social-feed-popin-loading").classList.remove("rlx-social-feed-popin-loading")}),document.body.clientHeight<=document.querySelector(".rlx-popin-content").clientHeight&&document.querySelector(".rlx-popin-container").classList.add("rlx-social-feed__popin--scroll-control"))}function successloadImg(){}function onerror(e){}watchData=null,self=this,tagRMC=Model.get("tags")?Model.get("tags")[0]:null,tagRMC?(xhrWatchWS=new ApiModelbyRMC(tagRMC).getXHRObject(),all([self.preloadPic(Model.get("original_image")).then(successloadImg,onerror),xhrWatchWS.then(onwatchsuccess,onerror)]).then(onloadpopin,onerror)):self.preloadPic(Model.get("original_image")).then(onloadpopin,onerror)}}}),ContainerMobilePopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self.query("container").appendChild(new PopinMobileContent(self._model).borrow())}(this)},_template:"div.rlx-social-feed-mobile-popin__container@container"}}),ItemSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,item){item=self.query("item"),item.appendChild(new OverlaySocialFeedZView(self._model).borrow()),"youtube"===helpers.getSocialId(self._model._data.social_id)&&item.classList.add("youtube")}(this)},_template:"li.rlx-social-feed__mosaic-item.rlx-white-text@item"}}),OverlaySocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,overlay,link,jLink){function onlinkclick(e){e.preventDefault(),this.classList.add("rlx-social-feed-popin-loading"),events.eventRouter.trigger(events.socialFeedToggleDisableClick),events.eventRouter.trigger(events.socialFeedOpenPopin,self._model)}function onpreventdefault(e){e.preventDefault()}function fadeInContent(e,Anim,elem,actived,ov){e.preventDefault(),self.query("link").removeAttribute("href"),Anim=new Animate,elem=e.currentTarget,link.hasAttribute("overlay")?(link.classList.add("rlx-social-feed-popin-loading"),events.eventRouter.trigger(events.socialFeedToggleDisableClick),events.eventRouter.trigger(events.socialFeedOpenPopin,self._model)):(actived=jQuery(".rlx-social-feed__list").find("a[overlay=true]").get(),actived.length&&(actived[0].removeAttribute("overlay"),ov=actived[0].children[0],Anim.fadeOut(ov,".2")),link.setAttribute("overlay",!0),overlay&&Anim.fadeIn(overlay,".2"))}function onkillApp(next,vars){return env.mobile||env.tablet?link.removeEventListener("touchstart",touchEventBind):jLink.off("click",onlinkclick),link.removeEventListener("click",onpreventdefault),events.eventRouter.off(events.appWillRender,onkillApp),next()}if(overlay=self.query("overlay"),link=self.query("link"),jLink=self.$query("link"),overlay.appendChild(new TextSocialFeedItemZView(self._model).borrow()),link.appendChild(new ImageSocialFeedItemZView(self._model).borrow()),events.eventRouter.on(events.appWillRender,onkillApp),env.mobile||env.tablet){self.query("link").removeAttribute("href");var touchEventBind=function(e){function ontouchmove(e){var posCurrent=e.touches[0].clientY;Math.abs(posCurrent-posStart)>14&&(window.removeEventListener("touchend",ontouchend),window.removeEventListener("touchmove",ontouchmove))}function ontouchend(e){window.removeEventListener("touchmove",ontouchmove),window.removeEventListener("touchend",ontouchend),fadeInContent(e)}var posStart=e.touches[0].clientY;window.addEventListener("touchmove",ontouchmove),window.addEventListener("touchend",ontouchend)};link.addEventListener("touchstart",touchEventBind,!0),link.addEventListener("click",onpreventdefault,!1)}else jLink.on("click",onlinkclick)}(this)},_template:"a.rlx-social-feed__mosaic-link[href=$url][target=_blank]@link > .rlx-social-feed__mosaic-text@overlay"}}),TextSocialFeedItemZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,socialItemHeader,socialId,iconClass){socialItemHeader=self.query("header"),socialId=self._model._data.social_id.split("_")[0],iconClass="rlx-social-feed__mosaic-icon-"+socialId,socialItemHeader.textContent=socialId,socialItemHeader.classList.add(iconClass),self.query("viewAndShare").innerHTML=locales.viewAndShare}(this)},_template:"div.rlx-textblock.rlx-textblock-medium.rlx-textblock-separator.rlx-t-center >                   (hgroup > h1.rlx-social-feed__mosaic-icon[lang=en]@header) +                   (.rlx-links > span.rlx-fake-link@viewAndShare{VIEW AND SHARE})"}}),ImageSocialFeedItemZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,image){image=self.query("image"),image.onload=function(orientation){orientation=this.width<=this.height?"landscape":"portrait",image.classList.add(orientation)}}(this)},_template:"figure.rlx-asset > img[src=$image].rlx-social-feed__mosaic-img@image"}}),ShowMoreButtonZview=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){function onclick(e){e.preventDefault(),events.eventRouter.trigger(events.socialFeedButtonSpinner),events.eventRouter.trigger(events.socialFeedLoadMore)}function onkillApp(next,vars){return self.$query("more").off("click",onclick),events.eventRouter.off(events.appWillRender,onkillApp),next()}self.$query("more").on("click",onclick),events.eventRouter.on(events.appWillRender,onkillApp)}(this)},_template:".rlx-links > a.rlx-links__button.rlx-social-feed__show-more[href=#]{$text}@more"}}),ChangeBoxFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,name){var k,value,nameM,regex;for(k in config.name)value=config.name[k],regex=/-/gi,nameM={feedName:value,formatedName:value.replace(regex," ")},self.query("changeFeed").appendChild(new ItemChangeBoxZView(nameM).borrow())}(this)},_template:"select[name=selectFeed]@changeFeed"}}),ItemChangeBoxZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:"option [value=$feedName] {$formatedName}"}})},{"../../core/Animate":12,"../../environment":35,"../../events":36,"./PopinSocialFeedZView":6,"./config":8,"./locales":9,"./utils":11,"korbutJS/src/Promise":60}],6:[function(require,module,exports){"use strict";var PopinContainerSocialFeedZView,ContentPopinSocialFeedZView,OriginPopinSocialFeedZView,OriginLinkPopinSocialFeedZView,ImagePopinSocialFeedZView,IframePopinSocialFeedZView,VideoPopinSocialFeedZView,CommentPopinSocialFeedZView,AuthorPopinSocialFeedZView,SharePopinSocialFeedZView,ItemSharePopinSocialFeedZView,WatchPopinSocialFeedZView,ImageWatchPopinSocialFeedZView,TextWatchPopinSocialFeedZView,ZView=requirejs("lib/ZenView"),klass=requirejs("utils").classMaker,Collection=requirejs("lib/Collection"),urlMapping=requirejs("modules/rlx-urlmapping"),locales=require("./locales"),events=require("../../events"),env=require("../../environment"),helpers=require("./utils").utils,Animate=require("../../core/Animate").Animate,sessionStorage=new requirejs("modules/rlx-storage").sessionStorage,PopinSocialFeedZView=module.exports.PopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.mainPopinClass=env.mobile?".rlx-social-feed-mobile-popin__container":".rlx-popin-content",statics.nextPopinClass=".rlx-social-feed__next-popin",void function(self,socialDatas){function onwillrender(next,vars){return events.eventRouter.off(events.socialFeedSwapContentPopin,onswapcontent),events.eventRouter.off(events.socialFeedRemovePopinEvents,onwillrender),next()}function onswapcontent(next,vars,data,Anim,oldContent,newContent,isRTL,firstWay,secondWay){return Anim=new Animate,oldContent=document.querySelectorAll(".rlx-social-feed__popin")[0],newContent=document.querySelector(".rlx-social-feed__next-popin"),firstWay=RLX.isRTL?"100%":"-100%",secondWay=RLX.isRTL?"-100%":"100%",setTimeout(function(newDiv){self.updateShowingArrows(data.Model),Anim.translateX(oldContent,"0.3s",data.way?firstWay:secondWay).then(function(){Anim.fadeIn(newContent,"0.5s").then(function(nextClassClean){nextClassClean=statics.nextPopinClass.substring(1,statics.nextPopinClass.length),document.querySelector(statics.nextPopinClass).classList.remove(nextClassClean),newDiv=document.createElement("div"),newDiv.className=nextClassClean,newDiv.classList.add("rlx-social-feed__popin"),oldContent&&(oldContent.parentNode.appendChild(newDiv),oldContent.parentNode.removeChild(oldContent))})})},100),events.eventRouter.trigger(events.socialFeedSwapLoaderPopin,{active:!1}),next()}self.query("container").appendChild(new PopinContainerSocialFeedZView(self._model).borrow()),events.eventRouter.on(events.socialFeedSwapContentPopin,onswapcontent),events.eventRouter.on(events.socialFeedRemovePopinEvents,onwillrender)}(this)},_template:"div.rlx-social-feed__popin@container",loadModels:function(){return JSON.parse(sessionStorage.getItem("socialData"))},findModel:function(offset,self,modelsSaved,collection,modelSelected,post,dataAdd){function myFunction(value,index,object){collection.add(value._data)}return self=this,modelsSaved=self.loadModels(),collection=new Collection,modelsSaved._models.forEach(myFunction),modelSelected=collection.find({offset:offset}),!!modelSelected&&modelSelected},updateShowingArrows:function(Model,self,socialDatas,jNext,jPrev,offset,Anim){self=this,socialDatas=self.loadModels(),Anim=new Animate,setTimeout(function(){offset=Model.get("offset"),jNext=jQuery(".rlx-social-feed-popin__arrow-next").get(0),jPrev=jQuery(".rlx-social-feed-popin__arrow-prev").get(0),offset>0&&offset<socialDatas._models.length-1?(Anim.fadeIn(jPrev,"0.2s"),Anim.fadeIn(jNext,"0.2s")):0==offset?(Anim.fadeOut(jPrev,"0.2s"),Anim.fadeIn(jNext,"0.2s")):offset==socialDatas._models.length-1&&(Anim.fadeIn(jPrev,"0.2s"),Anim.fadeOut(jNext,"0.2s"))},100)}}});module.exports.PopinMobileSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self.query("container").appendChild(new PopinSocialFeedZView(self._model).borrow()),self.query("close").addEventListener("touchstart",function(e){events.eventRouter.trigger(events.socialFeedCloseMobilePopin,self._model)})}(this)},_template:"div.rlx-nextpopin@new                             + div.rlx-social-feed__popin--mobile-wrapper                             > (button.rlx-btn-close@close > span{close})                             + div.rlx-container@container"}}),PopinContainerSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){self.query("content").appendChild(new ContentPopinSocialFeedZView(self._model).borrow()),self.query("share").appendChild(new SharePopinSocialFeedZView(self._model).borrow()),self.query("watch").style.height="0",self._model.get("watch.watch.rmc")&&(self.query("watch").appendChild(new WatchPopinSocialFeedZView(self._model).borrow()),self.query("watch").style.height="230px")}(this)},_template:"div.rlx-social-feed__popin-container@content + div.rlx-social-feed__popin-share@share + div.rlx-social-feed__popin-watch@watch"}}),ContentPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,socialDatas,checkVideo,modelEvent){checkVideo=self.controlHaveVideoContent(self._model.get("embed")),self.query("origin").appendChild(new OriginLinkPopinSocialFeedZView(self._model).borrow()),modelEvent={case:checkVideo.case,link:2===checkVideo.case?[checkVideo.link,"?fs=1&amp;wmode=transparent"].join(""):checkVideo.link,poster:self._model.get("image")},checkVideo&&(3===checkVideo.case&&self.query("media").appendChild(new ImagePopinSocialFeedZView(self._model).borrow()),checkVideo.case<3&&setTimeout(function(){events.eventRouter.trigger(events.socialFeedLoadVideoAfterPopinCreation,modelEvent)},100)),self.query("comment").appendChild(new CommentPopinSocialFeedZView(self._model).borrow()),self.query("author").appendChild(new AuthorPopinSocialFeedZView(self._model).borrow())}(this)},_template:"div.rlx-social-feed__popin-header@origin +                             div.rlx-social-feed__popin-media@media +                             div.rlx-social-feed__popin-comment@comment +                             div.rlx-social-feed__popin-author@author",controlHaveVideoContent:function(embedData,self,link,case_vid,json){return self=this,embedData?(link=embedData.indexOf("html")>-1?JSON.parse(embedData).html:embedData?embedData:null,case_vid=link.indexOf("mp4")>-1?1:link.indexOf("embed")>-1?2:3,json={case:case_vid,link:link.substring(parseInt(link.indexOf(":")+1,10),link.length)}):json={case:3},json}}}),OriginPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,socialNetwork,socialId,iconClass){socialNetwork=self.query("network"),socialId=helpers.getSocialId(self._model._data.social_id),iconClass="rlx-social-feed__popin-header-icon-"+socialId,socialNetwork.textContent=socialId,socialNetwork.classList.add(iconClass)}(this)},_template:"span > { from } + span.rlx-social-feed__popin-header-icon[lang=en]@network"}}),OriginLinkPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,socialNetwork,socialId,iconClass){self.query("link").appendChild(new OriginPopinSocialFeedZView(self._model).borrow())}(this)},_template:"a[href=$url][target=_blank]@link"}}),ImagePopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){env.mobile&&self.query("img").setAttribute("src",self._model.get("image"))}(this)},_template:"a[href=$url][target=_blank] > img[src=$original_image]@img"}}),IframePopinSocialFeedZView=module.exports.IframePopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){setTimeout(function(){document.querySelector(".rlx-social-feed__popin--iframe").setAttribute("src",self._model.get("link"))},150)}(this)},_template:"iframe.rlx-social-feed__popin--iframe[frameborder=0][allowfullscreen=true]@iframe"}}),VideoPopinSocialFeedZView=module.exports.VideoPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){}(this)},_template:env.touch?"video[src=$link][controls=true][loop=true][poster=$poster].rlx-social-feed__video@video":"video[src=$link][loop=true][poster=$poster].rlx-social-feed__video@video"}}),CommentPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){}(this)},_template:"p > {$title}"}}),AuthorPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,author){author=JSON.parse(self._model.get("author")),self.query("author").innerHTML=author.username,self.query("author").setAttribute("href",author.link)}(this)},_template:"div > span{posted by:} + a@author[target=_blank][lang=en]"}}),SharePopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data,url,title,image,zone,author,linkProfile,sharingData,hashtags,isZoneA,socialModel,base,rmcWatch,mNameWatch,hasMoreData){function modelFunction(value){hasMoreData&&(value.rmc=rmcWatch.toUpperCase(),value.family=mNameWatch.toLowerCase()),isZoneA!=value.zoned&&self.query("sharing").appendChild(new ItemSharePopinSocialFeedZView(value).borrow())}url=self._model.get("url"),title=encodeURI(self._model.get("title")),zone=RLX.device.country&&RLX.device.country.zone?RLX.device.country.zone:"",isZoneA="zone_a"===zone,hashtags=title.indexOf("#")>-1?self.getHashtags(title):null,image=self._model.get("original_image"),base="watch.watch",rmcWatch=self._model.get([base,".rmc"].join("")),mNameWatch=self._model.get([base,".modelName"].join("")),hasMoreData=!!rmcWatch,sharingData=[{name:"facebook",url:urlMapping("facebook",url,title),zoned:!0},{name:"twitter",url:[urlMapping("twitter",url,hashtags?hashtags.text:title),hashtags?"&hashtags="+hashtags.hash:""].join(""),zoned:!0},{name:"google-plus",url:urlMapping("google-plus",url,title),zoned:!0},{name:"linkedin",url:urlMapping("linkedin",url,title,"",""),zoned:!0},{name:"pinterest",url:urlMapping("pinterest",url,"",title,"",image),zoned:!0},{name:"weibo",url:urlMapping("weibo",url,title,"","",image,""),zoned:!1},{name:"tencent",url:urlMapping("tencent",url,title,"","",image),zoned:!1},{name:"qq",url:urlMapping("qq",url,title,"","",image,""),zoned:!1},{name:"douban",url:urlMapping("douban",url,title),zoned:!1}],sharingData.forEach(modelFunction)}(this)},_template:"div.rlx-share.rlx-popup@sharing > a.rlx-share__item.rlx-share__social.rlx-icon.rlx-icon--share",getHashtags:function(title,self,arrSplited,hash,arrHash){function hashFunction(value){arrSplited.push(self.removeSpace(value))}return self=this,arrHash=[],title=decodeURI(title),arrSplited=title.split("#"),arrSplited.forEach(hashFunction),{text:encodeURI(arrSplited.slice(0,1)),hash:arrHash.slice(1,arrHash.length).join(",")}},removeSpace:function(text){return text.replace(/\s+/g,"")}}}),ItemSharePopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){self._model.get("rmc")&&(self.root().setAttribute("data-product-id",self._model.get("rmc")),self.root().setAttribute("data-product-category",self._model.get("family")),self.root().classList.add("wa-share-product"))}(this)},_template:"a.rlx-share__item.rlx-share__$name.rlx-icon.rlx-icon--$name.wa-tracking-share[href=$url][target=_blank][data-platform=$name]"}}),WatchPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,subModel){subModel={image:env.mobile?self.constructUrlS7("mobile"):self.constructUrlS7("main"),image_r:self.constructUrlS7("retina"),familyName:self._model.get("watch.watch.familyName"),collection:self._model.get("watch.watch.collection"),pageLink:self._model.get("watch.watch.page_link"),discover:locales.discover},self.query("imageContainer").appendChild(new ImageWatchPopinSocialFeedZView(subModel).borrow()),self.query("textContainer").appendChild(new TextWatchPopinSocialFeedZView(subModel).borrow())}(this)},_template:"div.rlx-social-feed__popin-watch--image-container@imageContainer                             + div.rlx-social-feed__popin-watch--text-container@textContainer",constructUrlS7:function(type,self,base,main,preset){switch(self=this,base=self._model.get("watch.scene7.main_url"),main=self._model.get("watch.watch.s7_url_main"),type){case"main":preset=self._model.get("watch.scene7.grid_img");break;case"retina":preset=self._model.get("watch.scene7.grid_img_r");break;case"mobile":preset=self._model.get("watch.scene7.grid_img_m")}return[base,main,preset].join("")}}}),ImageWatchPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){}(this)},_template:env.mobile?"a[href=$pageLink] > img[src=$image]":"a[href=$pageLink] > img[src=$image][srcset=$image_r 2x]"}}),TextWatchPopinSocialFeedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,data){}(this)},_template:".rlx-social-feed__popin-watch--textblock                             > h2{$collection} + h3{$familyName}                             + .rlx-links > a.rlx-links__button[href=$pageLink]{$discover}"}})},{"../../core/Animate":12,"../../environment":35,"../../events":36,"./locales":9,"./utils":11}],7:[function(require,module,exports){"use strict";var singleton=requirejs("utils").singleton,requestAnimationFrame=requirejs("utils").requestAnimationFrame,ZView=requirejs("lib/ZenView"),AppEventRouter=requirejs("lib/SAppEventRouter").SAppEventRouter,eventRouter=new AppEventRouter,events=AppEventRouter.events;module.exports.SAppSocialFeed=singleton(ZView,function(Super,statics){return{constructor:function(){Super.call(this),void function(self){requestAnimationFrame(function(){eventRouter.dispatch(events.appZViewInitialSwap,self)})}(this)},_template:"#social-feed-app > div.rlx-social-feed__container@main"}})},{}],8:[function(require,module,exports){"use strict";var checkAttribute,selectedFeed,env=require("../../environment"),sessionStorage=new requirejs("modules/rlx-storage").sessionStorage,anchorDOM="socialFeedApp",namesOfFeed=["evian-championship","wimbledon-championships-2016","social-media-feed","social-embed-2016","wimbledon-championships-2015"],appDom=document.getElementById(anchorDOM);appDom&&(checkAttribute=appDom.attributes["data-feedname"],selectedFeed=checkAttribute?checkAttribute.value:namesOfFeed[0],module.exports={name:selectedFeed,sizeStartLoad:env.mobile?9:8,sizeNewLoad:env.mobile?9:16,multipleFeed:!1,apiUrl:"https://api.tintup.com/v1/feed",apiKey:"NmViMGE3Zjc2YjhhN2ZkMTc0YTYwNTg3ZTUxMDY4MDU3ZTBjMmYwYw==",startOffset:sessionStorage.getItem("lastOffset"),idDOM:anchorDOM})},{"../../environment":35}],9:[function(require,module,exports){"use strict";var i18n=requirejs("i18n");module.exports={loadMore:i18n("share/load-more"),discover:i18n("website/discover-this-model"),viewAndShare:i18n("share/view-and-share")}},{}],10:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),AppSocialFeed=require("./SAppSocialFeed").SAppSocialFeed,ContainerSocialFeedZView=require("./ContainerSocialFeedZView").ContainerSocialFeedZView,ApiRequestEngine=require("./utils").ApiRequestEngine,env=require("../../environment"),events=require("../../events"),locales=require("./locales"),Utils=require("./utils").utils;module.exports.SocialEmbedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,app,parent,config){function ondata(next,vars,resp,datas){return events.eventRouter.off(events.socialFeedDataReady,ondata),datas={locales:locales,data:resp._models},"attachEvent"in window||"msSetImmediate"in window?setTimeout(function(){parent.appendChild(new ContainerSocialFeedZView(datas).borrow())},1):parent.appendChild(new ContainerSocialFeedZView(datas).borrow()),app.innerHTML="",app.classList.add("rlx-social-feed-tint--ready"),app.appendChild(parent),events.eventRouter.trigger(events.socialFeedDomReady),next()}function ondomready(next,vars){var j,value,index,rowNumber,listItemsNodeList=jQuery(".rlx-social-feed__mosaic-item").not(".rlx-social-feed__mosaic-row"),listItemsArray=Array.prototype.slice.call(listItemsNodeList);for(j in listItemsArray)value=listItemsArray[j],index=j,rowNumber=env.mobile?index<3?1:index<6?2:3:index<4?1:index<8?2:index<12?3:4,value.classList.add("rlx-social-feed__mosaic-row","rlx-social-feed__mosaic-row-"+rowNumber);return next()}function onkillApp(next,vars){return parent.innerHTML="",events.eventRouter.off(events.socialFeedDataReady,ondata),events.eventRouter.off(events.socialFeedDomReady,ondomready),events.eventRouter.off(events.appWillRender,onkillApp),next()}config=require("./config"),parent=(new AppSocialFeed).query("main"),app=document.getElementById(config.idDOM),Utils.checkZone()&&app&&(events.eventRouter.on(events.socialFeedDataReady,ondata),events.eventRouter.on(events.socialFeedDomReady,ondomready),events.eventRouter.on(events.appWillRender,onkillApp),new ApiRequestEngine)}(this)}}})},{"../../environment":35,"../../events":36,"./ContainerSocialFeedZView":5,"./SAppSocialFeed":7,"./config":8,"./locales":9,"./utils":11}],11:[function(require,module,exports){"use strict";var tools,klass=requirejs("utils").classMaker,XHR=require("../../core/XHR").XHR,XHRp=new require("../../core/XHR").XHR.JSONP,events=require("../../events"),PromiseK=require("korbutJS/src/Promise").Promise,all=require("korbutJS/src/Promise").Promise.all,Collection=requirejs("lib/Collection"),config=require("./config"),urlMapping=requirejs("modules/rlx-urlmapping"),sessionStorage=new requirejs("modules/rlx-storage").sessionStorage;sessionStorage.removeItem("lastOffset"),sessionStorage.removeItem("socialData"),sessionStorage.removeItem("wait"),sessionStorage.removeItem("pageYBlock"),module.exports.ApiRequestEngine=klass(function(Super,statics){return{constructor:function(feedName,count,offsetStart){statics.urlBaseTintAPI=config.apiUrl,statics.apiKey=tools.decodeKey(config.apiKey),statics.feedName=feedName||config.name,statics.feedSize=count||config.sizeStartLoad,statics.lengthToReload=0,statics.offsetStart=offsetStart||null,statics.completeData=null,statics.overSize=!1,void function(self,url){function onerror(err){}sessionStorage.removeItem("lastOffset"),self.getJson().then(function(response){statics.feedSize>response.data.length&&(statics.overSize=!0),self.manageData(response)},onerror)}(this)},manageData:function(response,self,arr){self=this,response.data.length>0?self.recursiveData(response.data):events.eventRouter.trigger(events.socialFeedRemoveMoreButton)},recursiveData:function(resp,exclude,self,d,arr,cleanM,lastItem,lastOffset,renewUrl){function onSuccess(exclude){events.eventRouter.trigger(events.socialFeedButtonSpinner),cleanM=self.cleanModel(resp,exclude),null==statics.completeData?statics.completeData=cleanM:(statics.completeData.add(cleanM._models),sessionStorage.setItem("lastOffset",parseInt(sessionStorage.getItem("lastOffset"),10)+cleanM.length())),lastItem=parseInt(cleanM.length()-1,10),lastOffset=parseInt(cleanM.item(lastItem).get("offset"),10)+1,lastOffset<statics.feedsize&&(lastOffset=statics.feedsize),sessionStorage.setItem("lastOffset",lastOffset),statics.completeData.length()<statics.feedSize&&!statics.overSize?(renewUrl=self.generateUrlWS(lastOffset,statics.lengthToReload),self.getJson(renewUrl).then(function(response){self.recursiveData(response.data)},onerror)):(self.sendData(statics.completeData),events.eventRouter.trigger(events.socialFeedButtonRemoveSpinner),statics.overSize&&events.eventRouter.trigger(events.socialFeedRemoveMoreButton))}self=this,arr=[];for(var l in resp)arr.push(self.controlData(resp[l]));all(arr).then(onSuccess,onerror)},generateUrlWS:function(offset,size){return[statics.urlBaseTintAPI,"/",statics.feedName,"?api_token=",statics.apiKey,size||statics.feedSize?"&count="+(size||statics.feedSize):"",offset||statics.offsetStart?"&offset="+(offset||offset||statics.offsetStart):""].join("");
},generateNextUrl:function(nextUrl){},changeFeed:function(){},getJson:function(newUrl,self,url){return self=this,url=newUrl||self.generateUrlWS(),XHRp(url,{},"callback")},controlData:function(item,self,lengthToReload){return self=this,self.controlSrc(item.image,item.offset)},controlSrc:function(urlImg,offset){return new PromiseK(function(resolve,reject){var img=new Image;img.src=urlImg,img.onload=function(){resolve(null)},img.onerror=function(){statics.lengthToReload=statics.lengthToReload+1,resolve(offset)}})},cleanModel:function(Model,arrToClean,self,offsetToRemove,index,yolo,m){self=this,offsetToRemove=self.cleanArray(arrToClean),yolo=new Collection(Model);for(m in offsetToRemove)yolo.remove(yolo.find({offset:offsetToRemove[m]}));return yolo},cleanArray:function(arr){for(var a=0;a<arr.length;a++)"number"!=typeof arr[a]&&(arr.splice(a,1),a--);return arr},sendData:function(data,self){self=this,self.saveData(data),null==statics.offsetStart?events.eventRouter.trigger(events.socialFeedDataReady,data):events.eventRouter.trigger(events.socialFeedLoadData,data)},saveData:function(data,sData,sDataParsed,model,collection,post){if(sData=sessionStorage.getItem("socialData")){sDataParsed=JSON.parse(sData),collection=new Collection;for(var post=0;post<sDataParsed._models.length;post++)collection.add(sDataParsed._models[post]._data);collection.add(data._models),sData=JSON.stringify(collection),sessionStorage.setItem("socialData",sData)}else sessionStorage.setItem("socialData",JSON.stringify(data))}}}),module.exports.ApiModelbyRMC=klass(function(Super,statics){return{constructor:function(rmc,mode){statics.urlWS=urlMapping("json-social-feed-path"),statics.xhr=null,void function(self,data){return!!rmc&&void("string"==typeof rmc&&(mode?self.sendData(self.getJson(rmc)):statics.xhr=self.getJson(rmc)))}(this)},getJson:function(rmc,self,url){return self=this,!(!rmc||"string"!=typeof rmc)&&(url=[statics.urlWS,"?rmc=",rmc].join(""),new XHR(url))},sendData:function(xhr){xhr.then(function(response){events.eventRouter.trigger(events.socialFeedLoadWatchData,response)})},getXHRObject:function(){return statics.xhr}}}),tools=module.exports.utils={getSocialId:function(string,socialID){return string&&(socialID=string.split("_")[0]),socialID},decodeKey:function(key){return"undefined"!=typeof key&&atob(key)},checkZone:function(zone,targetZone,socialID,idDom){return zone=window.ClientContext.get("geolocation").data.areaName,!zone||(targetZone=zone.split("_")[1],"a"!==targetZone||(idDom=["#",config.idDOM].join(""),socialID=document.querySelector(idDom),socialID&&socialID.parentNode&&jQuery(socialID.parentNode).remove(),!1))}}},{"../../core/XHR":22,"../../events":36,"./config":8,"korbutJS/src/Promise":60}],12:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,transition=requirejs("modules/rlx-transition");module.exports.Animate=klass(function(Super,statics){return{constructor:function(){void function(self){}(this)},_fade:function(o,s,t){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,t="number"!=typeof t?parseFloat(t,10):t,transition.animate(o,{opacity:{to:t,transition:s}})},_translate:function(o,s,t){return"array"==typeof t&&t.join(","),transition.animate(o,{transform:{transition:s,to:"translate3d("+t+")"}})},translateX:function(o,s,t){return this._translate(o,s,[t,0,0])},translateY:function(o,s,t){return this._translate(o,s,[0,t,0])},fadeIn:function(o,s,t){return s="undefined"==typeof s?".4":s,t="undefined"==typeof t?1:t,this._fade(o,s,t)},fadeOut:function(o,s,t){return s="undefined"==typeof s?".4":s,t="undefined"==typeof t?0:t,this._fade(o,s,t)},height:function(o,s,u,t,unit){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,unit="undefined"==typeof u?"px":u,t="string"!=typeof t?t+"":t,t=t.indexOf(unit)===-1?parseInt(t,10)+unit:t,transition.animate(o,{height:{to:t,transition:s}})},top:function(o,s,t){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,t=t.indexOf("px")===-1?parseInt(t,10)+"px":t,transition.animate(o,{top:{to:t,transition:s}})},scrollTo:function(s,t,way,i,inc,posStart,easing,self){function setScroll(i){window.scrollTo(0,i)}self=this,easing=self.easing(),i=0,inc=5,way="undefined"==typeof way?0:way,posStart=function(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop},way&&(i=posStart(),inc*=-1),void function animloop(delta,pos,start,control){return start=posStart(),control=way?i>t:i<t,control&&i!==t?(i+=inc,delta=way?i-start:t-start,pos=easing.easeInOutCubic(i,start,delta,s),window.requestAnimationFrame(animloop),setScroll(pos),void 0):void window.cancelAnimationFrame(animloop)}()},easing:function(){return{easeInOutQuart:function(t,b,c,d){return t/=d/2,t<1?c/2*t*t*t*t+b:(t-=2,-c/2*(t*t*t*t-2)+b)},easeInOutCubic:function(t,b,c,d){return t/=d/2,t<1?c/2*t*t*t+b:(t-=2,c/2*(t*t*t+2)+b)}}}}})},{}],13:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,EE=requirejs("utils").EE,Promise=require("korbutJS/src/Promise").Promise,geoTimeout=(RLX.promises.gmapDFD,1e4),geoOptions={enableHighAccuracy:!1,timeout:geoTimeout,maximumAge:0};module.exports.Geolocation=klass(EE,function(Super,statics){return{constructor:function(){return function(self){return self._promise=new Promise(function(resolve,reject,geoFailSafe){function geoSuccess(pos){clearTimeout(geoFailSafe),resolve(pos)}function geoError(err){clearTimeout(geoFailSafe),reject(new Error(err.message))}navigator.geolocation.getCurrentPosition(geoSuccess,geoError,geoOptions),geoFailSafe=setTimeout(function(){reject(new Error("Geolocating timeout"))},geoTimeout+500)}),self.then=self._promise.then,self.catch=self._promise.catch,self._promise}(this)}}})},{"korbutJS/src/Promise":60}],14:[function(require,module,exports){"use strict";var env=require("../environment");module.exports={ImageLoad:function(config,o,attr,target,img,rTarget,cb,cssClass,attributeNode,attributeValue,parent){o=config||{},attr=o.attributeName||"data-load-type",target=o.target||".rlx-preload-img",parent=o.context||!1,cssClass=o.addToCSSclass||!1,cb="function"==typeof o.callback?o.callback:null,rTarget=parent.querySelectorAll(target).length?parent.querySelectorAll(target)[0]:parent.classList.contains(target.substring(1,target.length))?parent:void 0,parent&&(img=new Image,img.src=o.imageSrc,img.onload=function(){if(attributeNode=parent.attributes[attr],"undefined"!=typeof attributeNode)switch(attributeValue=attributeNode.value,env.mobile&&(attributeValue="image"),env.mobile&&rTarget.classList.contains("rlx-image-placeholder")&&rTarget.classList.remove("rlx-image-placeholder"),attributeValue){case"background":rTarget.style["background-image"]=["url('",o.imageSrc,"')"].join("");break;case"image":rTarget.appendChild(img);break;default:return}else rTarget.appendChild(img);cb&&cb.call(this),cssClass&&parent.classList.add(cssClass),RLX.GLOBALS.DOM.jDoc.trigger("images-loaded")})}}},{"../environment":35}],15:[function(require,module,exports){"use strict";module.exports.ImagePlaceholder=function(config,percent,o){function convertInPx(value){return[parseInt(value,10),"px"].join("")}o=config||{},o.responsive=o.responsive||!1,"true"===o.responsive||o.responsive===!0?(percent=parseInt(o.imageHeight/o.imageWidth*100,10),o.noSet||(o.placeholder.style.paddingBottom=[percent,"%"].join("")),o.placeholder.setAttribute("data-imageWidth",o.imageWidth),o.placeholder.setAttribute("data-imageHeight",o.imageHeight)):(o.placeholder.style.height=convertInPx(o.imageHeight),o.placeholder.style.width=convertInPx(o.imageWidth))}},{}],16:[function(require,module,exports){var klass=requirejs("utils").classMaker;module.exports.MDom=klass(function(statics){return{constructor:function(el){return!(arguments.length<1||"object"!=typeof el)&&void(this.elem=el[0]?el[0]:el)},addClass:function(c){this.elem.classList?this.elem.classList.add(c):this.elem.className+=" "+c},removeClass:function(c){this.elem.classList?this.elem.classList.remove(c):this.elem.className=this.elem.className.replace(new RegExp("(^|\\b)"+c.split(" ").join("|")+"(\\b|$)","gi")," ")},hasClass:function(c){return this.elem.classList?this.elem.classList.contains(c):new RegExp("(^| )"+this.elem.className+"( |$)","gi").test(c)},toggleClass:function(c){this.hasClass(c)?this.removeClass(c):this.addClass(c)},updatePropertyCss:function(prop,value){this.elem.style[prop]=value},next:function(){return this.elem.nextSibling},prev:function(){return this.elem.previousSibling},urlUtils:function(url){var aTag=document.createElement("a");return aTag.href=url,{domain:aTag.hostname,path:aTag.pathname,hash:aTag.hash,param:aTag.search}}}})},{}],17:[function(require,module,exports){"use strict";var EE=requirejs("utils").EE,klass=requirejs("utils").classMaker;module.exports.Route=klass(EE,function(Super,statics){function hackHandler(fn){return fn}return statics.envs=["publish","m-publish","author","m-author"],statics.devices=["desktop","tablet","mobile"],{constructor:function(dict){dict=dict&&dict.constructor===Object?dict:{},dict.path=dict.path&&dict.path.constructor===Object?dict.path:{},dict.handler=dict.handler&&dict.handler.constructor===Object?dict.handler:{},void function(self,i,l,env,dev,wild){for(self.path={},self.handleRoute={},i=0,l=module.exports.Route.envs.length;i<l;i++)env=module.exports.Route.envs[i],self.path[env]="string"==typeof dict.path[env]?dict.path[env]:Object.prototype.toString.call(dict.path[env]);for(i=0,l=module.exports.Route.devices.length;i<l;i++)dev=module.exports.Route.devices[i],self.handleRoute[dev]="function"==typeof dict.handler[dev]?hackHandler(dict.handler[dev]):function(next,vars,response){return next(!1)}}(this)}}})},{}],18:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,events=require("../events"),wrapP=jQuery.Deferred().resolve();module.exports.SAppSequencer=klass(function(Super,statics){return{constructor:function(){void function(self){}(this)},_sequence:[],_events:[],innerMethod:[],getDfdList:function(self){return self=this,self._sequence},getEventsList:function(self){return self=this,self._events},setActions:function(obj,self,e,t,m,c){return self=this,(obj.length||"object"==typeof obj)&&(self._sequence=jQuery.map(obj,function(a){return e=a.eventName||null,t=a.timing||0,m="function"==typeof a.method?a.method:null,c="undefined"==typeof a.condition||a.condition,m&&e&&self.bindEvent(e,m),e&&self._events.push(e),self.createDefer(t,e,c,m)})),self},setInnerActions:function(obj,self,seq,pos,m,t,dfd,mod,fm,posStr){if(self=this,pos=parseInt(obj.position,10)-1,m="function"==typeof obj.method?obj.method:null,t="number"==typeof obj.timing?obj.timing:0,dfd=self.createDefer(t,"",void 0,m),mod="undefined"==typeof obj.mode?"r":obj.mode,fm=0,!dfd)return!1;if(posStr=""+pos,self.innerMethod.length)for(x in self.innerMethod)self.innerMethod[x]===posStr&&(fm=1);switch(fm||"rw"!=mod||(mod="r"),mod){case"r":self._sequence.splice(pos,0,dfd);break;case"rw":self._sequence.splice(pos,1,dfd)}fm||self.innerMethod.push(posStr)},createDefer:function(timing,eventName,condition,method,self){return self=this,function(dfd){return dfd=jQuery.Deferred(),setTimeout(function(){eventName?self.triggerEvent(eventName):method.call(),dfd.resolve()},timing),dfd}},start:function(self,dfd,arrPromise,y,onePromise){return self=this,arrPromise=self.getDfdList(),jQuery.map(arrPromise,function(promise){wrapP=wrapP.then(promise)}),wrapP},triggerEvent:function(eventName){events.eventRouter.trigger(eventName)},bindEvent:function(eventName,method){events.eventRouter.on(eventName,method)},unbindEvent:function(eventName,method){events.eventRouter.off(eventName,method)},resetEventsList:function(self){self=this,self._events.length=0}}})},{"../events":36}],19:[function(require,module,exports){"use strict";var singleton=requirejs("utils").singleton,requestAnimationFrame=requirejs("utils").requestAnimationFrame,ZView=requirejs("lib/ZenView"),env=require("../environment"),stylesheet=require("../stylesheet").stylesheet,events=require("../events"),AppEventRouter=requirejs("lib/SAppEventRouter").SAppEventRouter,eventRouter=new AppEventRouter;events=AppEventRouter.events,module.exports.SAppZView=singleton(ZView,function(Super,statics){function debug(){var observer,appZView=new module.exports.SAppZView;try{observer=new MutationObserver(function(mutations){}),observer.observe(appZView.root(),{childList:!0,subTree:!0})}catch(e){}}return statics.stylesheet=stylesheet,{constructor:function(){Super.call(this),env.debugJS&&debug(),void function(self){requestAnimationFrame(function(){eventRouter.dispatch(events.appZViewInitialSwap,self),eventRouter.dispatch(events.appZViewReady,self)})}(this)},_template:"#watch-app-root > #watch-app-main.watch-app-tree@main + #watch-app-next.watch-app-tree@next"}})},{"../environment":35,"../events":36,"../stylesheet":56}],20:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,singleton=requirejs("utils").singleton,ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),$=jQuery;module.exports.SBreadcrumbZView=singleton(ZView,function(Super,statics,bc){return bc={},statics.getByUid=function(uid){return bc[uid]&&bc[uid].instance},statics.make=function(self,view,jCol,jItems){view=view||module.exports.BreadcrumbItemZView,jCol=$(".rlx-breadcrumb"),jItems=jCol.find(".rlx-breadcrumb__item a"),jItems.each(function(i,jItem,o){jItem=$(this),o={},o.href=jItem.attr("href"),o.text=jItem.text().trim(),view?self.add(new view(o)):self.add(o)}),jCol.replaceWith(self.borrow())},{constructor:function(dict,args){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.uid=UID.uid(),dict.cursor=dict.cursor||0,args[0]=dict,ZView.apply(this,args),void function(self){bc[self.uid()]={instance:self},self._items=[]}(this)},_template:"div.rlx-breadcrumb#$uid>ol.rlx-breadcrumb__list@list",_cursor:0,uid:function(){return this._model.get("uid")},add:function(v){this._items.push(v.uid()),this.query("list").appendChild(v.borrow())},get:function(arg){if("number"==typeof arg)return module.exports.BreadcrumbItemZView.getByUid(this._items[arg])},forEach:function(cb){this._items.forEach(function(uid,i,arr){cb(module.exports.BreadcrumbItemZView.getByUid(uid),i,arr)})},reset:function(cursor){cursor=cursor||this._model.get("cursor");for(var i=this._items.length;i>cursor;i--)void function(item){"undefined"!=typeof item&&item.kill()}(this.get(i-1));this._items.splice(cursor)},empty:function(){this.forEach(function(item){item.kill()}),this._items=[]},kill:function(){this.empty(),this.recover(),delete bc[this.uid()]}}}),module.exports.BreadcrumbItemZView=klass(ZView,function(Super,statics,items){return items={},statics.getByUid=function(uid){return items[uid]&&items[uid].instance},{constructor:function(dict,args){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.className=dict.className||"",dict.uid=UID.uid(),args[0]=dict,ZView.apply(this,args),void function(self){items[self.uid()]={instance:self}}(this)},_template:"li#$uid.rlx-breadcrumb__item.rlx-breadcrumb__item--active$className>span{$text}",uid:function(){return this._model.get("uid")},kill:function(){this.recover(),delete items[this.uid()]}}}),module.exports.BreadcrumbAnchorZView=klass(module.exports.BreadcrumbItemZView,function(Super,statics){return{constructor:function(){module.exports.BreadcrumbItemZView.apply(this,arguments)},_template:"li#$uid.rlx-breadcrumb__item$className>a[href=$href].rlx-breadcrumb__link>span{$text}"}}),module.exports.BreadcrumbItemHomeZView=klass(module.exports.BreadcrumbItemZView,function(Super,statics){return{constructor:function(){module.exports.BreadcrumbItemZView.apply(this,arguments)},_template:"li#$uid.rlx-breadcrumb__item.rlx-breadcrumb__home > a[href=$href].rlx-breadcrumb__link >(span.rlx-icon.rlx-icon--home + span.rlx-u-textScreenReader{$text})"}})},{}],21:[function(require,module,exports){"use strict";function treatlang(s){return s.replace("_","-").toLowerCase()}var _=requirejs("utils"),confstoreloc=requirejs("config~dealerlocator"),XHR=require("./XHR").XHR,Promise=require("korbutJS/src/Promise").Promise,countryCode=function(CC){return"undefined"!=typeof CC&&"undefined"!=typeof CC.get&&"undefined"!=typeof CC.get("geolocation").getProperty?CC.get("geolocation").getProperty("countryCode"):null}(window.ClientContext),confObj={processData:!0,data:{langCode:treatlang(RLX.lang),brand:"RLX"}};"undefined"!=typeof countryCode&&countryCode.length&&(confObj.data.countryCodeGeofencing=countryCode),module.exports.confCSTLS=confObj,module.exports.retailersAPI={base:confstoreloc["rest-service-url"]},module.exports.retailersAPI.urls={search:module.exports.retailersAPI.base+"/app/search",establishment:module.exports.retailersAPI.base+"/app/establishment/light/jsFront",establishments:module.exports.retailersAPI.base+"/app/establishments/light/jsFront",dealer:module.exports.retailersAPI.base+"/app/dealer/light/jsFront",dealers:module.exports.retailersAPI.base+"/app/dealers/light/jsFront",init_bounding:module.exports.retailersAPI.base+"/app/establishments/initial_bounding_box",by_viewport:module.exports.retailersAPI.base+"/app/establishments/by_viewport/light",sto_countries:module.exports.retailersAPI.base+"/app/sto_place/countries",sto_regions:module.exports.retailersAPI.base+"/app/sto_place/regions",sto_cities:module.exports.retailersAPI.base+"/app/sto_place/cities",sto_districts:module.exports.retailersAPI.base+"/app/sto_place/districts",sto_bydetails:module.exports.retailersAPI.base+"/app/sto_place/country_all_details",rmc:module.exports.retailersAPI.base+"/app/rmc"},module.exports.Service=_.classMaker(_.EE,function(Super,statics){return statics.SUCCESS_EVT="service/success",statics.FAIL_EVT="service/fail",statics.WILLREQUEST_EVT="service/willrequest",statics.HASREQUESTED_EVT="service/hasrequested",statics.HASFAIL_EVT="service/hasfail",{constructor:function(href,opts,headers){this.href=href,this.opts=opts,this.headers=headers||{}},_formatter:function(res){return res},request:function(obj,url){this.trigger(statics.WILL_REQUEST,[obj]),url="";for(var k in obj)obj.hasOwnProperty(k)&&(url+=[url.length?"&":"?",k,"=",encodeURI(obj[k]).trim()].join(""));return this._req=new XHR(this.href+url,this.opts),this._req.then(function(res){this.trigger(statics.HASREQUESTED_EVT,[res?this._formatter(res):null])}.bind(this),function(err){this.trigger(statics.HASFAIL_EVT)}.bind(this)),this._req},abort:function(){"object"==typeof this._req&&"function"==typeof this._req.abort&&this._req.abort()}}}),module.exports.AutocompleteService=_.classMaker(_.EE,function(Super,statics){return statics.SUCCESS_EVT="service/success",statics.FAIL_EVT="service/fail",statics.ABORT_EVT="service/abort",statics.WILLREQUEST_EVT="service/willrequest",statics.HASREQUESTED_EVT="service/hasrequested",statics.HASFAIL_EVT="service/hasfail",{constructor:function(opts,method){Super.apply(this,arguments),this.opts=opts||{},this.method=method||"getQueryPredictions"},_formatter:function(res){return res},request:function(obj,reqnam,service){this.trigger(statics.WILL_REQUEST,[obj]),service=this.service||(this.service=new google.maps.places.AutocompleteService),reqnam="";for(var k in obj)obj.hasOwnProperty(k)&&(reqnam+=[reqnam.length?"&":"?",k,"=",encodeURI(obj[k]).trim()].join(""));return this._req=new Promise(function(resolve,reject){function onabort(){reject()}this.on(statics.ABORT_EVT,onabort),service[this.method](jQuery.extend({},this.opts,obj),function(res,status){"ZERO_RESULTS"==status&&resolve([]),"OK"!=status&&reject(res),resolve(res),this.off(statics.ABORT_EVT,onabort)}.bind(this))}.bind(this)),this._req.then(function(res){this.trigger(statics.HASREQUESTED_EVT,[res?this._formatter(res):null])}.bind(this),function(res){this.trigger(statics.HASFAIL_EVT,[res])}.bind(this)),this._req},abort:function(){this.trigger("abort")}}})},{"./XHR":22,"korbutJS/src/Promise":60}],22:[function(require,module,exports){"use strict";var Promise=require("korbutJS/src/Promise").Promise,klass=requirejs("utils").classMaker,EE=requirejs("utils").EE,ajax=jQuery.ajax,events=require("../events"),eventRouter=require("../events").eventRouter;module.exports.XHR=klass(EE,function(Super,statics){var cache={};return statics._SUCCESS=1,statics._FAIL=2,statics.JSONP=function(url,dict,cbName,jsonpdict,p){return jsonpdict={dataType:"jsonp",jsonp:cbName||"cb"},dict=jQuery.extend({},dict||{},jsonpdict),new module.exports.XHR(url,dict)},{constructor:function(url,dict,request,args){return dict=dict||{},function(self){return self.promise=new Promise(function(resolve,reject){function oncomplete(jqXHR){self.trigger("complete",jqXHR),eventRouter.dispatch(events.xhrComplete,jqXHR)}function onsuccess(data,status,jqXHR){oncomplete.bind(self,jqXHR),cache[url].status=module.exports.XHR._SUCCESS,self.trigger("success",jqXHR),eventRouter.dispatch(events.xhrSuccess,jqXHR);var typeStatus=jqXHR.status.toString().substring(0,1);return"2"===typeStatus?resolve(data):resolve(),jqXHR}function onerror(jqXHR,status,error){return oncomplete.bind(self,jqXHR),self.trigger(error,jqXHR),eventRouter.dispatch(events.xhrError,jqXHR),cache[url].status=module.exports.XHR._FAIL,reject(jqXHR),jqXHR}!cache.hasOwnProperty(url)||dict.renew?(cache[url]={request:ajax.call(null,url,dict),status:0},cache[url].request.then(onsuccess,onerror)):setTimeout(function(){cache[url].request.then(onsuccess,onerror)},4),self.abort=function(){"undefined"==typeof cache[url]||cache[url].status||(cache[url].request.abort(),delete cache[url])}}),self.then=self.promise.then,self.catch=self.promise.catch,self.promise.abort=self.abort,self.promise}(this)}}})},{"../events":36,"korbutJS/src/Promise":60}],23:[function(require,module,exports){var locales=require("../locales"),env=require("../environment");module.exports={wishlist:{page:function(json){return json},combine:function(pagedata,locales,items,data,sidebar){var a,item,priceObj;items=pagedata.wishlists[0].items;for(a in items)item=items[a],priceObj=item.price,item.sidebar={asset:env.mobile?priceObj.asset_retina:priceObj.asset,asset_retina:env.mobile?priceObj.asset:[priceObj.asset_retina," 2x"].join(""),title:priceObj.priceTitle,subtitle:priceObj.priceSubtitle,close:locales.sidebar.close,hasPrice:!!priceObj.formattedPrice,locales:{vatnotice:priceObj.vatnotice,showPrice:priceObj.showPrices,pricenotice:priceObj.pricenotice,price_onDemand:priceObj.ondemandnotice,price_policies_text:priceObj.legalnotice,title_onDemand:priceObj.ondemandtitle}};return data={json:pagedata,itemlist:items},locales={locales:locales},jQuery.extend.apply(jQuery,[!0,{},data,locales].concat(Array.prototype.slice.call(arguments,2)))},combineNoTransform:function(pagedata,locales){return locales={locales:locales},jQuery.extend.apply(jQuery,[!0,{},pagedata,locales].concat(Array.prototype.slice.call(arguments,2)))}},price:function(json){return{majesty:{mainWatch:{price:{amount:json.formattedPrice?json.formattedPrice:json.ondemandtitle,rawPrice:json.price,priceNotice:json.formattedPrice?json.pricenotice:json.ondemandnotice,vatnotice:json.vatnotice,legalNotice:json.legalnotice,showPriceState:json.showPrices,hasPrice:!!json.formattedPrice,sidebar:{asset:env.mobile?json.asset_retina:json.asset,asset_retina:env.mobile?"":[json.asset_retina," 2x"].join(""),title:json.priceTitle,subtitle:json.priceSubtitle,hasPrice:!!json.formattedPrice,showPrice:json.showPrices,close:locales.sidebar.close,locales:{rolex_watches:locales.sidebar.watchesTitle,price_policy:locales.sidebar.pricingTitle,vatnotice:json.vatnotice,pricenotice:json.pricenotice,price_onDemand:json.ondemandnotice,price_policies_text:json.legalnotice,title_onDemand:json.ondemandtitle}}},cta:{price:json.formattedPrice?json.price:"0"},wishlist:{price:json.formattedPrice?json.price:"0"}}},price:json}},configurator:function(json,arrItemLabel,cObj,path,rmc,mainVariation,short_desc,thumbUrl,configJSON){arrItemLabel=[],"string"==typeof json&&(json=JSON.parse(json)),configJSON=json.majesty,configJSON.mainWatchImageUrl=configJSON.watch.s7_url,rmc=configJSON.watch.rmc,json.editorial&&(editorialJSON=json.editorial,editorialJSON.family=configJSON.watch.family,editorialJSON.rmc=rmc),configJSON.variation&&(mainVariation=configJSON.variation[configJSON.variation[rmc.toUpperCase()]]),thumbUrl=mainVariation?mainVariation.s7_url:configJSON.watch.s7_url;for(x in configJSON.button)cObj=configJSON.button[x],"number"==typeof cObj&&"length"!==x&&arrItemLabel.push(x);return configJSON.familyTitle=configJSON.watch.family,configJSON.collection=configJSON.locale[configJSON.watch.collection],configJSON.introduction=configJSON.locale[configJSON.watch.intro],configJSON.the=configJSON.locale.ref,configJSON.referenceCode=configJSON.watch.model,short_desc=configJSON.locale.family_short_description,configJSON.CTAConfiguratorCellini={configurator:{button:configJSON.button,variation:configJSON.variation,family:configJSON.watch.family},CTAContent:{rmc:configJSON.watch.rmc,retailer:{currentLocation:locales.currentLocation},dictionary:configJSON.locale}},configJSON.mainWatch={rmc:rmc,imgMainUrl:configJSON.watch.s7_url,imgMainUrlR:[configJSON.watch.s7_url_r," 2x"].join(""),imgMainUrlThumb:thumbUrl,collection:configJSON.collection||configJSON.watch.collection,viewAllTitle:configJSON.locale.viewallfamily,familyTitle:configJSON.locale[configJSON.familyTitle]||configJSON.familyTitle,familyCode:configJSON.watch.family,familyLink:configJSON.watch.family_link,description:[configJSON.locale[configJSON.watch.model_case],"."].join(""),findRetailer:locales.findRetailer,ctaIsOpen:!1,ctaActiveButton:"",slogan:configJSON.locale[configJSON.watch.slogan],introduction:configJSON.introduction,shareThisWatch:locales.shareThisWatch,addWishlist:locales.addWishlist,viewWishlist:locales.viewWishlist,currentLocation:locales.currentLocation,socialLinks:configJSON.social_network_links,modelName:configJSON.locale[configJSON.watch.model_name],configuratorTitle:configJSON.locale.viewallfamily,hasVariations:!!configJSON.variation,showPrice:locales.showPrice,hidePrice:locales.hidePrice,watch:{imgMainUrl:configJSON.watch.s7_url,rmc:rmc,imgMainUrlR:[configJSON.watch.s7_url_r," 2x"].join(""),imgMainUrlThumb:thumbUrl,collection:configJSON.watch.collection,familyTitle:configJSON.familyTitle,description:[configJSON.locale[configJSON.watch.model_case],"."].join(""),slogan:configJSON.locale[configJSON.watch.slogan],introduction:configJSON.introduction,modelName:configJSON.locale[configJSON.watch.model_name],hasVariations:!!configJSON.variation},cta:{rmc:rmc,familyTitle:configJSON.watch.family,familyCode:configJSON.watch.family,findRetailer:locales.findRetailer,configure:locales.configureButton,hasVariations:!!configJSON.variation},retailer:{currentLocation:locales.currentLocation},wishlist:{rmc:rmc,collection:configJSON.watch.collection,familyTitle:configJSON.watch.family,locales:locales.wishlist},social:{shareTitle:locales.shareThisWatch,collection:configJSON.collection,description:configJSON.locale[configJSON.watch.model_case],social_network_links:configJSON.social_network_links,productImgWishlist:thumbUrl,rmc:rmc,family:configJSON.watch.family,modelName:configJSON.locale[configJSON.watch.model_name],short_introduction:configJSON.locale.family_short_description},locales:{slogan:configJSON.locale[configJSON.watch.slogan],shareThisWatch:locales.shareThisWatch,currentLocation:locales.currentLocation,makeItYours:locales.makeItYours,configHeader:locales.configHeader,configuratorTitle:configJSON.locale.viewallfamily,ctaBtnTxt:configJSON.watch.cta_btn?configJSON.locale[configJSON.watch.cta_btn.text]:""}},configJSON.configurator={config:{rmc:rmc,familyTitle:configJSON.familyTitle,familyLink:configJSON.watch.family_link,buttonList:arrItemLabel,button:configJSON.button,bracelet:configJSON.bracelet,model:configJSON.model,dial:configJSON.dial,variation:configJSON.variation,isOpen:!1},locales:{configuratorClose:locales.configurator.close,buttonBack:locales.configurator.buttonBack,configuratorTitle:locales.configurator.title,viewAllfamilyTitle:configJSON.locale.viewallfamily,resetConfig:locales.resetConfig,familyTitle:configJSON.familyTitle,variationsLabels:{dial:configJSON.locale.dial,bracelet:configJSON.locale.bracelet,bezel:configJSON.locale.bezel,material:configJSON.locale.material,model:configJSON.locale.model},dictionary:configJSON.locale}},json},combine:function(price,config,edito){return jQuery.extend.apply(jQuery,[!0,{},price,config,edito].concat(Array.prototype.slice.call(arguments,5)))}}},{"../environment":35,"../locales":38}],24:[function(require,module,exports){"use strict";function noop(e){}var DealerAutosuggestionZView,ui=requirejs("modules/rlx-ui"),i18n=requirejs("i18n"),confdeal=requirejs("config~dealerlocator"),urlmap=requirejs("modules/rlx-urlmapping"),env=require("../environment"),SHeader=ui.SHeader,Promise=(require("../events"),require("korbutJS/src/Promise").Promise),AutosuggestionZView=require("../common/AutosuggestionZView").AutosuggestionZView,AutosuggestionListZView=require("../common/AutosuggestionZView").AutosuggestionListZView,AutosuggestionItemZView=require("../common/AutosuggestionZView").AutosuggestionItemZView,AutosuggestionAnchorZView=require("../common/AutosuggestionZView").AutosuggestionAnchorZView,Service=require("../core/Service").Service,AutocompleteService=require("../core/Service").AutocompleteService,confObj=require("../core/Service").confCSTLS,retailersAPI=require("../core/Service").retailersAPI,searchCharacterThresholdByRegion=function(arr,obj){return obj={},arr.forEach(function(item){item=item.split(":"),obj[item[0]]=item[1]}),obj}(confdeal.searchCharacterThresholdByRegion),NoResultZView=AutosuggestionListZView.extend(function(Super,statics){return{constructor:function(){Super.apply(this,arguments),this._model.set("text",i18n("/retailers/errors/could-not-find-any-match"))},_template:".rlx-autosuggestion__section.rlx-autosuggestion__section--noresults>p.rlx-autosuggestion__section-header{$text}"}}),AutosuggestionRetailerAnchorZView=AutosuggestionAnchorZView.extend(function(){return{constructor:function(){AutosuggestionAnchorZView.apply(this,arguments)},_template:"li.rlx-autosuggestion__list-item>a.rlx-autosuggestion__list-anchor.wa-retailersearch-retailername[data-retailersearch-retailername=$text][href=$href][dir=ltr]{$text}"}}),AutosuggestionServiceAnchorZView=AutosuggestionAnchorZView.extend(function(){return{constructor:function(){AutosuggestionAnchorZView.apply(this,arguments)},_template:"li.rlx-autosuggestion__list-item>a.rlx-autosuggestion__list-anchor.wa-retailersearch-retailername[data-retailersearch-retailername=$text][href=$href][dir=ltr]{$text}"}}),AutosuggestionLocationItemZView=AutosuggestionItemZView.extend(function(Super){return{constructor:function(){Super.apply(this,arguments)},_template:"li.rlx-autosuggestion__list-item.wa-retailersearch-retailerlocation[data-retailersearch-retailerlocation=$text]{$text}"}}),autosuggestionAll=new Service(retailersAPI.urls.search,confObj),autocompleteService=new AutocompleteService({types:["geocode"]},"getPlacePredictions");autosuggestionAll._formatter=function(response){var map=new Map;return"object"==typeof response.dealers&&response.dealers.length?map.set("dealers",response.dealers.map(function(item){return item.text=item.name,item.urlRolex&&""!=item.urlRolex?item.href=urlmap("dealer",item.urlRolex):item.dealerId&&""!=item.dealerId?item.href=urlmap("dealer",item.dealerId):item.href="#",item})):"object"==typeof response.stores&&response.stores.length&&map.set("dealers",response.stores.map(function(item){return item.text=item.nameTranslated,item.urlRolex&&""!=item.urlRolex?item.href=urlmap("storedetail",item.urlRolex):item.dealerId&&""!=item.dealerId?item.href=urlmap("storedetail",item.dealerId):item.href="#",item})),"object"==typeof response.serviceCenters&&response.serviceCenters.length&&map.set("servicecenters",response.serviceCenters.map(function(item){return item.text=item.nameTranslated,item.urlRolex&&""!=item.urlRolex?item.href=urlmap("servicecenter",item.urlRolex):item.dealerId&&""!=item.dealerId?item.href=urlmap("servicecenter",item.dealerId):item.href="#",
item})),"object"==typeof response.autoComplete&&"object"==typeof response.autoComplete.predictions&&map.set("autoComplete",response.autoComplete.predictions.map(function(item){return item.text=item.description,item})),map},autocompleteService._formatter=function(response){var map=new Map;return response.length&&map.set("autoComplete",response.map(function(item){return item.text=item.description,item})),map},DealerAutosuggestionZView=module.exports.DealerAutosuggestionZView=AutosuggestionZView.extend(function(Super,statics){return statics.CLICK_EVT="locator/autosuggestion/click",statics.linkToLocator=function(search,locator){search.on(DealerAutosuggestionZView.CLICK_EVT,function(expanded,scrollToOffset){search.close(),env.mobile&&(scrollToOffset=jQuery(".rlx-locator__content").offset().top-SHeader.header.$(".rlx-site-nav").height(),RLX.GLOBALS.DOM.jBody.add(RLX.GLOBALS.DOM.jHTML).animate({scrollTop:scrollToOffset},200)),locator._ready.then(function(){locator.update(expanded.place_id,expanded)},noop)})},statics.make=function(hasSearch,hasPlaces,as,retailerAutosuggestionList,locationAutosuggestionList,serviceAutosuggestionList,mobTimer){function makeNoResults(section){function onnewterm(){as.off(AutosuggestionZView.EMPTY_EVT,onnewterm),section.kill()}section=new NoResultZView,as.on(AutosuggestionZView.EMPTY_EVT,onnewterm),as.query("lists").appendChild(section.borrow())}function onchange(term,allArr){autosuggestionAll.abort(),autocompleteService.abort(),as.empty(),allArr=[],hasSearch&&allArr.push(autosuggestionAll.request(jQuery.extend({query:term},hasSearch))),hasPlaces&&allArr.push(autocompleteService.request({input:term})),Promise.all(allArr).then(function(res,hasResults){hasResults=!1,"undefined"!=typeof res[0]&&(res[0].dealers&&res[0].dealers.length||res[0].stores&&res[0].stores.length||res[0].serviceCenters&&res[0].serviceCenters.length||res[0].autoComplete&&res[0].autoComplete.length)&&(hasResults=!0),"undefined"!=typeof res[1]&&res[1].length&&(hasResults=!0),hasResults||makeNoResults(),as.trigger(AutosuggestionZView.READY_EVT)},function(err){as.empty(),makeNoResults(),as.trigger(AutosuggestionZView.READY_EVT)})}function makeSection(sectionloc,itemloc,ItemZView,idx){return idx=as.addSection(),function(res){"undefined"!=typeof res&&res.length&&void function(section){function makeItem(item){function onnewterm(){as.off(AutosuggestionZView.EMPTY_EVT,onnewterm),item.off("click",onitemclick),item.kill()}function onitemclick(expanded){as.trigger(statics.CLICK_EVT,[expanded])}item=new(ItemZView||AutosuggestionItemZView)(item),section.addItem(item.uid()),section.query("list").appendChild(item.borrow()),as.on(AutosuggestionZView.EMPTY_EVT,onnewterm),item.on("click",onitemclick)}function onnewterm(){as.off(AutosuggestionZView.EMPTY_EVT,onnewterm),section.kill()}as.getSection(idx).uid=section.uid(),as.getSection(idx).root.appendChild(section.borrow()),res.forEach(makeItem),as.on(AutosuggestionZView.EMPTY_EVT,onnewterm)}(new AutosuggestionListZView(sectionloc))}}return hasSearch="object"==typeof hasSearch?hasSearch:{typeSearch:"DEALER"},hasPlaces="boolean"!=typeof hasPlaces||hasPlaces,locationAutosuggestionList=null,retailerAutosuggestionList=null,serviceAutosuggestionList=null,as=new DealerAutosuggestionZView({placeholder:i18n("retailers/locator/search-field-placeholder"),className:"rlx-autosuggestion--locator"}),(~hasSearch.typeSearch.indexOf("AUTOCOMPLETE")||hasPlaces)&&(locationAutosuggestionList=makeSection({name:i18n("search/locations"),type:"locations"},{},AutosuggestionLocationItemZView)),~hasSearch.typeSearch.indexOf("DEALER")&&(retailerAutosuggestionList=makeSection({name:i18n("search/retailers"),type:"retailers"},{},AutosuggestionRetailerAnchorZView)),~hasSearch.typeSearch.indexOf("SERVICECENTER")&&(serviceAutosuggestionList=makeSection({name:i18n("search/service-centers"),type:"services"},{},AutosuggestionServiceAnchorZView)),Modernizr.mobile||Modernizr.tablet?as.on(AutosuggestionZView.CHANGE_EVT,function(term){clearTimeout(mobTimer),mobTimer=setTimeout(function(){return function(){onchange(term)}}(term),1e3)}):as.on(AutosuggestionZView.CHANGE_EVT,onchange),autocompleteService.on(Service.HASREQUESTED_EVT,function(map){locationAutosuggestionList&&map.has("autoComplete")&&locationAutosuggestionList(map.get("autoComplete")),as.open()}),autosuggestionAll.on(Service.HASREQUESTED_EVT,function(map){retailerAutosuggestionList&&map.has("dealers")&&retailerAutosuggestionList(map.get("dealers")),serviceAutosuggestionList&&map.has("servicecenters")&&serviceAutosuggestionList(map.get("servicecenters")),locationAutosuggestionList&&map.has("autoComplete")&&locationAutosuggestionList(map.get("autoComplete")),as.open()}),as},{constructor:function(){AutosuggestionZView.apply(this,arguments)},_charlimit:searchCharacterThresholdByRegion[RLX.cqlang],export:function(){return{}},import:function(){}}})},{"../common/AutosuggestionZView":1,"../core/Service":21,"../environment":35,"../events":36,"korbutJS/src/Promise":60}],25:[function(require,module,exports){"use strict";function noop(err){}var ZView=requirejs("lib/ZenView"),_=requirejs("utils"),ui=(require("../environment"),requirejs("i18n"),requirejs("modules/rlx-ui")),events=(ui.SHeader,requirejs("lib/UID"),require("../core/XHR").XHR,require("../events")),Promise=require("korbutJS/src/Promise").Promise,Geolocation=(requirejs("modules/rlx-history"),requirejs("modules/rlx-map"),require("../core/Geolocation").Geolocation),LocatorListContainerZView=require("./LocatorListContainerZView").LocatorListContainerZView,RetailerDetailsView=(require("./RetailerZView").RetailerZView,require("./RetailerDetailsView").RetailerDetailsView),popinModule=(require("./LocatorMapUI"),requirejs("modules/rlx-popins")),OverlayZView=require("../common/OverlayZView").OverlayZView,Service=require("../core/Service").Service,confObj=require("../core/Service").confCSTLS,retailersAPI=require("../core/Service").retailersAPI,getInitialBoundingBox=new Service(retailersAPI.urls.init_bounding,confObj),byViewport=new Service(retailersAPI.urls.by_viewport,confObj),getDealers=new Service(retailersAPI.urls.establishments,confObj),hashload=(require("./LocatorMarkerModel").LocatorMarkerModel,_.unserialize(window.location.hash.slice(1).replace("/",""))),popinelem=document.getElementById("rlx-geolocation-error-popin"),countryCode=function(CC){return"undefined"!=typeof CC&&"undefined"!=typeof CC.get&&"undefined"!=typeof CC.get("geolocation").getProperty?CC.get("geolocation").getProperty("countryCode"):null}(window.ClientContext);module.exports.LocatorFallbackZView=ZView.extend(function(Super,statics){return statics.prepInitialBounding=function(self,pos,o){return o={},"object"==typeof pos&&(o=jQuery.extend({},pos)),self._model.get("dealer-name")?o.dealerName=self._model.get("dealer-name"):"dealer"==self._model.get("type")?o.establishmentType="STORE":"service"==self._model.get("type")&&(o.establishmentType="STORE,SERVICECENTER,AFFILIATE"),o.width=1e3,o.height=500,o},statics.READY_EVT="locator/ready",statics.REJECT_EVT="locator/reject",statics.KILL_EVT="locator/kill",statics.GEOLOCATION_SUCCES_EVT="locator/geolocation/success",statics.updatePageUrl=function(self,search){statics.parsePlaceDetails(self,JSON.parse(self._model.expand().places||"{}"),{hash:search||""})},statics.parsePlaceDetails=function(self,details,state){return details.state=state,state.hash=state.hash||"",self._model.get("activeMarker")&&(state.hash+=(state.hash.length?"&":"")+"retailer="+self._model.get("activeMarker")),self._model.get("near")&&(state.hash+=(state.hash.length?"&":"")+"near"),self._model.get("placeId")&&(state.hash+=(state.hash.length?"&":"")+"place="+self._model.get("placeId")),self._model.get("near")?details.near=!0:details.near=!1,self._model.set("places",JSON.stringify(details)),events.eventRouter.trigger(events.locatorPushState,{details:details,state:state}),details},statics.request=function(self,obj,hash,opt){return opt=opt||"",hash=hash||"",getInitialBoundingBox.request(obj).then(function(pos){return new Promise(function(resolve,reject){return"undefined"==typeof pos||""==pos?reject("No JSON from initial_bounding request"):("undefined"==typeof obj.placeId||"object"!=typeof pos.stoPlaceDetails||pos.stoPlaceDetails.cityName?self._model.set("placeId",0):self._model.set("placeId",obj.placeId),~opt.indexOf("near")?self._model.set("near",1):self._model.set("near",0),"undefined"!=typeof pos.stoPlaceDetails?statics.parsePlaceDetails(self,pos.stoPlaceDetails,{hash:hash||""}):events.eventRouter.trigger(events.locatorPushState,{details:{},state:{}}),void resolve(pos))})},noop)},statics.REFRESH_EVT="locator/list/refresh",{constructor:function(mdl){ZView.apply(this,arguments),void function(self){function ongeorequest(next,vars){self.disable(),self._model.get("dealer-name")||self._list.empty(),self.geolocate().then(function(){self.enable()},function(){self.enable()}),next()}function onwillrender(next,vars){events.eventRouter.off(events.appWillRender,onwillrender),events.eventRouter.off(events.requestGeolocation,ongeorequest),events.eventRouter.off(events.locatorToggle,onmaptoggle),next()}events.eventRouter.on(events.appWillRender,onwillrender),self._overlay=new OverlayZView({transition_time:"400",background:"rgba(255, 255, 255, .7)",className:"rlx-locator-overlay",opacity:"1",parent:self.query("content")}),self._list=new LocatorListContainerZView({state:1,scrollbars:mdl.get("scrollbars")||!1}),self._ready=new Promise(function(resolve,reject){function onready(){self.off(statics.READY_EVT,onready),self.off(statics.REJECT_EVT,onreject),self.off(statics.KILL_EVT,onreject),resolve()}function onreject(err){self.off(statics.READY_EVT,onready),self.off(statics.REJECT_EVT,onreject),self.off(statics.KILL_EVT,onreject),reject(err)}self.on(statics.READY_EVT,onready),self.on(statics.REJECT_EVT,onreject),self.on(statics.KILL_EVT,onreject)}).then(function(){self.enable(),events.eventRouter.on(events.requestGeolocation,ongeorequest)},function(err){}),self._model.hook("locker",function(v){return v<0?0:v}),self._model.on("change",function(k,v,old){switch(k){case"locker":v?self._overlay.show():self._overlay.hide()}}),self.disable(),self.query("content").appendChild(self._list.borrow())}(this)},_template:".rlx-locator__content@content",import:function(o){this._model.set(o.main),this._list._model.set(o.list),this._list.empty(),"object"==typeof o.retailerlist&&"function"==typeof o.retailerlist.forEach&&o.retailerlist.forEach(function(retailer){this._list.add(retailer)}.bind(this))},export:function(obj){return obj={},obj.main=this._model.expand(),delete obj.main.active,delete obj.main.uid,obj.list=this._list._model.expand(),delete obj.list.uid,obj.retailerlist=[],this._list._items.forEach(function(uid,o){o=RetailerDetailsView.getByUid(uid)._model.expand(),obj.retailerlist.push(o.store)}),obj},disable:function(){this._model.set("locker",(this._model.get("locker")||0)+1)},enable:function(){this._model.set("locker",(this._model.get("locker")||0)-1)},geolocate:function(){var self=this;return(RLX.GLOBALS.features.isMobile||"undefined"==typeof self._lastgeoloc||"undefined"!=typeof self._lastgeoloc&&!self._lastgeoloc.worked)&&(self._lastgeoloc=new Geolocation),self._lastgeoloc.then(function(pos){"undefined"==typeof pos.lat&&(pos={lat:pos.coords.latitude,lng:pos.coords.longitude}),self._lastgeoloc.worked=!0,self.showList(!1,pos)},function(){return popinelem&&popinModule.open(popinelem),self._lastgeoloc.worked=!1,statics.request(self,jQuery.extend({},statics.prepInitialBounding(self),{countryCode:countryCode}),"near")},noop).then(function(){self.enable()},function(errr){self.enable(),noop(err)}).catch(function(err){noop(err),self.enable()}),self._lastgeoloc},init:function(onloadPlace,geoloc,markers,self,p){function reject(err){self.trigger(statics.REJECT_EVT,[err])}return self=this,self._model.get("show-list")&&"undefined"!=typeof markers&&markers.forEach(function(marker){self._list.add(jQuery.extend({},marker,{showFooter:!0})),self.trigger(statics.READY_EVT)}),p="undefined"!=typeof hashload.place&&hashload.place?self.update(hashload.place):onloadPlace?self.update(onloadPlace):statics.request(self,jQuery.extend({countryCode:countryCode},statics.prepInitialBounding(self,hashload.user))),hashload.place||hashload.user||(p=p.then(function(){if(geoloc)return self.geolocate()},noop)),p.then(function(){self.trigger(statics.READY_EVT)},reject).catch(reject),self._ready},update:function(place,obj,self,p){return self=this,self.disable(),"undefined"!=typeof self._retailer&&self._retailer.hide(),obj="string"==typeof place?{placeId:place}:place,statics.request(self,jQuery.extend(statics.prepInitialBounding(self),obj)).then(function(pos){"undefined"!=typeof pos&&"undefined"!=typeof pos.stoPlaceDetails&&pos.stoPlaceDetails.regionSeoName?void function(places,o){o={},["country","region","city","district"].forEach(function(item){var seoname=item+"SeoName",name=item+"Name";places[seoname]&&(o[seoname]=places[seoname]),places[name]&&(o[name]=places[name])}),self.showList(o)}(pos.stoPlaceDetails):"object"==typeof place&&place.regionSeoName?self.showList(place,!0):self.hideList(),self.enable()},noop).catch(function(err){self.enable()})},hideList:function(){this._model.get("show-list")||this._list.empty()},showList:function(arg,fromGeolocate,self){function populate(res){res&&res.length?(res.forEach(function(store){self._list.add(jQuery.extend({},store,{showFooter:!0,showHeading:!0}))}),self._list.equalize(),LocatorListContainerZView.makeScroll(self._list),events.eventRouter.trigger(events.locatorReplaceState)):self.hideList()}if(self=this,!self._model.get("no-list")&&!self._model.get("dealer-name"))return self._list.empty(),arg&&"object"==typeof arg?function(){return"service"==self._model.get("type")?arg.establishmentType="STORE,SERVICECENTER,AFFILIATE":arg.establishmentType="STORE",getDealers.request(arg).then(populate,noop)}():statics.request(self,statics.prepInitialBounding(self,fromGeolocate?fromGeolocate:void 0)).then(function(pos,o){return o={northEastLat:pos.boundingBox.northEast.lat,northEastLng:pos.boundingBox.northEast.lng,southWestLat:pos.boundingBox.southWest.lat,southWestLng:pos.boundingBox.southWest.lng},fromGeolocate&&(o.lat=fromGeolocate.lat,o.lng=fromGeolocate.lng),"service"==self._model.get("type")?o.establishmentType="STORE,SERVICECENTER,AFFILIATE":o.establishmentType="STORE",byViewport.request(o).then(populate,noop)},noop)},kill:function(){this.trigger(statics.KILL_EVT),this._overlay.kill(),this._list.kill(),this.recover()}}})},{"../common/OverlayZView":2,"../core/Geolocation":13,"../core/Service":21,"../core/XHR":22,"../environment":35,"../events":36,"./LocatorListContainerZView":27,"./LocatorMapUI":29,"./LocatorMarkerModel":31,"./RetailerDetailsView":33,"./RetailerZView":34,"korbutJS/src/Promise":60}],26:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),events=require("../events");module.exports.LocatorGeolocationButtonZView=ZView.extend(function(Super,statics){return statics.REQUEST_EVT="geolocation/request",{constructor:function(){Super.apply(this,arguments),this.root().addEventListener("click",this._onclickhandler=function(){events.eventRouter.trigger(events.requestGeolocation),this.trigger(statics.REQUEST_EVT)}.bind(this))},_template:"button.rlx-locator__find-nearest.rlx-geolocation-trigger.wa-retailersearch-currentlocation>span.rlx-fake-link{$findNearest}",kill:function(){this.root().removeEventListener("click",this._onclickhandler)}}})},{"../events":36}],27:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),env=requirejs("lib/environment"),RetailerDetailsView=require("./RetailerDetailsView").RetailerDetailsView,Stylesheet=require("../stylesheet"),stylesheet=Stylesheet.stylesheet,cssCompat=stylesheet.cssCompat,CSS_TRANSITION_PROPERTY=Stylesheet.CSS_TRANSITION_PROPERTY;module.exports.LocatorListContainerZView=ZView.extend(function(Super,statics){return statics.SHOW_EVT="locator/list/show",statics.SHOWN_EVT="locator/list/shown",statics.HIDE_EVT="locator/list/hide",statics.HIDDEN_EVT="locator/list/hidden",statics.KILL_EVT="locator/list/kill",statics.makeScroll=function(self){self._antiscroll=self.$root().antiscroll({x:!1,y:!0,forceHorizontal:!1,forceVertical:!1,autoHide:!1,initialDisplay:!0}).data("antiscroll"),self._scrollbarcontainer=self.$root().find(".antiscroll-scrollbar-vertical").wrap('<div class="antiscroll-scrollbar-container"></div>')},statics.remScroll=function(self){self._antiscroll.destroy(),self._scrollbarcontainer.remove(),self._antiscroll.inner.css({width:"",height:""})},{constructor:function(dict,args){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.scrollbars=dict.scrollbars||!1,dict.uid=UID.uid(),dict.transition_show=dict.transition_show||this._transition_show,dict.transition_hide=dict.transition_hide||this._transition_hide,dict.transition_property=dict.transition_property||this._transition_property,dict.transition_easing=dict.transition_easing||this._transition_easing,dict.transition_time=dict.transition_time||this._transition_time,args[0]=dict,dict.scrollbars&&(this._template=".rlx-locator__retailers-list#$uid>.antiscroll-inner@content"),Super.apply(this,args),void function(self,resizetimer,wasantiscroll){function onresize(){return self.equalize(),clearTimeout(resizetimer),"undefined"==typeof self._antiscroll?wasantiscroll=!1:(statics.remScroll(self),void(resizetimer=setTimeout(function(){statics.makeScroll(self)},1e3)))}resizetimer=null,wasantiscroll=!1,self._items=[],cssCompat(function(compatTable){stylesheet.rule(["#",self.uid(),"{opacity:",dict.state,"}"].join(""),["#",self.uid()," .antiscroll-scrollbar-container{}"].join(""),function(mainCSS,scrollbarCSS){dict.scrollbars&&(mainCSS.property("margin-right",-env.scrollbarWidth+"px"),scrollbarCSS.property("right",env.scrollbarWidth+1+"px")),"number"==typeof dict.state&&dict.state?(mainCSS.property(compatTable.transform,"translateY(0)"),mainCSS.property("position","relative"),mainCSS.property(dict.transition_property,dict.transition_show)):"number"==typeof dict.state&&(mainCSS.property(compatTable.transform,"translateY(-100%)"),mainCSS.property("position","absolute"),mainCSS.property(dict.transition_property,dict.transition_hide)),mainCSS.property(CSS_TRANSITION_PROPERTY,[dict.transition_property," ",dict.transition_time,"ms ",dict.transition_easing].join("")),mainCSS.property(dict.transition_property,dict.state?dict.transition_show:dict.transition_hide),self.on(statics.SHOW_EVT,function(){clearTimeout(self._lasttransition),mainCSS.property(compatTable.transform,"translateY(0)"),self.equalize(),mainCSS.property("position","relative"),mainCSS.property(dict.transition_property,dict.transition_show),self._lasttransition=setTimeout(function(){window.addEventListener("resize",onresize),self.trigger(statics.SHOWN_EVT)},dict.transition_time)}),self.on(statics.HIDE_EVT,function(){clearTimeout(self._lasttransition),mainCSS.property(dict.transition_property,dict.transition_hide),self._lasttransition=setTimeout(function(){window.removeEventListener("resize",onresize),mainCSS.property(compatTable.transform,"translateY(-100%)"),mainCSS.property("position","absolute"),self.trigger(statics.HIDDEN_EVT)},dict.transition_time)}),self._model.on("change",function(k,v){"state"==k&&v?self.trigger(statics.SHOW_EVT):"state"!=k||v||self.trigger(statics.HIDE_EVT)}),dict.state?self.trigger(statics.SHOW_EVT):self.trigger(statics.HIDE_EVT)})})}(this)},_transition_show:"1",_transition_hide:"0",_transition_property:"opacity",_transition_easing:"ease-in-out",_transition_time:425,_template:".rlx-locator__retailers-list#$uid@content",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},add:function(o,view){view=o instanceof RetailerDetailsView?o:new RetailerDetailsView(null,jQuery.extend({wholeanchor:!0},o)),this._items.push(view.uid()),view.render(function(docfrag,obj){this.$query("content").append(docfrag),view._root=obj.query("root")}.bind(this))},equalize:function(){RLX.GLOBALS.features.isMobile||this.$query("content").find(".rlx-retailer-textblock>.rlx-wrapper").equalize()},forEach:function(handler){"function"==typeof handler&&this._items.forEach(function(uid,retailer){(retailer=RetailerDetailsView.getByUid(uid))&&handler(retailer)})},filter:function(opts){this._filters=opts,this.forEach(function(view){var i,result=!1;for(i=opts.length;i--&&!(result=function(opt){return!("function"!=typeof opts||!opts(view._model))||!!~view._model.get("tags").indexOf(opt)}(opts[i])););result?jQuery(view._root).fadeIn(200):jQuery(view._root).fadeOut(200)}),this.equalize()},empty:function(){this.forEach(function(view){view.kill()}),this.query("content").innerHTML="",this._items=[],"undefined"!=typeof this._antiscroll&&(this._antiscroll.destroy(),this._scrollbarcontainer.remove())},show:function(){this._model.set("state",1)},hide:function(){this._model.set("state",0)},kill:function(){this.empty(),this.recover(),window.removeEventListener("resize",this._onresize),this.trigger(statics.KILL_EVT)}}})},{"../stylesheet":56,"./RetailerDetailsView":33}],28:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),Collection=requirejs("lib/Collection"),LocatorMapZView=require("./LocatorMapZView").LocatorMapZView,LocatorMarkerModel=require("./LocatorMarkerModel").LocatorMarkerModel,events=require("../events"),gmap=requirejs("modules/rlx-map"),Promise=require("korbutJS/src/Promise").Promise,Stylesheet=require("../styleSheet"),ss=Stylesheet.stylesheet,getCompat=Stylesheet.getCompat,CheckboxZView=module.exports.CheckboxZView=ZView.extend(function(Super,statics){return statics.CHANGE_EVT="checkbox/change",getCompat(function(table){ss.rule(".rlx-locator-debug__checkbox{overflow:hidden;padding:.5em;margin:.5em 0;}",".rlx-locator-debug__checkbox label{display:block;}",".rlx-locator-debug__checkbox input{display:block;}")}),{constructor:function(){ZView.apply(this,arguments),void function(self){self.query("input").addEventListener("change",self._oninput=function(e){self._model.set("checked",!("checked"!=e.target.checked&&!e.target.checked))})}(this)},_template:".rlx-locator-debug__checkbox.rlx-locator-debug__row>          label[for=$slug]{$name}        + input@input[type=checkbox][name=$slug][id=$slug]"}}),SliderZView=module.exports.SliderZView=ZView.extend(function(Super,statics){return statics.CHANGE_EVT="slider/change",getCompat(function(table){ss.rule(".rlx-locator-debug__slider{overflow:hidden;padding:.5em;margin:.5em 0;}",".rlx-locator-debug__slider label{display:block;}",".rlx-locator-debug__slider input{display:inline-block;width:200px;}",".rlx-locator-debug__slider output{display:inline-block;}")}),{constructor:function(){ZView.apply(this,arguments),void function(self){self._model.on("change",function(k,v){"numvalue"==k&&(self.query("input").value=v)}),self.query("input").addEventListener("input",self._oninput=function(e){self._model.set("numvalue",+e.target.value)})}(this)},_template:".rlx-locator-debug__slider.rlx-locator-debug__row>          label[for=$slug]{$name}        + input@input[type=range][name=$slug][id=$slug][min=$min][value=$numvalue][max=$max][step=$step]        + output@ouput[for=$slug]{$numvalue}"}}),TextZView=module.exports.SliderZView=ZView.extend(function(Super,statics){return statics.CHANGE_EVT="slider/change",getCompat(function(table){ss.rule(".rlx-locator-debug__text{overflow:hidden;padding:.5em;margin:.5em 0;border:1px solid;}",".rlx-locator-debug__text label{display:block;}",".rlx-locator-debug__text button{display:block;}")}),{constructor:function(){ZView.apply(this,arguments),void function(self){self.query("but").addEventListener("click",self._onclick=function(e){eval(self.$query("textarea").val()),self.trigger(statics.CHANGE_EVT,[e])})}(this)},_template:".rlx-locator-debug__text.rlx-locator-debug__row>          label[for=$slug]{$name}        + textarea@textarea[name=$slug][id=$slug]        + button@but{UPDATE}"}});module.exports.LocatorMapDebugZView=ZView.extend(function(Super,statics){return getCompat(function(table){ss.rule(".rlx-locator-debug{position:fixed;border:1px solid;bottom:0;right:0;background:#fff;min-height:200px;z-index:1000;}",".rlx-locator-debug__row{border-bottom:1px solid;}",".rlx-locator-debug__row:last-child{border-bottom:none;}")}),{constructor:function(){ZView.apply(this),void function(self){self._zoom=new SliderZView({slug:"zoom",name:"Zoom",min:1,max:18,numvalue:12,step:1}),self._clustergrid=new SliderZView({slug:"grid",name:"Cluster grid",min:1,max:1e3,numvalue:100,step:1}),self._clustermaxzoom=new SliderZView({slug:"cluster-max-zoom",name:"Cluster max zoom",min:1,max:20,numvalue:12,step:1}),self._averagecenter=new CheckboxZView({slug:"average-center",name:"Average center",checked:!1}),self._minclustersize=new SliderZView({slug:"min-cluster-size",name:"Minimum cluster size",min:1,max:50,numvalue:2,step:1}),self.root().appendChild(self._zoom.root()),self.root().appendChild(self._clustergrid.root()),self.root().appendChild(self._clustermaxzoom.root()),self.root().appendChild(self._averagecenter.root()),self.root().appendChild(self._minclustersize.root())}(this)},_template:".rlx-locator-debug"}})},{"../events":36,"../styleSheet":55,"./LocatorMapZView":30,"./LocatorMarkerModel":31,"korbutJS/src/Promise":60}],29:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),env=require("../environment"),i18n=requirejs("i18n");module.exports.ButtonZView=ZView.extend(function(Super,statics){return statics.CHANGE_EVT="button/change",{constructor:function(dict,args){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.uid=UID.uid(),args[0]=dict,Super.apply(this,args),void function(self){dict.state?self.query("button").checked="checked":self.query("button").checked="",self._model.on("change",function(k,v){switch(k){case"state":self.trigger(statics.CHANGE_EVT,v)}}),self.query("button").addEventListener("change",self._onchangehandler=function(e){self._model.get("enabled")&&self._model.set("state",e.target.checked)})}(this)},_template:env.mobile?"li.rlx-map-ui__button.rlx-map-ui__button--$className>input[type=checkbox]#$uid@button+label[for=$uid]{$text}":"div.rlx-map-ui__button.rlx-map-ui__button--$className>input[type=checkbox]#$uid@button+label[for=$uid]{$text}",kill:function(){this.query("button").removeEventListener("change",this._onchangehandler)}}}),module.exports.TogglerZView=ZView.extend(function(Super,statics){return statics.CHANGE_EVT="toggler/change",statics.VISIBLE_CLASS=" rlx-map-ui__togglers--visible",statics.ACTIVEITEM_CLASS=" rlx-map-ui__toggler--active",{constructor:function(dict,args){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.uid=UID.uid(),"undefined"==typeof dict.state&&(dict.state=0),args[0]=dict,dict.map=i18n("retailers/locator/map"),dict.list=i18n("retailers/locator/list"),Super.apply(this,args),void function(self){function show(){Array.prototype.slice.call(self.root().querySelectorAll("input")).forEach(function(item){item.removeAttribute("disabled")}),self.root().className+=statics.VISIBLE_CLASS}function hide(){Array.prototype.slice.call(self.root().querySelectorAll("input")).forEach(function(item){item.setAttribute("disabled","disabled")}),self.root().className=self.root().className.replace(statics.VISIBLE_CLASS,"")}self._model.on("change",function(k,v){switch(k){case"active":self.trigger(statics.CHANGE_EVT,[v]),"map"==v?(self.query("listtab").className=self.query("listtab").className.replace(statics.ACTIVEITEM_CLASS,""),self.query("maptab").className+=statics.ACTIVEITEM_CLASS):(self.query("maptab").className=self.query("maptab").className.replace(statics.ACTIVEITEM_CLASS,""),self.query("listtab").className+=statics.ACTIVEITEM_CLASS);break;case"state":v?show():hide()}}),Array.prototype.slice.call(self.root().querySelectorAll("input")).forEach(function(item){item.addEventListener("change",item._handler=function(e){self._model.set("active",item.value)})}),dict.state?show():hide(),"undefined"!=typeof dict.active&&(self.query(dict.active).checked=!0)}(this)},_template:".rlx-map-ui__togglers>            (.rlx-map-ui__toggler.rlx-map-ui__toggler-map.rlx-map-ui__toggler--active@maptab>                input@map[type=radio][name=view][value=map][id=map]              + label[for=map]{$map})          + (.rlx-map-ui__toggler.rlx-map-ui__toggler-list@listtab>                input@list[type=radio][name=view][value=list][id=list]              + label[for=list]{$list})",show:function(){this._model.set("state",1)},hide:function(){this.query("map").click(),this._model.set("state",0)},kill:function(){Array.prototype.slice.call(this.root().querySelectorAll("input")).forEach(function(item){item.removeEventListener("change",item._handler)})}}})},{"../environment":35}],30:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),UID=requirejs("lib/UID"),Collection=requirejs("lib/Collection"),gmap=requirejs("modules/rlx-map"),confstoreloc=requirejs("config~dealerlocator"),Promise=require("korbutJS/src/Promise").Promise,LocatorMarkerModel=require("./LocatorMarkerModel").LocatorMarkerModel,LocatorMapDebugZView=require("./LocatorMapDebugZView").LocatorMapDebugZView,debugMode=!!~window.location.search.search(/debugstoreloc/),latlong={lat:47,lng:2},styleArray=[{featureType:"all",stylers:[{saturation:-100}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#818181"},{gamma:"1.0"},{visibility:"on"},{weight:"0.25"}]},{featureType:"administrative.country",elementType:"all",stylers:[{visibility:"on"},{weight:"0.25"}]},{featureType:"administrative.province",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{color:"#5a5a5a"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"simplified"},{color:"#696767"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"simplified"},{weight:"0.67"},{lightness:"100"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#818181"},{visibility:"on"}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:20},{color:"#f7f7f7"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:21}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"},{lightness:"5"},{color:"#e9e9e9"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#dedede"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.highway",elementType:"labels.text",stylers:[{visibility:"simplified"},{color:"#000000"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#ff0000"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{
lightness:19}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{hue:"#ff0000"},{saturation:"-100"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:17}]}],Stylesheet=require("../stylesheet"),stylesheet=Stylesheet.stylesheet,cssCompat=stylesheet.cssCompat,CSS_TRANSITION_PROPERTY=Stylesheet.CSS_TRANSITION_PROPERTY,iconversion=window.devicePixelRatio>1.5?"@2x.png":".png",mapoptions={center:latlong,styles:styleArray,mapTypeControl:!1,disableDefaultUI:!0,keyboardShortcuts:!0,clickableIcons:!1,scrollwheel:!1,zoom:12,minZoom:5,maxZoom:18},clusterOption={textSize:1,anchorText:[100,100],width:30,height:30,iconAnchor:[15,15],url:""},mcoptions={gridSize:33,maxZoom:12,minimumClusterSize:2,averageCenter:!0,ignoreHidden:!0,styles:[clusterOption]};module.exports.MarkerCollection=Collection.extend(function(){return{constructor:function(){Collection.apply(this,arguments)},export:function(){return function(self,arr){return self.forEach(function(marker){arr.push(marker._gmapmarker)}),arr}(this,[])}}}),module.exports.LocatorMapContainerZView=ZView.extend(function(Super,statics){return statics.SHOW_EVT="locator/map/show",statics.SHOWN_EVT="locator/map/shown",statics.HIDE_EVT="locator/map/hide",statics.HIDDEN_EVT="locator/map/hidden",{constructor:function(dict,args){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},dict.uid=UID.uid(),dict.transition_show=dict.transition_show||this._transition_show,dict.transition_hide=dict.transition_hide||this._transition_hide,dict.transition_property=dict.transition_property||this._transition_property,dict.transition_easing=dict.transition_easing||this._transition_easing,dict.transition_time=dict.transition_time||this._transition_time,args[0]=dict,Super.apply(this,args),void function(self){cssCompat(function(compatTable){stylesheet.rule(["#",self.uid(),"{",dict.state,"}"].join(""),function(mainCSS){"number"==typeof dict.state&&dict.state?(mainCSS.property(compatTable.transform,"translateY(0)"),mainCSS.property("position","relative"),mainCSS.property(dict.transition_property,dict.transition_show)):"number"==typeof dict.state&&(mainCSS.property("position","absolute"),mainCSS.property(dict.transition_property,dict.transition_hide),mainCSS.property(dict.transition_property,"0")),mainCSS.property(CSS_TRANSITION_PROPERTY,[dict.transition_property," ",dict.transition_time,"ms ",dict.transition_easing].join("")),mainCSS.property(dict.transition_property,dict.state?dict.transition_show:dict.transition_hide),self.on(statics.SHOW_EVT,function(){clearTimeout(self._lasttransition),mainCSS.property(compatTable.transform,"translateY(0)"),mainCSS.property("position","relative"),mainCSS.property(dict.transition_property,dict.transition_show),self._lasttransition=setTimeout(function(){self.trigger(statics.SHOWN_EVT)},dict.transition_time)}),self.on(statics.HIDE_EVT,function(){clearTimeout(self._lasttransition),mainCSS.property(dict.transition_property,dict.transition_hide),self._lasttransition=setTimeout(function(){mainCSS.property("position","absolute"),mainCSS.property(compatTable.transform,"translateY(-100%)"),self.trigger(statics.HIDDEN_EVT)},dict.transition_time)})})}),self._model.on("change",function(k,v){"state"==k&&v?self.trigger(statics.SHOW_EVT):"state"==k&&self.trigger(statics.HIDE_EVT)})}(this)},_template:".rlx-locator__map-container#$uid@mapcontainer>.rlx-locator__map-controls@controls",_transition_show:"1",_transition_hide:"0",_transition_property:"opacity",_transition_easing:"ease-in-out",_transition_time:425,uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},show:function(){this.trigger(statics.SHOW_EVT),this._model.set("state",1)},hide:function(){this.trigger(statics.HIDE_EVT),this._model.set("state",0)},kill:function(){this.recover()}}}),module.exports.LocatorMapButtonZView=ZView.extend(function(Super,statics){return statics.CLICK_EVT="map/button/click",statics.INACTIVE_CLASS=" rlx-locator__map-button--inactive",statics.HIDDEN_CLASS=" rlx-locator__map-button--hidden",{constructor:function(args,dict){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},dict.uid=UID.uid(),dict.active="undefined"!=typeof dict.active?dict.active:1,dict.state="undefined"!=typeof dict.state?dict.state:1,args[0]=dict,Super.apply(this,args),void function(self){function setActive(v){v?self.root().className=self.root().className.replace(statics.INACTIVE_CLASS,""):self.root().className+=statics.INACTIVE_CLASS}function setVisible(v){v?self.root().className=self.root().className.replace(statics.HIDDEN_CLASS,""):self.root().className+=statics.HIDDEN_CLASS}setActive(dict.active),setVisible(dict.state),self._model.on("change",function(k,v){switch(k){case"active":setActive(v);break;case"state":setVisible(v)}}),self.root().addEventListener("click",self._onclickhandler=function(e){self._model.get("active")&&self.trigger(statics.CLICK_EVT)})}(this)},_template:"button#$uid.rlx-locator__map-button{$text}",enable:function(){this._model.set("active",1)},disable:function(){this._model.set("active",0)},kill:function(){this.root().removeEventListener("click",this._onclickhandler),this.recover()}}}),module.exports.LocatorMapZView=ZView.extend(function(Super,statics){return statics.READY_EVT="map/ready",statics.REJECT_EVT="map/reject",statics.KILL_EVT="map/kill",statics.MARKER_CLICK_EVT="marker/click",statics.MAP_CLICK_EVT="map/click",statics.OVERLAY_CLICK_EVT="overlay/click",statics.BOUNDS_CHANGED_EVT="map/bounds/changed",statics.ZOOM_CHANGED_EVT="map/zoom/changed",statics.USER_CHANGED_VIEWPORT_EVT="map/user/changed",statics.BATCH_NUM=100,statics.BATCH_TIMER=100,statics.comparePoints=function(point1,point2,ret){ret=!0;for(var k in point1)point1.hasOwnProperty(k)&&void function(val1,val2){val1!=val2&&(ret=!1)}(point1[k],point2[k]);return ret},statics.addPaddingToMap=function(map,padding,bounds,projection,ne,sw){return projection=map._.getProjection(),bounds=bounds||map._.getBounds(),padding/=Math.pow(2,map._.getZoom()),ne=projection.fromLatLngToPoint(bounds.getNorthEast()),sw=projection.fromLatLngToPoint(bounds.getSouthWest()),ne=new google.maps.Point(ne.x+padding,ne.y-padding),sw=new google.maps.Point(sw.x-padding,sw.y+padding),ne=projection.fromPointToLatLng(ne),sw=projection.fromPointToLatLng(sw),bounds.extend(ne),bounds.extend(sw),map.fitBounds(bounds),bounds},statics.mapHasSameBounds=function(mapview,bounds,viewbounds){if(viewbounds=mapview._model.expand().bounds,"undefined"==typeof viewbounds)return!1;bounds=new google.maps.LatLngBounds(new google.maps.LatLng(bounds.southWest),new google.maps.LatLng(bounds.northEast)),bounds=bounds.toJSON();for(var k in bounds)if(bounds.hasOwnProperty(k)&&bounds[k]!=viewbounds[k])return!1;return!0},statics.getGeoCodeWithPlaceId=function(id){return new Promise(function(resolve,reject){gmap.load().then(function(google){(new google.maps.Geocoder).geocode({placeId:id},function(results,status){status===google.maps.GeocoderStatus.OK&&results[0]&&resolve(results[0]),reject(status)})},function(err){})})},statics.makeMarker=function(self,o,m){o=jQuery.extend({position:{lat:o.lat,lng:o.lng}},o),delete o.lat,delete o.lng;try{LocatorMarkerModel.makeType(o,self._model.get("locatorPageType")),LocatorMarkerModel.makePinType(o,self._model.get("locatorPageType")),o.type!=statics.FLAGSHIPS_TYPE||self._flagships||(self._flagships=!0),o.pinType!=statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE&&o.pinType!=statics.HASWATCH_DEALERLOC_PINTYPE||self._pilots||(self._pilots=!0),m=new LocatorMarkerModel(o),m.addListener("click",function(){self.trigger(module.exports.LocatorMapZView.MARKER_CLICK_EVT,[m])})}catch(e){}return m},statics.fitBoundsWithCNS=function(map,o,bounds){return bounds=new google.maps.LatLngBounds(new google.maps.LatLng(o.southWest),new google.maps.LatLng(o.northEast)),map.fitBounds(bounds),bounds},statics.fitBoundsWithMarkers=function(map,markers,bounds){bounds=new google.maps.LatLngBounds;for(var i=markers.length;i--;)bounds.extend(markers[i].position);map.fitBounds(bounds)},statics.prepareBounds=function(bounds,ne,sw,obj){return ne=bounds.getNorthEast().toJSON(),sw=bounds.getSouthWest().toJSON(),obj={northEastLat:ne.lat,northEastLng:ne.lng,southWestLat:sw.lat,southWestLng:sw.lng}},statics.prepareCNS=function(bounds,ne,sw,obj){return obj={northEastLat:bounds.northEast.lat,northEastLng:bounds.northEast.lng,southWestLat:bounds.southWest.lat,southWestLng:bounds.southWest.lng}},statics.getViewport=function(map,bounds){return bounds=map.getBounds(),"undefined"==typeof bounds?null:statics.prepareBounds(bounds)},statics.addUserPos=function(map,obj,lat,lng){return lat=map._model.get("user.lat"),lng=map._model.get("user.lng"),obj||(obj={}),lat&&(obj.lat=lat),lng&&(obj.lng=lng),obj},statics.offsetLatLngWithPoint=function(map,base,offset){return base=map.getProjection().fromLatLngToPoint(base),map.getProjection().fromPointToLatLng(new google.maps.Point(base.x+offset.x,base.y+offset.y))},statics.getPlaceIdFromCountryCode=function(cc){return new Promise(function(resolve,reject){(new google.maps.Geocoder).geocode({componentRestrictions:{country:cc}},function(res,status,obj){return status==google.maps.GeocoderStatus.OK||res[0]?void resolve(res[0].place_id):reject(null)})})},statics.batchMarkers=function(list,funk,cb,take){take=list.splice(0,statics.BATCH_NUM);for(var i=take.length;i--;)funk(take[i],i);take.length?setTimeout(function(){statics.batchMarkers(list,funk,cb)},statics.BATCH_TIMER):"function"==typeof cb&&setTimeout(cb,statics.BATCH_TIMER)},statics.userIconUrl=function(type){switch(type){case"service":return confstoreloc.clientlib+"/css/images/icn-map-user-service"+iconversion;default:return confstoreloc.clientlib+"/css/images/icn-map-user"+iconversion}},{constructor:function(dict,args){args=Array.prototype.slice.apply(arguments),dict=args[0]||{},dict.uid=UID.uid(),dict.state=0,dict.user=dict.user||{lat:"",lng:""},args[0]=dict,Super.apply(this,args),void function(self){self._flagships=!1,self._pilots=!1,self._ready=new Promise(function(resolve,reject){function onready(){self.off(module.exports.LocatorMapZView.READY_EVT,onready),self.off(module.exports.LocatorMapZView.REJECT_EVT,onreject),self.off(module.exports.LocatorMapZView.KILL_EVT,onreject),self.enable(),resolve()}function onreject(err){self.off(module.exports.LocatorMapZView.READY_EVT,onready),self.off(module.exports.LocatorMapZView.REJECT_EVT,onreject),self.off(module.exports.LocatorMapZView.KILL_EVT,onreject),reject(err)}self.on(module.exports.LocatorMapZView.READY_EVT,onready),self.on(module.exports.LocatorMapZView.REJECT_EVT,onreject),self.on(module.exports.LocatorMapZView.KILL_EVT,onreject)}),self._model.on("change",function(k,v){switch(k){case"zoom":self.trigger(module.exports.LocatorMapZView.ZOOM_CHANGED_EVT,[v]),v===self._model.get("minzoom")?self._model.set("min",1):self._model.set("min",0),v===self._model.get("maxzoom")?self._model.set("max",1):self._model.set("max",0)}}),self._model.on("update",function(keys,o){keys=Array.prototype.slice.call(arguments),o=self._model.expand(),(~keys.indexOf("user.lat")||~keys.indexOf("user"))&&void function(val){""!=val.lat&&""!=val.lng&&"undefined"==typeof self._usermarker?(self._usermarker=new google.maps.Marker({position:val,map:self._,icon:{url:statics.userIconUrl(self._model.get("locatorPageType")),scaledSize:new google.maps.Size(30,30)}}),self.locate(val)):""!=val.lat&&""!=val.lng?(self._usermarker.setPosition(val),self._usermarker.setMap(self._),self.locate(val)):"undefined"!=typeof self._usermarker&&self._usermarker.setMap(null)}(o.user)}),debugMode&&void function(debugview){document.body.appendChild(debugview.root()),self.on(module.exports.LocatorMapZView.ZOOM_CHANGED_EVT,function(){debugview._zoom.query("input").value=self._.getZoom(),debugview._zoom.$query("output").text(self._.getZoom())}),debugview._zoom._model.on("change",function(k,v){"numvalue"==k&&self.setZoom(v)}),debugview._clustergrid._model.on("change",function(k,v){"numvalue"==k&&(self._mc.setGridSize(v),self._mc.repaint())}),debugview._clustermaxzoom._model.on("change",function(k,v){"numvalue"==k&&(self._mc.setMaxZoom(v),self._mc.repaint())}),debugview._averagecenter._model.on("change",function(k,v){"checked"==k&&(self._mc.setAverageCenter(v),self._mc.repaint())}),debugview._minclustersize._model.on("change",function(k,v){"numvalue"==k&&(self._mc.setMinimumClusterSize(v),self._mc.repaint())})}(new LocatorMapDebugZView)}(this)},_template:".rlx-locator__map#$uid",uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},init:function(center,self){function reject(err){self.trigger(module.exports.LocatorMapZView.REJECT_EVT,[err])}return self=this,self._markers=null,self._markersID=[],self._isdraggin=!1,"object"==typeof center&&"undefined"!=typeof center.location&&(mapoptions.center=center.location),gmap.load().then(function(gapi,map){function onmapclick(){self.trigger(statics.MAP_CLICK_EVT)}function willbeready(){self._idleevent.remove(),delete this._idleevent,self.trigger(module.exports.LocatorMapZView.READY_EVT)}function onzoomchange(){clearTimeout(self._onzoomtimer),self._onzoomtimer=setTimeout(function(){self.trigger(module.exports.LocatorMapZView.USER_CHANGED_VIEWPORT_EVT),self._model.set("zoom",self._.getZoom())},800)}function onboundschange(){clearTimeout(self._onboundstimer),self._onboundstimer=setTimeout(function(){self.trigger(module.exports.LocatorMapZView.BOUNDS_CHANGED_EVT),self._isdraggin&&self.trigger(module.exports.LocatorMapZView.USER_CHANGED_VIEWPORT_EVT)},800)}function ondragstart(){self._isdraggin=!0}function ondragend(){clearTimeout(self._onuserchangetimer),self._onuserchangetimer=setTimeout(function(){self.trigger(module.exports.LocatorMapZView.USER_CHANGED_VIEWPORT_EVT)},200),self._isdraggin=!1}try{mapoptions.minZoom=self._model.get("minzoom")||mapoptions.minZoom,mapoptions.maxZoom=self._model.get("maxzoom")||mapoptions.maxZoom,mapoptions.zoom=self._model.get("zoom")||mapoptions.zoom,mapoptions.scrollwheel="boolean"==typeof self._model.get("scrollwheel")?self._model.get("scrollwheel"):mapoptions.scrollwheel,map=window._map=self._=new gapi.maps.Map(self.root(),mapoptions),self._mc=new MarkerClusterer(self._,[],mcoptions)}catch(e){reject(e)}"object"==typeof center&&"undefined"!=typeof center.bounds&&self.fitBounds(center.bounds),map.addListener("bounds_changed",onboundschange),map.addListener("zoom_changed",onzoomchange),map.addListener("dragstart",ondragstart),map.addListener("dragend",ondragend),map.addListener("click",onmapclick),self._idleevent=map.addListener("idle",willbeready)},reject),self._ready},enable:function(){this._model.set("state",1)},disable:function(){this._model.set("state",0)},fitBounds:function(o){this._model.set("bounds",o.toJSON()),this._.fitBounds(o.toJSON())},getBounds:function(){return this._.getBounds()},getCenter:function(c){return c=this._.getCenter(),{lat:c.lat(),lng:c.lng()}},getZoom:function(){return this._.getZoom()},setZoom:function(v){this._model.set("zoom",v),this._.setZoom(v)},locate:function(o,pos){"undefined"!=typeof o.geometry?void function(self,geo){pos=geo.location,"undefined"!=typeof geo.bounds?self.fitBounds(geo.bounds):"undefined"!=typeof geo.viewport&&self.fitBounds(geo.viewport)}(this,o.geometry):pos=o,this._model.set("center","function"==typeof pos.toJSON?pos.toJSON():pos),this._.setCenter(pos)},panTo:function(pos,offset){"undefined"!=typeof pos.geometry&&(pos=pos.geometry.location),"undefined"!=typeof offset||"undefined"==typeof offset.x&&"undefined"==typeof offset.y?void function(pos,self,map,point1,point2){"object"==typeof pos.lat&&"object"==typeof pos.lng||(pos=new google.maps.LatLng(pos)),pos=statics.offsetLatLngWithPoint(map,pos,new google.maps.Point((offset.x||0)/Math.pow(2,map.getZoom()),(offset.y||0)/Math.pow(2,map.getZoom()))),self._model.set("center","function"==typeof pos.toJSON?pos.toJSON():pos),map.panTo(pos)}(pos,this,this._):(this._model.set("center","function"==typeof pos.toJSON?pos.toJSON():pos),this._.panTo(pos))},filter:function(opts,self){self=this,self._markers.forEach(function(model){var i,result=!1;for(i=opts.length;i--&&!(result=function(opt){return!("function"!=typeof opts||!opts(model))||!!~model.get("tags").indexOf(opt)}(opts[i])););result?model.set("state",!0):model.set("state",!1)}),self._mc.repaint()},addMarkers:function(list,cb,self,nulist){function batchCB(){self._mc.addMarkers(self._markers.export()),"function"==typeof cb&&cb()}self=this,nulist=[].concat(list),self.reset();try{nulist.length?statics.batchMarkers(nulist,function(retailer){retailer=module.exports.LocatorMapZView.makeMarker(self,retailer),retailer.set("locatorPageType",self._model.get("locatorPageType")),retailer._map=self._,self._markers.add(retailer),self._markersID.push(retailer.get("rolexId"))},batchCB):batchCB()}catch(e){}},mergeMarkers:function(list,cb,self,nulist,nucollection){self=this,nulist=[],nucollection=new module.exports.MarkerCollection;for(var i=list.length;i--;)void function(item,hey){~self._markersID.indexOf(item.rolexId)||nulist.push(item)}(list[i]);statics.batchMarkers(nulist,function(retailer){retailer=module.exports.LocatorMapZView.makeMarker(self,retailer),retailer.set("locatorPageType",self._model.get("locatorPageType")),retailer._map=self._,nucollection.add(retailer),self._markers.add(retailer),self._markersID.push(retailer.get("rolexId"))},function(){self._mc.addMarkers(nucollection.export()),this._markers=nucollection,"function"==typeof cb&&cb()})},forEachMarkers:function(handler){"function"==typeof handler&&this._markers&&this._markers.forEach(handler)},reset:function(){this._markers&&this._mc.removeMarkers(this._markers.export()),this._markers=new module.exports.MarkerCollection},kill:function(){clearTimeout(this._onzoomtimer),clearTimeout(this._onboundstimer),clearTimeout(this._onuserchangetimer),this.trigger(statics.KILL_EVT),this.recover(),"undefined"!=typeof this._&&(window.google.maps.event.clearInstanceListeners(this._),delete this._),"undefined"!=typeof this._mc&&(this.reset(),delete this._mc)}}})},{"../stylesheet":56,"./LocatorMapDebugZView":28,"./LocatorMarkerModel":31,"korbutJS/src/Promise":60}],31:[function(require,module,exports){"use strict";var Model=requirejs("lib/Model"),confstoreloc=(requirejs("modules/rlx-map"),requirejs("config~dealerlocator"));module.exports.LocatorMarkerModel=Model.extend(function(Super,statics){var iconversion=window.devicePixelRatio>1.5?"@2x.png":".png";return statics.AFFILIATES_TYPE="AFFILIATE",statics.RETAILERS_TYPE="STORE",statics.SERVICES_CENTER_TYPE="SERVICECENTER",statics.SERVICES_COUNTER_TYPE="SERVICECOUNTER",statics.FLAGSHIPS_TYPE="FLAGSHIP",statics.RETAILER_DEALERLOC_PINTYPE="STORE",statics.FLAGSHIP_DEALERLOC_PINTYPE="FLAGSHIP",statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE="PILOTFLAG",statics.HASWATCH_DEALERLOC_PINTYPE="PILOT",statics.AFFILIATE_SERVICELOC_PINTYPE="AFFILIATE",statics.CENTER_SERVICELOC_PINTYPE="SERVICECENTER",statics.RETAILER_SERVICELOC_PINTYPE="STORESERVICELOC",statics.AUTH_TAG="OFFICIAL",statics.PIN_PATH=confstoreloc.clientlib+"/css/images/pin/",statics.OPTIONS_AFFILIATE=statics.PIN_PATH+"affiliate/affiliate"+iconversion,statics.OPTIONS_RETAILER=statics.PIN_PATH+"retailer/retailer"+iconversion,statics.OPTIONS_FLAGSHIP=statics.PIN_PATH+"flagship/flagship"+iconversion,statics.OPTIONS_SERVICE_CENTER=statics.PIN_PATH+"service-center/service-center"+iconversion,statics.OPTIONS_ROLEX_OFFICIAL=statics.PIN_PATH+"rolex-official/rolex-official"+iconversion,statics.OPTIONS_PILOT=statics.PIN_PATH+"pilot/pilot"+iconversion,statics.OPTIONS_PILOTFLAG=statics.PIN_PATH+"pilotflag/pilotflag"+iconversion,statics.OPTIONS_AFFILIATE_ACTIVE=statics.PIN_PATH+"affiliate/affiliate-selected"+iconversion,statics.OPTIONS_RETAILER_ACTIVE=statics.PIN_PATH+"retailer/retailer-selected"+iconversion,statics.OPTIONS_FLAGSHIP_ACTIVE=statics.PIN_PATH+"flagship/flagship"+iconversion,statics.OPTIONS_SERVICE_CENTER_ACTIVE=statics.PIN_PATH+"service-center/service-center-selected"+iconversion,statics.OPTIONS_ROLEX_OFFICIAL_ACTIVE=statics.PIN_PATH+"rolex-official/rolex-official-selected"+iconversion,statics.OPTIONS_PILOT_ACTIVE=statics.PIN_PATH+"pilot/pilot-selected"+iconversion,statics.OPTIONS_PILOTFLAG_ACTIVE=statics.PIN_PATH+"pilotflag/pilotflag"+iconversion,statics.OPTIONS_AFFILIATE_HOVER=statics.PIN_PATH+"affiliate/affiliate-selected"+iconversion,statics.OPTIONS_RETAILER_HOVER=statics.PIN_PATH+"retailer/retailer-selected"+iconversion,statics.OPTIONS_FLAGSHIP_HOVER=statics.PIN_PATH+"flagship/flagship"+iconversion,statics.OPTIONS_SERVICE_CENTER_HOVER=statics.PIN_PATH+"service-center/service-center-selected"+iconversion,statics.OPTIONS_ROLEX_OFFICIAL_HOVER=statics.PIN_PATH+"rolex-official/rolex-official-selected"+iconversion,statics.OPTIONS_PILOT_HOVER=statics.PIN_PATH+"pilot/pilot-selected"+iconversion,statics.OPTIONS_PILOTFLAG_HOVER=statics.PIN_PATH+"pilotflag/pilotflag"+iconversion,[statics.OPTIONS_AFFILIATE,statics.OPTIONS_RETAILER,statics.OPTIONS_FLAGSHIP,statics.OPTIONS_SERVICE_CENTER,statics.OPTIONS_ROLEX_OFFICIAL,statics.OPTIONS_PILOT,statics.OPTIONS_AFFILIATE_ACTIVE,statics.OPTIONS_RETAILER_ACTIVE,statics.OPTIONS_FLAGSHIP_ACTIVE,statics.OPTIONS_SERVICE_CENTER_ACTIVE,statics.OPTIONS_ROLEX_OFFICIAL_ACTIVE,statics.OPTIONS_PILOT_ACTIVE,statics.OPTIONS_AFFILIATE_HOVER,statics.OPTIONS_RETAILER_HOVER,statics.OPTIONS_FLAGSHIP_HOVER,statics.OPTIONS_SERVICE_CENTER_HOVER,statics.OPTIONS_ROLEX_OFFICIAL_HOVER,statics.OPTIONS_PILOT_HOVER,statics.OPTIONS_PILOTFLAG,statics.OPTIONS_PILOTFLAG_ACTIVE,statics.OPTIONS_PILOTFLAG_HOVER].forEach(function(src,img){img=document.createElement("img"),img.src=src}),statics.chooseSizeOptions=function(pinType){switch(pinType){case statics.RETAILER_DEALERLOC_PINTYPE:case statics.FLAGSHIP_DEALERLOC_PINTYPE:case statics.AFFILIATE_SERVICELOC_PINTYPE:case statics.CENTER_SERVICELOC_PINTYPE:case statics.RETAILER_SERVICELOC_PINTYPE:return new google.maps.Size(25,30);case statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:case statics.HASWATCH_DEALERLOC_PINTYPE:return new google.maps.Size(32,38)}},statics.chooseOptions=function(pinType){switch(pinType){case statics.AFFILIATE_SERVICELOC_PINTYPE:return statics.OPTIONS_AFFILIATE;case statics.RETAILER_DEALERLOC_PINTYPE:return statics.OPTIONS_RETAILER;case statics.FLAGSHIP_DEALERLOC_PINTYPE:return statics.OPTIONS_FLAGSHIP;case statics.CENTER_SERVICELOC_PINTYPE:return statics.OPTIONS_SERVICE_CENTER;case statics.RETAILER_SERVICELOC_PINTYPE:return statics.OPTIONS_ROLEX_OFFICIAL;case statics.HASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOT;case statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOTFLAG}},statics.chooseActiveOptions=function(pinType){switch(pinType){case statics.AFFILIATE_SERVICELOC_PINTYPE:return statics.OPTIONS_AFFILIATE_ACTIVE;case statics.RETAILER_DEALERLOC_PINTYPE:return statics.OPTIONS_RETAILER_ACTIVE;case statics.FLAGSHIP_DEALERLOC_PINTYPE:return statics.OPTIONS_FLAGSHIP_ACTIVE;case statics.CENTER_SERVICELOC_PINTYPE:return statics.OPTIONS_SERVICE_CENTER_ACTIVE;case statics.RETAILER_SERVICELOC_PINTYPE:return statics.OPTIONS_ROLEX_OFFICIAL_ACTIVE;case statics.HASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOT_ACTIVE;case statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOTFLAG_ACTIVE}},statics.chooseHoverOptions=function(pinType){switch(pinType){case statics.AFFILIATE_SERVICELOC_PINTYPE:return statics.OPTIONS_AFFILIATE_HOVER;case statics.RETAILER_DEALERLOC_PINTYPE:return statics.OPTIONS_RETAILER_HOVER;case statics.FLAGSHIP_DEALERLOC_PINTYPE:return statics.OPTIONS_FLAGSHIP_HOVER;case statics.CENTER_SERVICELOC_PINTYPE:return statics.OPTIONS_SERVICE_CENTER_HOVER;case statics.RETAILER_SERVICELOC_PINTYPE:return statics.OPTIONS_ROLEX_OFFICIAL_HOVER;case statics.HASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOT_HOVER;case statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:return statics.OPTIONS_PILOTFLAG_HOVER}},statics.makeMarker=function(dict,active,marker){return marker={},marker.icon={url:active?statics.chooseActiveOptions(dict.pinType):statics.chooseOptions(dict.pinType),scaledSize:statics.chooseSizeOptions(dict.pinType)},marker.position=dict.position,marker.title=dict.translatedName,marker},statics.makeType=function(o,loctype){return o.type=o.type||statics.RETAILERS_TYPE,o.isServiceCounter&&(o.type=statics.SERVICES_COUNTER_TYPE),"flagship"==o.typeRolex.trim().toLowerCase()&&"service"!=loctype&&(o.type=statics.FLAGSHIPS_TYPE),o},statics.makePinType=function(o,loctype){switch(loctype||"dealer"){case"dealer":o.type===statics.RETAILERS_TYPE?o.pinType=statics.RETAILER_DEALERLOC_PINTYPE:o.type===statics.SERVICES_COUNTER_TYPE?o.pinType=statics.RETAILER_DEALERLOC_PINTYPE:o.rmcDealerUrl&&o.onModelPage?o.pinType=o.type==FLAGSHIPS_TYPE?statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:statics.HASWATCH_DEALERLOC_PINTYPE:o.pinType=o.type||statics.RETAILERS_TYPE;break;case"service":o.type===statics.RETAILERS_TYPE?o.pinType=statics.RETAILER_SERVICELOC_PINTYPE:o.type===statics.SERVICES_COUNTER_TYPE?o.pinType=statics.CENTER_SERVICELOC_PINTYPE:o.type===statics.AFFILIATES_TYPE?o.pinType=statics.CENTER_SERVICELOC_PINTYPE:o.pinType=o.type||statics.CENTER_SERVICELOC_PINTYPE}return o},{constructor:function(dict,args,gmapo){dict=dict||{},dict.state=1,dict.tags="true"===dict.isRolexHorloger?[dict.type,statics.AUTH_TAG]:[dict.type],Model.call(this,dict),void function(self){self._gmapmarker=new google.maps.Marker(statics.makeMarker(dict,0)),self._gmapmarker.type=dict.type,self._gmapmarker.hasWatch=dict.pinType==statics.HASWATCH_DEALERLOC_PINTYPE||dict.pinType==statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE,google.maps.event.addListener(self._gmapmarker,"mouseover",function(){self._gmapmarker.setIcon({url:statics.chooseHoverOptions(dict.pinType),scaledSize:statics.chooseSizeOptions(dict.pinType)})}),google.maps.event.addListener(self._gmapmarker,"mouseout",function(){self.get("active")||self._gmapmarker.setIcon({url:statics.chooseOptions(dict.pinType),scaledSize:statics.chooseSizeOptions(dict.pinType)})}),self.on("change",function(k,v){switch(k){case"state":v?self._gmapmarker.setVisible(self.get("visible")):self._gmapmarker.setVisible(!1);break;case"visible":self.get("state")&&v?self._gmapmarker.setVisible(!0):self._gmapmarker.setVisible(!1);break;case"active":v?self.setOptions(statics.makeMarker(self.expand(),v)):self.setOptions(statics.makeMarker(self.expand(),v));break;case"rmcDealerUrl":if(""==v)return;var newPinType=self.get("type")==statics.FLAGSHIPS_TYPE?statics.FLAGSHIPHASWATCH_DEALERLOC_PINTYPE:statics.HASWATCH_DEALERLOC_PINTYPE;dict.pinType=newPinType,self.set("pinType",newPinType),self._gmapmarker.hasWatch=!0,self.setOptions(statics.makeMarker(self.expand(),self.get("active")))}})}(this)},_defaults:{visible:!0,state:!0},setActive:function(){this.get("active")||this.set("active",!0)},setInactive:function(){this.set("active",!1)},setVisible:function(v){this.set("visible",v)},setState:function(v){this.set("state",v)},setOptions:function(o){this._gmapmarker.setOptions(o),this.set(o)},getPosition:function(){return this._gmapmarker.getPosition()},addListener:function(type,handler){this["_on"+type]=handler,this._gmapmarker.addListener(type,function(){this.get("active")||handler()}.bind(this))}}})},{}],32:[function(require,module,exports){"use strict";function noop(err){}var ZView=requirejs("lib/ZenView"),_=requirejs("utils"),env=require("../environment"),i18n=requirejs("i18n"),ui=requirejs("modules/rlx-ui"),events=(ui.SHeader,require("../events")),Promise=require("korbutJS/src/Promise").Promise,Geolocation=require("../core/Geolocation").Geolocation,LocatorListContainerZView=require("./LocatorListContainerZView").LocatorListContainerZView,LocatorMapZView=require("./LocatorMapZView").LocatorMapZView,LocatorMapButtonZView=require("./LocatorMapZView").LocatorMapButtonZView,LocatorMapContainerZView=require("./LocatorMapZView").LocatorMapContainerZView,LocatorMapUI=require("./LocatorMapUI"),RetailerZView=require("./RetailerZView").RetailerZView,RetailerDetailsView=require("./RetailerDetailsView").RetailerDetailsView,popinModule=requirejs("modules/rlx-popins"),OverlayZView=require("../common/OverlayZView").OverlayZView,Service=require("../core/Service").Service,confObj=require("../core/Service").confCSTLS,retailersAPI=require("../core/Service").retailersAPI,getInitialBoundingBox=new Service(retailersAPI.urls.init_bounding,confObj),byViewport=new Service(retailersAPI.urls.by_viewport,confObj),getDealers=new Service(retailersAPI.urls.establishments,confObj),LocatorMarkerModel=require("./LocatorMarkerModel").LocatorMarkerModel,hashload=null,popinelem=document.getElementById("rlx-geolocation-error-popin"),countryCode=function(CC){return"undefined"!=typeof CC&&"undefined"!=typeof CC.get&&"undefined"!=typeof CC.get("geolocation").getProperty?CC.get("geolocation").getProperty("countryCode"):null}(window.ClientContext);module.exports.LocatorZView=ZView.extend(function(Super,statics){return statics.prepInitialBounding=function(self,pos,map,o){return map=self._map,o={},"string"==typeof pos?o=function(pos){return{lat:pos[0],lng:pos[1]}}(pos.split(",")):"object"==typeof pos?o=jQuery.extend({},pos):"boolean"==typeof pos&&pos&&(o=function(pos){return pos?{lat:pos.user.lat,lng:pos.user.lng}:{}}(self._model.expand().user)),self._model.get("dealer-name")?o.dealerName=self._model.get("dealer-name"):"dealer"==self._model.get("type")?o.establishmentType="STORE":"service"==self._model.get("type")&&(o.establishmentType="STORE,SERVICECENTER,AFFILIATE"),o.width=map.$root().width(),o.height=map.$root().height(),o},statics.READY_EVT="locator/ready",statics.REJECT_EVT="locator/reject",statics.KILL_EVT="locator/kill",statics.GEOLOCATION_SUCCES_EVT="locator/geolocation/success",statics.makeHash=function(map,prefix,bounds,arr){return map?(prefix=prefix||"",bounds=map._model.expand().bounds,arr=[],(""!=prefix?prefix+"&":"")+arr.join("&")):""},statics.updatePageUrl=function(self,search){statics.parsePlaceDetails(self,JSON.parse(self._model.expand().places||"{}"),{hash:statics.makeHash(self._map,search||"")})},statics.parsePlaceDetails=function(self,details,state){return state=state||{},state.hash=state.hash||statics.makeHash(self),self._model.get("activeMarker")&&(state.hash+=(state.hash.length?"&":"")+"retailer="+self._model.get("activeMarker")),self._model.get("near")&&(state.hash+=(state.hash.length?"&":"")+"near"),self._model.get("placeId")&&(state.hash+=(state.hash.length?"&":"")+"place="+self._model.get("placeId")),self._model.get("search")&&(state.hash+=(state.hash.length?"&":"")+"search="+self._model.get("search")),self._model.get("near")?details.near=!0:details.near=!1,self._model.set("places",JSON.stringify(details)),events.eventRouter.trigger(events.locatorPushState,{details:details,state:state}),details},statics.makeBoundsForRetailerPanel=function(self,map,mapBounds,pt){return map=self._map,mapBounds=map.getBounds(),pt=function(){return RLX.GLOBALS.features.isMobile?LocatorMapZView.offsetLatLngWithPoint(map._,mapBounds.getNorthEast(),new google.maps.Point(0,(map.$root().height()-self._retailer.$root().height())/Math.pow(2,map.getZoom()))):LocatorMapZView.offsetLatLngWithPoint(map._,mapBounds.getNorthEast(),new google.maps.Point((self._retailer.$root().width()-map.$root().width())/Math.pow(2,map.getZoom()),0))}(),new google.maps.LatLngBounds(mapBounds.getSouthWest(),pt)},statics.pointIsHiddenByRetailerPanel=function(self,point){return statics.makeBoundsForRetailerPanel(self).contains(new google.maps.LatLng(point))},statics.request=function(self,obj,opt,hash){return opt=opt||"",hash=hash||"",getInitialBoundingBox.request(obj).then(function(pos){return new Promise(function(resolve,reject){function upd(){resolve(pos)}return"undefined"==typeof pos||""==pos?reject("No JSON from initial_bounding request"):("undefined"==typeof obj.placeId||"object"!=typeof pos.stoPlaceDetails||pos.stoPlaceDetails.cityName?self._model.set("placeId",!1):self._model.set("placeId",obj.placeId),
opt.near?self._model.set("near",!0):self._model.set("near",!1),opt.search?self._model.set("search",_.unserialize(opt.search).search):self._model.set("search",!1),LocatorMapZView.mapHasSameBounds(self._map,pos.boundingBox)?upd():google.maps.event.addListenerOnce(self._map._,"idle",upd),"undefined"!=pos.boundingBox&&LocatorMapZView.fitBoundsWithCNS(self._map,pos.boundingBox),void("undefined"!=typeof pos.stoPlaceDetails?statics.parsePlaceDetails(self,pos.stoPlaceDetails,{hash:statics.makeHash(self._map,hash)}):events.eventRouter.trigger(events.locatorPushState,{details:{},state:{}})))})},noop)},{constructor:function(mdl){ZView.apply(this,arguments),void function(self){function onmaptoggle(next,vars){self._model.set("locview",vars.type),next()}function onzoomchange(e){"undefined"!=typeof self._retailer&&self._map.getZoom()<=11&&self._retailer.hide()}function onmarkerclick(marker,o,ddlpage){self._model.set("activeMarker",marker.get("rolexId"))}function onviewportchange(mapcenter,user){user=self._model.expand().user,user&&""!=user.lat&&""!=user.lng&&!self._map._.getBounds().contains(new google.maps.LatLng(user))?self._findme._model.set("active",1):self._findme._model.set("active",0)}function maptoggle(type){"map"==type?void function(){self._list.on(LocatorListContainerZView.HIDDEN_EVT,function onlisthidden(){self._list.off(LocatorListContainerZView.HIDDEN_EVT,onlisthidden),self._mapcontainer.show()}),self._list.hide()}():void function(){self._mapcontainer.on(LocatorMapContainerZView.HIDDEN_EVT,function onmaphidden(){self._mapcontainer.off(LocatorMapContainerZView.HIDDEN_EVT,onmaphidden),self._list.show()}),self._mapcontainer.hide()}()}function ongeorequest(next,vars){self.disable(),"undefined"!=typeof self._retailer&&self._retailer.hide(),self._model.get("dealer-name")||self._list.empty(),self.geolocate().then(function(){self.enable()},function(){self.enable()}),next()}function onwillrender(next,vars){events.eventRouter.off(events.appWillRender,onwillrender),events.eventRouter.off(events.requestGeolocation,ongeorequest),events.eventRouter.off(events.locatorToggle,onmaptoggle),next()}events.eventRouter.on(events.appWillRender,onwillrender),self._mapcontainer=new LocatorMapContainerZView({state:1}),self._overlay=new OverlayZView({transition_time:"400",background:"rgba(255, 255, 255, .7)",className:"rlx-locator-overlay",opacity:"1",parent:self.query("content")}),self._map=new LocatorMapZView({scrollwheel:RLX.GLOBALS.features.isMobile,minzoom:self._model.get("dealer-name")?2:RLX.GLOBALS.features.isMobile?2:5,zoom:self._model.get("dealer-name")?2:12,onModelPage:self._model.get("onModelPage"),locatorPageType:self._model.get("type")}),self._zoomplus=new LocatorMapButtonZView({text:"plus",active:!0,state:!0}),self._zoomminus=new LocatorMapButtonZView({text:"minus",active:!0,state:!0}),self._findme=new LocatorMapButtonZView({text:"find me",active:0,state:0}),self._mapToggler=new LocatorMapUI.TogglerZView({active:"map",map:"MAP",list:"LIST"}),self._list=new LocatorListContainerZView({state:0}),"service"==self._model.get("type")?self._buttons=[new LocatorMapUI.ButtonZView({text:i18n("retailers/sc/singular"),type:[LocatorMarkerModel.AUTH_TAG,LocatorMarkerModel.SERVICES_CENTER_TYPE,LocatorMarkerModel.AFFILIATES_TYPE,LocatorMarkerModel.SERVICES_COUNTER_TYPE],className:LocatorMarkerModel.SERVICES_CENTER_TYPE,state:!0,enabled:!0}),new LocatorMapUI.ButtonZView({text:i18n("retailers/dlr/heading"),type:[LocatorMarkerModel.RETAILERS_TYPE],className:LocatorMarkerModel.RETAILERS_TYPE,state:!0,enabled:!0})]:self._buttons=[],self._buttons.forEach(function(button){button.on(LocatorMapUI.ButtonZView.CHANGE_EVT,function(opts){opts=[],self._buttons.forEach(function(button){button._model.get("state")&&(opts=opts.concat(button._model.get("type")))}),self._map.filter(opts),self._list.filter(opts)})}),self._ready=new Promise(function(resolve,reject){function onready(){self.off(statics.READY_EVT,onready),self.off(statics.REJECT_EVT,onreject),self.off(statics.KILL_EVT,onreject),resolve()}function onreject(err){self.off(statics.READY_EVT,onready),self.off(statics.REJECT_EVT,onreject),self.off(statics.KILL_EVT,onreject),reject(err)}self.on(statics.READY_EVT,onready),self.on(statics.REJECT_EVT,onreject),self.on(statics.KILL_EVT,onreject)}).then(function(){self.enable(),self._onReady(),events.eventRouter.on(events.requestGeolocation,ongeorequest)},function(err){}),self._model.hook("user",function(v){return"string"==typeof v&&(v=pos.split(","),v={lat:+pos[0],lng:+pos[1]}),self._map._model.set("user",v),self._findme._model.set("state",v?1:0),v}),self._model.hook("locker",function(v){return v<0?0:v}),self._model.on("change",function(k,v,old){switch(k){case"locview":maptoggle(v);break;case"activeMarker":statics.updatePageUrl(self),v?self._ready.then(function(){self._map.forEachMarkers(function(marker){marker.get("rolexId")==v&&self.showRetailer(marker)})},noop):v||"undefined"==typeof self._retailer||self._retailer.hide();break;case"locker":v?self._overlay.show():self._overlay.hide()}}),self.disable(),self.query("mapui").appendChild(self._mapToggler.borrow()),self._mapcontainer.query("controls").appendChild(self._zoomplus.root()),self._mapcontainer.query("controls").appendChild(self._zoomminus.root()),self._mapcontainer.query("controls").appendChild(self._findme.root()),void function(node,container){node[node.textContent?"textContent":"innerText"]=i18n("retailers/locator/filter-by-type"),node.className+=" rlx-map-ui__legend",container.appendChild(node),self._buttons.forEach(function(item){container.appendChild(item.borrow())})}(document.createElement("p"),self.query("mapui-buttons")),_.requestAnimationFrame(function(){var buttons=Array.prototype.slice.call(self.query("mapui-buttons").querySelectorAll(".rlx-map-ui__button")),buttonw=0;return!(!buttons||!RLX.GLOBALS.features.isMobile)&&(buttonw=buttons.reduce(function(acc,item){return acc+jQuery(item).outerWidth()},0),void(buttonw+25>288&&(self.query("fades").className+=self.query("fades").className+"--display")))}),self._mapcontainer.root().appendChild(self._map.borrow()),self.root().appendChild(self._mapcontainer.borrow()),self.root().appendChild(self._list.borrow()),self._map._model.on("change",function(k,v){switch(k){case"min":v?self._zoomminus.disable():self._zoomminus.enable();break;case"max":v?self._zoomplus.disable():self._zoomplus.enable()}}),self._mapToggler.on(LocatorMapUI.TogglerZView.CHANGE_EVT,maptoggle),self._map.on(LocatorMapZView.MARKER_CLICK_EVT,onmarkerclick),self._map.on(LocatorMapZView.ZOOM_CHANGED_EVT,onzoomchange),self._map.on(LocatorMapZView.USER_CHANGED_VIEWPORT_EVT,onviewportchange),events.eventRouter.on(events.locatorToggle,self._onmaptoggle=onmaptoggle),self._zoomplus.on(LocatorMapButtonZView.CLICK_EVT,function(){self._map.setZoom(self._map.getZoom()+1)}),self._zoomminus.on(LocatorMapButtonZView.CLICK_EVT,function(){self._map.setZoom(self._map.getZoom()-1)}),self._findme.on(LocatorMapButtonZView.CLICK_EVT,function(){self.geolocate()})}(this)},_template:env.mobile?".rlx-locator__content@content>                                    .rlx-locator__map-ui@mapui>                                      .rlx-locator__buttons-fades@fades>                                        .rlx-locator__buttons-scroll>                                          ul.rlx-map-ui__buttons@mapui-buttons":".rlx-locator__content@content>                                  .rlx-locator__map-ui@mapui>                                      .rlx-map-ui__buttons@mapui-buttons",_onReady:function(self){"service"==this._model.get("type")?this.query("mapui-buttons").style.display="block":this.query("mapui-buttons").style.display="","service"==this._model.get("type")||this._map._flagships||"undefined"==typeof this._buttons[1]?"service"!=this._model.get("type")&&"undefined"!=typeof this._buttons[1]&&(this._buttons[1].root().style.display=""):this._buttons[1].root().style.display="none"},import:function(o){this._model.set(o.main),this._mapcontainer._model.set(o.mapcontainer),this._mapToggler._model.set("active",o.togglers.active),this._mapToggler.query(o.togglers.active).checked=!0,this._buttons.forEach(function(button,i){"object"==typeof o.buttons&&button._model.set(o.buttons[i])}.bind(this)),"undefined"!=typeof o.main.user&&(this._lastgeoloc=new Promise(function(resolve){resolve(o.main.user)})),this._map._model.set(o.map),this._list._model.set(o.list),this._list.empty(),"object"==typeof o.retailerlist&&"function"==typeof o.retailerlist.forEach&&o.retailerlist.forEach(function(retailer){this._list.add(retailer)}.bind(this))},export:function(obj){return obj={},obj.main=this._model.expand(),delete obj.main.active,delete obj.main.uid,obj.map=this._map._model.expand(),delete obj.map.uid,obj.mapcontainer=this._mapcontainer._model.expand(),delete obj.mapcontainer.uid,obj.list=this._list._model.expand(),delete obj.list.uid,obj.retailerlist=[],this._list._items.forEach(function(uid,o){o=RetailerDetailsView.getByUid(uid)._model.expand(),obj.retailerlist.push(o.store)}),obj.togglers=this._mapToggler._model.expand(),delete obj.togglers.uid,obj.buttons=[],this._buttons.forEach(function(button){button=button._model.expand(),delete button.uid,obj.buttons.push(button)}.bind(this)),obj},disable:function(){this._model.set("locker",(this._model.get("locker")||0)+1)},enable:function(){this._model.set("locker",(this._model.get("locker")||0)-1)},geolocate:function(){var self=this;return(RLX.GLOBALS.features.isMobile||"undefined"==typeof self._lastgeoloc||"undefined"!=typeof self._lastgeoloc&&!self._lastgeoloc.worked)&&(self._lastgeoloc=new Geolocation),self._lastgeoloc.then(function(pos){return"undefined"==typeof pos.lat&&(pos={lat:pos.coords.latitude,lng:pos.coords.longitude}),self._model.set("user",pos),self._lastgeoloc.worked=!0,jQuery.extend({},statics.prepInitialBounding(self,pos))},function(){return popinelem&&popinModule.open(popinelem),self._lastgeoloc.worked=!1,self._model.set("user",{lat:"",lng:""}),LocatorMapZView.getPlaceIdFromCountryCode(countryCode).then(function(){return self._model.get("dealer-name")?statics.prepInitialBounding(self):placeId?jQuery.extend({},statics.prepInitialBounding(self),{placeId:placeId}):void 0})},noop).then(function(obj){return statics.request(self,obj,{near:!0})},function(){self._map.setZoom(2)}).then(function(pos,bounds,hasSameBounds){return self._lastgeoloc.worked?(self.trigger(statics.GEOLOCATION_SUCCES_EVT),void(self._lastgeoloc.worked&&self.showList(!0,!1,!0))):self.hideList()},noop).then(function(){self.enable()},function(errr){self.enable(),noop(err)}).catch(function(err){noop(err),self.enable()}),self._lastgeoloc},init:function(onloadPlace,geoloc,markers,self,p){function last(){"undefined"!=typeof markers&&"number"==typeof markers.length?self.addMarkers(markers):void function doh(obj){return(obj=LocatorMapZView.getViewport(self._map))?("service"==self._model.get("type")?obj.establishmentType="STORE,SERVICECENTER,AFFILIATE":obj.establishmentType="STORE",self._model.get("rmc")&&(obj.rmc=self._model.get("rmc")),void byViewport.request(obj).then(function(res){res&&""!=res&&"number"==typeof res.length||(res=[]),self.addMarkers(res)})):setTimeout(doh,200)}()}function reject(err){self.trigger(statics.REJECT_EVT,[err])}return self=this,hashload=_.unserialize(window.location.hash.slice(1).replace("/","")),p=self._map.init().then(function(obj){self._model.get("show-list")&&"undefined"!=typeof markers&&(markers.forEach(function(marker){marker.locatorPageType=self._model.get("type"),self._list.add(jQuery.extend({},marker,{showFooter:!0}))}),self._mapToggler.show()),"undefined"!=typeof hashload.user&&self._model.set("user",hashload.user),"undefined"!=typeof hashload.retailer&&self._model.set("activeMarker",hashload.retailer)},noop),p="undefined"!=typeof hashload.place&&hashload.place?p.then(function(){return self.update(hashload.place)}):onloadPlace?p.then(function(){return self.update(onloadPlace)}):p.then(function(){return LocatorMapZView.getPlaceIdFromCountryCode(countryCode)},noop).then(function(placeId,obj){return obj={},hashload.user||self._model.get("dealer-name")||!placeId||(obj.placeId=placeId),statics.request(self,jQuery.extend(obj,statics.prepInitialBounding(self,hashload.user)))},noop).then(function(pos,bounds){},function(){self._map.setZoom(2)}),hashload.place||hashload.user||(p=p.then(function(){if(geoloc||hashload.near)return self.geolocate()},noop)),p.then(last,last).catch(reject),self._ready},update:function(place,fromSearch,hashload,obj,self,p){return self=this,self.disable(),hashload&&"undefined"!=typeof hashload.retailer?self._model.set("activeMarker",hashload.retailer):"undefined"!=typeof self._retailer&&self._retailer.hide(),obj="string"==typeof place?{placeId:place}:place,statics.request(self,jQuery.extend(statics.prepInitialBounding(self),obj),fromSearch?{search:"search="+place}:{}).then(function(pos){"undefined"!=typeof pos&&"undefined"!=typeof pos.stoPlaceDetails&&pos.stoPlaceDetails.regionSeoName?void function(places,o){o={},["country","region","city","district"].forEach(function(item){var seoname=item+"SeoName",name=item+"Name";places[seoname]&&(o[seoname]=places[seoname]),places[name]&&(o[name]=places[name])}),self.showList(o)}(pos.stoPlaceDetails):"object"==typeof place&&place.regionSeoName?self.showList(place):self.hideList(),self.enable()},noop).catch(function(err){self.enable()})},hideList:function(){this._model.get("show-list")||(this._mapToggler.hide(),this._list.empty())},addMarkers:function(markers,cb){this._map.addMarkers(markers,function(){"function"==typeof cb&&cb(),setTimeout(function(){this.trigger(statics.READY_EVT)}.bind(this),500)}.bind(this))},showRetailer:function(marker,self,o){function onmapclickwhileretaileropenhandler(){self._retailer.hide()}function onviewportmovewhileretaileropenhandler(e,bounds,obj){self._model.get("active")&&(bounds=self._map.getBounds(),obj=self._retailer._model.expand(),bounds.contains(new google.maps.LatLng({lat:obj.position.lat,lng:obj.position.lng}))||self._retailer.hide())}self=this,o=marker.expand(),o.onModelPage=self._model.get("onModelPage"),o.rmc=self._model.get("rmc"),o.onModelPage&&o.rmcDealerUrl&&o.rmc&&(o.imageUrl=o.imageUrl.replace(new RegExp(".jpg$","i"),"."+o.rmc+".jpg")),env.mobile&&(o.transition_show="translate3d(0, 0, 0)",o.transition_hide="translate3d(0, 100%, 0)"),"undefined"==typeof self._retailer?(self._retailer=new RetailerZView(o),self._map.on(LocatorMapZView.USER_CHANGED_VIEWPORT_EVT,onviewportmovewhileretaileropenhandler),self._map.on(LocatorMapZView.MAP_CLICK_EVT,onmapclickwhileretaileropenhandler),self._retailer.on(RetailerZView.HIDDEN_EVT,function(){self._map.off(LocatorMapZView.USER_CHANGED_VIEWPORT_EVT,onviewportmovewhileretaileropenhandler),self._map.off(LocatorMapZView.MAP_CLICK_EVT,onmapclickwhileretaileropenhandler),"undefined"!=typeof self._activemarker&&self._activemarker.setInactive(),delete self._retailer,self._model.set("activeMarker",!1)}),self._mapcontainer.root().appendChild(self._retailer.borrow()),self._retailer.show()):self._retailer._model.set(jQuery.extend({},o,{src:"/"+o.imageUrl})),setTimeout(function(retailerwidth,retailerheight,point){retailerwidth=self._retailer.$root().width(),retailerheight=self._retailer.$root().height(),point={lat:o.position.lat,lng:o.position.lng},window._satellite&&"STORE"==o.type?window._satellite.track("storePreview"):window._satellite&&o.type&&window._satellite.track("servicePreview"),statics.pointIsHiddenByRetailerPanel(self,point)&&self._map.panTo(point,{x:RLX.GLOBALS.features.isMobile?0:-retailerwidth/2,y:RLX.GLOBALS.features.isMobile?retailerheight/2:0})},10),"undefined"!=typeof self._activemarker&&self._activemarker.setInactive(),self._activemarker=marker,self._activemarker.setActive()},showList:function(arg,bounds,fromGeolocate,self){function populate(res){res&&res.length?(res.forEach(function(store){store.locatorPageType=self._model.get("type"),self._list.add(jQuery.extend({},store,{showFooter:!0,showHeading:!0}))}),self._mapToggler.show(),self._list.equalize(),events.eventRouter.trigger(events.locatorReplaceState)):self.hideList()}if(self=this,!self._model.get("no-list")&&!self._model.get("dealer-name"))return self._list.empty(),"object"==typeof arg?function(){return"service"==self._model.get("type")?arg.establishmentType="STORE,SERVICECENTER,AFFILIATE":arg.establishmentType="STORE",getDealers.request(arg).then(populate,noop)}():self._map._ready.then(function(o){return o={},new Promise(function resolver(resolve,reject){o="object"==typeof bounds?LocatorMapZView.prepareCNS(bounds):LocatorMapZView.getViewport(self._map),o?(fromGeolocate&&(o=LocatorMapZView.addUserPos(self._map,o)),"service"==self._model.get("type")?o.establishmentType="STORE,SERVICECENTER,AFFILIATE":o.establishmentType="STORE",byViewport.request(o).then(function(res){resolve(res)},reject)):setTimeout(function(){resolver.call(this,resolve,reject)}.bind(this),500)})},noop).then(populate,noop)},kill:function(){this.trigger(statics.KILL_EVT),this._overlay.kill(),this._mapcontainer.kill(),this._zoomplus.kill(),this._zoomminus.kill(),this._findme.kill(),this._map.kill(),this._list.kill(),this._mapToggler.kill(),this._buttons.forEach(function(item){item.kill()}),this.recover()}}})},{"../common/OverlayZView":2,"../core/Geolocation":13,"../core/Service":21,"../environment":35,"../events":36,"./LocatorListContainerZView":27,"./LocatorMapUI":29,"./LocatorMapZView":30,"./LocatorMarkerModel":31,"./RetailerDetailsView":33,"./RetailerZView":34,"korbutJS/src/Promise":60}],33:[function(require,module,exports){"use strict";var tpl=requirejs("hbs!tpl/storelocator/retailer-new"),View=requirejs("lib/View"),UID=requirejs("lib/UID"),LocatorMarkerModel=require("./LocatorMarkerModel").LocatorMarkerModel,urlmap=requirejs("modules/rlx-urlmapping"),countryCode=function(CC){return"undefined"!=typeof CC&&"undefined"!=typeof CC.get&&"undefined"!=typeof CC.get("geolocation").getProperty?CC.get("geolocation").getProperty("countryCode"):null}(window.ClientContext);module.exports.RetailerDetailsView=View.extend(function(Super,statics,retailers){return retailers={},statics.getByUid=function(uid){return retailers[uid]&&retailers[uid].instance},statics.getType=function(o){return o.store.type===LocatorMarkerModel.RETAILERS_TYPE?"dlr":o.store.type===LocatorMarkerModel.SERVICES_CENTER_TYPE?"sc":o.store.type===LocatorMarkerModel.AFFILIATES_TYPE?"aff":o.store.type===LocatorMarkerModel.SERVICES_COUNTER_TYPE?"sco":""},{constructor:function(dict,args,type,tags){args=Array.prototype.slice.call(arguments),dict=args[1]||{},dict.uid=UID.uid(),type=dict.type,tags="true"===dict.isRolexHorloger?[dict.type,LocatorMarkerModel.AUTH_TAG]:[dict.type],dict.store={showHeading:!0,name:dict.formattedName};for(var k in dict)"store"!=k&&dict.hasOwnProperty(k)&&(dict.store[k]=dict[k],delete dict[k]);dict.store.type=statics.getType(dict),"RSWI_3637"===dict.store.rolexId&&(dict.store.type="hq"),dict.mobile=RLX.GLOBALS.features.isMobile,void 0!=(RLX.countries||function(o){return o[countryCode]={googleMapsUrl:""},o}({}))[countryCode]?dict.gmapUrl=(RLX.countries||function(o){return o[countryCode]={googleMapsUrl:""},o}({}))[countryCode].googleMapsUrl:dict.gmapUrl="https://google.map.com",dict.watchAvailable=!!dict.store.rmcDealerUrl,dict.type=type,dict.tags=tags,"dlr"==dict.store.type?dict.moreUrl=urlmap("storedetail",dict.store.urlRolex):dict.moreUrl=urlmap("servicecenter",dict.store.urlRolex),dict.store.locatorPageType&&"service"===dict.store.locatorPageType&&"sco"===dict.store.type&&(dict.store.scoASsc=!0),args[1]=dict,Super.apply(this,args),void function(self){retailers[self.uid()]={instance:self}}(this)},_hbTemplate:tpl,uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},show:function(){this._model.set("visible",1)},hide:function(){this._model.set("visible",0)},kill:function(){delete retailers[this.uid()]}}})},{"./LocatorMarkerModel":31}],34:[function(require,module,exports){"use strict";var ZView=requirejs("lib/ZenView"),events=require("../events"),UID=requirejs("lib/UID"),_=requirejs("utils"),i18n=requirejs("i18n"),env=requirejs("lib/environment"),Stylesheet=require("../stylesheet"),stylesheet=Stylesheet.stylesheet,std_transition=Stylesheet.std_transition,cssCompat=stylesheet.cssCompat,popinModule=requirejs("modules/rlx-popins"),$=jQuery,RetailerDetailsView=require("./RetailerDetailsView").RetailerDetailsView,CSS_TRANSITION_PROPERTY=Stylesheet.CSS_TRANSITION_PROPERTY;module.exports.RetailerZView=ZView.extend(function(Super,statics){return statics.SHOW_EVT="retailer/show",statics.HIDE_EVT="retailer/hide",statics.HIDDEN_EVT="retailer/hidden",statics.SHOWN_EVT="retailer/shown",statics.SERVICES_TYPE="SERVICECENTER",statics.AFFILIATES_TYPE="AFFILIATE",statics.RETAILERS_TYPE="STORE",{constructor:function(dict,args,stores){args=Array.prototype.slice.call(arguments),dict=args[0]||{},dict.uid=UID.uid(),dict.transition_show=dict.transition_show||this._transition_show,dict.transition_hide=dict.transition_hide||this._transition_hide,dict.transition=dict.transition||this._transition,dict.transition_time=dict.transition_time||this._transition_time,dict.src="/"+dict.imageUrl,dict.address||(dict.address=""),ZView.apply(this,args),void function(self){function registerESC(){window.addEventListener("keyup",self._onkeyup=function(e){27==e.keyCode&&(window.removeEventListener("keyup",self._onkeyup),self.hide())})}function checkItems(dict){for(var k in dict)dict.hasOwnProperty(k)&&void function(elem,value){!value&&elem&&elem.hide()}(self.$query(k),dict[k]);"undefined"!=typeof self._details&&self._details.kill(),self.query("details").innerHTML="",makeDetails(dict)}function makeDetails(dict){self._details=new RetailerDetailsView(null,jQuery.extend({showHeading:!1,wholeanchor:!0,showFooter:!1},dict)),self._details.render(function(docfrag){self.$query("details").append(docfrag);var buttonredirect=document.querySelector('[data-ref="retailer-external-link"]');buttonredirect&&buttonredirect.addEventListener("click",onmoredetailsclick)})}function onmoredetailsclick(e,popindom,buttonredirectcancel,headingdom,textdom,retailerexternalurl){e.preventDefault(),popindom=popinModule.view.DOM.popin[0],popinModule.open($("#rlx-redirect-popin")).then(function(){env.mobile&&(popindom.querySelector(".rlx-popin-content").style.height="auto")}),buttonredirectcancel=popindom.querySelector(".rlx-button-redirect-cancel"),headingdom=popindom.querySelector('[data-ref="heading"]'),textdom=popindom.querySelector('[data-ref="text"]'),retailerexternalurl=popindom.querySelector('[data-ref="retailer-external-url"]'),buttonredirectcancel&&buttonredirectcancel.addEventListener("click",onpopinclose),headingdom&&(headingdom.innerHTML=i18n("/retailers/popinmodelpagetitle").replace("$link",self._model.get("inventoryExternalUrlDisplay"))),textdom&&(textdom.innerHTML=i18n("/retailers/popinmodelpagetext").replace("$link",self._model.get("inventoryExternalUrlDisplay")),textdom.innerHTML=textdom.innerHTML.replace("$retailer_name",self._model.get("nameTranslated"))),retailerexternalurl&&(retailerexternalurl.href=self._model.get("rmcDealerUrl"),retailerexternalurl.addEventListener("click",ontargetblank))}function onpopinclose(e){e.preventDefault(),popinModule.close()}function ontargetblank(){popinModule.close()}self._model.on("update",function(){checkItems(self._model.expand())}),cssCompat(function(compatTable){stylesheet.rule(["#",self.uid(),"{}"].join(""),function(mainCSS){mainCSS.property(CSS_TRANSITION_PROPERTY,std_transition(dict.transition_time+"ms "+dict.transition,compatTable.transform)),mainCSS.property(compatTable.transform,dict.transition_hide),self.on(statics.SHOW_EVT,function(){clearTimeout(self._lasttransition),registerESC(),_.requestAnimationFrame(function(){mainCSS.property(compatTable.transform,dict.transition_show),self._lasttransition=setTimeout(function(){events.eventRouter.trigger(statics.SHOWN_EVT),self.trigger(statics.SHOWN_EVT)},dict.transition_time)})}),self.on(statics.HIDE_EVT,function(){clearTimeout(self._lasttransition),_.requestAnimationFrame(function(){window.removeEventListener("keyup",self._onkeyup),mainCSS.property(compatTable.transform,dict.transition_hide),self._lasttransition=setTimeout(function(){self.recover(),self.trigger(statics.HIDDEN_EVT)},dict.transition_time)})})})})}(this)},_template:"div.rlx-retailer-details#$uid>              button.rlx-retailer-details__close@close            + (.rlx-retailer-details__container>                  img.rlx-retailer-details__image[src=$src]@retailerimg                + .rlx-retailer-details__text-container@details)",_transition_show:"translate3d(0, 0, 0)",_transition_hide:RLX.isRTL?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",_transition:"transform ease-in-out",_transition_time:225,uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},show:function(){this.trigger(statics.SHOW_EVT),this.query("close").addEventListener("click",this._onclosehandler=function(){this.hide()}.bind(this))},hide:function(){this.trigger(statics.HIDE_EVT),this.query("close").removeEventListener("click",this._onclosehandler)},kill:function(){this._details.kill(),this.query("close").removeEventListener("click",this._onclosehandler),this.recover()}}})},{"../events":36,"../stylesheet":56,"./RetailerDetailsView":33}],35:[function(require,module,exports){"use strict";module.exports=requirejs("lib/environment"),module.exports.geoloc=requirejs("modules/rlx-geolocation"),module.exports.debugJS&&(module.exports.geoloc.showPrices=function(){return!0},module.exports.geoloc.zone=function(){return"zone_h"},module.exports.geoloc.countryCode=function(){return"FR"})},{}],36:[function(require,module,exports){"use strict";var SAppEventRouter=requirejs("lib/SAppEventRouter");module.exports=SAppEventRouter.SAppEventRouter.events,module.exports.SAppEventRouter=SAppEventRouter,module.exports.eventRouter=SAppEventRouter.eventRouter},{}],37:[function(require,module,exports){"use strict";var Promise=jQuery.Deferred;module.exports.loadingPromise=new Promise},{}],38:[function(require,module,exports){"use strict";var i18n=requirejs("i18n"),confstoreloc=requirejs("config~dealerlocator"),env=requirejs("lib/environment"),numTrad=requirejs("modules/rlx-num-trad");module.exports={findRetailer:i18n("model/find-retailer"),hideRetailer:i18n("model/hide-retailer"),currentLocation:i18n("retailers/use-your-current-location"),showPrice:i18n("model/show-price"),hidePrice:i18n("model/hide-price"),configureButton:i18n("model/configure"),addWishlist:i18n("model/watch-added")+" (5/9)",viewWishlist:i18n("model/watch-add-full"),shareThisWatch:i18n("model/share-this-watch"),makeItYours:i18n("website/make-it-yours"),configHeader:i18n("model/configurator-header"),resetConfig:i18n("model/reset-configuration"),shareThisPage:i18n("share/share-this-page"),sidebar:{watchesTitle:i18n("model/rolex-watches"),pricingTitle:i18n("model/rolex-pricing-policies"),close:i18n("model/close")},share:{byEmail:i18n("share/email")},locator:{title:"Rolex retailer locator",findNearest:i18n("retailers/locator/use-current-location-link")},specs:{mobile:{title:i18n("model/specifications"),link:{open:i18n("model/open-detailed-specs"),close:i18n("model/close-detailed-specs")}}}},module.exports.wishlist={add:i18n("model/add-to-wishlist"),added:i18n("model/watch-added"),remove:i18n("model/remove-from-wishlist"),removed:i18n("/model/watch-removed"),full:i18n("model/watch-add-full-alert",numTrad.numTrad(9,["fa"])),show:i18n("model/watch-add-full")},module.exports.wishlist.page={findmyrolex:i18n("website/find-your-rolex"),downloadebrochure:i18n("model/download-brochure"),confirm:i18n("login/send-verification-email"),sharethismodel:i18n("model/share-this-watch"),discover:i18n("website/discover"),removethiswatch:i18n("model/remove-this-watch"),placholdertxt:i18n("wishlist/select-from-collections"),showPrice:i18n("model/show-price"),hidePrice:i18n("model/hide-price"),ref:i18n("/model/ref"),sidebar:{watchesTitle:i18n("model/rolex-watches"),pricingTitle:i18n("model/rolex-pricing-policies"),close:i18n("model/close")}},module.exports.wishlist.sidebar={noItems:i18n("your-wishlist-is-empty"),close:i18n("login/close"),title:i18n("wishlist/my-wishlist"),subtitle:i18n("wishlist/panel-description"),viewmoredetails:i18n("wishlist/panel-cta")},module.exports.specs={mobile:{title:i18n("model/specifications"),link:{open:i18n("model/open-detailed-specs"),close:i18n("model/close-detailed-specs")}}},module.exports.header={yourAccount:i18n("account/your-account"),myAccount:i18n("account/my-account"),account:i18n("account/_"),wishlist:i18n("website/wishlist")},module.exports.configurator={buttonBack:i18n("website/back"),title:i18n("model/configure-model"),close:i18n("website/close"),viewAll:"View all",wouldText:i18n("model/would-you-like-to-see")},module.exports.locator={header:"find a retailer",subHeader:"where to buy a rolex",type:"dealer",findNearest:i18n("retailers/locator/use-current-location-link"),sto:{country:{title:i18n("/retailers/locator/select-country"),type:"country"},region:{title:i18n("/retailers/locator/select-region"),type:"region"},city:{title:i18n("/retailers/locator/select-city"),type:"city"},district:{title:i18n("/retailers/locator/select-district"),type:"district"}},url:[env.baseUrl,confstoreloc["store-locator-base-url"]].join("")},module.exports.service={header:"find a servicing",subHeader:"where to service a rolex",type:"service",findNearest:i18n("retailers/locator/use-current-location-link"),sto:{country:{title:i18n("/retailers/locator/select-country"),type:"country"},region:{title:i18n("/retailers/locator/select-region"),type:"region"}},url:[env.baseUrl,confstoreloc["service-locator-base-url"]].join("")},module.exports.grids={"noresults-watches":{text:i18n("search/sorry-no-match"),more:i18n("search/please-try-another-combination-or-reset")}},module.exports.search={"new-noresults":{title:i18n("search/no-results-found"),text:i18n("search/please-try-another-keyword"),anchor:i18n("/search/back-to-the-home")}},module.exports.filters={show:i18n("model/filters/show-filters"),hide:i18n("model/filters/hide-filters"),reset:i18n("website/reset"),filter_the_results:i18n("model/filters/filter-results"),close:i18n("website/close"),viewtheresults:i18n("search/view-results"),selectcriterials:i18n("search/filters/title"),noresult:i18n("search/no-results-found"),backtomodel:i18n("website/back")}},{}],39:[function(require,module,exports){window.define("modules/rlx-model-page-v5.5",["utils","i18n","lib/SEventRouter","lib/environment","lib/SAppEventRouter","lib/SAppRouter","lib/UID","lib/Iterator","lib/Router","lib/Model","lib/ZenView","lib/Collection","lib/StyleSheet","lib/ClientRect","lib/Cookie","modules/rlx-transition","modules/rlx-history","modules/rlx-geolocation","modules/rlx-popins","modules/rlx-urlmapping","modules/rlx-user-data","cq-modules/rlx-wishlists-wrapper","modules/rlx-storage","modules/rlx-map","modules/rlx-ui","config~dealerlocator","modules/rlx-web-analytics","hbs!tpl/storelocator/retailer-new","config-members","modules/rlx-num-trad","views/PopinView"],function(){function main(){new AppZView,eventRouter.unwhen(events.routerReady,main)}var routes,uiRoute,uiRouter,AppEventRouter,AppRouter,AppZView,eventRouter,events,appRouter,i,env=require("./environment"),loadingPromise=require("./loadingPromise").loadingPromise,ui=requirejs("modules/rlx-ui");if(!env.debug_static){for(routes=require("./routes/model").routes,uiRoute=require("./routes/commons").routes,uiRouter=ui.router,AppEventRouter=requirejs("lib/SAppEventRouter").SAppEventRouter,AppRouter=requirejs("lib/SAppRouter"),AppZView=require("./core/SAppZView").SAppZView,eventRouter=new AppEventRouter,events=AppEventRouter.events,appRouter=new AppRouter(routes),eventRouter.when(events.routerReady,main),i=0;i<uiRoute.length;)uiRouter.when(uiRoute[i].path,uiRoute[i].handler),++i;return{loadingPromise:loadingPromise.promise}}})},{"./core/SAppZView":19,"./environment":35,"./loadingPromise":37,
"./routes/commons":50,"./routes/model":53}],40:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),env=require("../environment"),events=require("../events"),Animate=require("../core/Animate").Animate,sSto=requirejs("modules/rlx-storage").sessionStorage,RetailerContentCta=require("./CommonComponentsZView").RetailerContentCta;module.exports.CelliniRetailerCTAZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.isInWishlist=null,void function(self,exp,Anim){function onToggleContent(next,vars,data){return"retailer"===data.new?self._model.set("showCTA",!0):"retailer"===data.old&&self._model.set("showCTA",!1),next()}function onwillrender(next,vars){return events.eventRouter.off(events.modelContainerMapReady,showMapRetailer),events.eventRouter.off(events.modelCtaChangeContent,onToggleContent),events.eventRouter.off(events.appSwap,appSwap),events.eventRouter.off(events.appWillRender,onwillrender),next()}function appSwap(next,vars){return self._model.set("showCTA",!1),next()}function showMapRetailer(next,vars,data){return self.query("retailer-content").childNodes.length||new RetailerContentCta([self.query("retailer-content"),self._model.get("rmc")]),next()}exp=self._model.expand(),Anim=new Animate,self._model.on("change",function(key,newValue,oldValue){"showCTA"===key&&(newValue?Anim.height(self.query("retailer-content"),".4","px",env.mobile?"505":"900").then(function(){Anim.fadeIn(self.query("retailer-content"),".2").then(function(){setTimeout(function(){sSto.setItem("ctaBusy","0"),events.eventRouter.trigger(events.modelContainerMapReady)},100)})}):Anim.fadeOut(self.query("retailer-content"),".2").then(function(){Anim.height(self.query("retailer-content"),".4","px",0).then(function(){sSto.setItem("ctaBusy","0")})}))}),events.eventRouter.on(events.modelContainerMapReady,showMapRetailer),events.eventRouter.on(events.modelCtaChangeContent,onToggleContent),events.eventRouter.on(events.appSwap,appSwap),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"( .rlx-main-watch__content--item .rlx-main-watch__content--item-retailer .rlx-locator--extended @retailer-content)"}})},{"../core/Animate":12,"../environment":35,"../events":36,"./CommonComponentsZView":42}],41:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),ui=requirejs("modules/rlx-ui"),env=(ui.router,require("../environment")),events=require("../events"),MainWatch=(require("../locales"),require("./MainWatchCelliniZView").MainWatchCelliniZView),CTAConfig=require("./ConfiguratorOysterZView").ConfiguratorZView,EditorialContent=require("./EditorialZView").EditorialZView,SpecsZView=require("./SpecsZView").SpecsZView,DownloadContent=require("./EditorialZView").blocDownloadZView,MagazineContent=require("./EditorialZView").blocMagazineZView,CelliniRetailerCTAZView=(require("./EditorialZView").blocSocialEmbedZView,require("./CelliniRetailerCTAZView").CelliniRetailerCTAZView),WAglobalLoadingPage=require("./CommonComponentsZView").WAPageLoadingZView,sSto=(require("../core/Animate").Animate,requirejs("modules/rlx-storage").sessionStorage),SBreadcrumbZView=(requirejs("modules/rlx-storage").localStorage,require("../core/SBreadcrumbZView").SBreadcrumbZView),breadcrumb=(require("../core/SBreadcrumbZView").BreadcrumbItemZView,require("../core/SBreadcrumbZView").BreadcrumbAnchorZView,new SBreadcrumbZView);module.exports.CelliniZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,buttonList,expandModel,majestyModel,editorialModel,mainWatchModel,watchModel,newMainWatch,configuratorModel,priceModel,variationsModel){function beforeSwap(next,vars,data,lastActiveTab){return lastActiveTab=[self.$query("contain").find(".rlx-configurator-control-bar__list-item--active").index(),""].join(""),sSto.setItem("configurator.tab",lastActiveTab),next()}function afterSwap(next,vars,data,lazyLoad){var lastItem,WAdata;return lazyLoad=require("./utils").lazyLoading,new lazyLoad,env.mobile||1===sSto.getItem("beforeFirstSwap")||(lastItem=parseInt(breadcrumb._items.length-1,10),breadcrumb.get(lastItem)._model.set("text",majestyModel.referenceCode),breadcrumb.get(lastItem)._model.set("href",majestyModel.watch.page_link)),WAdata={rmc:mainWatchModel.rmc.toUpperCase(),family:mainWatchModel.familyCode,price:mainWatchModel.price&&mainWatchModel.price.hasPrice?mainWatchModel.price.rawPrice:0,path:location.pathname,showPriceState:!!mainWatchModel.price&&mainWatchModel.price.showPriceState},WAglobalLoadingPage(WAdata),next()}function onwillrender(next,vars,data){return events.eventRouter.off(events.appBeforeSwap,beforeSwap),events.eventRouter.off(events.appAfterSwap,afterSwap),events.eventRouter.off(events.appWillRender,onwillrender),next()}expandModel=self._model.expand(),majestyModel=expandModel.majesty,editorialModel=expandModel.editorial,mainWatchModel=majestyModel.mainWatch,watchModel=majestyModel.watch,newMainWatch=jQuery.extend({},mainWatchModel,watchModel),configuratorModel=majestyModel.configurator,priceModel=expandModel.price,sSto.removeItem("configIsHidden"),sSto.removeItem("ctaBusy"),self.query("contain").appendChild(new MainWatch(newMainWatch).borrow()),self.query("contain").appendChild(new CTAConfig(configuratorModel).borrow()),self.query("contain").appendChild(new CelliniRetailerCTAZView(configuratorModel).borrow()),self.query("contain").appendChild(new EditorialContent(editorialModel).borrow()),self.query("contain").appendChild(new SpecsZView(majestyModel).borrow()),self.query("contain").appendChild(new DownloadContent(editorialModel).borrow()),self.query("contain").appendChild(new MagazineContent(editorialModel).borrow()),events.eventRouter.on(events.appBeforeSwap,beforeSwap),events.eventRouter.on(events.appAfterSwap,afterSwap),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"div.rlx-model-page.rlx-model-page--cellini@contain"}})},{"../core/Animate":12,"../core/SBreadcrumbZView":20,"../environment":35,"../events":36,"../locales":38,"./CelliniRetailerCTAZView":40,"./CommonComponentsZView":42,"./ConfiguratorOysterZView":43,"./EditorialZView":44,"./MainWatchCelliniZView":45,"./SpecsZView":48,"./utils":49}],42:[function(require,module,exports){"use strict";var CtaButtonZView,WishlistContentZView,SocialContentZView,RetailerContentCta,gmap,Service,LocatorZView,LocatorFallbackZView,confObj,retailersAPI,DealerAutosuggestionZView,LocatorGeolocationButtonZView,getAllDealers,getInventory,countryCode,CtaContentZView,WishlistContentEventsKlass,WishlistContentTemplate00ZView,WishlistContentTemplate10ZView,WishlistContentTemplate11ZView,WishlistContentTemplate12ZView,klass=requirejs("utils").classMaker,ZView=(requirejs("utils").singleton,requirejs("lib/ZenView")),Model=requirejs("lib/Model"),env=require("../environment"),ui=requirejs("modules/rlx-ui"),UIRouter=ui.router,NavPane=env.mobile?ui.MobileNavPane:ui.NavPane,events=require("../events"),locales=require("../locales"),Animate=require("../core/Animate").Animate,_=requirejs("require/hbs/underscore"),SharePopinZView=require("../common/SharePopinZView").SharePopinZView,UtilsConfigurator=require("./ConfiguratorOysterZView").ConfiguratorUtils,wrapWishlist=requirejs("cq-modules/rlx-wishlists-wrapper"),RmcUtils=requirejs("modules/rmc"),numTrad=requirejs("modules/rlx-num-trad"),sSto=requirejs("modules/rlx-storage").sessionStorage,lSto=requirejs("modules/rlx-storage").localStorage,rlxDataLayer=requirejs("modules/rlx-data-layer"),SidebarPrice=new(require("../common/side-bar/PriceInfoZView").sidebarPrice),killSwitch=requirejs("config-members").membersKillSwitch||!0,userland=null;require("korbutJS/src/Promise").Promise;killSwitch||(userland=requirejs("modules/rlx-userland-v5.6")),gmap=requirejs("modules/rlx-map"),Service=require("../core/Service").Service,LocatorZView=require("../dealers/LocatorZView").LocatorZView,LocatorFallbackZView=require("../dealers/LocatorFallbackZView").LocatorFallbackZView,confObj=require("../core/Service").confCSTLS,retailersAPI=require("../core/Service").retailersAPI,DealerAutosuggestionZView=require("../dealers/DealerAutosuggestionZView").DealerAutosuggestionZView,LocatorGeolocationButtonZView=require("../dealers/LocatorGeolocationButtonZView").LocatorGeolocationButtonZView,getAllDealers=new Service(retailersAPI.urls.establishments,confObj),getInventory=new Service(retailersAPI.urls.rmc,function(nuObj,oldObj){return nuObj={processData:!0,data:{langCode:oldObj.data.langCode,brand:"RLX"}},nuObj.data.countryCode=confObj.data.countryCodeGeofencing,nuObj}({},confObj)),countryCode=function(CC){return"undefined"!=typeof CC&&"undefined"!=typeof CC.get&&"undefined"!=typeof CC.get("geolocation").getProperty?CC.get("geolocation").getProperty("countryCode"):null}(window.ClientContext),module.exports.descLineAndPrice=klass(ZView,function(Super,statics){return{constructor:function(){return Super.apply(this,arguments),function(self){function onwillrender(next,vars){return events.eventRouter.off(events.appAfterSwap,appAfterSwap),events.eventRouter.off(events.priceClick,toggleDisplayPrice),events.eventRouter.off(events.openPriceInfo,openPriceSideBar),SidebarPrice.off(NavPane.HIDE_EVT,hidePriceInfo),events.eventRouter.off(events.appWillRender,onwillrender),next()}function appAfterSwap(next,vars){return Anim.fadeIn(self.query("descLine"),".5"),self._model.set("cta.showPriceState",self._model.get("price.showPriceState")),next()}function hidePriceInfo(next,vars,data){self.query("moreInfoPrice").classList.remove("rlx-price-info-active")}function openPriceSideBar(next,vars,data){return self.query("moreInfoPrice")==data.el&&(self.query("moreInfoPrice").classList.add("rlx-price-info-active"),UIRouter.dispatch("/ui/side/price",{data:sidebarModel}),sSto.getItem("configuratorIsOpen")&&events.eventRouter.trigger(events.configuratorClick)),next()}function toggleDisplayPrice(next,vars,data){var targetDom=env.mobile?self.query("priceBlock"):self.query("descLine");return Anim.fadeOut(targetDom,".3").then(function(){data.active?(env.mobile||(self.query("priceBlock").style["min-width"]="170px"),self.query("priceBlock").classList.remove("rlx-main-watch__title--price-reduce"),lSto.setItem("priceHidden",!1),self._model.set("hidePrice",locales.hidePrice),self.query("mountPrice").style.display="inline-block",self.query("moreInfoPrice").style.display="inline-block"):(env.mobile||(self.query("priceBlock").style["min-width"]="60px"),self.query("priceBlock").classList.add("rlx-main-watch__title--price-reduce"),lSto.setItem("priceHidden",!0),self._model.set("hidePrice",locales.showPrice),self.query("mountPrice").style.display="none",self.query("moreInfoPrice").style.display="none"),setTimeout(function(){self.query("priceBlock").style["min-width"]=data.active?"130px":"60px",Anim.fadeIn(targetDom,".3")},200)}),next()}var sidebarModel,Anim=new Animate;events.eventRouter.on(events.appAfterSwap,appAfterSwap),events.eventRouter.on(events.priceClick,toggleDisplayPrice),events.eventRouter.on(events.openPriceInfo,openPriceSideBar),SidebarPrice.on(NavPane.HIDE_EVT,hidePriceInfo),events.eventRouter.on(events.appWillRender,onwillrender),sidebarModel=self._model.expand().price?self._model.expand().price.sidebar:{},self.$query("showPrice").on("click",function(e){e.preventDefault();var statePrice="undefined"!=typeof lSto.getItem("priceHidden")&&null!==lSto.getItem("priceHidden")&&lSto.getItem("priceHidden");events.eventRouter.trigger(events.priceClick,{active:statePrice,el:this.parentNode})}),self.$query("moreInfoPrice").on("click",function(e){e.preventDefault(),events.eventRouter.trigger(events.openPriceInfo,{el:this})}),lSto.getItem("priceHidden")&&self._model.get("price.hasPrice")&&events.eventRouter.trigger(events.priceClick,{active:!1}),sidebarModel.showPrice||self.$query("priceBlock").remove(),sidebarModel.hasPrice?self.query("priceBlock").classList.add("rlx-main-watch__title--price-mount-numerical"):self.$query("showPrice").remove()}(this)},_template:"  div.rlx-main-watch__description@descLine >                           (span.rlx-main-watch__title--resume@resume{$description}                             + (span.rlx-main-watch__title--price@priceBlock >                                 (span.rlx-main-watch__title--price-mount{$price.amount}@mountPrice                                 + a.rlx-main-watch__title--price-button@showPrice{$hidePrice}                                 + a.rlx-main-watch__title--price-button-info@moreInfoPrice)))"}}),module.exports.CtaMainControllerZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,modelpage,ctaModel){function onwillrender(next,vars){return events.eventRouter.off(events.ctaToggleEvent,onToggleCTA),events.eventRouter.off(events.modelCtaChangeContent,onToggleContent),events.eventRouter.off(events.appWillRender,onwillrender),next()}function onToggleCTA(next,vars,data){return data.way?self.buttonContentSlideDown():self.buttonContentSlideUp(),next()}function autoScroll(){var scroll=window.scrollY,ctaPos=jQuery(".rlx-main-watch__cta-component").offset().top,navH=jQuery(".rlx-site-nav").height(),winH=parseInt((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-jQuery(".rlx-configurator__control-bar").height()-navH,10),ctaBarH=jQuery(".rlx-main-watch__cta-bar").outerHeight(!0),ctaContentH=jQuery(".rlx-main-watch__content--item-wishlist").outerHeight(!0),bottomCTA=parseInt(ctaPos+ctaBarH+(ctaContentH<105?105:ctaContentH)-(scroll+navH),10),scrollValue=parseInt(bottomCTA-winH+scroll,10);bottomCTA>winH&&jQuery("html, body").animate({scrollTop:[scrollValue,"px"].join("")},300)}function onToggleContent(next,vars,data){return data&&"retailer"===data.new&&"oyster"===sSto.getItem("model-type")&&self.buttonContentSlideDown(env.mobile?500:890,".4").then(function(){events.eventRouter.trigger(events.modelContainerMapReady)}),data&&null!=data.new&&"retailer"===data.old&&"oyster"===sSto.getItem("model-type")&&self.buttonContentSlideDown(),"wishlist"!==data.new&&"social"!==data.new||sSto.getItem("isAnna")||autoScroll(),next()}modelpage=require("./utils").info,ctaModel=self._model.expand().cta,modelpage.isCellini&&self.$query("watch-info-divider").remove(),self.query("cta-button-bar").appendChild(new CtaButtonZView(ctaModel).borrow()),self.query("cta-content").appendChild(new CtaContentZView(self._model).borrow()),events.eventRouter.on(events.ctaToggleEvent,onToggleCTA),events.eventRouter.on(events.modelCtaChangeContent,onToggleContent),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"div.rlx-main-cta-text@cta-main >       (div.rlx-main-watch__cta-bar@cta-button-bar       + div.rlx-main-watch__cta-content.rlx-main-watch__cta-main-content@cta-content       + span.rlx-main-watch__divider@watch-info-divider)",buttonContentSlideDown:function(height,speed,Anim,self){return self=this,Anim=new Animate,Anim.fadeIn(self.query("watch-info-divider"),".2"),self.query("watch-info-divider").style.display="block",Anim.height(self.query("cta-content"),"undefined"!=typeof speed?speed:".2","px","undefined"!=typeof height?height:"100").then(function(){})},buttonContentSlideUp:function(Anim,self){return self=this,Anim=new Animate,Anim.fadeOut(self.query("watch-info-divider"),".2"),self.query("watch-info-divider").style.display="",Anim.height(self.query("cta-content"),".2","px","0").then(function(){})}}}),CtaContentZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,modelpage,exp){function showMapRetailer(next,vars,data){return events.eventRouter.trigger(events.scrollTablet),modelpage.isOyster&&(self.query("retailer-content").childNodes.length||new RetailerContentCta([self.query("retailer-content"),self._model.get("rmc")])),next()}function toggleContent(next,vars,data){return data&&self.toggleContent(data.new,data.old),next()}function onwillrender(next,vars){return events.eventRouter.off(events.modelContainerMapReady,showMapRetailer),events.eventRouter.off(events.modelCtaChangeContent,toggleContent),events.eventRouter.off(events.appWillRender,onwillrender),next()}modelpage=require("./utils").info,exp=self._model.expand(),modelpage.isCellini&&self.$query("retailer-content").remove(),env.mobile||self.query("social-content").appendChild(new SocialContentZView(exp.social).borrow()),self.query("wishlist-content").appendChild(new WishlistContentZView(exp.wishlist).borrow()),events.eventRouter.on(events.modelContainerMapReady,showMapRetailer),events.eventRouter.on(events.modelCtaChangeContent,toggleContent),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:".rlx-main-watch__content--item-retailer.rlx-main-watch__content--item.rlx-locator--extended@retailer-content                           + .rlx-main-watch__content--item-wishlist.rlx-main-watch__content--item@wishlist-content                           + .rlx-main-watch__content--item-social.rlx-main-watch__content--item.rlx-configurator--remove-mobile@social-content",toggleContent:function(newItem,oldItem,self,target,targetNew,targetOld,Anim,modelpage){self=this,Anim=new Animate,modelpage=require("./utils").info,oldItem&&(targetOld=self.query([oldItem,"-content"].join("")),targetOld&&Anim.fadeOut(targetOld,".2").then(function(){self.updateZindex(targetOld,"0"),targetOld.style.display="none",setTimeout(function(){modelpage.isCellini?"retailer"!==newItem&&"retailer"!==oldItem&&sSto.setItem("ctaBusy","0"):sSto.setItem("ctaBusy","0")},300)})),newItem&&(targetNew=self.query([newItem,"-content"].join("")),targetNew&&(targetNew.style.display="block",Anim.fadeIn(targetNew,".2").then(function(){self.updateZindex(targetNew,"1"),setTimeout(function(){modelpage.isCellini?"retailer"!==newItem&&"retailer"!==oldItem&&sSto.setItem("ctaBusy","0"):sSto.setItem("ctaBusy","0")},300)})))},updateZindex:function(obj,z){"undefined"!=typeof z&&"undefined"!=typeof obj&&(obj.style.zIndex=z)}}}),module.exports.CtaButtonZView=CtaButtonZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.activeButtonClass="rlx-main-watch__cta-bar-link--active",statics.isInWishlist=null,statics.maxItems=9,statics.rmc=this._model.get("rmc"),void function(self,root,wishlistButton,modelpage,isAlreadyAddedOnWishlist){function onOpenConfigurator(next,vars,data){return self._model.get("ctaIsOpen")&&(self._model.set("ctaIsOpen",!1),self._model.set("ctaActiveButton",null)),next()}function toggleCtaButtons(next,vars,data,utilsConf,buttonType,configIsOpen){if(parseInt(sSto.getItem("ctaBusy"),10))return next();switch(sSto.setItem("ctaBusy","1"),utilsConf=new UtilsConfigurator,buttonType=vars.request.split("/")[1],configIsOpen=sSto.getItem("configuratorIsOpen"),statics.isInWishlist=sSto.getItem("isAlreadyAddedOnWishlist"),statics.isTabletMode=utilsConf.checkIsSmallLayout(),configIsOpen&&events.eventRouter.trigger(events.configuratorClick),"undefined"!=typeof buttonType&&"string"==typeof buttonType&&("configure"!=buttonType?self._model.get("ctaActiveButton")?self._model.get("ctaActiveButton")===buttonType?(self._model.set("ctaIsOpen",!1),self._model.set("ctaActiveButton",null)):(self._model.set("ctaActiveButton",buttonType),self._model.set("ctaIsOpen")||self._model.set("ctaIsOpen",!0),"retailer"===buttonType&&modelpage.isCellini&&self._model.set("ctaIsOpen",!1)):(self._model.set("ctaActiveButton",buttonType),(modelpage.isCellini&&"retailer"!==buttonType||modelpage.isOyster)&&self._model.set("ctaIsOpen",!0)):(self._model.set("ctaIsOpen",!1),self._model.set("ctaActiveButton",null),events.eventRouter.trigger(events.configuratorClick))),self.toggleBtnTxt(),buttonType){case"wishlist":self._model.get("ctaIsOpen")?statics.isInWishlist?events.eventRouter.trigger(events.ctaWishlistChangeView,{template:"12"}):events.eventRouter.trigger(events.ctaWishlistAdd):!statics.isInWishlist&&sSto.getItem("wishlist-size")<statics.maxItems&&setTimeout(function(){wishlistButton.classList.add("wa-model-addtowishlist-cta"),wishlistButton.setAttribute("data-product-category",self._model.get("familyTitle")),wishlistButton.setAttribute("data-product-id",self._model.get("rmc").toUpperCase()),wishlistButton.setAttribute("data-product-price",self._model.get("price")||self._model.get("price.price"))},100)}return next()}function onActiveWishlist(next,vars){return wishlistButton.classList.add("rlx-added"),setTimeout(function(){wishlistButton.classList.remove("wa-model-addtowishlist-cta"),wishlistButton.removeAttribute("data-product-category"),wishlistButton.removeAttribute("data-product-id"),wishlistButton.removeAttribute("data-product-price")},100),next()}function onInactiveWishlist(next,vars){return wishlistButton.classList.remove("rlx-added"),next()}function onAddToWishlist(next,vars,data){return!sSto.getItem("wishlist-size")&&window._satellite&&window._satellite.track("wishlistCreated"),sSto.getItem("isAlreadyAddedOnWishlist")?events.eventRouter.trigger(events.ctaWishlistChangeView,{template:"12"}):self.updateSizeOfWishlist(!0)&&wrapWishlist.addRmc(statics.rmc,statics.maxItems).done(function(listRmc){sSto.setItem("isAlreadyAddedOnWishlist",!0),events.eventRouter.trigger(events.ctaWishlistActive),events.eventRouter.trigger(events.ctaWishlistChangeView,{template:"10"}),UIRouter.dispatch("/ui/side/reload/wishlist"),userland&&userland.cacheManager.reload()}),next()}function onRemoveToWishlist(next,vars){return self.updateSizeOfWishlist(!1),wrapWishlist.removeRmc(statics.rmc).done(function(resp){sSto.setItem("isAlreadyAddedOnWishlist",!1),events.eventRouter.trigger(events.ctaWishlistInactive),events.eventRouter.trigger(events.ctaWishlistChangeView,{template:"11"}),UIRouter.dispatch("/ui/side/reload/wishlist"),userland&&userland.cacheManager.reload()}),next()}function onCheckToWishlist(next,vars,currentRmc){return currentRmc=statics.rmc,wrapWishlist.getRmcArray().done(function(listRmc,isAlreadyAdded){isAlreadyAdded=RmcUtils.indexOf(listRmc,currentRmc)!==-1,sSto.setItem("wishlist-size",listRmc.length),isAlreadyAdded?(events.eventRouter.trigger(events.ctaWishlistActive),sSto.setItem("isAlreadyAddedOnWishlist",!0),statics.isInWishlist=!0):(sSto.setItem("isAlreadyAddedOnWishlist",!1),statics.isInWishlist=!1)}),next()}function positionScrollMode(next,vars){var scrollDesktopResp=parseInt(jQuery(".rlx-main-watch__description").offset().top-60,10),scrollMobileResp=sSto.getItem("isAnna")?scrollDesktopResp:300,scrollValue=env.mobile?scrollMobileResp:scrollDesktopResp;return jQuery("html, body").animate({scrollTop:[scrollValue,"px"].join("")},300),next()}function onwillrender(next,vars){return self.$query("retailer-button").off("click"),self.$query("configure-button").off("click"),self.$query("wishlist-button").off("click"),self.$query("social-button").off("click"),events.eventRouter.off(events.ctaWishlistActive,onActiveWishlist),events.eventRouter.off(events.ctaWishlistInactive,onInactiveWishlist),events.eventRouter.off(events.ctaWishlistAdd,onAddToWishlist),events.eventRouter.off(events.ctaWishlistRemove,onRemoveToWishlist),events.eventRouter.off(events.ctaWishlistCheck,onCheckToWishlist),events.eventRouter.off(events.wlClick,toggleCtaButtons),events.eventRouter.off(events.shareClick,toggleCtaButtons),events.eventRouter.off(events.retailerClick,toggleCtaButtons),events.eventRouter.off(events.ctaconfigureClick,toggleCtaButtons),events.eventRouter.off(events.configOpen,onOpenConfigurator),events.eventRouter.off(events.scrollTablet,positionScrollMode),events.eventRouter.off(events.appWillRender,onwillrender),next()}root=self.root(),wishlistButton=self.query("wishlist-button"),modelpage=require("./utils").info,sSto.setItem("ctaBusy","0"),events.eventRouter.on(events.ctaWishlistActive,onActiveWishlist),events.eventRouter.on(events.ctaWishlistInactive,onInactiveWishlist),events.eventRouter.on(events.ctaWishlistAdd,onAddToWishlist),events.eventRouter.on(events.ctaWishlistRemove,onRemoveToWishlist),events.eventRouter.on(events.ctaWishlistCheck,onCheckToWishlist),events.eventRouter.on(events.configOpen,onOpenConfigurator),events.eventRouter.on(events.ctaconfigureClick,toggleCtaButtons),events.eventRouter.on(events.wlClick,toggleCtaButtons),events.eventRouter.on(events.shareClick,toggleCtaButtons),events.eventRouter.on(events.retailerClick,toggleCtaButtons),events.eventRouter.on(events.scrollTablet,positionScrollMode),events.eventRouter.on(events.appWillRender,onwillrender),self._model.on("change",function(key,value,oldValue,target,oldTarget){switch(target=null,oldTarget=null,key){case"ctaIsOpen":switch(self._model.get("ctaActiveButton")){case"retailer":self._model.set("findRetailer",value?locales.hideRetailer:locales.findRetailer),value||events.eventRouter.trigger(events.ctaToggleEvent,{way:value});break;default:events.eventRouter.trigger(events.ctaToggleEvent,{way:value}),self._model.set("findRetailer",locales.findRetailer)}break;case"ctaActiveButton":value&&(target=[value,"-button"].join("")),oldValue&&(oldTarget=[oldValue,"-button"].join("")),events.eventRouter.trigger(events.modelCtaChangeContent,{new:value,old:oldValue}),!oldValue&&value&&self.query(target)?self.query(target).classList.add(statics.activeButtonClass):oldValue&&value&&oldValue!=value?(self.query(target).classList.add(statics.activeButtonClass),self.query(oldTarget).classList.remove(statics.activeButtonClass)):oldTarget&&self.query(oldTarget)&&self.query(oldTarget).classList.remove(statics.activeButtonClass)}}),self._model.get("hasVariations")||self.$query("configure-button").remove(),events.eventRouter.trigger(events.ctaWishlistCheck),!statics.isInWishlist&&sSto.getItem("wishlist-size")<statics.maxItems&&(wishlistButton.classList.add("wa-model-addtowishlist-cta"),wishlistButton.setAttribute("data-product-category",self._model.get("familyCode")),wishlistButton.setAttribute("data-product-id",self._model.get("rmc").toUpperCase()),wishlistButton.setAttribute("data-product-price",self._model.get("price")||self._model.get("price.price"))),void 0!=self._model.get("hasConfig")&&self._model.get("hasConfig")===!1&&self.$query("configure-button").remove(),self.$query("configure-button").on("click",function(e){e.preventDefault(),events.eventRouter.trigger(events.ctaconfigureClick)}),self.$query("retailer-button").on("click",function(e){e.preventDefault(),parseInt(sSto.getItem("ctaBusy"),10)||events.eventRouter.trigger(events.retailerClick,{index:0})}),self.$query("wishlist-button").on("click",function(e){e.preventDefault(),events.eventRouter.trigger(events.wlClick,{index:1})}),env.mobile||self.$query("social-button").on("click",function(e){e.preventDefault(),events.eventRouter.trigger(events.shareClick,{index:2})})}(this)},_template:env.mobile?"  (a.rlx-main-watch__cta-bar-link.rlx-configurator--remove-mobile.rlx-main-watch__cta-bar-link--configure@configure-button > span{$configure})                                                 + (a.rlx-main-watch__cta-bar-link.rlx-main-watch__cta-bar-link--text.rlx-main-watch__cta-bar-link--retailer@retailer-button > span@retailer-button-text{$findRetailer})                                                 + a.rlx-main-watch__cta-bar-link.rlx-main-watch__cta-bar-link--wishlist@wishlist-button":"  (a.rlx-main-watch__cta-bar-link.rlx-main-watch__cta-bar-link--configure@configure-button > span{$configure})                                                 + (a.rlx-main-watch__cta-bar-link.rlx-main-watch__cta-bar-link--retailer@retailer-button > span@retailer-button-text{$findRetailer})                                                 + a.rlx-main-watch__cta-bar-link.rlx-main-watch__cta-bar-link--wishlist@wishlist-button                                                 + a.rlx-main-watch__cta-bar-link.rlx-configurator--remove-mobile.rlx-main-watch__cta-bar-link--social@social-button",updateSizeOfWishlist:function(update,sized,nSize){if(sized=sSto.getItem("wishlist-size")?parseInt(sSto.getItem("wishlist-size"),10):0,update){if(sized+1>statics.maxItems)return events.eventRouter.trigger(events.ctaWishlistChangeView,{template:"00"}),!1;nSize=sized+1}else nSize=sized-1;return events.eventRouter.trigger(events.wishlistUpdateSize,{newSize:nSize}),!0},toggleBtnTxt:function(self){switch(self=this,self._model.get("ctaActiveButton")){case"retailer":self._model.set("findRetailer",locales.hideRetailer);break;default:self._model.set("findRetailer",locales.findRetailer)}}}}),module.exports.SocialContentZView=SocialContentZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,pop,data){function openPopup(e){return e.preventDefault(),events.eventRouter.trigger(events.modelSocialClick,this),!1}function openPopin(e){e.preventDefault(),events.eventRouter.trigger(events.modelSharingPopinClick,{form:!!e.data&&e.data.form})}function openSocialPopup(next,vars,e,platform,social){return platform=e.getAttribute("data-platform"),social=_.find(self._model.get("social_network_links"),function(v){if(v["platform-key"].toLowerCase()===platform)return v.href}),window.open(social.href,"social","height=500, width=500"),next()}function openSocialPopin(next,vars,data){return pop=new SharePopinZView(self._model),pop.show(),data&&data.form&&setTimeout(function(){var steps=document.querySelector(".rlx-popin-model-share-by-js").querySelectorAll(".rlx-steps");steps[0].classList.remove("rlx-active"),steps[1].classList.add("rlx-active")},10),next()}function onwillrender(next,vars){return self.$query("more").off("click",openPopin),self.$query("mail").off("click",openPopin),self.$query("facebook").off("click",openPopup),self.$query("twitter").off("click",openPopup),self.$query("pinterest").off("click",openPopup),jQuery("#rlx-share-trigger").off("click"),events.eventRouter.off(events.modelSocialClick,openSocialPopup),events.eventRouter.off(events.modelSharingPopinClick,openSocialPopin),events.eventRouter.off(events.appWillRender,onwillrender),next()}self._model.set("modelPageUrl",location.href),self.query("facebook").setAttribute("data-product-id",self._model.get("rmc").toUpperCase()),self.query("twitter").setAttribute("data-product-id",self._model.get("rmc").toUpperCase()),self.query("pinterest").setAttribute("data-product-id",self._model.get("rmc").toUpperCase()),self.$query("more").on("click",openPopin),self.$query("mail").on("click",{form:!0},openPopin),self.$query("facebook").on("click",openPopup),self.$query("twitter").on("click",openPopup),self.$query("pinterest").on("click",openPopup),jQuery("#rlx-share-trigger").off("click").on("click",openPopin),events.eventRouter.on(events.modelSocialClick,openSocialPopup),events.eventRouter.on(events.modelSharingPopinClick,openSocialPopin),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"p{$shareTitle}                           + div.rlx-share >                                 a .rlx-share__item .rlx-icon .rlx-share__mail .rlx-icon--envelope @mail[href=#]                              + a .rlx-share__item .rlx-icon .rlx-share__facebook .rlx-icon--facebook .wa-tracking-share .wa-share-product [data-platform=facebook] [data-product-category=$family][href=#] @facebook                              + a .rlx-share__item .rlx-icon .rlx-share__twitter .rlx-icon--twitter .wa-tracking-share .wa-share-product [data-platform=twitter] [data-product-category=$family][href=#] @twitter                              + a .rlx-share__item .rlx-icon .rlx-share__pinterest .rlx-icon--pinterest .wa-tracking-share .wa-share-product [data-platform=pinterest][data-product-category=$family][href=#] @pinterest                              + a .rlx-share__item .rlx-share__more .rlx-icon rlx-icon--ellipsis[href=#] @more"}}),module.exports.WAPageLoadingZView=function(data){rlxDataLayer.dataLayer&&(rlxDataLayer.dataLayer.page||(rlxDataLayer.dataLayer.page={}),rlxDataLayer.dataLayer.page.functionalURL=data.path,rlxDataLayer.dataLayer.page.products||(rlxDataLayer.dataLayer.page.products={}),
rlxDataLayer.dataLayer.page.products.detail=[{id:data.rmc,category:data.family}],data.showPriceState&&(rlxDataLayer.dataLayer.page.products.detail[0].price=data.price),rlxDataLayer.trackPageView())},module.exports.RetailerContentCta=RetailerContentCta=klass(ZView,function(Super,statics){return{constructor:function(data){Super.apply(this,arguments),void function(self,container,RMC){function init(obj,searchview,locview,butview,locmdl,reqalldealers){function onready(){locview._map._mc.resetViewport(),locview._map._mc.redraw(),locview._onReady()}obj=jQuery.extend({},locales.locator,obj),searchview=DealerAutosuggestionZView.make(obj.map?{typeSearch:"DEALER"}:{typeSearch:"DEALER,AUTOCOMPLETE"},obj.map),locmdl=new Model(obj),butview=new LocatorGeolocationButtonZView(locmdl),locview=obj.map?new LocatorZView(locmdl):new LocatorFallbackZView(locmdl),DealerAutosuggestionZView.linkToLocator(searchview,locview),self._storeloc={searchview:searchview,butview:butview,locview:locview},container.className+=" rlx-locator--dealer",container.appendChild(searchview.borrow()),container.appendChild(butview.borrow()),container.appendChild(locview.borrow()),obj.map||(locview.trigger(LocatorZView.READY_EVT),locview.on(LocatorFallbackZView.REFRESH_EVT,function(){LocatorFallbackZView.makeScroll(locview)})),reqalldealers=obj.map?function(rmc,obj){return obj={},"service"==locview._model.get("type")?obj.establishmentType="STORE,SERVICECENTER,AFFILIATE":obj.establishmentType="STORE",getAllDealers.request(obj)}(obj.rmc):null,locview.init(null,!!countryCode).then(function(res){return reqalldealers&&reqalldealers.then(function(res){return locview._map.mergeMarkers(res,onready),locview._ready},noop).catch(noop),obj.map?(countryCode||locview._map.setZoom(2),void locview._model.on("change",function(k,v,pushmarker){"places"==k&&obj.map&&(pushmarker=null,locview._model.get("activeMarker")&&locview._map.forEachMarkers(function(marker){marker.get("rolexId")==locview._model.get("activeMarker")&&(pushmarker=marker.get("type"))}),window._satellite&&"STORE"==pushmarker?window._satellite.track("storePreview"):window._satellite&&pushmarker&&window._satellite.track("servicePreview"))})):null},noop).catch(noop)}function noop(err){}container=data[0],RMC=data[1],gmap.load().then(function(){init({map:!0,"no-list":!0,onModelPage:!0,rmc:RMC})},function(err){noop(err),init({map:!1,"no-list":!1,scrollbars:!0,onModelPage:!0,rmc:RMC})})}(this)},kill:function(){this.recover()}}}),module.exports.WishlistContentZView=WishlistContentZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,modelCases){function onToggleCTA(next,vars,data){return data.way||self.eraseContent(),next()}function onChangeContent(next,vars,opts){return opts&&opts.template&&(self._model.get("currentTemplate")||self._model.set("currentTemplate",opts.template),self.fadeOut("0.2s").then(function(){switch(self.eraseContent(),opts.template){case"00":self.query("content").appendChild(new WishlistContentTemplate00ZView(modelCases).borrow());break;case"10":self.query("content").appendChild(new WishlistContentTemplate10ZView(modelCases).borrow());break;case"11":self.query("content").appendChild(new WishlistContentTemplate11ZView(modelCases).borrow());break;case"12":self.query("content").appendChild(new WishlistContentTemplate12ZView(modelCases).borrow());break;default:self.query("content").appendChild(new WishlistContentTemplate12ZView(modelCases).borrow())}self.fadeIn("0.1s")})),next()}function onwillrender(next,vars){return events.eventRouter.off(events.ctaToggleEvent,onToggleCTA),events.eventRouter.off(events.ctaWishlistChangeView,onChangeContent),events.eventRouter.off(events.appWillRender,onwillrender),next()}modelCases={show:self._model.get("locales.show"),add:self._model.get("locales.add"),added:self._model.get("locales.added"),remove:self._model.get("locales.remove"),removed:self._model.get("locales.removed"),full:self._model.get("locales.full"),showHref:[RLX.isAuthor?"/content/rolexcom":"",RLX.urlLang?"/"+RLX.urlLang:"","/wishlist.html"].join(""),rmc:self._model.get("rmc").toUpperCase(),familyTitle:self._model.get("familyTitle"),price:self._model.get("price")?self._model.get("price"):0},events.eventRouter.on(events.ctaWishlistChangeView,onChangeContent),events.eventRouter.on(events.ctaToggleEvent,onToggleCTA),events.eventRouter.on(events.appWillRender,onwillrender),self.query("content").appendChild(new WishlistContentTemplate12ZView(modelCases).borrow())}(this)},_template:"div.rlx-main-watch__content--wishlist-content@content",fadeOut:function(timing,self,Anim){return self=this,Anim=new Animate,Anim.fadeOut(self.query("content"),timing)},fadeIn:function(timing,self,Anim){return self=this,Anim=new Animate,Anim.fadeIn(self.query("content"),timing)},eraseContent:function(self){self=this,self.query("content").innerHTML=""}}}),WishlistContentEventsKlass=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self){function onwillrender(next,vars){return self.$query("remove").off("click",onRemove),self.$query("add").off("click",onAdd),events.eventRouter.off(events.appWillRender,onwillrender),next()}function onRemove(e){e.preventDefault(),events.eventRouter.trigger(events.ctaWishlistRemove)}function onAdd(e){e.preventDefault(),events.eventRouter.trigger(events.ctaWishlistAdd)}self.$query("remove").on("click",onRemove),self.$query("add").on("click",onAdd),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_getSize:function(){var sizeSaved=sSto.getItem("wishlist-size")?parseInt(sSto.getItem("wishlist-size"),10):0;return sizeSaved}}}),WishlistContentTemplate00ZView=klass(WishlistContentEventsKlass,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments)},_template:"(p > span.rlx-main-watch__content-wishlist--full@full{$full}) +                         (p > a.rlx-main-watch__content-wishlist--show[href=$showHref]{$show})"}}),WishlistContentTemplate10ZView=klass(WishlistContentEventsKlass,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,addedUpdated){addedUpdated=[self._model.get("added")," (",numTrad.numTrad(self._getSize(),["fa"]),"/",numTrad.numTrad(9,["fa"]),")"].join(""),self._model.set("added",addedUpdated)}(this)},_template:"(p > span.rlx-main-watch__content-wishlist--added{$added}@added) +                         (p > a.rlx-main-watch__content-wishlist--remove.wa-wishlist-removeproduct@remove[href=#][data-product-category=$familyTitle][data-product-id=$rmc][data-product-price=$price] {$remove}) +                         (p > a.rlx-main-watch__content-wishlist--show[href=$showHref]{$show})"}}),WishlistContentTemplate11ZView=klass(WishlistContentEventsKlass,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,removedUpdated){removedUpdated=[self._model.get("removed")," (",numTrad.numTrad(self._getSize(),["fa"]),"/",numTrad.numTrad(9,["fa"]),")"].join(""),self._model.set("removed",removedUpdated)}(this)},_template:"(p > span.rlx-main-watch__content-wishlist--removed{$removed}@removed) +                         (p > a.rlx-main-watch__content-wishlist--add.wa-model-addtowishlist-cta[href=#][data-rmc=$rmc][data-product-category=$familyTitle][data-product-id=$rmc][data-product-price=$price][href=#]{$add}@add) +                         (p > a.rlx-main-watch__content-wishlist--show[href=$showHref]{$show}@show)"}}),WishlistContentTemplate12ZView=klass(WishlistContentEventsKlass,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,addedUpdated){addedUpdated=[self._model.get("added")," (",numTrad.numTrad(self._getSize(),["fa"]),"/",numTrad.numTrad(9,["fa"]),")"].join(""),self._model.set("added",addedUpdated)}(this)},_template:"(p > span.rlx-main-watch__content-wishlist--added{$added}@added) +                         (p > a.rlx-main-watch__content-wishlist--remove.wa-wishlist-removeproduct[href=#][data-product-category=$familyTitle][data-product-id=$rmc][data-product-price=$price] @remove {$remove}) +                         (p > a.rlx-main-watch__content-wishlist--show[href=$showHref]{$show}@show)"}})},{"../common/SharePopinZView":3,"../common/side-bar/PriceInfoZView":4,"../core/Animate":12,"../core/Service":21,"../dealers/DealerAutosuggestionZView":24,"../dealers/LocatorFallbackZView":25,"../dealers/LocatorGeolocationButtonZView":26,"../dealers/LocatorZView":32,"../environment":35,"../events":36,"../locales":38,"./ConfiguratorOysterZView":43,"./utils":49,"korbutJS/src/Promise":60}],43:[function(require,module,exports){"use strict";var ConfiguratorUtils,ConfiguratorContentContainerZView,ConfiguratorContentItemZView,ConfiguratorContentPlaceHolderZView,ConfiguratorControlBars,ConfiguratorControlBarDefault,SConfiguratorVariationTypeTooltip,ConfiguratorControlBarOpened,ConfiguratorButtonListZView,singleton=requirejs("utils").singleton,klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),Model=requirejs("lib/Model"),UID=requirejs("lib/UID"),ui=requirejs("modules/rlx-ui"),UIRouter=(requirejs("modules/rlx-popins"),ui.router),events=require("../events"),locales=require("../locales"),env=require("../environment"),MDom=require("../core/MDom").MDom,StyleSheet=requirejs("lib/StyleSheet"),configuratorStylesheet=new StyleSheet,_=requirejs("require/hbs/underscore"),Animate=require("../core/Animate").Animate,sSto=requirejs("modules/rlx-storage").sessionStorage;module.exports.ConfiguratorZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.configuratorIsOpen=!1,statics.isFirstSwap=null!==sSto.getItem("beforeFirstSwap")?"0"!==sSto.getItem("beforeFirstSwap"):null,statics.haveVariations=!!this._model.get("config.variation.length"),statics.hasBeenAlreadyOpen=!1,statics.dataVariation=null,statics.variationTypeIndex=null,statics.positionPageBeforeOpen=null,statics.positionPageTabletMode=sSto.getItem("scrollPosTablet")?parseInt(sSto.getItem("scrollPosTablet"),10):null,statics.isTabletMode=!1,statics.isPopinOpen=!1,statics.limitHideConfig=null,statics.limitScreenHeight=670,statics.posYWhenConf=!!sSto.getItem("posYAfterOpenConfig")&&sSto.getItem("posYAfterOpenConfig"),sSto.getItem("configuratorIsOpen")?(statics.configuratorIsOpen=sSto.getItem("configuratorIsOpen"),sSto.setItem("configIsHidden",!1)):sSto.setItem("configIsHidden",!0),void function(self,utils,Anim){function onwillrender(next,vars){return events.eventRouter.off(events.appSwap,DOMready),events.eventRouter.off(events.configuratorClick,onToggleConfigurator),events.eventRouter.off(events.appPrepareSwap,prepareSwap),events.eventRouter.off(events.configOpen,openConfigurator),events.eventRouter.off(events.configClose,closeConfigurator),events.eventRouter.off(events.modelAutoScroll,autoScroll),events.eventRouter.off(events.configContentReady,configReady),events.eventRouter.off(events.buttonListClick,onChangeTab),events.eventRouter.off(events.windowScroll,controlPositionBar),events.eventRouter.off(events.appWillRender,onwillrender),jQuery(window).off("scroll",self.manageScrolling),next()}function controlPositionBar(next,vars,doc,posY){return statics.limitHideConfig=850,doc=document.documentElement,posY=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),posY>statics.limitHideConfig&&statics.configuratorIsOpen&&Anim.translateY(self.query("configWrap"),".175",[env.mobile?125:290,"px"].join("")).then(function(){events.eventRouter.trigger(events.configuratorClick,this)}),next()}function prepareSwap(next,vars,carousel){return carousel=jQuery(".rlx-carousel").get(null!==statics.variationTypeIndex?statics.variationTypeIndex:0),events.eventRouter.trigger(events.configStylesReset),events.eventRouter.trigger(events.configStylesOpened),next()}function DOMready(next,vars,x,e,otherWidth,button,otherResetButton,indexSelectedInLoading,c,pane){return statics.configuratorIsOpen&&window.scrollTo(0,statics.posYWhenConf),statics.haveVariations&&(jQuery(window).on("scroll",self.manageScrolling),self.startLoadingContentStructure(),statics.configuratorIsOpen&&events.eventRouter.trigger(events.configOpen)),next()}function onToggleConfigurator(next,vars,elem,state,rootApp,attr,isOpen,utils){return utils=new ConfiguratorUtils,isOpen=sSto.getItem("configuratorIsOpen"),state=isOpen&&isOpen>0?0:1,sSto.setItem("configuratorIsOpen",state),self._model.set("config.isOpen",!!state),statics.isTabletMode=utils.checkIsSmallLayout(),state?(events.eventRouter.trigger(events.configOpen),sSto.setItem("configIsHidden",!1)):(events.eventRouter.trigger(events.configClose),sSto.setItem("configIsHidden",!0)),next()}function onChangeTab(next,vars,elem,activeButton,currentButton,iClick,objDfd,context,configContentSelected){return activeButton=new MDom(document.getElementsByClassName("rlx-configurator-control-bar__list-item--active")),currentButton=new MDom(elem),iClick=jQuery(currentButton.elem).index(),events.eventRouter.trigger(events.configChangeTypeVariations),activeButton.elem&&activeButton.toggleClass("rlx-configurator-control-bar__list-item--active"),self.showActiveButton(elem),self.query("configurator-content").querySelectorAll("li").length&&self.hideContentConfigurator().then(function(){self.switchContentConfigurator(iClick),configContentSelected=self.$query("configurator-content").find("[index="+iClick+"]").get(0),context=configContentSelected.querySelector(".rlx-configurator-content-variations__list"),self.loadImageVariations(context),events.eventRouter.trigger(events.configContentReady,elem),self._model.get("configContentLoaded")&&self.showContentConfigurator()}),next()}function configReady(){self._model.get("configContentLoaded")||self._model.set("configContentLoaded",1)}function openConfigurator(next,vars,data,ob,db,b,tn){return b=document.body||document.documentElement||document.body.parentNode,tn=document.querySelector(".rlx-configurator__control-bar"),setTimeout(function(){sSto.setItem("posYAfterOpenConfig",window.scrollY)},500),statics.hasBeenAlreadyOpen||(statics.hasBeenAlreadyOpen=!0),statics.configuratorIsOpen||(self.toggleTabletMode(!0),self._model.get("configContentLoaded")&&self.showContentConfigurator(),Anim.translateY(self.query("configWrap"),".175",0).then(function(){sSto.setItem("ctaBusy","0")}),env.mobile&&Anim.height(tn,".4","px","40")),statics.configuratorIsOpen=!0,events.eventRouter.trigger(events.configStylesOpened),document.body.classList.add("rlx-header-collapsed"),next()}function closeConfigurator(next,vars,t,h,tn){return tn=document.querySelector(".rlx-configurator__control-bar"),h=[env.mobile?125:240,"px"].join(""),Anim.translateY(self.query("configWrap"),".175",h),self.hideContentConfigurator(),statics.configuratorIsOpen=!1,events.eventRouter.trigger(events.configStylesReset),env.mobile&&Anim.height(tn,".4","px","66"),document.body.classList.remove("rlx-header-collapsed"),next()}function autoScroll(next,vars,data,self,viewportH,configH,priceOffsetTop,priceH,scrollValue){return viewportH=jQuery(window).height(),configH=jQuery(".rlx-wrapper-configurator").height(),priceOffsetTop=jQuery(".rlx-main-watch__description").offset().top,priceH=jQuery(".rlx-main-watch__description").height(),scrollValue=null,statics.isTabletMode?scrollValue=parseInt(priceOffsetTop-(viewportH-configH-priceH-5),10):env.mobile?scrollValue=83:utils.checkIsLargeLayout()?scrollValue=0:env.mobile||statics.isTabletMode||(scrollValue=50),jQuery("html, body").animate({scrollTop:[scrollValue,"px"].join("")},175),next()}statics.haveVariations&&(utils=new ConfiguratorUtils,Anim=new Animate,!!statics.configuratorIsOpen!==self._model.get("config.isOpen")&&self._model.set("config.isOpen",!0),self._model.set("variations",self.getDataVariations()),events.eventRouter.on(events.buttonListClick,onChangeTab),statics.variationTypeIndex=null!=sSto.getItem("configurator.tab")?parseInt(sSto.getItem("configurator.tab"),10):0,self._model.get("variations")[statics.variationTypeIndex].vars.length<2&&(statics.variationTypeIndex=0),self.query("configWrap").insertBefore(new ConfiguratorControlBars(self._model).borrow(),self.query("configWrapContent")),statics.isTabletMode=utils.checkIsSmallLayout(),statics.dataVariation=self.getDataVariations(),statics.isFirstSwap&&configuratorStylesheet.rule(".rlx-wrapper-configurator {}",".rlx-configurator__control-bar--default{}",".rlx-configurator__control-bar--open{}",".rlx-main-cta-text {}",".rlx-configurator__control-bar {}",".rlx-main-watch__infos {}",".rlx-main-watch__cta-component {}",function(a,b,c,d,e,f,h){function openStyles(next,vars){return statics.configuratorIsOpen&&(a.property({transform:"translate3d(0, 0, 0)"}),b.property({"z-index":"0",opacity:"0"}),c.property({"z-index":"1",opacity:"1"}),d.property({visibility:"visible",opacity:"1"}),e.property({"min-height":env.mobile?"40px":"50px"}),f.property({transform:"translate3d(0, -80px, 0)"}),h.property({opacity:"0"})),next()}function resetStyles(next,vars){return a.property({transform:null}),b.property({"z-index":null,opacity:null}),c.property({"z-index":null,opacity:null}),d.property({visibility:null,opacity:null}),e.property({"min-height":null}),f.property({transform:null}),h.property({opacity:null}),next()}function onwillrender(next,vars){return events.eventRouter.off(events.configStylesOpened,openStyles),events.eventRouter.off(events.configStylesReset,resetStyles),events.eventRouter.off(events.appWillRender,onwillrender),next()}events.eventRouter.on(events.configStylesOpened,openStyles),events.eventRouter.on(events.configStylesReset,resetStyles),events.eventRouter.on(events.appWillRender,onwillrender)}),events.eventRouter.on(events.appSwap,DOMready),events.eventRouter.on(events.configuratorClick,onToggleConfigurator),events.eventRouter.on(events.appPrepareSwap,prepareSwap),events.eventRouter.on(events.configOpen,openConfigurator),events.eventRouter.on(events.configClose,closeConfigurator),events.eventRouter.on(events.modelAutoScroll,autoScroll),events.eventRouter.on(events.configContentReady,configReady),events.eventRouter.on(events.windowScroll,controlPositionBar),events.eventRouter.on(events.appWillRender,onwillrender),self.$query("configWrapContent").on("touchmove",function(e){e.preventDefault()}))}(this)},_template:"section .rlx-wrapper-configurator@configWrap >                               section .rlx-configurator__content@configWrapContent >                                 .rlx-configurator-content-slide @configurator-content",getDataVariations:function(self,model,buttonList,buttonName,x,j,utils,array,arrayVars,sizeVars,lengthOfVars,variation,nameOfVars,schemaOfVars){self=this,buttonList=self._model.get("config.buttonList"),utils=new ConfiguratorUtils(self._model),array=[];for(x in buttonList)if(arrayVars=[],buttonName=buttonList[x],"string"==typeof buttonName){for(sizeVars=utils.getPath(["config","button",x,"length"],!0),j=0;j<sizeVars;++j)arrayVars.push(utils.getPath(["config","button",x,j],!0));array.push({name:utils.getPath(["locales","variationsLabels",buttonName],!0),vars:arrayVars,schema:utils.getPath(["config","button",x,"schema"],!0),info:{activeInfoIcon:utils.getPath(["config","button",x,"info","activeInfoIcon"],!0,!0),title:utils.getPath(["config","button",x,"info","title"],!0,!0),subtitle:utils.getPath(["config","button",x,"info","subtitle"],!0,!0),text:utils.getPath(["config","button",x,"info","text"],!0,!0)}})}return array},manageScrolling:_.throttle(function(){events.eventRouter.trigger(events.windowScroll,this)},250),startLoadingContentStructure:function(self,j,node){self=this,self.updateContentConfigurator(statics.variationTypeIndex),window.onload=self.loadAsyncContentConfiguratorP().then(function(){events.eventRouter.trigger(events.buttonListClick,jQuery(".rlx-configurator-control-bar__list--inner").children().get(statics.variationTypeIndex))})},updateContentConfigurator:function(index,type,self,t,content,indexRef){self=this,t="undefined"==typeof type||1===type,indexRef=self.query("configurator-content").attributes.indexRef?self.query("configurator-content").attributes.indexRef.value:-1,content=new ConfiguratorContentContainerZView([statics.dataVariation,index],self._model).borrow(),content.childNodes[0].style.display="none",self.query("configurator-content").appendChild(content)},loadAsyncContentConfiguratorP:function(self,dfd,k,type){for(dfd=jQuery.Deferred(),self=this,k=0;k<statics.dataVariation.length;++k)k!==statics.variationTypeIndex&&(type=k>statics.variationTypeIndex?1:0,self.updateContentConfigurator(k,type));return statics.dataVariation.length===self.query("configurator-content").childNodes.length?dfd.resolve():dfd.reject(),dfd.promise()},switchViewMainInformation:function(mode,self,startContent,translateYContent,Anim){self=this,startContent=jQuery(".rlx-main-cta-text").get(0),translateYContent=jQuery(".rlx-main-watch__infos").get(0),Anim=new Animate,mode?(Anim.fadeOut(startContent,".5","0"),startContent.style.visibility="hidden",Anim.translateY(translateYContent,".175",env.mobile?"-45px":"-50%")):Anim.translateY(translateYContent,".175","0").then(function(){startContent.style.visibility="visible",Anim.fadeIn(startContent,".5","1")})},getLocale:function(var_locale){return"undefined"!=typeof var_locale&&""!==var_locale&&self._model.get(["locale",".",var_locale].join(""))},hideContentConfigurator:function(Anim){return Anim=new Animate,Anim.fadeOut(this.query("configWrapContent"),".3")},showContentConfigurator:function(Anim){return Anim=new Animate,Anim.fadeIn(this.query("configWrapContent"),".3")},switchContentConfigurator:function(index,self,sizeContent,i,indexAttr,indexRead){for(self=this,sizeContent=self.query("configurator-content").childNodes.length,i=0;i<sizeContent;++i){if(indexAttr=self.query("configurator-content").childNodes[i].attributes.index,!indexAttr)return;indexRead=parseInt(indexAttr.value,10),indexRead!==index&&(self.query("configurator-content").childNodes[i].style.display="none")}self.$query("configurator-content").find("[index="+index+"]").css("display","block")},toggleTabletMode:function(mode,self,heightTitles,heightHeader,mainWatchHeight,configHeight){var mWatch,allBlock;self=this,statics.positionPageTabletMode||(mWatch=document.querySelector(".rlx-main-watch__watch"),mWatch?(heightTitles=jQuery(".rlx-main-watch__title").height(),mainWatchHeight=document.querySelector(".rlx-main-watch__watch").offsetHeight,configHeight=document.querySelector(".rlx-wrapper-configurator").offsetHeight,heightHeader=env.mobile?50:60,allBlock=parseInt(window.innerHeight-(heightHeader+configHeight+heightTitles+mainWatchHeight),10),statics.positionPageTabletMode=(heightHeader-(allBlock<0?parseInt(allBlock,10):allBlock))/2):statics.positionPageTabletMode=100),sSto.setItem("scrollPosTablet",statics.positionPageTabletMode),mode?(statics.positionPageBeforeOpen=window.scrollY?window.scrollY:0,jQuery("html, body").animate({scrollTop:statics.positionPageTabletMode},175)):(window.scrollY===statics.positionPageTabletMode&&jQuery("html, body").animate({scrollTop:statics.positionPageBeforeOpen},400),sSto.removeItem("scrollPosTablet"))},loadImageVariations:function(context,Anim,imgObj,lis,c,elem,imageUrl,fig){if(imgObj=[],Anim=new Animate,context&&"object"==typeof context){lis=context.querySelectorAll("li");for(c in lis)"object"==typeof lis[c]&&lis[c]&&(elem=lis[c],null!==elem.querySelector("figure")&&"undefined"!=typeof elem.querySelector("figure")&&"undefined"==typeof elem.attributes.loaded&&(imgObj[c]=new Image,imgObj[c].setAttribute("index",c),imgObj[c].onload=function(e,index,containerIMG,fig,url,url_r,imgTag){index=this.attributes.index.value,containerIMG=context.querySelectorAll("li")[index],fig=containerIMG.querySelector("figure"),containerIMG.style.opacity=0,containerIMG.classList.remove("rlx-configurator-content-variations__list-item--empty"),url=containerIMG.querySelector("figure").getAttribute("data-load-src"),url_r=containerIMG.querySelector("figure").getAttribute("data-load-src-retina"),imgTag=document.createElement("img"),imgTag.setAttribute("src",url),url_r&&imgTag.setAttribute("srcset",url_r),imgTag.setAttribute("alt",""),fig.appendChild(imgTag),fig.removeAttribute("data-load-src"),Anim.fadeIn(containerIMG,"0.3")},imgObj[c].src=elem.querySelector("figure").attributes["data-load-src"].value,elem.setAttribute("loaded",!0)))}},updateZindex:function(obj,z){"undefined"!=typeof z&&"undefined"!=typeof obj&&(obj.style.zIndex=z)},showActiveButton:function(elem,element){arguments.length<1||"undefined"==typeof elem,elem.classList.toggle("rlx-configurator-control-bar__list-item--active")},getPositionOfWatch:function(self,win,c,m,z,mw,offMW,rest){return self=this,win=window.innerHeight,c=document.querySelector(".rlx-configurator__content").offsetHeight+document.querySelector(".rlx-configurator__control-bar").offsetHeight,m=parseInt(document.querySelector(".rlx-main-watch__watch--fig").offsetHeight,10),mw=document.querySelectorAll(".rlx-main-watch__watch--fig"),offMW=self.offset(mw),rest=win-c,parseInt(offMW-(rest-m)/2)},offset:function(o){if(!o.length)return 0;for(var element=o[0],top=element.offsetTop||0;element=element.offsetParent;)top+=element.offsetTop;return top}}}),ConfiguratorContentContainerZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.index=arguments[0][1],statics.vars=arguments[0][0],statics.rmcCurrent=null,statics.nbWatchByCarousel=env.mobile?2:3,void function(self,jsonVars,b,k,variation,countPlaceHolder,jsonSize,liSize,docFrag,activeItem,pane){statics.rmcCurrent=self._model.get("config.rmc"),jsonVars=self.loadContentVars(statics.vars,statics.index),jsonSize=jsonVars.length,liSize=self.$query("configurator-content-list").find("li").size(),docFrag=document.createDocumentFragment(),self.root().setAttribute("index",statics.index),liSize&&self.$query("configurator-content-list").parent().remove();for(b in jsonVars)variation=jsonVars[b],statics.rmcCurrent.toLowerCase()===variation.rmc.toLowerCase()&&(pane=parseInt(variation.index/statics.nbWatchByCarousel,10),self.query("carrousel").setAttribute("data-rlx-carousel-start",pane)),docFrag.appendChild(new ConfiguratorContentItemZView(variation).borrow());if(jsonSize<statics.nbWatchByCarousel&&(countPlaceHolder=parseInt(statics.nbWatchByCarousel-jsonSize,10)))for(k=0;k<countPlaceHolder;++k)docFrag.appendChild((new ConfiguratorContentPlaceHolderZView).borrow());self.query("configurator-content-list").appendChild(docFrag),self.query("carrousel").classList.add(env.mobile?"rlx-carousel-x2":"rlx-carousel-x3"),env.mobile&&(self.query("carrousel").setAttribute("data-rlx-carousel-dir","false"),self.query("carrousel").setAttribute("data-rlx-carousel-dot","true"))}(this)},_template:".rlx-configurator-content__variations .rlx-carousel[data-rlx-carousel-dir=always][data-rlx-carousel-dot=false]@carrousel >                               .rlx-carousel-window >                                   ul .rlx-configurator-content-variations__list .rlx-carousel-wrapper @configurator-content-list",loadContentVars:function(d,index,variation,sch,varsR,rmc,variationType,x,indexV,modelName,pageLink,m_ref,b_ref,d_ref,sce7,sce7r,modelRef,dialRef,braceletRef,title,self,utils,familyCode,currentRMC){self=this,utils=new ConfiguratorUtils(self._model),familyCode=self._model.get("config.familyTitle"),currentRMC=self._model.get("config.rmc"),variation=(d[index]||{}).vars||{},sch=d[index].schema,varsR=[],variationType=utils.getPath(["config","button",index,"name"],!0);for(x in variation){switch(rmc=variation[x],indexV=utils.getPath(["config",sch,rmc],!0),modelName=utils.getPath(["config",sch,indexV,"model_name"],!0,!0),pageLink=utils.getPath(["config",sch,indexV,"page_link"],!0),m_ref=utils.getPath(["config",sch,indexV,"model_ref"],!0),b_ref=utils.getPath(["config",sch,indexV,"bracelet_ref"],!0),d_ref=utils.getPath(["config",sch,indexV,"dial_ref"],!0),sce7=utils.getPath(["config",sch,indexV,"s7_url"],!0),sce7r=utils.getPath(["config",sch,indexV,"s7_url_r"],!0),modelRef=utils.getPath(["config","model",m_ref],!0),dialRef=utils.getPath(["config","dial",d_ref],!0),braceletRef=utils.getPath(["config","bracelet",b_ref],!0),variationType){case"model":title=utils.getPath(["config","model",modelRef,"model_case"],!0,!0);break;case"bezel":title=utils.getPath(["config","model",modelRef,"bezel"],!0,!0);break;case"dial":title=utils.getPath(["config","dial",dialRef,"dial"],!0,!0);break;case"bracelet":title=utils.getPath(["config","bracelet",braceletRef,"bracelet"],!0,!0);break;case"material":title=utils.getPath(["config","model",modelRef,"material"],!0,!0)}varsR.push({type:variationType,familyCode:familyCode,modelName:modelName,m_ref:m_ref,s7_url:sce7,s7_url_r:sce7r,title:title,rmc:rmc,url:rmc!==statics.rmcCurrent?pageLink:"",index:parseInt(x,10),currentRmc:currentRMC})}return varsR}}}),ConfiguratorContentItemZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.currentRmc=null,void function(self){statics.currentRmc=self._model.get("currentRmc").toLowerCase(),self.query("figureTag").setAttribute("data-load-src",self._model.get("s7_url")),self._model.get("s7_url_r")&&self.query("figureTag").setAttribute("data-load-src-retina",[self._model.get("s7_url")," 1x, ",self._model.get("s7_url_r")," 2x"].join("")),self.$query("list-item").on("click",function(e,i,nextRMC){e.preventDefault(),i=jQuery(this).index(),sSto.setItem("configurator.slide",i),nextRMC=jQuery(this).data("rmc"),sSto.setItem("configurator.next",nextRMC)}),statics.currentRmc==self._model.get("rmc").toLowerCase()&&self.query("list-item").classList.add("rlx-configurator-content-variations__list-item--active")}(this)},_template:"li.rlx-configurator-content-variations__list-item.rlx-configurator-content-variations__list-item--empty.rlx-carousel-slide[data-rmc=$rmc]@list-item >                           a.rlx-configurator-content-variations__link.wa-model-configurator[href=$url][data-configurator-optiontype=$type][data-product-category=$familyCode][data-product-id=$rmc][data-target-spa=1] >                             (figure.rlx-configurator-content-variations__figure@figureTag >                               figcaption.rlx-configurator-content-variations__caption >                                 h3.rlx-configurator-content-variations__caption-family {$modelName}                                 + span.rlx-configurator-content-variations__caption-model {$title} )                           + (.rlx-configurator-list__layer)"}}),ConfiguratorContentPlaceHolderZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:"li .rlx-configurator-content-variations__list-item .rlx-configurator-content-variations__list-item--placeholder .rlx-carousel-slide"}}),ConfiguratorControlBars=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.configuratorIsOpen=function(){return!!sSto.getItem("configuratorIsOpen")&&!!parseInt(sSto.getItem("configuratorIsOpen"),10)},statics.variationTypeIndex=sSto.getItem("configurator.tab")?parseInt(sSto.getItem("configurator.tab"),10):0,statics.limitHideConfig=null,statics.buttonList=null,statics.toggleButton=null,statics.closeButton=null,statics.configWrapper=null,statics.heightConfig=env.mobile?190:290,statics.heightBar=env.mobile?40:50,void function(self,defaultModel,openedModel,utils){function onReady(next,vars){return statics.configWrapper=window["watch-app"].querySelector(".rlx-wrapper-configurator"),setTimeout(function(){self.updateConfig()},200),next()}function onHide(next,vars){return self.hideConfig(),setTimeout(function(){statics.configuratorIsOpen()&&events.eventRouter.trigger(events.configuratorClick)},1e3),next()}function onShow(next,vars){return statics.configuratorIsOpen()||self.showConfig(),next()}function onwillrender(next,vars){return events.eventRouter.off(events.windowScroll,controlPositionBar),events.eventRouter.off(events.appSwap,onReady),
events.eventRouter.off("ui/main/sitenav",onHide),events.eventRouter.off("ui/nav/close",onShow),events.eventRouter.off("viewport/globalunlock/request",onShow),statics.toggleButton.off("click touchstart",toggleConfigurator),statics.closeButton.off("click touchstart",toggleConfigurator),events.eventRouter.off(events.appWillRender,onwillrender),UIRouter.unwhen("/ui/side/price",onHide),UIRouter.unwhen("/ui/side/wishlist'",onHide),UIRouter.unwhen("/ui/header/show",onShow),next()}function toggleConfigurator(e){e.preventDefault(),events.eventRouter.trigger(events.configuratorClick,this)}function controlPositionBar(next,vars){return self.updateConfig(),next()}utils=new ConfiguratorUtils(self._model),defaultModel={configuratorTitle:utils.getPath(["locales","configuratorTitle"],!0),viewAllfamilyTitle:utils.getPath(["locales","viewAllfamilyTitle"],!0),viewAllHref:self._model.get("config.familyLink"),back:locales.configurator.buttonBack},openedModel={currentRmc:self._model.get("config.rmc").toLowerCase(),resetConfig:utils.getPath(["locales","resetConfig"],!0),configuratorClose:utils.getPath(["locales","configuratorClose"],!0),variations:self._model.get("variations"),familyTitle:utils.getPath(["locales","familyTitle"],!0),wouldText:locales.configurator.wouldText},self.query("controls-bar").appendChild(new ConfiguratorControlBarDefault(defaultModel).borrow()),self.query("controls-bar").appendChild(new ConfiguratorControlBarOpened(openedModel).borrow()),statics.buttonList=self.$query("controls-bar").find(".rlx-configurator-control-bar__list--inner"),statics.toggleButton=self.$query("controls-bar").find(".rlx-configurator-control-bar__button--configure"),statics.closeButton=self.$query("controls-bar").find(".rlx-configurator-control-bar__button--close"),events.eventRouter.on(events.windowScroll,controlPositionBar),events.eventRouter.on(events.appSwap,onReady),events.eventRouter.on(events.appWillRender,onwillrender),statics.toggleButton.on("click touchstart",toggleConfigurator),statics.closeButton.on("click touchstart",toggleConfigurator),events.eventRouter.on("ui/main/sitenav",onHide),events.eventRouter.on("ui/nav/close",onShow),events.eventRouter.on("viewport/globalunlock/request",onShow),UIRouter.when("/ui/side/price",onHide),UIRouter.when("/ui/side/wishlist",onHide),UIRouter.when("/ui/header/show",onShow)}(this)},_template:".rlx-configurator__control-bar @controls-bar",updateConfig:function(doc,posY,outApp,self,Anim){self=this,doc=document.documentElement,posY=doc.getBoundingClientRect().top*-1,Anim=new Animate,null==statics.limitHideConfig&&(statics.limitHideConfig=550),posY>statics.limitHideConfig?self.hideConfig():self.showConfig()},showConfig:function(Anim,y){sSto.getItem("configIsDisplay")||statics.configuratorIsOpen()||(sSto.setItem("configIsDisplay",!0),Anim=new Animate,requestAnimationFrame(function(){y=[env.mobile?125:240,"px"].join(""),Anim.translateY(statics.configWrapper,".175",y)}))},hideConfig:function(Anim,h,y){sSto.getItem("configIsDisplay")&&(statics.configuratorIsOpen()&&events.eventRouter.trigger(events.configuratorClick,this),sSto.setItem("configIsDisplay",!1),Anim=new Animate,requestAnimationFrame(function(){y=[env.mobile?"210":statics.heightConfig,"px"].join(""),Anim.translateY(statics.configWrapper,".175",y)}))}}}),ConfiguratorControlBarDefault=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,Anim){function onOpenConfigurator(next,vars,data){return Anim.fadeOut(self.query("defaultBar")).then(function(){self.query("defaultBar").style.zIndex=0}),next()}function onCloseConfigurator(next,vars,data){return Anim.fadeIn(self.query("defaultBar")).then(function(){self.query("defaultBar").style.zIndex=1}),next()}function onviewallclick(){events.eventRouter.trigger(events.modelOutbound)}function onwillrender(next,vars){return events.eventRouter.off(events.configClose,onCloseConfigurator),events.eventRouter.off(events.configOpen,onOpenConfigurator),self.$query("viewAllButton").off("click",onviewallclick),self.$query("back").off("click",backTo),events.eventRouter.off(events.appWillRender,onwillrender),next()}function backTo(e,func){e.preventDefault(),func.call(this)}Anim=new Animate,self.$query("viewAllButton").on("click",onviewallclick),events.eventRouter.on(events.configClose,onCloseConfigurator),events.eventRouter.on(events.configOpen,onOpenConfigurator),events.eventRouter.on(events.appWillRender,onwillrender),requirejs(["lib/SEventRouter"],function(SE){var EventRouter=SE.SEventRouter;(new EventRouter).when("/user/backto/response",function(next,vars,show,fn){return show?self.$query("back").on("click",backTo,fn):self.$query("back").remove(),next()}),(new EventRouter).dispatch("/user/backto/request")})}(this)},_template:"header .rlx-configurator__control-bar--default@defaultBar >                             (a .rlx-configurator-control-bar__button--back@back >                               span .rlx-configurator--remove-mobile {$back}) +                             (a .rlx-configurator-control-bar__button--all .rlx-configurator--remove-mobile [href=$viewAllHref]@viewAllButton >                                 span {$viewAllfamilyTitle} ) +                             (div >                                 ul .rlx-configurator-control-bar__config-list >                                     li .rlx-configurator-control-bar__config-list-item >                                         a .rlx-configurator-control-bar__button--configure @config-button {$configuratorTitle})"}}),SConfiguratorVariationTypeTooltip=singleton(ZView,function(Super,statics,items){return items={},statics.current=null,statics.getUID=function(uid){return items[uid]&&items[uid].instance},statics.SCROLL_OPTS={x:!1,y:!0,forceHorizontal:!1,forceVertical:!0,autoHide:!1,initialDisplay:!0},statics.MAX_TEXT_HEIGHT_DESKTOP=176,statics.PAGE_OFFSET=document.body.scrollTop,statics.EXTRA_TEXT_HEIGHT=75,{constructor:function(){Super.apply(this,arguments),void function(self){function onWillRender(next,vars){return self.kill(),events.eventRouter.off(events.configClose,configClose),events.eventRouter.off(events.configChangeTypeVariations,configClose),events.eventRouter.off(events.appWillRender,onWillRender),next()}function configClose(next,vars){return self.toggle(),next()}items[self.uid()]={instance:self},self._model.set("available",!0),self.$query("close").on("click",function(){self.toggle()}),events.eventRouter.on(events.configClose,configClose),events.eventRouter.on(events.configChangeTypeVariations,configClose),events.eventRouter.on(events.appWillRender,onWillRender)}(this)},_template:env.mobile?"(div.rlx-configurator-control-bar__tooltip@tooltip >                                   (div.rlx-configurator-control-bar__tooltip--wrapper@wrapperMobile >                                     button@close +                                       div.rlx-configurator-control-bar__tooltip-box@textcontent >                                           span {$subtitle} +                                           h3 {$title} +                                           p {$text})":"(div.rlx-configurator-control-bar__tooltip@tooltip >                                   button@close +                                   div.antiscroll-wrap@wrapper >                                     div.rlx-configurator-control-bar__tooltip-box >                                       div.antiscroll-inner@textcontent >                                         span {$subtitle} +                                         h3 {$title} +                                         p {$text}@textContentParagraph)",available:function(self){return self=this,self._model.get("available")},uid:function(){return this._model.get("uid")||(this._model.set("uid",UID.uid()),this._model.get("uid"))},show:function(self,Anim){if(self=this,window.addEventListener("keyup",self._onkeyup=function(e){27==e.keyCode&&(window.removeEventListener("keyup",self._onkeyup),self.toggle())}),env.mobile&&(document.body.style.top=-statics.PAGE_OFFSET+"px",document.body.style.position="fixed"),self._model.get("available"))return self._model.set("available",!1),Anim=new Animate,self.query("tooltip").style.display="block",Anim.fadeIn(self.query("tooltip"),".2")},hide:function(self,Anim){return self=this,window.removeEventListener("keyup",self._onkeyup),env.mobile&&(document.body.style.position="relative",document.body.style.top="auto",window.scroll(0,statics.PAGE_OFFSET)),self._model._data.activeInfoIcon.blur(),self._model._data.activeInfoIcon.className="",Anim=new Animate,Anim.fadeOut(self.query("tooltip"),".2").then(function(){self._model.set("available",!0),self.query("tooltip").style.display="none"})},toggle:function(model,self,index){self=this,index="undefined"==typeof index&&model?model.index:self._model.get("index"),null==statics.current||statics.current==index?(null==statics.current&&(statics.current=index),!self._model.get("visible")&&model?(self._model.set("visible",1),self.show(),self.refresh(model)):(self._model.set("visible",0),self.hide(),statics.current=null)):self.refresh(model).then(function(){self._model.get("visible")||(self.show(),self._model.set("visible",1)),statics.current=index})},refresh:function(model,self,dfd,Anim){return self=this,dfd=jQuery.Deferred(),Anim=new Animate,model?(self._model._data.activeInfoIcon.className="",Anim.fadeOut(self.query("textcontent"),".1").then(function(configBarIcons,i,j){!env.mobile&&self.$query("wrapper").data("antiscroll")&&(self.query("textcontent").style.height="",self.query("textcontent").style.top="",self.query("textContentParagraph").style.height="",self.$query("wrapper").data("antiscroll").destroy(),self.$query("wrapper").find(".antiscroll-scrollbar-container").remove());for(j in model)self._model.set(j,model[j]);model.activeInfoIcon.className="rlx-more-info-active",Anim.fadeIn(self.query("textcontent"),".1").then(function(){env.mobile||self.query("textcontent").clientHeight>statics.MAX_TEXT_HEIGHT_DESKTOP&&(self.query("textcontent").style.height=statics.MAX_TEXT_HEIGHT_DESKTOP+"px",self.query("textContentParagraph").style.height=self.query("textContentParagraph").clientHeight+statics.EXTRA_TEXT_HEIGHT+"px",self.$query("wrapper").antiscroll(statics.SCROLL_OPTS),self.$query("wrapper").find(".antiscroll-scrollbar-vertical").wrap('<div class="antiscroll-scrollbar-container"></div>')),dfd.resolve()})}),dfd.promise()):void dfd.reject()},kill:function(){this.recover()}}}),ConfiguratorControlBarOpened=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.dataVariation=null,statics.variationTypeIndex=sSto.getItem("configurator.tab")?parseInt(sSto.getItem("configurator.tab"),10):0,statics.isFirstSwap=null!==sSto.getItem("beforeFirstSwap")?"number"!=typeof sSto.getItem("beforeFirstSwap")||0!=sSto.getItem("beforeFirstSwap"):null,statics.rmcOrigin=sSto.getItem("rmc-origin"),statics.linkOrigin=sSto.getItem("link-origin"),void function(self,x,dataButton,typeVar,Anim){function configReady(next,vars){return jQuery(".rlx-carousel[index=0]").on("carousel-events:redraw",function(){Anim.fadeIn(jQuery(".rlx-configurator__content"),".175")}),next()}function onReady(next,vars){return next()}function onwillrender(next,vars){return events.eventRouter.off(events.appSwap,onReady),events.eventRouter.off(events.configButtonInfoClick,onClickTooltip),events.eventRouter.off(events.configContentReady,configReady),events.eventRouter.off(events.configOpen,onOpenConfigurator),events.eventRouter.off(events.configClose,onCloseConfigurator),events.eventRouter.off(events.appWillRender,onwillrender),next()}function onOpenConfigurator(next,vars,data){return Anim.fadeIn(self.query("openBar")).then(function(){self.query("openBar").style.zIndex=1}),next()}function onCloseConfigurator(next,vars,data){return Anim.fadeOut(self.query("openBar")).then(function(){self.query("openBar").style.zIndex=0}),next()}function onClickTooltip(next,vars,data,dataPopin,tooltip,target){return dataPopin=self._model._data.variations[data.index].info,dataPopin.index=data.index,dataPopin.activeInfoIcon=data.activeInfoIcon,tooltip=new SConfiguratorVariationTypeTooltip(new Model(dataPopin)),data.activeInfoIcon.className="rlx-more-info-active",target=env.mobile?document.body:self.query("openBar"),self.query("openBar").querySelector(".rlx-configurator-control-bar__tooltip")||target.appendChild(tooltip.borrow()),tooltip.toggle(dataPopin),next()}statics.dataVariation=self._model.get("variations"),statics.isFirstSwap||self._model.get("currentRmc")===statics.rmcOrigin?self.$query("reset").remove():self.setRMCforResetButton(),Anim=new Animate;for(x in statics.dataVariation)typeVar=statics.dataVariation[x],dataButton={name:typeVar.name,index:parseInt(x,10),indexSelected:statics.variationTypeIndex,size:typeVar.vars.length,infoclose:locales.sidebar.close,infotitle:typeVar.info.title,infosubtitle:typeVar.info.subtitle,infotext:typeVar.info.text},self.query("list-button").appendChild(new ConfiguratorButtonListZView(dataButton).borrow());events.eventRouter.on(events.appSwap,onReady),events.eventRouter.on(events.configContentReady,configReady),events.eventRouter.on(events.configButtonInfoClick,onClickTooltip),events.eventRouter.on(events.configOpen,onOpenConfigurator),events.eventRouter.on(events.configClose,onCloseConfigurator),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"header .rlx-configurator__control-bar--open@openBar >                             (span .rlx-configurator-control-bar__list-left-item >                               a.rlx-main-watch__more-reset-button[data-target-spa=1] @reset ) +                             (ul .rlx-configurator-control-bar__list >                               (li .rlx-configurator-control-bar__list-item @control-bar-content >                                 span.rlx-configurator--remove-mobile.rlx-configurator-control-bar__text{$wouldText} +                                ul .rlx-configurator-control-bar__list--inner @list-button ) ) +                             (span .rlx-configurator-control-bar__list-right-item @close-button-parent >                               a .rlx-configurator-control-bar__button--close @close-button >                                   span .rlx-configurator--remove-mobile {$configuratorClose} )",setRMCforResetButton:function(self,url,resetButton){self=this;try{!!statics.linkOrigin&&self.query("reset").setAttribute("href",statics.linkOrigin)}catch(e){}},showActiveButton:function(elem,element){arguments.length<1||"undefined"==typeof elem,element=new MDom(elem),element.toggleClass("rlx-configurator-control-bar__list-item--active")}}}),ConfiguratorButtonListZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,lengthVars,Anim){function buttonListClickEvent(e){var node=e.currentTarget,target=node.classList.contains("rlx-configurator-control-bar__list-item")?this:node.parentNode;events.eventRouter.trigger(events.buttonListClick,target)}function buttonMoreClickEvent(e){e.preventDefault();var dataEv={index:self._model.get("index"),type:e.originalEvent?e.originalEvent.type:e.handleObj.type,activeInfoIcon:self.query("more")};events.eventRouter.trigger(events.configButtonInfoClick,dataEv)}function onwillrender(next,vars){return self.$query("name").off("click",buttonListClickEvent),self.$query("more").off("click",buttonMoreClickEvent),events.eventRouter.off(events.appWillRender,onwillrender),next()}Anim=new Animate,lengthVars=self._model.get("size"),self.$query("name").on("click",buttonListClickEvent),self.$query("more").on("click",_.throttle(buttonMoreClickEvent,50)),events.eventRouter.on(events.appWillRender,onwillrender),self._model.get("index")==self._model.get("indexSelected")&&self.query("item").classList.add("rlx-configurator-control-bar__list-item--active"),1===lengthVars&&self.query("item").classList.add("rlx-configurator-control-bar__list-item--no-more-vars")}(this)},_template:"li .rlx-configurator-control-bar__list-item @item >                                 (span {$name} @name + a[href=#]@more)"}}),module.exports.ConfiguratorUtils=ConfiguratorUtils=klass(function(Super,statics){return{constructor:function(model){statics.tabletModeHeightLimit=850,void function(self){"undefined"!=typeof model&&(self._model=model)}(this)},getLocale:function(var_locale,self,value){return self=this,value=self.getPath(["locales","dictionary",var_locale],!0,!1),"undefined"!=typeof var_locale&&""!==var_locale&&value},getPath:function(values,model,locale,self,x,outArray,path){if(self=this,arguments.length<1,model="undefined"!=typeof model&&("boolean"==typeof model&&model),locale="undefined"!=typeof locale&&("boolean"==typeof locale&&locale),"object"==typeof values){for(outArray=[],x=0;x<values.length;++x)outArray.push(values[x]),parseInt(values.length-1,10)!=x&&outArray.push(".");return path=outArray.join(""),model?locale?self.getLocale(self._model.get(path)):self._model.get(path):locale?self.getLocale(path):path}return!1},checkIsSmallLayout:function(verifHeight,verifWidth){return verifHeight=document.body.clientHeight<=statics.tabletModeHeightLimit,!!verifHeight},checkIsLargeLayout:function(verifHeight,verifWidth){return verifHeight=document.body.clientHeight>=statics.tabletModeHeightLimit,!!verifHeight}}})},{"../core/Animate":12,"../core/MDom":16,"../environment":35,"../events":36,"../locales":38}],44:[function(require,module,exports){"use strict";var editorialsUtils,blocTextImageBkgZView,uprightWatchZView,familyIntroductionItemZView,blocTextImageLeftZView,blocTextImageRightZView,blocDownloadLinkZView,klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),_=requirejs("require/hbs/underscore"),env=require("../environment"),locales=require("../locales"),ImagePlaceholder=require("../core/ImagePlaceholder").ImagePlaceholder,ImageLoad=require("../core/ImageLoad").ImageLoad,events=require("../events"),Animate=require("../core/Animate").Animate;module.exports.EditorialZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.getSizes=function(){return{colW:jQuery(".rlx-column",".rlx-editorial-feature:eq(0)").width(),_w:parseInt(jQuery(".rlx-ghost").eq(0).attr("data-imagewidth")),_h:parseInt(jQuery(".rlx-ghost").eq(0).attr("data-imageheight"))}},void function(self,blocList,data,helpers,editoAsset,dataExtraFeatures){function onwillrender(next,vars){return events.eventRouter.off(events.appAfterSwap,onAppAfterSwap),events.eventRouter.off(events.appSwap,appReady),events.eventRouter.off(events.appWillRender,onwillrender),next()}function appReady(next,vars){return env.mobile||updateHeightBlock(),next()}function onAppAfterSwap(next,vars){var editorialnodes=document.querySelectorAll(".rlx-editorial-feature"),sizeBlock=editorialnodes.length,node=sizeBlock&&sizeBlock<4?editorialnodes[sizeBlock-1]:null;return node&&(node.style["margin-bottom"]="150px"),next()}function updateHeightBlock(h,hBloc,blockSizes){blockSizes=statics.getSizes(),hBloc=parseInt(blockSizes.colW*blockSizes._h/blockSizes._w,10),h=[hBloc,"px"].join(""),jQuery(".rlx-column, .rlx-figure",".rlx-editorial-feature").css("height",h)}blocList=["material","dial","bracelet","movement"],data={},self.query("editoContent").appendChild(new uprightWatchZView(self._model).borrow()),helpers=new editorialsUtils(self._model,"editorial"),events.eventRouter.on(events.appSwap,appReady),events.eventRouter.on(events.appAfterSwap,onAppAfterSwap),events.eventRouter.on(events.appWillRender,onwillrender),env.mobile||jQuery(window).on("resize",_.throttle(function(e,winWidth){winWidth=window.innerWidth,winWidth>1024&&winWidth<1360&&updateHeightBlock(),winWidth<1024&&0===i&&(updateHeightBlock(),++i)},10)),_.map(blocList,function(v,i){data=helpers.constructData(v),data&&(env.mobile?self.query("editoContent").appendChild(new blocTextImageRightZView(data).borrow()):"left"===helpers.getData(v,"mode")?self.query("editoContent").appendChild(new blocTextImageLeftZView(data).borrow()):self.query("editoContent").appendChild(new blocTextImageRightZView(data).borrow()))}),dataExtraFeatures=helpers.constructData("extra_feature"),self.query("editoContent").appendChild(new blocTextImageBkgZView(dataExtraFeatures).borrow());var i=0}(this)},_template:"div.rlx-editorial-container@editoContent"}}),uprightWatchZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,visual,img,Anim){img=new Image,Anim=new Animate,visual=self._model._data["editorial."+self._model._data["editorial.upright_watch"]+".asset"],self._model.set("name",self._model._data["editorial."+self._model._data["editorial.upright_watch"]+".name"]),self.query("bloc").style.opacity=0,img.src=visual,img.onload=function(){self.query("bloc").style["background-image"]="url('"+visual+"')",Anim.fadeIn(self.query("bloc"))}}(this)},_template:"section[data-story-name=$name] .rlx-uprightwatch.rlx-preload-img[data-load-type=background] @bloc"}}),familyIntroductionItemZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:"li .rlx-dfn-sense {$text}"}}),blocTextImageLeftZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){ImagePlaceholder({placeholder:self.query("ghost"),imageHeight:self._model._data.imgHeight,imageWidth:self._model._data.imgWidth,responsive:!0}),self.query("root").setAttribute("data-src",self._model.get("imgSrc"))}(this)},_template:"section[data-load=0][data-load-type=background][data-story-name=$name] .rlx-lazy-loading .rlx-section .rlx-editorial-feature @container >           div.rlx-editorial__load-content >       + (div .rlx-column .rlx-v-middle .rlx-h-right > .rlx-wrapper > .rlx-align > .rlx-asset > .rlx-ghost@ghost + .rlx-figure.rlx-image-placeholder.rlx-model-feature.rlx-preload-img@placeholder)       + (div.rlx-column .rlx-v-middle .rlx-h-center > div.rlx-wrapper > .rlx-align > .rlx-textblock .rlx-textblock-medium > (hgroup > (h1{$title} + h2{$subtitle}) + p{$text}) )"}}),blocTextImageRightZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self){ImagePlaceholder({placeholder:self.query("ghost"),imageHeight:self._model._data.imgHeight,imageWidth:self._model._data.imgWidth,responsive:!0}),self.query("root").setAttribute("data-src",self._model._data.imgSrc)}(this)},_template:"section[data-load=0][data-load-type=background][data-story-name=$name] .rlx-lazy-loading .rlx-section .rlx-editorial-feature @container >         .rlx-editorial__load-content >     + (div.rlx-column .rlx-v-middle .rlx-h-center > div.rlx-wrapper > .rlx-align > .rlx-textblock .rlx-textblock-medium > (hgroup > (h1{$title} + h2{$subtitle}) + p{$text}) )     + (div .rlx-column .rlx-v-middle .rlx-h-left > .rlx-wrapper > .rlx-align > .rlx-asset > .rlx-ghost@ghost + .rlx-image-placeholder.rlx-preload-img.rlx-figure@placeholder) "}}),module.exports.blocDownloadZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,helpers,links,link){helpers=new editorialsUtils(self._model,"editorial"),ImagePlaceholder({placeholder:self.query("ghost"),imageHeight:helpers.getData("download","asset_hei"),imageWidth:helpers.getData("download","asset_wid"),responsive:!0}),links=helpers.getData("download","href.length",null);for(var i=0;i<links;i++)link={},link.href=helpers.getTrad(helpers.getData("download","href."+i)),link.text=helpers.getTrad(helpers.getData("download","link."+i)),link.file=link.href.substring(link.href.lastIndexOf("/")+1),link.pid=self._model.get("rmc").toUpperCase(),link.family=self._model.get("family"),link.href&&self.query("links").appendChild(new blocDownloadLinkZView(link).borrow());self.query("root").setAttribute("data-src",helpers.getData("download","asset")),self._model.set("name",helpers.getData("download","name")),self.query("title").innerHTML=helpers.getData("download","title",!0),self.query("subtitle").innerHTML=helpers.getData("download","subtitle",!0),self.query("text").innerHTML=helpers.getData("download","text",!0)}(this)},_template:"section[data-load=0][data-load-type=background][data-story-name=$name] .rlx-downloads .rlx-lazy-loading .rlx-block .rlx-push-right >                   .rlx-editorial__load-content >                   .rlx-ghost@ghost +                   figure.rlx-figure.rlx-preload-img +                   .rlx-pushed >                     .rlx-textblock .rlx-textblock-medium .rlx-vertically-centered >                       hgroup > (h1@title + h2@subtitle) >                       + p@text                       + .rlx-links@links"}}),blocDownloadLinkZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments)},_template:"a.rlx-links__button-downloads.wa-tracking-download.wa-download-product[href=$href][target=_blank][data-target-ntab=true][data-product-category=$family][data-downloadfile=$file][data-product-id=$pid]{$text}"}}),module.exports.blocMagazineZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self,editoAsset,helpers){helpers=new editorialsUtils(self._model,"editorial"),ImagePlaceholder({placeholder:self.query("ghost"),imageHeight:helpers.getData("spirit","asset_hei"),imageWidth:helpers.getData("spirit","asset_wid"),responsive:!0}),editoAsset=helpers.getData("spirit","asset"),editoAsset&&self.query("root").childNodes[0].setAttribute("data-src",editoAsset),self.setAttr(self.query("link"),{href:helpers.getData("spirit","href",!0),title:helpers.getData("spirit","link",!0)}),self._model.set("spirit_title",helpers.getData("spirit","title",!0)),self._model.set("spirit_subtitle",helpers.getData("spirit","subtitle",!0)),self._model.set("spirit_link_text",helpers.getData("spirit","link",!0))}(this)},_template:"section[data-load=0] .rlx-spirit .rlx-white-text .rlx-background .rlx-push-center[data-load-type=background] >                   .rlx-editorial__load-content.rlx-preload-img >                   .rlx-ghost@ghost +                   .rlx-pushed >                     .rlx-textblock .rlx-textblock-large .rlx-t-center .rlx-vertically-centered >                       hgroup.rlx-textblock__heading >                         (h1{$spirit_subtitle} + h2{$spirit_title}) +                         (.rlx-links > a.rlx-links__button@link{$spirit_link_text})",setAttr:function(el,attrs){for(var key in attrs)el.setAttribute(key,attrs[key])}}}),module.exports.blocTextImageBkgZView=blocTextImageBkgZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self){ImagePlaceholder({placeholder:self.query("ghost"),responsive:!0,noSet:!0,imageHeight:self._model.get("imgHeight"),imageWidth:self._model.get("imgWidth")}),ImageLoad({context:self.root(),imageSrc:self._model.get("imgSrc")})}(this)},_template:"section[data-story-name=$name] .rlx-extra-feature .rlx-block .rlx-push-right [data-load-type=background][data-src=$imgSrc] >                   .rlx-ghost@ghost +                   figure.rlx-figure.rlx-preload-img +                   .rlx-pushed >                     .rlx-textblock .rlx-textblock-medium .rlx-vertically-centered >                       hgroup > (h1{$title} + h2{$subtitle})                         + p{$text}                    + figure.rlx-figure@img"}}),module.exports.blocSocialEmbedZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){setTimeout(function(){var socialEmbed=require("../common/social-feed/socialFeedEmbed").SocialEmbedZView;self.query("content").appendChild((new socialEmbed).borrow())},300)}(this)},_template:"div.social-feed >     (div.rlx-banner > div.rlx-banner__container > div.rlx-textblock > hgroup.rlx-textblock__heading > h1{$title} + h2{$subtitle}) +     (div#socialFeedApp.rlx-social-feed-tint@content[data-feedname=$feed_name])"}}),module.exports.shareBarZView=klass(ZView,function(Super,Statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self._model.set("shareText",locales.shareThisPage)}(this)},_template:".rlx-footer-share >                     a.rlx-footer-share-btn[href=#]{$shareText}"}}),module.exports.EditorialsUtils=editorialsUtils=klass(function(Super,statics){return statics._section=null,{constructor:function(model,section){void function(self){self._model=model,statics._section=section}(this)},getTrad:function(variable,self){return self=this,variable?self._model._data["locale."+variable]:null},getData:function(set,value,mode,self){return self=this,"undefined"==typeof mode&&(mode=!1),"undefined"!=typeof self._model&&(null===value?self._model._data[statics._section+"."+set]:"undefined"!=typeof value&&"undefined"!=typeof set?mode?self.getTrad(self._model._data[statics._section+"."+(self._model._data[statics._section+"."+set]||set)+"."+value]):self._model._data[statics._section+"."+("number"==typeof self._model._data[statics._section+"."+set]&&self._model._data[statics._section+"."+set]+""||set)+"."+value]:void 0)},constructData:function(v,getData,self){function getData(get,mode){return"undefined"==typeof mode&&(mode=!1),self.getData.call(self,v,get,mode)}return self=this,!!getData("asset")&&{imgSrc:getData("asset"),name:getData("name"),title:getData("title",!0),subtitle:getData("subtitle",!0),text:getData("text",!0),imgHeight:getData("asset_hei"),imgWidth:getData("asset_wid")}}}})},{"../common/social-feed/socialFeedEmbed":10,"../core/Animate":12,"../core/ImageLoad":14,"../core/ImagePlaceholder":15,"../environment":35,"../events":36,"../locales":38}],45:[function(require,module,exports){"use strict";var userland,StyleSheet,CTAStyleSheet,DescLineAndPrice,CtaComponentZView,SoldatCelliniZView,CtaComponentUGButtonZView,klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),ui=(requirejs("lib/Model"),requirejs("modules/rlx-ui")),events=(ui.router,require("../events")),env=(require("../locales"),require("../environment")),Animate=require("../core/Animate").Animate,sSto=(requirejs("require/hbs/underscore"),require("./ConfiguratorOysterZView").ConfiguratorUtils,requirejs("cq-modules/rlx-wishlists-wrapper"),requirejs("modules/rmc"),requirejs("modules/rlx-num-trad"),requirejs("modules/rlx-storage").sessionStorage),killSwitch=(requirejs("modules/rlx-storage").localStorage,requirejs("config-members").membersKillSwitch||!0);killSwitch||(userland=requirejs("modules/rlx-userland-v5.6")),StyleSheet=requirejs("lib/StyleSheet"),CTAStyleSheet=new StyleSheet,DescLineAndPrice=require("./CommonComponentsZView").descLineAndPrice,CtaComponentZView=require("./CommonComponentsZView").CtaMainControllerZView,module.exports.MainWatchCelliniZView=klass(ZView,function(Super,statics){return{constructor:function(){statics.activeItemClass="rlx-main-watch__content-item--active",statics.activeButtonClass="rlx-main-watch__cta-bar-link--active",statics.targetButtonBase="rlx-main-watch__cta-bar-link--",statics.isFirstSwap=null!==sSto.getItem("beforeFirstSwap")?"number"!=typeof sSto.getItem("beforeFirstSwap")||0!=sSto.getItem("beforeFirstSwap"):null,Super.apply(this,arguments),void function(self,Anim,exp,mainWatchUrl,mainWatchUrlRetina,bgIMG,socialModel,wishlistModel,imgObj){function onwillrender(next,vars,data){return events.eventRouter.off(events.configOpen,openConfigurator),events.eventRouter.off(events.configClose,closeConfigurator),events.eventRouter.off(events.appBeforeSwap,beforeSwap),events.eventRouter.off(events.appWillRender,onwillrender),next()}function openConfigurator(next,vars,data){return Anim.fadeOut(self.query("cta-component"),".2"),self.$query("majesty").on("click",onCloseByMajesty),self.query("majesty").classList.add("rlx-main-watch__watch--pointer"),next()}function closeConfigurator(next,vars,data){return Anim.fadeIn(self.query("cta-component"),".2"),self.$query("majesty").off("click",onCloseByMajesty),
self.query("majesty").classList.remove("rlx-main-watch__watch--pointer"),next()}function beforeSwap(next,vars,data,img){return img=self.query("majesty").querySelector("div"),img&&Anim.fadeOut(img,".6"),next()}function onCloseByMajesty(e){e.preventDefault(),sSto.getItem("configuratorIsOpen")&&events.eventRouter.trigger(events.configuratorClick,this)}Anim=new Animate,imgObj=new Image,exp=self._model.expand(),socialModel=exp.social,wishlistModel=exp.wishlist,mainWatchUrl=self._model.get("imgMainUrl"),mainWatchUrlRetina=self._model.get("imgMainUrlR"),mainWatchUrl?(imgObj.src=mainWatchUrl,env.mobile||(imgObj.srcset=mainWatchUrlRetina),imgObj.onload=function(div,source,img){div=document.createElement("div"),source=this.currentSrc?this.currentSrc:mainWatchUrl,self.query("soldat").classList.remove("rlx-main-watch__watch--placeholder"),div.classList.add("rlx-majesty-cellini"),div.style["background-image"]=["url(",source,")"].join(""),self.query("majesty").appendChild(div),img=self.query("majesty").querySelector("div"),img&&Anim.fadeIn(img,".3")},imgObj.onerror=function(){self.query("soldat").classList.remove("rlx-main-watch__watch--placeholder")}):self.query("soldat").classList.remove("rlx-main-watch__watch--placeholder"),self._model.set("bgClass",["rlx-",self._model.get("validModelName"),"-asset"].join("")),statics.isFirstSwap||CTAStyleSheet.rule(".rlx-main-watch__cta-bar-link {}",function(a){a.property({opacity:"1",animation:" none"})}),events.eventRouter.on(events.appBeforeSwap,beforeSwap),events.eventRouter.on(events.appWillRender,onwillrender),events.eventRouter.on(events.configOpen,openConfigurator),events.eventRouter.on(events.configClose,closeConfigurator),self.query("soldat").appendChild(new SoldatCelliniZView(self._model).borrow()),self.query("cta-component").appendChild(new CtaComponentZView(self._model).borrow())}(this)},_template:"div.rlx-main-watch__soldat@bg-soldat >                     ( div.rlx-main-watch__soldat--image .$bgClass@majesty                     +  div.rlx-main-watch__soldat--content .rlx-main-watch__watch--placeholder @soldat                     + div.rlx-main-watch__cta-component@cta-component)"}}),SoldatCelliniZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,Anim,exp,moonPhaseRMC){function onBeforeSwap(next,vars,data){return Anim.fadeOut(self.query("descContainer"),".2"),next()}function onwillrender(next,vars,data){return events.eventRouter.off(events.appBeforeSwap,onBeforeSwap),events.eventRouter.off(events.appWillRender,onwillrender),next()}exp=self._model.expand(),moonPhaseRMC="m50535-0002",exp.cta_btn&&(exp.cta_btn.text=exp.locales.ctaBtnTxt),self.query("descContainer").appendChild(new DescLineAndPrice(self._model).borrow()),exp.rmc==moonPhaseRMC&&self.query("watchTitle").appendChild(new CtaComponentUGButtonZView(exp.cta_btn).borrow()),Anim=new Animate,events.eventRouter.on(events.appBeforeSwap,onBeforeSwap),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},_template:"(div.rlx-main-watch__title@watchTitle >                       h1.rlx-main-watch__title--collection)                   + (div.rlx-main-watch__info >                       h2.rlx-main-watch__info--family {$modelName}                       + a.rlx-main-watch__info--family-link[href=$familyLink]{$viewAllTitle}                       + p.rlx-main-watch__info--infos-content {$introduction})                   + div.rlx-main-watch__desc@descContainer"}}),CtaComponentUGButtonZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){}(this)},_template:" a.rlx-cta-ug-button[href=$link] >                       span.rlx-cta-ug-button--text{$text}"}})},{"../core/Animate":12,"../environment":35,"../events":36,"../locales":38,"./CommonComponentsZView":42,"./ConfiguratorOysterZView":43}],46:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),ui=(requirejs("lib/Model"),requirejs("modules/rlx-ui")),events=(ui.router,require("../events")),env=(require("../locales"),require("../environment")),Animate=require("../core/Animate").Animate,UtilsConfigurator=(requirejs("require/hbs/underscore"),require("./ConfiguratorOysterZView").ConfiguratorUtils),sSto=(requirejs("cq-modules/rlx-wishlists-wrapper"),requirejs("modules/rmc"),requirejs("modules/rlx-num-trad"),requirejs("modules/rlx-storage").sessionStorage),DescLineAndPrice=(requirejs("modules/rlx-storage").localStorage,require("./CommonComponentsZView").descLineAndPrice),CtaComponentZView=require("./CommonComponentsZView").CtaMainControllerZView;module.exports.MainWatchZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.activeItemClass="rlx-main-watch__content-item--active",statics.activeButtonClass="rlx-main-watch__cta-bar-link--active",statics.targetButtonBase="rlx-main-watch__cta-bar-link--",statics.isFirstSwap=null!==sSto.getItem("beforeFirstSwap")?"number"!=typeof sSto.getItem("beforeFirstSwap")||0!=sSto.getItem("beforeFirstSwap"):null,statics.isTabletMode=null,statics.rmc=this._model.get("rmc"),statics.maxItems=9,statics.isInWishlist=null,void function(self,mainWatchUrl,objIMG,Anim,targetIMG,mainWatchUrlRetina,utilsConf){function onwillrender(next,vars){return events.eventRouter.off(events.appSwap,appSwap),events.eventRouter.off(events.configOpen,openConfigurator),events.eventRouter.off(events.configClose,closeConfigurator),events.eventRouter.off(events.appWillRender,onwillrender),next()}function openConfigurator(next,vars){return self._model.set("ctaIsOpen",!1),self._model.set("ctaActiveButton","configure"),self.query("majesty").classList.add("rlx-main-watch__watch--pointer"),env.mobile||Anim.translateY(self.query("infosBlock"),".1","-80px"),Anim.fadeOut(self.query("cta-component"),".2"),Anim.fadeOut(self.query("familyLink"),".2"),next()}function closeConfigurator(next,vars){return self.query("majesty").classList.remove("rlx-main-watch__watch--pointer"),Anim.fadeIn(self.query("cta-component"),".2"),Anim.fadeIn(self.query("familyLink"),".2"),Anim.translateY(self.query("infosBlock"),".1","0"),next()}function appSwap(next,vars,geoloc,exp){return self.query("cta-component").appendChild(new CtaComponentZView(self._model).borrow()),self.query("familyLink").setAttribute("href",self._model.get("familyLink")),Anim.fadeIn(self.query("familyLink"),".2"),self._model.get("price.showPriceState")||self.$query("priceBlock").remove(),next()}Anim=new Animate,objIMG=new Image,utilsConf=new UtilsConfigurator,self.query("mainWatch").setAttribute("data-rmc",self._model.get("rmc")),mainWatchUrl=self._model.get("imgMainUrl"),mainWatchUrlRetina=self._model.get("imgMainUrlR"),targetIMG=self.query("main-watch-fig"),objIMG.setAttribute("width","610"),objIMG.setAttribute("height","330"),objIMG.setAttribute("class","rlx-main-watch__watch--image"),objIMG.setAttribute("src",mainWatchUrl),env.mobile||objIMG.setAttribute("srcset",mainWatchUrlRetina),statics.isFirstSwap?(self.query("main-watch-fig").appendChild(objIMG),targetIMG.classList.remove("rlx-main-watch__watch--placeholder")):objIMG.onload=function(e){self.query("main-watch-fig").appendChild(objIMG),targetIMG.classList.remove("rlx-main-watch__watch--placeholder")},self.query("descContainer").appendChild(new DescLineAndPrice(self._model).borrow()),events.eventRouter.on(events.appSwap,appSwap),events.eventRouter.on(events.configOpen,openConfigurator),events.eventRouter.on(events.configClose,closeConfigurator),events.eventRouter.on(events.appWillRender,onwillrender),self.$query("main-watch-fig").on("click",function(e){e.preventDefault(),sSto.getItem("configuratorIsOpen")&&events.eventRouter.trigger(events.configuratorClick,this)}),env.mobile&&self.$query("infosBlock").remove()}(this)},_template:"div.rlx-main-watch@mainWatch[id=mainWatch][data-button-content-open=false] >                 (div.rlx-main-watch__title@titles >                   span.rlx-main-watch__title--collection{$collection}                   + h2.rlx-main-watch__title--family{$modelName}                   + a.rlx-main-watch__trigger-configurator@familyLink {$configuratorTitle})               + div.rlx-main-watch__watch@majesty >                     (figure .rlx-main-watch__watch--placeholder .rlx-main-watch__watch--fig@main-watch-fig                      + div@descContainer                     + div.rlx-main-watch__content >                           (div.rlx-main-watch__cta-component@cta-component                         + (div.rlx-main-watch__infos@infosBlock >                             h3.rlx-main-watch__infos-title {$slogan}                             + p.rlx-main-watch__infos-content {$introduction}) ) "}})},{"../core/Animate":12,"../environment":35,"../events":36,"../locales":38,"./CommonComponentsZView":42,"./ConfiguratorOysterZView":43}],47:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),events=require("../events"),env=require("../environment"),MainWatch=require("./MainWatchOysterZView").MainWatchZView,Configurator=require("./ConfiguratorOysterZView").ConfiguratorZView,EditorialContent=require("./EditorialZView").EditorialZView,DownloadContent=require("./EditorialZView").blocDownloadZView,MagazineContent=require("./EditorialZView").blocMagazineZView,SpecsZView=require("./SpecsZView").SpecsZView,SocialEmbedZView=require("./EditorialZView").blocSocialEmbedZView,Animate=(require("./CommonComponentsZView").SocialContentZView,require("../core/Animate").Animate),sSto=requirejs("modules/rlx-storage").sessionStorage,WAglobalLoadingPage=(requirejs("modules/rlx-web-analytics"),require("./CommonComponentsZView").WAPageLoadingZView),SBreadcrumbZView=require("../core/SBreadcrumbZView").SBreadcrumbZView,BreadcrumbAnchorZView=(require("../core/SBreadcrumbZView").BreadcrumbItemZView,require("../core/SBreadcrumbZView").BreadcrumbAnchorZView),breadcrumb=new SBreadcrumbZView;breadcrumb._model.set("cursor",jQuery(".rlx-breadcrumb").eq(0).find(".rlx-breadcrumb__item").length),SBreadcrumbZView.make(breadcrumb,BreadcrumbAnchorZView),breadcrumb._model.set("cursor",jQuery(".rlx-breadcrumb").eq(0).find(".rlx-breadcrumb__item").length),module.exports.OysterZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,expandModel,majestyModel,editorialModel,mainWatchModel,configuratorModel,priceModel){function beforeSwap(next,vars,offset,watch,varsList,Anim,lastActiveTab){return Anim=new Animate,watch=self.$query("contain").find(".rlx-main-watch__watch--fig").get(0),varsList=self.$query("contain").find(".rlx-configurator-content-variations__list"),Anim.fadeOut(watch,".6"),Anim.fadeOut(varsList,".6"),lastActiveTab=[self.$query("contain").find(".rlx-configurator-control-bar__list-item--active").index(),""].join(""),sSto.setItem("configurator.tab",lastActiveTab),next()}function afterSwap(next,vars,Anim,lazyLoad){var lastItem,WAdata;return lazyLoad=require("./utils").lazyLoading,Anim=new Animate,Anim.fadeIn(self.$query("contain").find(".rlx-configurator-content-variations__list"),".3"),new lazyLoad,env.mobile||1===sSto.getItem("beforeFirstSwap")||(lastItem=parseInt(breadcrumb._items.length-1,10),breadcrumb.get(lastItem)._model.set("text",majestyModel.referenceCode),breadcrumb.get(lastItem)._model.set("href",majestyModel.watch.page_link)),WAdata={rmc:mainWatchModel.rmc.toUpperCase(),family:mainWatchModel.familyCode,price:mainWatchModel.price&&mainWatchModel.price.hasPrice?mainWatchModel.price.rawPrice:0,path:location.pathname,showPriceState:!!mainWatchModel.price&&mainWatchModel.price.showPriceState},WAglobalLoadingPage(WAdata),events.eventRouter.trigger(events.shareReloadContent,{data:mainWatchModel.social}),next()}function onwillrender(next,vars,data){return events.eventRouter.off(events.appBeforeSwap,beforeSwap),events.eventRouter.off(events.appAfterSwap,afterSwap),events.eventRouter.off(events.appWillRender,onwillrender),next()}expandModel=self._model.expand(),majestyModel=expandModel.majesty,editorialModel=expandModel.editorial,mainWatchModel=majestyModel.mainWatch,configuratorModel=majestyModel.configurator,priceModel=expandModel.price,events.eventRouter.on(events.appBeforeSwap,beforeSwap),events.eventRouter.on(events.appAfterSwap,afterSwap),events.eventRouter.on(events.appWillRender,onwillrender),self.query("contain").appendChild(new MainWatch(mainWatchModel).borrow()),configuratorModel.config.variation&&self.query("contain").appendChild(new Configurator(configuratorModel).borrow()),self.query("contain").appendChild(new EditorialContent(editorialModel).borrow()),self.query("contain").appendChild(new SpecsZView(majestyModel).borrow()),self.query("contain").appendChild(new DownloadContent(editorialModel).borrow()),self.query("contain").appendChild(new MagazineContent(editorialModel).borrow());var socialEmbedModel=editorialModel.editorial[editorialModel.editorial.social_embed];socialEmbedModel&&(socialEmbedModel.title=editorialModel.locale[socialEmbedModel.title],socialEmbedModel.subtitle=editorialModel.locale[socialEmbedModel.subtitle],socialEmbedModel.display&&self.query("contain").appendChild(new SocialEmbedZView(socialEmbedModel).borrow()))}(this)},_template:"div.rlx-model-page.rlx-model-page--oyster@contain"}})},{"../core/Animate":12,"../core/SBreadcrumbZView":20,"../environment":35,"../events":36,"./CommonComponentsZView":42,"./ConfiguratorOysterZView":43,"./EditorialZView":44,"./MainWatchOysterZView":46,"./SpecsZView":48,"./utils":49}],48:[function(require,module,exports){"use strict";var SpecsBlocZView,SpecsItemZView,SpecsMobileZview,SpecsDesktopZView,SpecsBlocMobileZView,klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),events=require("../events"),locales=require("../locales"),EditorialsUtils=require("./EditorialZView").EditorialsUtils,env=require("../environment"),Animate=require("../core/Animate").Animate,isRtl=!("rtl"!==RLX.GLOBALS.DOM.jHtml.attr("dir"));module.exports.SpecsZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){env.mobile?(self._model.set("specTitle",locales.specs.mobile.title),self.query("specContainer").appendChild(new SpecsMobileZview(self._model).borrow())):(self.query("headSpecs").removeChild(self.query("specsFamName")),self.query("headSpecs").removeChild(self.query("specTitle")),self.query("specContainer").appendChild(new SpecsDesktopZView(self._model).borrow()))}(this)},_template:".rlx-specs-global-container[data-story-name=specifications] >                                     .rlx-specs-container@specContainer >                                         .rlx-specs-general@headSpecs >                                             h3.rlx-specs__family-name@specsFamName{$collection} +                                             h2.rlx-specs__title@specTitle{$specTitle} +                                             span.rlx-specs__family{$the} +                                             span.rlx-specs__reference{$referenceCode}"}}),SpecsDesktopZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,specsSize,i,j,innerData,helpers){for(helpers=new EditorialsUtils(self._model,"specs"),specsSize=helpers.getData("length",null),i=0;i<specsSize;++i){for(innerData={},innerData.items=[],innerData.name=helpers.getData(i,"name",!0),innerData.ref=helpers.getData(i,"ref"),j=0;j<helpers.getData(i,"length");++j)""!==helpers.getData(i,j+".text")&&innerData.items.push({title:helpers.getData(i,j+".title",!0),content:helpers.getData(i,j+".text",!0)});self.query("container").appendChild(new SpecsBlocZView(innerData).borrow())}}(this)},_template:".rlx-specs-desktop@container"}}),SpecsMobileZview=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),statics.startHeightContent=0,statics.startScroll=0,statics.heightCompleteContent=0,statics.getScrollPosition=function(){return window.scrollY},statics.getHeightContent=function(self){return self.query("global-container").clientHeight||self.query("global-container").offsetHeight},void function(self,helpers,specsSize,i,j,innerData,Anim){function onwillrender(next,vars){return self.$query("expandSpecs").off("click",revealSpec),events.eventRouter.off(events.appSwap,onAppSwap),events.eventRouter.off(events.appAfterSwap,onAfterSwap),events.eventRouter.off(events.revealCompleteSpecsClick,openCompleteSpecs),events.eventRouter.off(events.revealCompleteSpecsClick,closeCompleteSpecs),events.eventRouter.off(events.appWillRender,onwillrender),next()}function revealSpec(e){e.preventDefault(),events.eventRouter.trigger(events.revealCompleteSpecsClick,this)}function openCompleteSpecs(next,vars,el){return statics.startScroll=statics.getScrollPosition(),self._model.set("detailledSpecs",locales.specs.mobile.link.close),Anim.fadeOut(self.query("global-container"),".1").then(function(){window.requestAnimationFrame(function(hc){calculateHeightOfElem(self.query("global-container"),new SpecsDesktopZView(self._model).clone()).then(function(){Anim.height(self.query("global-container"),".3","px",statics.heightCompleteContent).then(function(){self.query("global-container").innerHTML="",self.query("global-container").appendChild(new SpecsDesktopZView(self._model).borrow()),Anim.fadeIn(self.query("global-container"),".3")})})})}),events.eventRouter.off(events.revealCompleteSpecsClick,openCompleteSpecs),events.eventRouter.on(events.revealCompleteSpecsClick,closeCompleteSpecs),next()}function closeCompleteSpecs(next,vars){return self._model.set("detailledSpecs",locales.specs.mobile.link.open),jQuery("html, body").animate({scrollTop:statics.startScroll},200),Anim.fadeOut(self.query("global-container"),".1").then(function(hc){window.requestAnimationFrame(function(){Anim.height(self.query("global-container"),".3","px",statics.startHeightContent).then(function(){self.query("global-container").innerHTML="",self.generateContentMobileSpecs().then(function(){Anim.fadeIn(self.query("global-container"),".3")})})})}),events.eventRouter.off(events.revealCompleteSpecsClick,closeCompleteSpecs),events.eventRouter.on(events.revealCompleteSpecsClick,openCompleteSpecs),next()}function calculateHeightOfElem(objGetH,html,fragDom,fakeContent,obj,dfd,delay){return dfd=jQuery.Deferred(),fakeContent=document.createElement("div"),fakeContent.classList.add("rlx-fake-container"),fakeContent.style.position="relative",fakeContent.style[isRtl?"right":"left"]="-999em",fakeContent.appendChild(html.borrow()),delay=isRtl?150:100,objGetH.appendChild(fakeContent),setTimeout(function(){statics.heightCompleteContent=fakeContent.clientHeight||fakeContent.offsetHeight,dfd.resolve()},delay),dfd.promise()}function onAfterSwap(next,vars){return jQuery(".rlx-specs-contain").height([statics.getHeightContent(self),"px"].join("")),next()}function onAppSwap(next,vars){return window.requestAnimationFrame(function(){statics.startHeightContent=statics.getHeightContent(self)}),next()}helpers=new EditorialsUtils(self._model,"specs"),specsSize=helpers.getData("length",null),Anim=new Animate,self._model.set("detailledSpecs",locales.specs.mobile.link.open),self.$query("expandSpecs").on("click",revealSpec),events.eventRouter.on(events.appSwap,onAppSwap),events.eventRouter.on(events.revealCompleteSpecsClick,openCompleteSpecs),events.eventRouter.on(events.appAfterSwap,onAfterSwap),events.eventRouter.on(events.appWillRender,onwillrender),self.generateContentMobileSpecs()}(this)},_template:".rlx-specs-contain@global-container                           + (.rlx-specs-mobile__button.rlx-white-text >                               a.rlx-links__button@expandSpecs{$detailledSpecs})",generateContentMobileSpecs:function(helpers,specsSize,self,dfd,innerData,i,wrap){for(self=this,dfd=jQuery.Deferred(),helpers=new EditorialsUtils(self._model,"specs"),specsSize=helpers.getData("length",null),self.query("global-container").innerHTML="",wrap=document.createElement("div"),wrap.classList.add("rlx-specs-mobile"),i=0;i<specsSize;++i)innerData={},innerData.items=[],innerData.ref=helpers.getData(i,"ref"),innerData.name=helpers.getData(i,"name",!0),""!==helpers.getData(i,"0.text")&&(innerData.items.push({name:helpers.getData(i,"name",!0),title:helpers.getData(i,"0.title",!0),content:helpers.getData(i,"0.text",!0)}),wrap.appendChild(new SpecsBlocMobileZView(innerData).borrow()));return self.query("global-container").appendChild(wrap),wrap.childNodes.length==specsSize?dfd.resolve():dfd.reject(),dfd.promise()}}}),SpecsBlocZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,x,items,itemsLength){items=self._model.get("items"),itemsLength=items.length,1===items.length&&self.query("specBloc").classList.add("rlx-specs-bloc--one-item");for(x in items)self.query("specBloc").appendChild(new SpecsItemZView(items[x]).borrow())}(this)},_template:"dl.rlx-specs-bloc@specBloc >                               dt.rlx-specs-bloc__name@title{$name}"}}),SpecsBlocMobileZView=klass(SpecsBlocZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self.query("specBloc").removeChild(self.query("title"))}(this)}}}),SpecsItemZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){null==self._model.get("name")&&null!=self._model.get("title")&&self._model.set("name",self._model.get("title")),null!=self._model.get("name")&&null==self._model.get("title")&&self._model.set("title",self._model.get("name")),null==self._model.get("content")&&self.root().removeChild(self.query("desc")),null==self._model.get("title")&&self.$query("title").remove()}(this)},_template:"dd.rlx-specs-bloc__content >                               div.rlx-specs-bloc__content-title@title {$name} +                               span.rlx-specs-bloc__content-desc@desc {$content}"}})},{"../core/Animate":12,"../environment":35,"../events":36,"../locales":38,"./EditorialZView":44}],49:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),_=requirejs("require/hbs/underscore"),events=require("../events"),ImageLoad=require("../core/ImageLoad").ImageLoad,Animate=require("../core/Animate").Animate,sSto=requirejs("modules/rlx-storage").sessionStorage;module.exports.lazyLoading=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,targets,mapPosition,elemArray,lazy,Anim){function onwillrender(next,vars){return events.eventRouter.off(events.appWillRender,onwillrender),jQuery(window).off("scroll",startLazyLoad),next()}Anim=new Animate,mapPosition=[],elemArray=[],targets=[,".rlx-editorial-feature",".rlx-downloads",".rlx-spirit"],_.map(targets,function(v,i,p,element,obj){0!==document.querySelectorAll(v).length&&(document.querySelectorAll(v).length>1?[].forEach.call(document.querySelectorAll(v),function(elem){elemArray.push(elem)}):elemArray.push(document.querySelector(v)))}),mapPosition=_.map(elemArray,function(v,i,offsetTop,offsetTopJS){if(null!=v)return v.offsetTop}),lazy=function(doc,posY,winH,scrollB,indexBlocHover,lazyMargin){doc=document.documentElement,lazyMargin=-100,posY=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),winH=window.screen.height,scrollB=parseInt(posY+winH+lazyMargin,10),indexBlocHover=_.map(mapPosition,function(v,i){return v<scrollB&&i}),_.map(indexBlocHover,function(v,i,state,source,imgObj,elemLazy){state=v!==!1?1:0,elemLazy=elemArray[i],"undefined"!=typeof elemLazy.attributes["data-load"]&&0===parseInt(elemLazy.attributes["data-load"].value,10)&&state&&(elemLazy.setAttribute("data-load",state),elemLazy.classList.add("rlx-main-watch__watch--placeholder"),ImageLoad({context:elemLazy,imageSrc:elemLazy.getAttribute("data-src")||elemLazy.childNodes[0].getAttribute("data-src"),callback:function(){elemLazy.classList.remove("rlx-main-watch__watch--placeholder"),elemLazy.childNodes[0].classList.add("rlx-editorial__load-content--loaded")},addToCSSclass:"background"===elemLazy.attributes["data-load-type"]?"rlx-editorial-feature--bkg":""}))})};var startLazyLoad=_.throttle(function(){lazy()},50);jQuery(window).on("scroll",startLazyLoad),events.eventRouter.on(events.appWillRender,onwillrender)}(this)},addClass:function(elem,classToAdd,classAttr){"undefined"!=typeof elem&&(classAttr=elem.className,classAttr.indexOf(classToAdd)===-1&&(elem.className+=" "+classToAdd))}}}),module.exports.info={type:sSto.getItem("model-type"),isCellini:"cellini"===sSto.getItem("model-type"),isOyster:"oyster"===sSto.getItem("model-type")}},{"../core/Animate":12,"../core/ImageLoad":14,"../events":36}],50:[function(require,module,exports){"use strict";var sidebar=require("./sidebar");module.exports.routes=[sidebar]},{"./sidebar":51}],51:[function(require,module,exports){"use strict";var ui=requirejs("modules/rlx-ui"),env=require("../../environment"),header=ui.SHeader.header,NavPane=ui.NavPane,MobileNavPane=ui.MobileNavPane,Pane=env.mobile?MobileNavPane:NavPane,SideBarPrice=require("../../common/side-bar/PriceInfoZView").sidebarPrice,sideprice={path:"/ui/side/price",handler:function(next,vars,d,priceSB){priceSB=new SideBarPrice(d.data),priceSB.refresh(d.data),header.hide(function(){priceSB.show(),priceSB.on(Pane.HIDDEN_EVT,function onnavclose(){priceSB.off(Pane.HIDDEN_EVT,onnavclose),setTimeout(function(){header.show()},150)})}),next()}};module.exports=sideprice},{"../../common/side-bar/PriceInfoZView":4,"../../environment":35}],52:[function(require,module,exports){"use strict";function mhandler(next,vars){return dp_handler.apply(null,arguments)}function da_handler(next,vars,rmc,family,zone,country){return rmc=vars.rmc.replace(/\.html$/,""),vars.family=vars.family.replace(/\.html$/,""),zone=geoloc.zone(),country=geoloc.countryCode(),dp_handler.apply(null,arguments)}function dp_handler(next,vars,rmc,zone,country,jsonmodelhref,jsonpricehref,pdata,mdata){function onerror(e){throw e}function onprice(response){response?("object"!=typeof response&&null!=response&&(response=JSON.parse(response)),pdata=filters.price(response)):pdata=filters.price({})}function onmajesty(response){mdata=response?filters.configurator(response):filters.configurator({})}function ondata(state){function removeOnSessionStorage(arr,i){if(arr&&"object"==typeof arr)for(i=0;i<arr.length;++i)sSto.removeItem(arr[i])}"pending"==loadingPromise.state()?(loadingPromise.resolve(),removeOnSessionStorage(["configurator.tab","configurator.slide","configurator.next","wishlist-size","isAlreadyAddedOnWishlist","scrollPosTablet","configIsDisplay","ctaBusy"]),rmc=mdata.majesty.watch.rmc?mdata.majesty.watch.rmc.toLowerCase():null,sSto.setItem("rmc-origin",rmc),sSto.setItem("link-origin",mdata.majesty.watch.page_link),state=1):state=0,sSto.setItem("beforeFirstSwap",state),state&&sSto.removeItem("configuratorIsOpen"),state&&sSto.removeItem("hasScrolled"),sSto.setItem("model-type","cellini"),void function(parent,wApp){sequencer.setInnerActions({position:3,mode:"rw",method:function(){wApp=document.getElementById("watch-app"),events.eventRouter.trigger(events.appWillRender),window.requestAnimationFrame(function(){document.body.classList&&document.body.classList.remove("rlx-lock-scroll"),parent.childNodes.length&&(parent.innerHTML=""),"attachEvent"in window||"msSetImmediate"in window?setTimeout(function(){parent.appendChild(new CelliniZView(filters.combine(pdata,mdata,locales)).borrow())},1):parent.appendChild(new CelliniZView(filters.combine(pdata,mdata,locales)).borrow()),setTimeout(function(){events.eventRouter.trigger(events.broadcastModel)},4),wApp.innerHTML="",wApp.appendChild(parent),("attachEvent"in window||"msSetImmediate"in window)&&setTimeout(function(){events.eventRouter.trigger(events.appSwap),setTimeout(function(){events.eventRouter.trigger(events.appAfterSwap)},100)},100),events.eventRouter.trigger(events.appSwap),setTimeout(function(){events.eventRouter.trigger(events.appAfterSwap)},100)})}}),sequencer.start()}((new AppZView).query("main"))}return rmc=vars.rmc.replace(/\.html$/,""),zone=geoloc.zone(),country=geoloc.countryCode(),jsonmodelhref=urlMapping("modelJSON",rmc,zone,country),jsonpricehref=urlMapping("priceJSON",rmc,zone,country),all([new XHR(jsonmodelhref).then(onmajesty,onerror),new XHR(jsonpricehref).then(onprice,onerror)]).then(ondata,onerror).catch(function(err){}),next()}var sequencer,env=require("../../environment"),geoloc=env.geoloc,loadingPromise=require("../../loadingPromise").loadingPromise,Route=require("../../core/Route").Route,all=require("korbutJS/src/Promise").Promise.all,locales=require("../../locales"),events=require("../../events"),filters=require("../../core/filters"),XHR=require("../../core/XHR").XHR,AppZView=require("../../core/SAppZView").SAppZView,CelliniZView=require("../../model/CelliniZView").CelliniZView,Sequencer=require("../../core/SAppSequencer").SAppSequencer,urlMapping=requirejs("modules/rlx-urlmapping"),sSto=requirejs("modules/rlx-storage").sessionStorage;module.exports=new Route({path:{publish:"/:lang/watches/:family(cellini(?:.*))/:rmc","m-publish":[env.devMobilePrefix,"/:lang","/watches/:family(cellini(?:.*))/:rmc"].join(""),author:"/content/rolexcom/:lang/watches/:family(cellini(?:.*))/:rmc","m-author":"/content/rolexcom-mobile/:lang/watches/:family(cellini(?:.*))/:rmc"},handler:{desktop:env.isAuthor?da_handler:dp_handler,mobile:mhandler,tablet:env.isAuthor?da_handler:dp_handler}}),sequencer=new Sequencer,sequencer.setActions([{eventName:events.appBeforeSwap,timing:100},{eventName:events.appPrepareSwap,timing:100}])},{"../../core/Route":17,"../../core/SAppSequencer":18,"../../core/SAppZView":19,"../../core/XHR":22,"../../core/filters":23,"../../environment":35,"../../events":36,"../../loadingPromise":37,"../../locales":38,"../../model/CelliniZView":41,"korbutJS/src/Promise":60}],53:[function(require,module,exports){"use strict";var cellini=require("./cellini"),oyster=require("./oyster");module.exports.routes=[oyster,cellini]},{"./cellini":52,"./oyster":54}],54:[function(require,module,exports){"use strict";function mhandler(next,vars){return dp_handler.apply(null,arguments)}function da_handler(next,vars,rmc,family,zone,country){return rmc=vars.rmc.replace(/\.html$/,""),vars.family=vars.family.replace(/\.html$/,""),zone=geoloc.zone(),country=geoloc.countryCode(),dp_handler.apply(null,arguments)}function dp_handler(next,vars,rmc,zone,country,jsonmodelhref,jsonpricehref,pdata,cdata,edata,origin){function onerror(e){throw e}function onprice(response){response?("object"!=typeof response&&null!=response&&(response=JSON.parse(response)),pdata=filters.price(response)):pdata=filters.price({})}function onconfigurator(response){cdata=response?filters.configurator(response):filters.configurator({})}function ondata(state,rmc){function removeOnSessionStorage(arr,i){if(arr&&"object"==typeof arr)for(i=0;i<arr.length;++i)sSto.removeItem(arr[i])}"pending"==loadingPromise.state()?(loadingPromise.resolve(),removeOnSessionStorage(["configurator.tab","configurator.slide","configurator.next","wishlist-size","isAlreadyAddedOnWishlist","scrollPosTablet","configIsDisplay","ctaBusy"]),rmc=cdata.majesty.watch.rmc?cdata.majesty.watch.rmc.toLowerCase():null,sSto.setItem("rmc-origin",rmc),sSto.setItem("link-origin",cdata.majesty.watch.page_link),state=1):(state=0,removeOnSessionStorage(["isAlreadyAddedOnWishlist"])),sSto.setItem("beforeFirstSwap",state),state&&sSto.removeItem("configuratorIsOpen"),state&&sSto.removeItem("hasScrolled"),sSto.setItem("model-type","oyster"),void function(parent,wApp){sequencer.setInnerActions({position:3,mode:"rw",method:function(){wApp=document.getElementById("watch-app"),events.eventRouter.trigger(events.appWillRender),window.requestAnimationFrame(function(){document.body.classList&&document.body.classList.remove("rlx-lock-scroll"),parent.childNodes.length&&(parent.innerHTML=""),
"attachEvent"in window||"msSetImmediate"in window?setTimeout(function(){parent.appendChild(new OysterZView(filters.combine(pdata,cdata,edata,locales)).borrow())},1):parent.appendChild(new OysterZView(filters.combine(pdata,cdata,edata,locales)).borrow()),setTimeout(function(){events.eventRouter.trigger(events.broadcastModel)},4),state||null===sSto.getItem("scrollPosTablet")?sSto.removeItem("scrollPosTablet"):window.scrollTo(0,sSto.getItem("scrollPosTablet")),wApp.innerHTML="",wApp.appendChild(parent),("attachEvent"in window||"msSetImmediate"in window)&&setTimeout(function(){events.eventRouter.trigger(events.appSwap),setTimeout(function(){events.eventRouter.trigger(events.appAfterSwap)},100)},100),events.eventRouter.trigger(events.appSwap),setTimeout(function(){events.eventRouter.trigger(events.appAfterSwap)},100)})}}),sequencer.start()}((new AppZView).query("main"))}return rmc=vars.rmc.replace(/\.html$/,""),zone=geoloc.zone(),country=geoloc.countryCode(),jsonmodelhref=urlMapping("modelJSON",rmc,zone,country),jsonpricehref=urlMapping("priceJSON",rmc,zone,country),all([new XHR(jsonmodelhref).then(onconfigurator,onerror),new XHR(jsonpricehref).then(onprice,onerror)]).then(ondata,onerror).catch(function(err){}),next()}var sequencer,all=require("korbutJS/src/Promise").Promise.all,events=require("../../events"),env=require("../../environment"),loadingPromise=require("../../loadingPromise").loadingPromise,Route=require("../../core/Route").Route,filters=require("../../core/filters"),XHR=require("../../core/XHR").XHR,AppZView=require("../../core/SAppZView").SAppZView,OysterZView=require("../../model/OysterZView").OysterZView,Sequencer=require("../../core/SAppSequencer").SAppSequencer,geoloc=env.geoloc,locales=require("../../locales"),urlMapping=requirejs("modules/rlx-urlmapping"),sSto=requirejs("modules/rlx-storage").sessionStorage;module.exports=new Route({path:{publish:"/:lang/watches/:family((?!cellini)(?:.*))/:rmc","m-publish":[env.devMobilePrefix,"/:lang","/watches/:family((?!cellini)(?:.*))/:rmc"].join(""),author:"/content/rolexcom/:lang/watches/:family((?!cellini)(?:.*))/:rmc","m-author":"/content/rolexcom-mobile/:lang/watches/:family((?!cellini)(?:.*))/:rmc"},handler:{desktop:env.isAuthor?da_handler:dp_handler,mobile:mhandler,tablet:env.isAuthor?da_handler:dp_handler}}),sequencer=new Sequencer,sequencer.setActions([{eventName:events.appBeforeSwap,timing:10},{eventName:events.appPrepareSwap,timing:100}])},{"../../core/Route":17,"../../core/SAppSequencer":18,"../../core/SAppZView":19,"../../core/XHR":22,"../../core/filters":23,"../../environment":35,"../../events":36,"../../loadingPromise":37,"../../locales":38,"../../model/OysterZView":47,"korbutJS/src/Promise":60}],55:[function(require,module,exports){"use strict";var ZParser,COMPUTED_STYLE_COMPAT,CSS_TRANSITION_COMPAT,CSS_TRANSITION_PROPERTY,CSS_TRANSITIONEND_EVENT,Stylesheet=requirejs("lib/StyleSheet"),Promise=jQuery.Deferred;Stylesheet=requirejs("lib/StyleSheet"),ZParser=requirejs("lib/ZenView").ZenParser,COMPUTED_STYLE_COMPAT=module.exports.COMPUTED_STYLE_COMPAT="getComputedStyle"in window?1:0,CSS_TRANSITION_COMPAT=module.exports.CSS_TRANSITION_COMPAT=COMPUTED_STYLE_COMPAT&&"TransitionEvent"in window?1:"WebKitTransitionEvent"in window?3:0,CSS_TRANSITION_PROPERTY=module.exports.CSS_TRANSITION_PROPERTY=1==CSS_TRANSITION_COMPAT?"transition":3==CSS_TRANSITION_COMPAT?"-webkit-transition":null,CSS_TRANSITIONEND_EVENT=module.exports.CSS_TRANSITIONEND_EVENT=1==CSS_TRANSITION_COMPAT?"transitionend":3==CSS_TRANSITION_COMPAT?"webkitTransitionEnd":null,module.exports.stylesheet=new Stylesheet,module.exports.std_transition=function(str,prop){return str.replace("transform",prop)},module.exports.getCompat=module.exports.stylesheet.cssCompat=function(dfd){return dfd=new Promise,module.exports.stylesheet.rule(".test-a{position:fixed; width:400px; height: 100px; background: red; z-index: 10000;}",".test-b{position:sticky; position:-webkit-sticky}",".test-c{-webkit-overflow-scrolling:touch}",".test-d{transform:translate(0, 0);-webkit-transform:translate(0, 0)}",".test-e{backface-visibility:hidden; -webkit-backface-visibility:hidden;}",".test-f{perspective:1000; -webkit-perspective:1000;}",function(a,b,c,d,e,f){dfd.resolve({fixed:a.property("position"),sticky:b.property("position"),overflow_scrolling_touch:c.property("-webkit-overflow-scrolling"),transform:d.property("transform")?"transform":d.property("-webkit-transform")?"-webkit-transform":null,backfaceVisibility:e.property("backface-visibility")?"backface-visibility":e.property("-webkit-backface-visibility")?"-webkit-backface-visibility":null,perspective:f.property("perspective")?"perspective":f.property("-webkit-perspective")?"-webkit-perspective":null})}),function(cb){return dfd.then(cb)}}()},{}],56:[function(require,module,exports){arguments[4][55][0].apply(exports,arguments)},{dup:55}],57:[function(require,module,exports){"use strict";module.exports.bus=RLX.GLOBALS.DOM.jDoc,module.exports.user={login:"user:login",gigyaRegistration:"user:gigya:registration",gigyaRegistrationFail:"user:gigya:registration:fail",gigyaLogin:"user:gigya:login",gigyaLoginFail:"user:gigya:login:fail",logout:"user:logout",logoutAction:"user:logout-click",changeHeader:"user:header:title"},module.exports.usermenu={swapBefore:"usermenu:swap:before",swapAfter:"usermenu:swap:after",click:"usermenu:click"},module.exports.userpanel={close:"userpanel:close",open:"userpanel:open",swap:"userpanel:swap",resize:"userpanel:resize",removeSwitch:"userpanel:remove:switchbar"},module.exports.banner={click:"wishlist-banner:click"},module.exports.breadcrumb={click:"breadcrumb:click"},module.exports.wishlist={willrender:"wishlist:render:start",render:"wishlist:render:end",swap:"wishlist:render:swap",mobileShow:"wishlist:mobile:show",requestRefresh:"wishlist:request:refresh",selectPersonalList:"wishlist:request:select-personal-list",selectRetailerList:"wishlist:request:select-retailer-list",deleteRetailerListRequest:"wishlist:retailer:delete-list",cancelDeleteRetailerListRequest:"wishlist:retailer:delete-list-cancel",deleteRetailerListRequestComplete:"wishlist:retailer:delete-list-complete",add:"wishlist:modify:add",removeRequest:"wishlist:modify:removerequest",removeSuccess:"wishlist:modify:removesuccess",removeError:"wishlist:modify:removeerror",removeAnimationStart:"wishlist:modify:removeanimationstart",removeAnimationEnd:"wishlist:modify:removeanimationend",informations:"wishlist:data:informations",data:"wishlist:data:load",nodata:"wishlist:data:error",loginrequired:"wishlist:retailer-code:logged-out",equalizeRequest:"wishlist:equalize:request",equalizeResponse:"wishlist:equalize:response",socialdisplay:"wishlist:share-popin:display",socialnetworkclick:"wishlist:social:share",shareemailactivate:"wishlist:share-email:activate",sharemaildeactivate:"wishlist:share-email:deactivate",shareWishlistRequest:"wishlist:share:request",exploreWishlistRequest:"wishlist:share:request",registerRequest:"wishlist:register:request",showSpecs:"wishlist:specs:show",hideSpecs:"wishlist:specs:hide",retailerFullDetails:"wishlist:retailer:full-details",consumeCodeRequest:"wishlist:retailer:consumeCodeRequest",downloadAsset:"wishlist:asset:download",analLoaded:"analytics:open-wishlist"}},{}],58:[function(require,module,exports){"use strict";var i18n=requirejs("i18n");"false"==RLX.device.is_mobile&&"false"==RLX.device.is_tablet;module.exports.usermenu={"your-wishlist":i18n("login/your-wishlist"),"my-wishlist":i18n("wishlist/my-wishlist"),username:i18n("login/link-panel-access"),"open-menu":i18n("login/open-menu"),login:i18n("login/login"),register:i18n("login/register"),logout:i18n("login/logout"),account:i18n("account/your-account")},module.exports.loginpanel={form:{legend:i18n("login/login-title"),inputs:{email:{id:"login-email",classes:"",label:i18n("login/email"),placeholder:i18n("login/email"),type:"email",value:"",itemType:"input"},password:{id:"login-password",classes:"",label:i18n("login/password"),placeholder:i18n("login/password"),type:"password",value:"",itemType:"input"},checkbox:{id:"login-keep",classes:" rlx-user-panel__form-checkbox",label:i18n("login/keep-me-logged-in"),itemType:"input",value:"",type:"checkbox"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),forgot:{text:i18n("login/forgot-password"),href:"#forgot-pwd"},button:{type:"submit",id:"submit",text:i18n("login/login")}},network:{header:i18n("login/login-social"),facebook:{name:"facebook",text:i18n("login/facebook")},googleplus:{name:"googleplus",text:i18n("login/google")},linkedin:{name:"linkedin",text:i18n("login/linkedin")}},register:{header:i18n("login/not-yet-member-title"),text:i18n("login/not-yet-member-text"),button:i18n("login/register"),thanks:i18n("login/welcome-title")}},module.exports.registerpanel={form:{legend:i18n("login/sign-up-email"),introText:i18n("login/intro-text"),inputs:{gender:{id:"register-gender",classes:"",label:i18n("login/title"),placeholder:i18n("login/title"),options:[{value:"",text:i18n("login/title")},{value:"Mr",text:i18n("login/mr")},{value:"Mrs",text:i18n("login/mrs")},{value:"Ms",text:i18n("login/ms")}]},firstName:{id:"register-firstname",classes:"",placeholder:i18n("login/first-name"),label:i18n("login/first-name"),type:"text",value:"",itemType:"input"},lastName:{id:"register-lastname",classes:"",placeholder:i18n("login/last-name"),label:i18n("login/last-name"),type:"text",value:"",itemType:"input"},email:{id:"register-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"},password:{id:"register-password",classes:"",placeholder:i18n("login/password"),label:i18n("login/password"),type:"password",value:"",itemType:"input"},password2:{id:"register-password2",classes:"",placeholder:i18n("login/retype-password"),label:i18n("login/retype-password"),type:"password",value:"",itemType:"input"},checkbox:{id:"register-terms",classes:" rlx-user-panel__form-checkbox",label:i18n("login/terms-conditions"),itemType:"input",value:"",type:"checkbox"},accessToken:{id:"register-token",classes:"",placeholder:"",label:"",type:"hidden",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"submit",text:i18n("login/sign-up")}},network:{header:i18n("login/sign-up-social"),facebook:{name:"facebook",text:i18n("login/facebook")},googleplus:{name:"googleplus",text:i18n("login/google")},linkedin:{name:"linkedin",text:i18n("login/linkedin")}},login:{header:i18n("login/already-member-title"),text:i18n("login/already-member-text"),button:i18n("login/login")}},module.exports.confirmpanel={form:{legend:i18n("login/please-confirm"),text:i18n("login/thank-you-message"),resend:{type:"submit",id:"resend",text:i18n("login/resend-email")},button:{type:"button",id:"close",text:i18n("login/ok")}}},module.exports.activatepanel={form:{legend:i18n("login/activate-account-subtitle"),text:i18n("login/activate-account-text"),resend:{type:"submit",id:"resend",text:i18n("login/resend-email")},button:{type:"button",id:"close",text:i18n("account/cancel")}}},module.exports.forgotpanel={form:{legend:i18n("login/forgot-password-subtitle"),text:i18n("login/forgot-password-subtitle-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"forgot-submit",text:i18n("login/send-verification-email")},cancel:{type:"button",id:"forgot-cancel",text:i18n("account/cancel")},close:{type:"button",id:"forgot-close",text:i18n("login/close")}}},module.exports.resendVerification={header:i18n("login/token-activation-expired-title"),form:{legend:i18n("login/token-activation-expired-subtitle"),text:i18n("login/token-activation-expired-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),submit:{type:"submit",id:"token-resend",text:i18n("login/resend-email")},cancel:{type:"button",id:"token-close",text:i18n("account/cancel")},close:{type:"button",id:"token-close",text:i18n("login/close")}}},module.exports.resendForgot={header:i18n("login/token-password-expired-title"),form:{legend:i18n("login/token-password-expired-subtitle"),text:i18n("login/token-password-expired-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"forgot-submit",text:i18n("login/send-verification-email")},cancel:{type:"button",id:"forgot-cancel",text:i18n("account/cancel")},close:{type:"button",id:"forgot-close",text:i18n("login/close")}}},module.exports.passwordpanel={form:{legend:i18n("login/reset-password-subtitle"),inputs:{password:{id:"change-password",classes:"",placeholder:i18n("login/reset-password-new-password"),label:i18n("login/reset-password-new-password"),type:"password",value:"",itemType:"input"},password2:{id:"change-password-verification",classes:"",placeholder:i18n("login/reset-password-retype-new-password"),label:i18n("login/reset-password-retype-new-password"),type:"password",value:"",itemType:"input"},token:{id:"change-password-token",classes:"",placeholder:"",label:"",type:"hidden",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",name:"submit",text:i18n("login/send-verification-email")}}},module.exports.passwordtips={header:i18n("login/password-tips"),rules:[{regExp:"^.{6,15}$",text:i18n("login/pwd-tips-one")},{regExp:"[\\d]{1,}",text:i18n("login/pwd-tips-two")},{regExp:"[a-z]{1,}",text:i18n("login/pwd-tips-three")}]},module.exports.accountuser={header:i18n("account/your-rolex-account"),privacy:i18n("account/privacy"),edit:i18n("account/edit-account-details"),title:i18n("account/your-title"),firstName:i18n("account/your-first-name"),lastName:i18n("account/your-last-name"),email:i18n("account/email"),textintro:i18n("account/your-account-text")},module.exports.accountwishlist={header:i18n("wishlist/your-wishlist"),"n-watches-wishlist":i18n("account/n-watches-wishlist"),"one-watch":i18n("account/one-watch-wishlist"),create:i18n("account/create-selection"),text:i18n("account/wishlist-intro"),button:i18n("account/explore-collection"),view:i18n("account/view-wishlist")},module.exports.accountretailer={header:i18n("account/your-preferred-retailer"),create:i18n("account/select-your-retailer"),text:i18n("account/your-preferred-retailer-text-long"),button:i18n("account/select-your-retailer"),view:i18n("account/retailer-details")},module.exports.userpanel={close:i18n("login/close"),subLogin:{header:i18n("login/login-title")},subForgot:{header:i18n("login/forgot-password-title")},subActivate:{header:i18n("login/activate-account-title")},subConfirm:{header:i18n("login/thank-you-title")},subRegister:{header:i18n("login/sign-up-title")},subPassword:{header:i18n("login/reset-password-title")},subAccount:{header:{welcome:i18n("account/welcome"),w:i18n("login/welcome"),username:i18n("account/username"),logout:i18n("login/logout")}}},module.exports.banner={h1:i18n("wishlist/banner/h1"),h2:i18n("wishlist/banner/h2"),paragraph:i18n("wishlist/banner/paragraph"),button:{text:i18n("wishlist/banner/button"),href:"#login"},img:{src:"/media/images/wishlist/main-banner.jpg"}},module.exports.wishlistbanner={placeholders:{empty:i18n("wishlist/placeholder-empty"),item:i18n("wishlist/select-from-collections")},save:i18n("wishlist/save")},module.exports.wishlistlist={deletelabel:i18n("wishlist/delete")},module.exports.wishlistitem={specs:{show:i18n("wishlist/show-features"),hide:i18n("wishlist/hide-features"),ref:i18n("model/ref")},links:{remove:i18n("model/remove-this-watch"),brochure:i18n("model/download-brochure"),share:i18n("website/share-this-watch")}},module.exports.retailerlist={header:i18n("wishlist/shared-wishlist-title"),from:i18n("wishlist/from"),copy:i18n("wishlist/shared-wishlist-banner-text"),view:i18n("wishlist/view")},module.exports.deleteRetailerList={title:i18n("wishlist/delete-confirmation-message"),cancel:i18n("wishlist/cancel"),ok:i18n("wishlist/yes"),thankTitle:i18n("wishlist/thank-you"),thankCopy:i18n("wishlist-deleted")},module.exports.breadcrumb={mywishlist:i18n("wishlist/my-wishlist"),shared:i18n("wishlist/shared-wishlist"),home:i18n("website/home")},module.exports.sharepopin={email:i18n("share/email"),shareTitle:i18n("model/share-this-watch"),sendmecopy:"send me copy",validation:{empty:i18n("share/empty-invalid-form"),email:i18n("email-invalid-form")}},module.exports.wishlistkillswitched={button:i18n("website/share"),copy:i18n("wishlist/killswitch-banner-description")}},{}],59:[function(require,module,exports){"use strict";var klass=require("./class").class;module.exports.Iterator=klass(function(statics){return Object.defineProperties(statics,{iterable:{enumerable:!0,value:function(o){try{return Object.keys(o),!0}catch(e){return!!o&&Object.prototype.hasOwnProperty.call(o,"length")}return!1}},iterate:{enumerable:!0,value:function(o,rv,i,l,lead,trail){if(o=o||Object.create(null),o.constructor===Object&&o.hasOwnProperty("length"))try{for(rv=Array.prototype.slice.call(o),i=0,l=o.length;i<l;i++)if(!rv.hasOwnProperty(i))throw error;o=rv}catch(e){}try{if(rv=Object.keys(o),"[object String]"==Object.prototype.toString.call(o))throw new Error;return rv}catch(e){if(rv=[],"[object String]"==Object.prototype.toString.call(o))for(i=0,l=o.length;i<l;i++)lead=o.charCodeAt(i),trail=o.charCodeAt(i<l-1?i+1:""),rv.push(lead>=55296&&lead<=56319&&trail>=56320&&trail<=57343?o[i]+o[++i]:o[i]);return rv}}}}),{constructor:function(o,opt_keys,keys,i,l){for(opt_keys=!!arguments[1]||"[object String]"==Object.prototype.toString.call(arguments[0]),keys=statics.iterate(o),i=0,l=keys.length,Object.defineProperties(this,{_pointer:{writable:!0,value:-1},_range:{value:[]}});i<l;i++)this._range[i]=opt_keys?[keys[i]]:[keys[i],arguments[0][keys[i]]]},next:{enumerable:!0,value:function(cb,idx){return cb="function"==typeof cb?cb:null,idx=++this._pointer,Object.defineProperty(this,"_current",{configurable:!0,value:idx>=(this._range||[]).length?{index:null,key:null,value:null,done:!0}:{index:idx,key:this._range[idx][0],value:this._range[idx][this._range[idx].length-1],done:!1}}),cb&&cb(this.current.done,this.current.key,this.current.value),this.current}},range:{enumerable:!0,get:function(){return this._range?[].concat(this._range):[]}},pointer:{enumerable:!0,get:function(){return this._pointer||-1},set:function(v){this._pointer=this._pointer||Object.defineProperty(this,"_pointer",{value:-1})._pointer,this._pointer=v}},length:{enumerable:!0,get:function(){return this._range.length}},current:{enumerable:!0,get:function(){return this._current||this.next(),this._current}},purge:{enumerable:!0,configurable:!0,value:function(){}}}})},{"./class":62}],60:[function(require,module,exports){"use strict";var _=require("./utils"),klass=require("./class").class,Iterator=require("./Iterator").Iterator,UID=require("./UID").UID;module.exports.Promise=klass(function(statics){var promises=Object.create(null);return Object.defineProperties(statics,{all:{enumerable:!0,value:function(promises){if(!Iterator.iterable(promises))throw new TypeError("korbut.Promise.all requires an iterable object as argument 0.");return new module.exports.Promise(function(resolve,reject,iterator,length,value){function onresolve(idx){return function(v){value[idx]=v,--length||resolve(value)}}function onreject(e){reject(e)}for(iterator=new Iterator(promises),length=promises.length,value=[];!iterator.next().done;)void function(iteration,input){input=iteration.value,module.exports.Promise.isImplementedBy(input)||(input=module.exports.Promise.cast(input)),input.then(onresolve(iteration.index),onreject)}(iterator.current)})}},cast:{enumerable:!0,value:function(v){return module.exports.Promise.isImplementedBy(v)?v:new module.exports.Promise(function(resolve){resolve("function"==_.typeof(v)?v():v)})}},race:{enumerable:!0,value:function(promises){if(!Iterator.iterable(promises))throw new TypeError("korbut.Promise.race requires an iterable object as argument 0.");return new module.exports.Promise(function(resolve,reject,iterator,length,resolved){function onresolve(v){resolved||(resolved=!0,resolve(v))}function onreject(){--length||reject(new Error("all promises were rejected"))}for(iterator=new Iterator(promises),length=iterator.length;!iterator.next().done;)module.exports.Promise.isImplementedBy(iterator.current.value)&&iterator.current.value.then(onresolve,onreject)})}},reject:{enumerable:!0,value:function(reason){return new module.exports.Promise(function(resolve,reject){reject(reason)})}},resolve:{enumerable:!0,value:function(value){return new module.exports.Promise(function(resolve){resolve(value)})}},getByUid:{enumerable:!0,value:function(uid){return promises[uid]?promises[uid].promise:void 0}},PENDING:{enumerable:!0,value:"pending"},RESOLVED:{enumerable:!0,value:"resolved"},REJECTED:{enumerable:!0,value:"rejected"}}),{constructor:function(resolver,resolved){function resolve(v,handlers){if(!resolved)for(resolved=!0,promises[this.uid].state.key=this.RESOLVED,promises[this.uid].state.value=v,Object.freeze(promises[this.uid].state),handlers=Array.isArray(this._onresolve)?[].concat(this._onresolve):[];handlers.length;)handlers.shift().call(null,v)}function reject(r,handlers){if(!resolved)for(resolved=!0,promises[this.uid].state.key=this.REJECTED,promises[this.uid].state.value=r,Object.freeze(promises[this.uid].state),handlers=Array.isArray(this._onreject)?[].concat(this._onreject):[];handlers.length;)handlers.shift().call(null,r)}if("function"!=typeof resolver)throw new TypeError("Constructor korbut.Promise requires a resolver function as argument 0.");promises[this.uid]={promise:this,state:{key:this.PENDING,value:null}},resolver(resolve.bind(this),reject.bind(this))},then:{enumerable:!0,value:function(onresolve,onreject){return function(self,hasResolved,hasRejected){return hasResolved||hasRejected?hasResolved?new module.exports.Promise(function(resolve,reject,rv){try{rv="function"==typeof onresolve?onresolve(promises[self.uid].state.value):null}catch(e){return void reject(e)}rv&&"function"==typeof rv.then?rv.then(function(v){resolve(v)},function(r){reject(r)}):resolve(rv)}):hasRejected?new module.exports.Promise(function(resolve,reject,rv){try{rv="function"==typeof onreject?onreject(promises[self.uid].state.value):null}catch(e){return void reject(e)}rv&&"function"==typeof rv.then?rv.then(function(v){resolve(v)},function(r){reject(r)}):setTimeout(reject,4,rv)}):void 0:new module.exports.Promise(function(resolve,reject){!Array.isArray(self._onresolve)&&Object.defineProperty(self,"_onresolve",{value:[]}),!Array.isArray(self._onreject)&&Object.defineProperty(self,"_onreject",{value:[]}),self._onresolve.push(function(v,rv){try{rv=onresolve(v)}catch(e){return void reject(e)}rv&&"function"==typeof rv.then?rv.then(function(v){resolve(v)},function(r){reject(r)}):resolve(rv)}),self._onreject.push(function(r,rv){try{rv=onreject(r)}catch(e){return void reject(e)}rv&&"function"==typeof rv.then?rv.then(function(v){resolve(v)},function(r){reject(r)}):resolve(rv)})})}(this,promises[this.uid].state.key==this.RESOLVED,promises[this.uid].state.key==this.REJECTED)}},catch:{enumerable:!0,value:function(onreject){return function(self){return new module.exports.Promise(function(resolve,reject){self.then(resolve,function(r){return reject(r),onreject(r)})})}(this)}},PENDING:{enumerable:!0,get:function(){return module.exports.Promise.PENDING}},RESOLVED:{enumerable:!0,get:function(){return module.exports.Promise.RESOLVED}},REJECTED:{enumerable:!0,get:function(){return module.exports.Promise.REJECTED}},uid:{enumerable:!0,configurable:!0,get:function(){return this._uid||Object.defineProperty(this,"_uid",{value:UID.uid()})._uid}},state:{enumerable:!0,configurable:!0,get:function(){return promises[this.uid].state.key}}}})},{"./Iterator":59,"./UID":61,"./class":62,"./utils":63}],61:[function(require,module,exports){"use strict";var _=require("./utils"),klass=require("./class").class;module.exports.UID=klass(function(statics){var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",MAP="Fxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",RADIX=16,REGEXP=/[xy]/g,generators=Object.create(null);return Object.defineProperties(statics,{uid:{enumerable:!0,value:function(date){return date=Date.now(),MAP.replace(REGEXP,function(c,r){return r=(date+Math.random()*RADIX)%RADIX|0,"y"===c&&(r=3&r|8),CHARS[r]})}}}),{constructor:function(dict){dict=dict&&"object"==_.typeof(dict)?dict:{},generators[this.uid]={map:"string"==_.typeof(dict.map)?dict.map:MAP,radix:"number"==_.typeof(dict.radix)?dict.radix:RADIX,regexp:"regexp"==_.typeof(dict.regexp)?dict.regexp:REGEXP}},generate:{enumerable:!0,value:function(date){return date=Date.now(),this.map.replace(this.regexp,function(c,r){return r=(date+Math.random()*this.radix)%this.radix|0,"y"===c&&(r=3&r|8),CHARS[r]}.bind(this))}},map:{enumerable:!0,get:function(){return generators[this.uid].map}},radix:{enumerable:!0,get:function(){return generators[this.uid].radix}},regexp:{enumerable:!0,get:function(){return generators[this.uid].regexp}},uid:{enumerable:!0,configurable:!0,get:function(){return this._uid||Object.defineProperty(this,"_uid",{value:module.exports.UID.uid()})._uid}}}})},{"./class":62,"./utils":63}],62:[function(require,module,exports){"use strict";var _=require("./utils");module.exports.class=function(args,statics,Class,prototype,k){for(args=_.spread(arguments),statics=Object.create(null),prototype=Object.create({}),args[args.length-1]=function getDescriptors(descriptors,keys,i,l){if("function"==_.typeof(descriptors))return getDescriptors(descriptors.call(null,statics));for(descriptors.constructor=descriptors.hasOwnProperty("constructor")?descriptors.constructor:function(){},Class="function"!=_.typeof(descriptors.constructor)||_.native(descriptors.constructor)?"function"!=_.typeof(descriptors.constructor.value)||_.native(descriptors.constructor.value)?function(){}:descriptors.constructor.value:descriptors.constructor,delete descriptors.constructor,keys=Object.keys(descriptors);keys.length;)void function(key){descriptors[key]=descriptors[key].constructor==Object&&(descriptors[key].hasOwnProperty("value")||descriptors[key].hasOwnProperty("get")||descriptors[key].hasOwnProperty("set"))?descriptors[key]:{configurable:!0,enumerable:!0,writable:!0,value:descriptors[key]}}(keys.shift());return{prototype:Object.create(null,descriptors)}}(args[args.length-1]);args.length;)void function(Super,propertyNames){try{propertyNames=Object.getOwnPropertyNames(Super.prototype)}catch(e){propertyNames=[]}for(;propertyNames.length;)void function(property,descriptor){Object.defineProperty(prototype,property,descriptor)}(propertyNames[0],Object.getOwnPropertyDescriptor(Super.prototype,propertyNames.shift()))}(args.shift());return Object.defineProperty(prototype,"constructor",{value:Class,configurable:!0,enumerable:!0}),Class.prototype=prototype,void function(properties){for(;properties.length;)Object.defineProperty(Class,properties[0],Object.getOwnPropertyDescriptor(statics,properties.shift()))}(Object.getOwnPropertyNames(statics)),!Class.hasOwnProperty("create")&&Object.defineProperty(Class,"create",{enumerable:!0,value:function(args){function F(){return Class.apply(this,args)}return args=_.spread(arguments),F.prototype=Class.prototype,new F}}),!Class.hasOwnProperty("extend")&&Object.defineProperty(Class,"extend",{enumerable:!0,value:function(){return module.exports.class.apply(null,[Class].concat(_.spread(arguments)))}}),!Class.hasOwnProperty("isImplementedBy")&&Object.defineProperty(Class,"isImplementedBy",{enumerable:!0,value:function(o,prototype,keys,i,l){if(!o)return!1;if(prototype=o&&o.prototype?o.prototype:"function"==typeof o.constructor?o.constructor.prototype:null,o instanceof Class||Class.prototype===prototype)return!0;for(keys=Object.getOwnPropertyNames(Class.prototype),l=keys.length,i=0;i<l;i++)if("constructor"!=keys[i]&&function(o,c,err){return err=!o||!c,o&&(c.configurable?c.hasOwnProperty("value")&&typeof o.value!=typeof c.value&&(err=!0):(c.hasOwnProperty("value")&&o.value!==c.value&&(err=!0),c.hasOwnProperty("get")&&o.get!==c.get&&(err=!0),c.hasOwnProperty("set")&&o.set!==c.set&&(err=!0))),err}(Object.getOwnPropertyDescriptor(prototype,keys[i]),Object.getOwnPropertyDescriptor(Class.prototype,keys[i])))return!1;return!0}}),!Class.hasOwnProperty("implementsOn")&&Object.defineProperty(Class,"implementsOn",{enumerable:!0,value:function(o,prototype,properties){for(prototype="function"==_.typeof(o)?o.prototype:"object"==_.typeof(o)?o:function(){throw new TypeError}(),properties=Object.getOwnPropertyNames(Class.prototype);properties.length;)Object.defineProperty(prototype,properties[0],Object.getOwnPropertyDescriptor(Class.prototype,properties.shift()));Class.apply(prototype,_.spread(arguments,1))}}),Class},module.exports.singleton=function(F,G){return F=module.exports.class.apply(null,arguments),G=module.exports.class.call(null,F,function(statics,k){for(k in F)statics[k]=F[k];return{constructor:function(){return G.instance?G.instance:(G.instance=this,F.apply(this,arguments))}}})}},{"./utils":63}],63:[function(require,module,exports){"use strict";module.exports.native=function(rnative){return function(fn){try{return"function"==typeof fn&&!!fn.toString().match(rnative)}catch(e){return null}}}(/\s*\[native code\]\s*/i),module.exports.spread=function(slice){return function(o,i,l){return slice.call(o,i,l)}}(Array.prototype.slice),module.exports.typeof=function(toString){return function(o,ntypeof){return Array.isArray(o)?"array":(ntypeof=typeof o,"object"!=ntypeof?o===o?ntypeof:"NaN":o&&o.constructor&&!module.exports.native(o.constructor)?"instance":o&&"function"==typeof o.prototype?"function":toString.call(o).slice(8,-1).toLowerCase())}}(Object.prototype.toString),module.exports.invoke=function(fn,ctx,args){switch(fn="function"==typeof fn?fn:function(){throw new TypeError("korbut.utils.invoke - function expected as argument 0")}(),ctx=arguments[1]||null,args=3==arguments.length&&Array.isArray(args)?args:module.exports.spread(arguments,2),args.length){case 0:return Function.prototype.call.call(fn,ctx);case 1:return Function.prototype.call.call(fn,ctx,args[0]);case 2:return Function.prototype.call.call(fn,ctx,args[0],args[1]);case 3:return Function.prototype.call.call(fn,ctx,args[0],args[1],args[2]);default:return Function.prototype.apply.call(fn,ctx,args)}}},{}]},{},[39]);