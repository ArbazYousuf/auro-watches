!function e(t,n,r){function s(o,u){var a,f,l;if(!n[o]){if(!t[o]){if(a="function"==typeof require&&require,!u&&a)return a(o,!0);if(i)return i(o,!0);throw f=new Error("Cannot find module '"+o+"'"),f.code="MODULE_NOT_FOUND",f}l=n[o]={exports:{}},t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var o,i="function"==typeof require&&require;for(o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,ZView=(requirejs("utils").singleton,requirejs("lib/ZenView")),wWrap=(requirejs("lib/Model"),requirejs("cq-modules/rlx-wishlists-wrapper")),ui=requirejs("modules/rlx-ui"),sSto=requirejs("modules/rlx-storage").sessionStorage,numTrad=requirejs("modules/rlx-num-trad"),events=(require("../locales"),require("../events")),Animation=require("../core/Animate").Animate,eventRouter=events.eventRouter,UIRouter=ui.router,sessionStorage=new requirejs("modules/rlx-storage").sessionStorage,HeaderMenuLink=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){"undefined"==typeof self._model.get("moreClass")&&self._model.set("moreClass","")}(this)},_template:"li.rlx-site-nav__item.added-by-js@li >                           a[href=$href][title=$title][target=$target][class=$class]@link >                               span[class=$iconClass]@icon                             + span.rlx-hide-collapsed{$text} >                                 span[class=$moreClass]@more"}});module.exports.HeaderWishlistLink=klass(HeaderMenuLink,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,Anim){function onclick(e){return self.isOwnPage()?void e.preventDefault():(self._model.get("size")&&(e.preventDefault(),UIRouter.dispatch("/ui/side/wishlist")),void(sSto.getItem("configuratorIsOpen")&&eventRouter.trigger(events.configuratorClick)))}function onchangesize(next,vars,data,wishlistCount){return data&&"undefined"!=typeof data.newSize&&0!==data.newSize?(wishlistCount=data.newSize,self.query("more").innerHTML=[" ","(",numTrad.numTrad(wishlistCount,["fa"]),")"].join(""),self.query("more").style.display="inline",self._model.set("size",data.newSize)):(self.query("more").style.display="none",self._model.set("size",0)),next()}Anim=new Animation,self.query("more").style.display="none",self.$query("link").css("opacity",0),self.isOwnPage()&&self.query("li").classList.add("rlx-site-nav__item--inactive"),setTimeout(function(){Anim.fadeIn(self.$query("link"),".1")},100),self.$query("link").on("click",onclick),eventRouter.on(events.wishlistUpdateSize,onchangesize),self._model.on("change",function(key,value,oldValue){switch(key){case"size":sessionStorage.setItem("wishlist-size",value),eventRouter.trigger(events.wishlistUpdateSize,{newSize:value})}}),self.loadWishlistData()}(this)},loadWishlistData:function(self){self=this,wWrap.getRmcArray().done(function(listRmc){"undefined"!=typeof listRmc&&self._model.set("size",listRmc.length)})},isOwnPage:function(self){return self=this,location.pathname.indexOf("wishlist")>-1}}}),module.exports.HeaderAccountLink=klass(HeaderMenuLink,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,dfd,Anim){function onopenside(e){var user,route;e.preventDefault(),user=new(require("../userland/SUser").SUser),route=["/ui/side/account/",user.get("state")?"account":"login"].join(""),user.get("state")?user.update().then(function(){UIRouter.dispatch(route)}):UIRouter.dispatch(route)}dfd=new jQuery.Deferred,Anim=new Animation,self.query("link").style.opacity=0,setTimeout(function(){Anim.fadeIn(self.query("link"),".1")},100),self.$query("link").on("click",onopenside)}(this)}}})},{"../core/Animate":2,"../events":4,"../locales":6,"../userland/SUser":9}],2:[function(require,module,exports){"use strict";var klass=requirejs("utils").classMaker,transition=requirejs("modules/rlx-transition");module.exports.Animate=klass(function(Super,statics){return{constructor:function(){void function(self){}(this)},_fade:function(o,s,t){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,t="number"!=typeof t?parseFloat(t,10):t,transition.animate(o,{opacity:{to:t,transition:s}})},_translate:function(o,s,t){return"array"==typeof t&&t.join(","),transition.animate(o,{transform:{transition:s,to:"translate3d("+t+")"}})},translateX:function(o,s,t){return this._translate(o,s,[t,0,0])},translateY:function(o,s,t){return this._translate(o,s,[0,t,0])},fadeIn:function(o,s,t){return s="undefined"==typeof s?".4":s,t="undefined"==typeof t?1:t,this._fade(o,s,t)},fadeOut:function(o,s,t){return s="undefined"==typeof s?".4":s,t="undefined"==typeof t?0:t,this._fade(o,s,t)},height:function(o,s,u,t,unit){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,unit="undefined"==typeof u?"px":u,t="string"!=typeof t?t+"":t,t=t.indexOf(unit)===-1?parseInt(t,10)+unit:t,transition.animate(o,{height:{to:t,transition:s}})},top:function(o,s,t){return s=s.indexOf("s")===-1?parseFloat(s,10)+"s":s,t=t.indexOf("px")===-1?parseInt(t,10)+"px":t,transition.animate(o,{top:{to:t,transition:s}})},scrollTo:function(s,t,way,i,inc,posStart,easing,self){function setScroll(i){window.scrollTo(0,i)}self=this,easing=self.easing(),i=0,inc=5,way="undefined"==typeof way?0:way,posStart=function(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop},way&&(i=posStart(),inc*=-1),void function animloop(delta,pos,start,control){return start=posStart(),control=way?i>t:i<t,control&&i!==t?(i+=inc,delta=way?i-start:t-start,pos=easing.easeInOutCubic(i,start,delta,s),window.requestAnimationFrame(animloop),setScroll(pos),void 0):void window.cancelAnimationFrame(animloop)}()},easing:function(){return{easeInOutQuart:function(t,b,c,d){return t/=d/2,t<1?c/2*t*t*t*t+b:(t-=2,-c/2*(t*t*t*t-2)+b)},easeInOutCubic:function(t,b,c,d){return t/=d/2,t<1?c/2*t*t*t+b:(t-=2,c/2*(t*t*t+2)+b)}}}}})},{}],3:[function(require,module,exports){"use strict";module.exports=requirejs("lib/environment"),module.exports.geoloc=requirejs("modules/rlx-geolocation"),module.exports.debugJS&&(module.exports.geoloc.showPrices=function(){return!0},module.exports.geoloc.zone=function(){return"zone_h"},module.exports.geoloc.countryCode=function(){return"FR"})},{}],4:[function(require,module,exports){"use strict";var SAppEventRouter=requirejs("lib/SAppEventRouter");module.exports=SAppEventRouter.SAppEventRouter.events,module.exports.SAppEventRouter=SAppEventRouter,module.exports.eventRouter=SAppEventRouter.eventRouter},{}],5:[function(require,module,exports){"use strict";var Promise=jQuery.Deferred;module.exports.loadingPromise=new Promise},{}],6:[function(require,module,exports){"use strict";var i18n=requirejs("i18n"),confstoreloc=requirejs("config~dealerlocator"),env=requirejs("lib/environment"),numTrad=requirejs("modules/rlx-num-trad");module.exports={findRetailer:i18n("model/find-retailer"),hideRetailer:i18n("model/hide-retailer"),currentLocation:i18n("retailers/use-your-current-location"),showPrice:i18n("model/show-price"),hidePrice:i18n("model/hide-price"),configureButton:i18n("model/configure"),addWishlist:i18n("model/watch-added")+" (5/9)",viewWishlist:i18n("model/watch-add-full"),shareThisWatch:i18n("model/share-this-watch"),makeItYours:i18n("website/make-it-yours"),configHeader:i18n("model/configurator-header"),resetConfig:i18n("model/reset-configuration"),shareThisPage:i18n("share/share-this-page"),sidebar:{watchesTitle:i18n("model/rolex-watches"),pricingTitle:i18n("model/rolex-pricing-policies"),close:i18n("model/close")},share:{byEmail:i18n("share/email")},locator:{title:"Rolex retailer locator",findNearest:i18n("retailers/locator/use-current-location-link")},specs:{mobile:{title:i18n("model/specifications"),link:{open:i18n("model/open-detailed-specs"),close:i18n("model/close-detailed-specs")}}}},module.exports.wishlist={add:i18n("model/add-to-wishlist"),added:i18n("model/watch-added"),remove:i18n("model/remove-from-wishlist"),removed:i18n("/model/watch-removed"),full:i18n("model/watch-add-full-alert",numTrad.numTrad(9,["fa"])),show:i18n("model/watch-add-full")},module.exports.wishlist.page={findmyrolex:i18n("website/find-your-rolex"),downloadebrochure:i18n("model/download-brochure"),confirm:i18n("login/send-verification-email"),sharethismodel:i18n("model/share-this-watch"),discover:i18n("website/discover"),removethiswatch:i18n("model/remove-this-watch"),placholdertxt:i18n("wishlist/select-from-collections"),showPrice:i18n("model/show-price"),hidePrice:i18n("model/hide-price"),ref:i18n("/model/ref"),sidebar:{watchesTitle:i18n("model/rolex-watches"),pricingTitle:i18n("model/rolex-pricing-policies"),close:i18n("model/close")}},module.exports.wishlist.sidebar={noItems:i18n("your-wishlist-is-empty"),close:i18n("login/close"),title:i18n("wishlist/my-wishlist"),subtitle:i18n("wishlist/panel-description"),viewmoredetails:i18n("wishlist/panel-cta")},module.exports.specs={mobile:{title:i18n("model/specifications"),link:{open:i18n("model/open-detailed-specs"),close:i18n("model/close-detailed-specs")}}},module.exports.header={yourAccount:i18n("account/your-account"),myAccount:i18n("account/my-account"),account:i18n("account/_"),wishlist:i18n("website/wishlist")},module.exports.configurator={buttonBack:i18n("website/back"),title:i18n("model/configure-model"),close:i18n("website/close"),viewAll:"View all",wouldText:i18n("model/would-you-like-to-see")},module.exports.locator={header:"find a retailer",subHeader:"where to buy a rolex",type:"dealer",findNearest:i18n("retailers/locator/use-current-location-link"),sto:{country:{title:i18n("/retailers/locator/select-country"),type:"country"},region:{title:i18n("/retailers/locator/select-region"),type:"region"},city:{title:i18n("/retailers/locator/select-city"),type:"city"},district:{title:i18n("/retailers/locator/select-district"),type:"district"}},url:[env.baseUrl,confstoreloc["store-locator-base-url"]].join("")},module.exports.service={header:"find a servicing",subHeader:"where to service a rolex",type:"service",findNearest:i18n("retailers/locator/use-current-location-link"),sto:{country:{title:i18n("/retailers/locator/select-country"),type:"country"},region:{title:i18n("/retailers/locator/select-region"),type:"region"}},url:[env.baseUrl,confstoreloc["service-locator-base-url"]].join("")},module.exports.grids={"noresults-watches":{text:i18n("search/sorry-no-match"),more:i18n("search/please-try-another-combination-or-reset")}},module.exports.search={"new-noresults":{title:i18n("search/no-results-found"),text:i18n("search/please-try-another-keyword"),anchor:i18n("/search/back-to-the-home")}},module.exports.filters={show:i18n("model/filters/show-filters"),hide:i18n("model/filters/hide-filters"),reset:i18n("website/reset"),filter_the_results:i18n("model/filters/filter-results"),close:i18n("website/close"),viewtheresults:i18n("search/view-results"),selectcriterials:i18n("search/filters/title"),noresult:i18n("search/no-results-found"),backtomodel:i18n("website/back")}},{}],7:[function(require,module,exports){"use strict";var ui=requirejs("modules/rlx-ui"),env=require("../../environment"),header=ui.SHeader.header,NavPane=ui.NavPane,MobileNavPane=ui.MobileNavPane,WishlistSide=(ui.router,require("../../wishlist/WishlistSideZView").SWishlistSideZView),Pane=env.mobile?MobileNavPane:NavPane,sSto=requirejs("modules/rlx-storage").sessionStorage,WebAnalytics=requirejs("modules/rlx-web-analytics"),wishlistside={path:"/ui/side/wishlist",handleRoute:function(next,vars){var wl=new WishlistSide;header.hide(function(){wl.show(),wl.on(Pane.HIDDEN_EVT,function onnavclose(){wl.off(Pane.HIDDEN_EVT,onnavclose),setTimeout(function(){header.show()},500)})}),setTimeout(function(){var wa=new WebAnalytics,dL=sSto.getItem("data-layer-side-event");dL&&wa.populate(dL,"page/products/selections").go("wishlistPanel")},1e3),next()}},wishlistsidereload={path:"/ui/side/reload/wishlist",handleRoute:function(next,vars){var wl=new WishlistSide;wl.reload(),next()}};module.exports=[wishlistside,wishlistsidereload]},{"../../environment":3,"../../wishlist/WishlistSideZView":14}],8:[function(require,module,exports){"use strict";var ZParser,COMPUTED_STYLE_COMPAT,CSS_TRANSITION_COMPAT,CSS_TRANSITION_PROPERTY,CSS_TRANSITIONEND_EVENT,Stylesheet=requirejs("lib/StyleSheet"),Promise=jQuery.Deferred;Stylesheet=requirejs("lib/StyleSheet"),ZParser=requirejs("lib/ZenView").ZenParser,COMPUTED_STYLE_COMPAT=module.exports.COMPUTED_STYLE_COMPAT="getComputedStyle"in window?1:0,CSS_TRANSITION_COMPAT=module.exports.CSS_TRANSITION_COMPAT=COMPUTED_STYLE_COMPAT&&"TransitionEvent"in window?1:"WebKitTransitionEvent"in window?3:0,CSS_TRANSITION_PROPERTY=module.exports.CSS_TRANSITION_PROPERTY=1==CSS_TRANSITION_COMPAT?"transition":3==CSS_TRANSITION_COMPAT?"-webkit-transition":null,CSS_TRANSITIONEND_EVENT=module.exports.CSS_TRANSITIONEND_EVENT=1==CSS_TRANSITION_COMPAT?"transitionend":3==CSS_TRANSITION_COMPAT?"webkitTransitionEnd":null,module.exports.stylesheet=new Stylesheet,module.exports.std_transition=function(str,prop){return str.replace("transform",prop)},module.exports.getCompat=module.exports.stylesheet.cssCompat=function(dfd){return dfd=new Promise,module.exports.stylesheet.rule(".test-a{position:fixed; width:400px; height: 100px; background: red; z-index: 10000;}",".test-b{position:sticky; position:-webkit-sticky}",".test-c{-webkit-overflow-scrolling:touch}",".test-d{transform:translate(0, 0);-webkit-transform:translate(0, 0)}",".test-e{backface-visibility:hidden; -webkit-backface-visibility:hidden;}",".test-f{perspective:1000; -webkit-perspective:1000;}",function(a,b,c,d,e,f){dfd.resolve({fixed:a.property("position"),sticky:b.property("position"),overflow_scrolling_touch:c.property("-webkit-overflow-scrolling"),transform:d.property("transform")?"transform":d.property("-webkit-transform")?"-webkit-transform":null,backfaceVisibility:e.property("backface-visibility")?"backface-visibility":e.property("-webkit-backface-visibility")?"-webkit-backface-visibility":null,perspective:f.property("perspective")?"perspective":f.property("-webkit-perspective")?"-webkit-perspective":null})}),function(cb){return dfd.then(cb)}}()},{}],9:[function(require,module,exports){"use strict";function removeCookies(){jQuery.removeCookie(config.memberData,{path:config.cookiePath,domain:config.cookieDomain,secure:!0})}var _=requirejs("utils"),Model=requirejs("mvc").Model,config=requirejs("config-members"),sanitizer=(requirejs("lib/ZenView").ZenParser,require("sanitizer")),events=require("./events"),MemberService=(require("../events").eventRouter,requirejs("modules/rlx-ui").router,requirejs("lib/Cookie"),require("./Service").MemberService),memberCookie=jQuery.cookie(config.memberData),simpleURLReg=/(https?:)?\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/;module.exports.SUser=_.singleton(Model,function(Super,statics){function walk(o,opts){var k,i;if("undefined"==typeof o.length)for(k in o)o.hasOwnProperty(k)&&choose(o,k,opts);else for(i=o.length;i--;)choose(o,i,opts)}function choose(o,k,opts){"string"!=typeof o[k]||simpleURLReg.test(o[k])?"object"==typeof o[k]&&walk(o[k],opts):o[k]=opts.simple?statics.sanitizeHTMLSimpler(o[k],opts.blacklist||{}):statics.sanitizeHTML(o[k])}var UNLOGGED=statics.UNLOGGED=0,LOGGED=statics.LOGGED=1;return statics.sanitizeObject=function(o,opts){"object"==typeof o&&walk(o,opts||{})},statics.sanitizeHTML=function(v){return sanitizer.sanitize(v)},statics.sanitizeHTMLSimpler=function(value,blacklisted,defaults,e){return defaults="script|style|object|embed","string"!=typeof blacklisted&&(blacklisted=""),blacklisted+="|"+defaults,e=new RegExp("(<("+blacklisted+")[^>]*>.*?</\\2>)","gi"),value.replace(e,"")},{constructor:function(){Super.apply(this,arguments),this.initModel(),"undefined"!=typeof memberCookie&&""!=memberCookie&&this.set("state",LOGGED),this.hook("memberInfo",function(v){return"undefined"!=typeof v.title&&v.title||(v.title=""),v}),this.hook("memberInfo.title",function(v){return"undefined"!=typeof v&&v||(v=""),v})},_defaults:{state:UNLOGGED,fetched:!1},save:function(o,self){return self=this,MemberService.post(jQuery.extend({cmd:"save"},o)).then(function(response){self.set("memberInfo",o),self.trigger("save")})},deactivate:function(self){return self=this,MemberService.post({cmd:"delete"}).then(function(){self.set("state",UNLOGGED),removeCookies()})},update:function(self){self=this;var dfd=new jQuery.Deferred;return MemberService.post({cmd:"memberAccount",lang:RLX.cqlang,mobile:RLX.GLOBALS.features.isMobile,countryCode:RLX.device.country_code,nocache:!1}).then(function(response,memberInfo,wishlistsInfo,accountPage,retailerInfo){self.trigger("switch"),memberInfo=response.memberInfo,wishlistsInfo=response.wishlistsInfo,accountPage=response.accountPage,retailerInfo=response.accountPage.retailerInfo,void function(arr){for(var i=arr.length;i--;)statics.sanitizeObject(arr[i].o,arr[i].opts)}([{o:memberInfo,opts:{simple:!1}},{o:accountPage,opts:{simple:!1}},{o:retailerInfo,opts:{simple:!1}},{o:wishlistsInfo,opts:{simple:!1}}]),self.set("memberInfo",memberInfo),self.set("wishlistsInfo",wishlistsInfo),self.set("accountPage",accountPage),self.set("retailerInfo",retailerInfo),self.set("fetched",!0),setTimeout(function(){dfd.resolve()},500)},function(obj,err,msg){return arguments}),dfd},login:function(self,memberCookie,obj,data){self=this,memberCookie=jQuery.cookie(config.memberData),self.set("state",LOGGED);try{data=decodeURIComponent(escape(atob(memberCookie||""))).split(";"),data&&data.length&&self.set("memberInfo.id",data[0])}catch(e){_error(e),removeCookies()}events.bus.trigger(events.user.login,[this])},logout:function(force){var p=new jQuery.Deferred;return this.set("state",UNLOGGED),force&&removeCookies(),events.bus.trigger(events.user.logout,[this]),setTimeout(function(){p.resolve()},100),p},getMemberData:function(self){return self=this,"undefined"==typeof self._savedMemberPromise&&(self._savedMemberPromise=MemberService.post({cmd:"get"})),self._savedMemberPromise.then(function(response){return self.set("memberInfo.id",response.id),self.set("memberInfo.firstName",response.firstName),self.set("memberInfo.lastName",response.lastName),response},function(){removeCookies()}),self._savedMemberPromise},getWishlist:function(){var self=this,p=new jquery.Deferred;return self.get("state")&&MemberService.post({cmd:"onlineSimpleWishLists",memberId:self.get("id")}).then(function(response){p.resolve(response)}),p},addToWishList:function(rmc){var self=this,p=new jQuery.Deferred;return self.get("state")&&MemberService.post({cmd:"addToWishList",memberId:self.get("id"),wishlistId:"5473cd3999329bb12565f213",rmc:rmc}).then(function(response){p.resolve(response)}),p},deleteFromWishList:function(rmc){var self=this,p=new jQuery.Deferred;return self.get("state")&&(p=MemberService.post({cmd:"deleteFromWishList",memberId:self.get("id"),wishlistId:"5473cd3999329bb12565f213",rmc:rmc})),p}}})},{"../events":4,"./Service":10,"./events":11,sanitizer:17}],10:[function(require,module,exports){"use strict";var config=requirejs("config-members"),_=requirejs("utils"),ajax=jQuery.ajax,CacheService=(require("./locales"),module.exports.CacheService=_.classMaker(function(Super,statics){return{constructor:function(){void function(self){self.data={}}(this)},get:function(item,self){return self=this,self.data[item]},set:function(item,data,self){self=this,item&&data&&"save"!==item?self.data[item]=data:"save"===item&&data.hasOwnProperty("title")&&self.data.hasOwnProperty("memberAccount")?self.update(self.data.memberAccount.memberInfo,data):self.clear()},remove:function(item,self){self=this,delete self.data[item]},has:function(item,self){return self=this,!(!self.data.hasOwnProperty(item)||!self.data[item])},clear:function(self,v){if(self=this,Object.keys(self.data).length)for(v in self.data)delete self.data[v]},update:function(obj,data,self,v){self=this;for(v in data)obj.hasOwnProperty(v)&&"string"==typeof data[v]&&obj[v]!==data[v]&&(obj[v]=data[v])},reload:function(self,User){function refreshOK(resp){self.data={},self.data=resp}function refreshNOK(err){throw err}self=this,User=new(require("./SUser").SUser),User.get("state")&&MemberService.post({cmd:"memberAccount",lang:RLX.cqlang,mobile:RLX.GLOBALS.features.isMobile,countryCode:RLX.device.country_code,nocache:!0}).then(refreshOK,refreshNOK)}}})),Cache=new CacheService,Service=module.exports.Service=_.classMaker(function(Super,statics){return statics.get=function(url,obj){return new Service("get").request(url,obj)},statics.post=function(url,obj){return new Service("post").request(url,obj)},{constructor:function(type){this.type=type||"get"},request:function(url,obj){return obj.contentType="application/x-www-form-urlencoded;charset=UTF-8",obj.type=this.type,this._prev=ajax(url,obj).complete(function(resp){obj.data.nocache===!1&&Cache.set(obj.data.cmd,resp.responseJSON)})}}}),MemberService=module.exports.MemberService=Service.extend(function(Super,statics){return statics.get=function(dataObj,headers){return new MemberService("get").request(dataObj,headers)},statics.post=function(dataObj,headers){return new MemberService("post").request(dataObj,headers)},{constructor:function(type){Super.apply(this),this.type=type||"get"},request:function(dataObj,headers,self,dfd){return self=this,dfd=jQuery.Deferred(),headers=headers||{},dataObj=dataObj||{},dataObj._charset_="UTF-8",dataObj.nocache===!1&&Cache.has(dataObj.cmd)?(dfd.resolve(Cache.get(dataObj.cmd)),dfd.promise()):Service.prototype.request.call(self,config.servletPath,{data:dataObj,type:self.type,headers:headers,dataType:"json"})}}})},{"./SUser":9,"./locales":12}],11:[function(require,module,exports){"use strict";module.exports.bus=RLX.GLOBALS.DOM.jDoc,module.exports.user={login:"user:login",gigyaRegistration:"user:gigya:registration",gigyaRegistrationFail:"user:gigya:registration:fail",gigyaLogin:"user:gigya:login",gigyaLoginFail:"user:gigya:login:fail",logout:"user:logout",logoutAction:"user:logout-click",changeHeader:"user:header:title"},module.exports.usermenu={swapBefore:"usermenu:swap:before",swapAfter:"usermenu:swap:after",click:"usermenu:click"},module.exports.userpanel={close:"userpanel:close",open:"userpanel:open",swap:"userpanel:swap",resize:"userpanel:resize",removeSwitch:"userpanel:remove:switchbar"},module.exports.banner={click:"wishlist-banner:click"},module.exports.breadcrumb={click:"breadcrumb:click"},module.exports.wishlist={willrender:"wishlist:render:start",render:"wishlist:render:end",swap:"wishlist:render:swap",mobileShow:"wishlist:mobile:show",requestRefresh:"wishlist:request:refresh",selectPersonalList:"wishlist:request:select-personal-list",selectRetailerList:"wishlist:request:select-retailer-list",deleteRetailerListRequest:"wishlist:retailer:delete-list",cancelDeleteRetailerListRequest:"wishlist:retailer:delete-list-cancel",deleteRetailerListRequestComplete:"wishlist:retailer:delete-list-complete",add:"wishlist:modify:add",removeRequest:"wishlist:modify:removerequest",removeSuccess:"wishlist:modify:removesuccess",removeError:"wishlist:modify:removeerror",removeAnimationStart:"wishlist:modify:removeanimationstart",removeAnimationEnd:"wishlist:modify:removeanimationend",informations:"wishlist:data:informations",data:"wishlist:data:load",nodata:"wishlist:data:error",loginrequired:"wishlist:retailer-code:logged-out",equalizeRequest:"wishlist:equalize:request",equalizeResponse:"wishlist:equalize:response",socialdisplay:"wishlist:share-popin:display",socialnetworkclick:"wishlist:social:share",shareemailactivate:"wishlist:share-email:activate",sharemaildeactivate:"wishlist:share-email:deactivate",shareWishlistRequest:"wishlist:share:request",exploreWishlistRequest:"wishlist:share:request",registerRequest:"wishlist:register:request",showSpecs:"wishlist:specs:show",hideSpecs:"wishlist:specs:hide",retailerFullDetails:"wishlist:retailer:full-details",consumeCodeRequest:"wishlist:retailer:consumeCodeRequest",downloadAsset:"wishlist:asset:download",analLoaded:"analytics:open-wishlist"}},{}],12:[function(require,module,exports){"use strict";var i18n=requirejs("i18n");"false"==RLX.device.is_mobile&&"false"==RLX.device.is_tablet;module.exports.usermenu={"your-wishlist":i18n("login/your-wishlist"),"my-wishlist":i18n("wishlist/my-wishlist"),username:i18n("login/link-panel-access"),"open-menu":i18n("login/open-menu"),login:i18n("login/login"),register:i18n("login/register"),logout:i18n("login/logout"),account:i18n("account/your-account")},module.exports.loginpanel={form:{legend:i18n("login/login-title"),inputs:{email:{id:"login-email",classes:"",label:i18n("login/email"),placeholder:i18n("login/email"),type:"email",value:"",itemType:"input"},password:{id:"login-password",classes:"",label:i18n("login/password"),placeholder:i18n("login/password"),type:"password",value:"",itemType:"input"},checkbox:{id:"login-keep",classes:" rlx-user-panel__form-checkbox",label:i18n("login/keep-me-logged-in"),itemType:"input",value:"",type:"checkbox"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),forgot:{text:i18n("login/forgot-password"),href:"#forgot-pwd"},button:{type:"submit",id:"submit",text:i18n("login/login")}},network:{header:i18n("login/login-social"),facebook:{name:"facebook",text:i18n("login/facebook")},googleplus:{name:"googleplus",text:i18n("login/google")},linkedin:{name:"linkedin",text:i18n("login/linkedin")}},register:{header:i18n("login/not-yet-member-title"),text:i18n("login/not-yet-member-text"),button:i18n("login/register"),thanks:i18n("login/welcome-title")}},module.exports.registerpanel={form:{legend:i18n("login/sign-up-email"),introText:i18n("login/intro-text"),inputs:{gender:{id:"register-gender",classes:"",label:i18n("login/title"),placeholder:i18n("login/title"),options:[{value:"",text:i18n("login/title")},{value:"Mr",text:i18n("login/mr")},{value:"Mrs",text:i18n("login/mrs")},{value:"Ms",text:i18n("login/ms")}]},firstName:{id:"register-firstname",classes:"",placeholder:i18n("login/first-name"),label:i18n("login/first-name"),type:"text",value:"",itemType:"input"},lastName:{id:"register-lastname",classes:"",placeholder:i18n("login/last-name"),label:i18n("login/last-name"),type:"text",value:"",itemType:"input"},email:{id:"register-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"},password:{id:"register-password",classes:"",placeholder:i18n("login/password"),label:i18n("login/password"),type:"password",value:"",itemType:"input"},password2:{id:"register-password2",classes:"",placeholder:i18n("login/retype-password"),label:i18n("login/retype-password"),type:"password",value:"",itemType:"input"},checkbox:{id:"register-terms",classes:" rlx-user-panel__form-checkbox",label:i18n("login/terms-conditions"),itemType:"input",value:"",type:"checkbox"},accessToken:{id:"register-token",classes:"",placeholder:"",label:"",type:"hidden",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"submit",text:i18n("login/sign-up")}},network:{header:i18n("login/sign-up-social"),facebook:{name:"facebook",text:i18n("login/facebook")},googleplus:{name:"googleplus",text:i18n("login/google")},linkedin:{name:"linkedin",text:i18n("login/linkedin")}},login:{header:i18n("login/already-member-title"),text:i18n("login/already-member-text"),button:i18n("login/login")}},module.exports.confirmpanel={form:{legend:i18n("login/please-confirm"),text:i18n("login/thank-you-message"),resend:{type:"submit",id:"resend",text:i18n("login/resend-email")},button:{type:"button",id:"close",text:i18n("login/ok")}}},module.exports.activatepanel={form:{legend:i18n("login/activate-account-subtitle"),text:i18n("login/activate-account-text"),resend:{type:"submit",id:"resend",text:i18n("login/resend-email")},button:{type:"button",id:"close",text:i18n("account/cancel")}}},module.exports.forgotpanel={form:{legend:i18n("login/forgot-password-subtitle"),text:i18n("login/forgot-password-subtitle-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"forgot-submit",text:i18n("login/send-verification-email")},cancel:{type:"button",id:"forgot-cancel",text:i18n("account/cancel")},close:{type:"button",id:"forgot-close",text:i18n("login/close")}}},module.exports.resendVerification={header:i18n("login/token-activation-expired-title"),form:{legend:i18n("login/token-activation-expired-subtitle"),text:i18n("login/token-activation-expired-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),submit:{type:"submit",id:"token-resend",text:i18n("login/resend-email")},cancel:{type:"button",id:"token-close",text:i18n("account/cancel")},close:{type:"button",id:"token-close",text:i18n("login/close")}}},module.exports.resendForgot={header:i18n("login/token-password-expired-title"),form:{legend:i18n("login/token-password-expired-subtitle"),text:i18n("login/token-password-expired-text"),inputs:{email:{id:"forgot-email",classes:"",placeholder:i18n("login/email"),label:i18n("login/email"),type:"email",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",id:"forgot-submit",text:i18n("login/send-verification-email")},cancel:{type:"button",id:"forgot-cancel",text:i18n("account/cancel")},close:{type:"button",id:"forgot-close",text:i18n("login/close")}}},module.exports.passwordpanel={form:{legend:i18n("login/reset-password-subtitle"),inputs:{password:{id:"change-password",classes:"",placeholder:i18n("login/reset-password-new-password"),label:i18n("login/reset-password-new-password"),type:"password",value:"",itemType:"input"},password2:{id:"change-password-verification",classes:"",placeholder:i18n("login/reset-password-retype-new-password"),label:i18n("login/reset-password-retype-new-password"),type:"password",value:"",itemType:"input"},token:{id:"change-password-token",classes:"",placeholder:"",label:"",type:"hidden",value:"",itemType:"input"}},errorNetwork:i18n("login/error-general"),error:i18n("share/empty-invalid-form"),button:{type:"submit",name:"submit",text:i18n("login/send-verification-email")}}},module.exports.passwordtips={header:i18n("login/password-tips"),rules:[{regExp:"^.{6,15}$",text:i18n("login/pwd-tips-one")},{regExp:"[\\d]{1,}",text:i18n("login/pwd-tips-two")},{regExp:"[a-z]{1,}",text:i18n("login/pwd-tips-three")}]},module.exports.accountuser={header:i18n("account/your-rolex-account"),privacy:i18n("account/privacy"),edit:i18n("account/edit-account-details"),title:i18n("account/your-title"),firstName:i18n("account/your-first-name"),lastName:i18n("account/your-last-name"),email:i18n("account/email"),textintro:i18n("account/your-account-text")},module.exports.accountwishlist={header:i18n("wishlist/your-wishlist"),"n-watches-wishlist":i18n("account/n-watches-wishlist"),"one-watch":i18n("account/one-watch-wishlist"),create:i18n("account/create-selection"),text:i18n("account/wishlist-intro"),button:i18n("account/explore-collection"),view:i18n("account/view-wishlist")},module.exports.accountretailer={header:i18n("account/your-preferred-retailer"),create:i18n("account/select-your-retailer"),text:i18n("account/your-preferred-retailer-text-long"),button:i18n("account/select-your-retailer"),view:i18n("account/retailer-details")},module.exports.userpanel={close:i18n("login/close"),subLogin:{header:i18n("login/login-title")},subForgot:{header:i18n("login/forgot-password-title")},subActivate:{header:i18n("login/activate-account-title")},subConfirm:{header:i18n("login/thank-you-title")},subRegister:{header:i18n("login/sign-up-title")
},subPassword:{header:i18n("login/reset-password-title")},subAccount:{header:{welcome:i18n("account/welcome"),w:i18n("login/welcome"),username:i18n("account/username"),logout:i18n("login/logout")}}},module.exports.banner={h1:i18n("wishlist/banner/h1"),h2:i18n("wishlist/banner/h2"),paragraph:i18n("wishlist/banner/paragraph"),button:{text:i18n("wishlist/banner/button"),href:"#login"},img:{src:"/media/images/wishlist/main-banner.jpg"}},module.exports.wishlistbanner={placeholders:{empty:i18n("wishlist/placeholder-empty"),item:i18n("wishlist/select-from-collections")},save:i18n("wishlist/save")},module.exports.wishlistlist={deletelabel:i18n("wishlist/delete")},module.exports.wishlistitem={specs:{show:i18n("wishlist/show-features"),hide:i18n("wishlist/hide-features"),ref:i18n("model/ref")},links:{remove:i18n("model/remove-this-watch"),brochure:i18n("model/download-brochure"),share:i18n("website/share-this-watch")}},module.exports.retailerlist={header:i18n("wishlist/shared-wishlist-title"),from:i18n("wishlist/from"),copy:i18n("wishlist/shared-wishlist-banner-text"),view:i18n("wishlist/view")},module.exports.deleteRetailerList={title:i18n("wishlist/delete-confirmation-message"),cancel:i18n("wishlist/cancel"),ok:i18n("wishlist/yes"),thankTitle:i18n("wishlist/thank-you"),thankCopy:i18n("wishlist-deleted")},module.exports.breadcrumb={mywishlist:i18n("wishlist/my-wishlist"),shared:i18n("wishlist/shared-wishlist"),home:i18n("website/home")},module.exports.sharepopin={email:i18n("share/email"),shareTitle:i18n("model/share-this-watch"),sendmecopy:"send me copy",validation:{empty:i18n("share/empty-invalid-form"),email:i18n("email-invalid-form")}},module.exports.wishlistkillswitched={button:i18n("website/share"),copy:i18n("wishlist/killswitch-banner-description")}},{}],13:[function(require,module,exports){window.define("modules/rlx-wishlist-side-v5.6",["utils","i18n","modules/rlx-ui","lib/SEventRouter","lib/environment","lib/SAppEventRouter","lib/SAppRouter","lib/UID","lib/Iterator","lib/Router","lib/Model","lib/ZenView","lib/Collection","lib/StyleSheet","lib/ClientRect","lib/Cookie","modules/rlx-transition","modules/rlx-storage","cq-modules/rlx-wishlists-wrapper","modules/rlx-popins","config~dealerlocator","modules/rlx-web-analytics","modules/rlx-num-trad"],function(_,i18n,ui){"use strict";for(var hrefBack,wishlistLink,ulList,lastItem,locales=require("./locales"),Model=(jQuery.Deferred,require("./environment"),require("./loadingPromise").loadingPromise,requirejs("lib/Model")),SAppEventRouter=(new ui.SideBar,requirejs("lib/SAppEventRouter").SAppEventRouter),UIRouter=(SAppEventRouter.events,ui.router),route=require("./routes/wishlist/sidebar"),headerItemMenu=(jQuery(".rlx-site-nav"),require("./common/HeaderMenuZView").HeaderWishlistLink),foo=0;foo<route.length;)UIRouter.when(route[foo].path,route[foo].handleRoute),++foo;hrefBack=document.querySelector(".rlx-site-nav__wishlist")?document.querySelector(".rlx-site-nav__wishlist").getAttribute("href"):"/wishlist.html",wishlistLink=new Model({text:locales.header.wishlist.toUpperCase(),title:"",target:"",href:hrefBack,class:"rlx-site-nav__link rlx-site-nav__wishlist wa-tracking-wishlist",iconClass:"rlx-icon rlx-icon--wishlist",empty:!0}),ulList=document.querySelector(".rlx-site-nav__list"),lastItem=ulList.children[parseInt(ulList.children.length-1,10)],ulList.replaceChild(new headerItemMenu(wishlistLink).borrow(),lastItem)})},{"./common/HeaderMenuZView":1,"./environment":3,"./loadingPromise":5,"./locales":6,"./routes/wishlist/sidebar":7}],14:[function(require,module,exports){"use strict";var WishlistSidebarContainer,WishlistContent,WishlistSideBarHeaderZView,WishlistSideBarLinkZView,WishlistSideBarCloseButton,WishlistSideBarDetailsButton,WishlistSideBarTitlesZView,WishlistSideBarItemZView,WishlistEmptyZView,WishlistSideBarImageZView,WishlistSideBarImageMobileZView,WishlistSideBarTextZView,singleton=requirejs("utils").singleton,ui=requirejs("modules/rlx-ui"),klass=requirejs("utils").classMaker,ZView=requirejs("lib/ZenView"),Model=requirejs("lib/Model"),_=requirejs("utils"),env=require("../environment"),wWrap=requirejs("cq-modules/rlx-wishlists-wrapper"),SideBar=ui.SideBar,sSto=(ui.NavPane,requirejs("modules/rlx-storage").sessionStorage),locales=(requirejs("utils").requestAnimationFrame,requirejs("utils").cancelAnimationFrame,jQuery.Deferred,require("../locales")),cssCompat=require("../stylesheet").getCompat,stylesheet=require("../stylesheet").stylesheet,UIRouter=ui.router;module.exports.SWishlistSideZView=singleton(SideBar,function(Super,statics){return{constructor:function(){Super.call(this),void function(self){cssCompat(function(compatTable){stylesheet.rule("#"+self.uid()+"{overflow:hidden;}","#"+self.uid()+" > .rlx-ui-pane-wrap{overflow-x:hidden;overflow-y:scroll;left:0;position:relative;}")}),self.query("wrap").appendChild((new WishlistSidebarContainer).borrow()),UIRouter.when("/ui/nav/close",function(next,vars){self.hide(),next()})}(this)},reload:function(self){self=this,self.query("wrap").innerHTML="",self.query("wrap").appendChild((new WishlistSidebarContainer).borrow())}}}),WishlistSidebarContainer=module.exports.WishlistSidebarContainer=klass(ZView,function(Super,statics){return{constructor:function(){Super.call(this),void function(self,sideBarModel,queries,request,closeModel){sideBarModel=[],queries=jQuery.extend(_.unserialize(location.search.slice(1)),_.unserialize(location.hash.slice(1))),request={lang:RLX.cqlang,mobile:RLX.GLOBALS.features.isMobile,code:queries.hasOwnProperty("code")?queries.code:null},closeModel=new Model({text:locales.wishlist.sidebar.close,href:"#",css:""}),wWrap.getWishlistsPageInfo(request).then(function(data,items,wishItem,wa,dataLayer){var b;if(dataLayer=[],data.wishlists[0].items){items=data.wishlists[0].items;for(b in items)wishItem=items[b],sideBarModel.push({imagesrc:wishItem.productSidebarImg,imagesrc_r:[wishItem.productSidebarImgRetina," 2x"].join(""),href:wishItem.modelPageUrl,modelName:wishItem.modelName,rmc:wishItem.rmc.toLowerCase(),description:wishItem.description}),dataLayer.push({category:wishItem.catalogLine.toLowerCase(),id:wishItem.productId});self.query("container").appendChild(new WishlistContent(new Model({items:sideBarModel,urlWishlistPage:data.wishlistPageUrl})).borrow())}else self.query("container").appendChild((new WishlistEmptyZView).borrow());dataLayer&&sSto.setItem("data-layer-side-event",dataLayer)}),self.query("closeLink").appendChild(new WishlistSideBarCloseButton(closeModel).borrow()),void function(container,img,target){container.className+=" rlx-ui-pane__logo",container.appendChild(img),target.parentNode.appendChild(container)}(document.createElement("div"),document.querySelector(".rlx-site-nav__logo").cloneNode(!0),self.query("container"))}(this)},_template:"div@closeLink + div.rlx-wishlist__sidebar-container@container"}}),WishlistContent=module.exports.WishlistSideBarContentZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,wishlist,c){self.query("head").appendChild(new WishlistSideBarHeaderZView(self._model).borrow()),wishlist=self._model.get("items");for(c in wishlist)self.query("list").appendChild(new WishlistSideBarItemZView(wishlist[c]).borrow())}(this)},_template:".rlx-wishlist__sidebar@sidebar >                     .rlx-wishlist__sidebar-head@head +                     ul.rlx-wishlist__sidebar-list.rlx-grid.rlx-grid-watches@list"}}),WishlistSideBarHeaderZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,model){self.query("titles").appendChild(new WishlistSideBarTitlesZView(new Model({title:locales.wishlist.sidebar.title,subtitle:locales.wishlist.sidebar.subtitle})).borrow()),self.query("detailsLink").appendChild(new WishlistSideBarDetailsButton(new Model({text:locales.wishlist.sidebar.viewmoredetails,href:self._model.get("urlWishlistPage"),css:"rlx-wishlist__sidebar-link--details"})).borrow())}(this)},_template:"div@titles +                 .rlx-u-textCenter@detailsLink"}}),WishlistSideBarLinkZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,model){}(this)},_template:"a[href=$href][class=$css]@link{$text}"}}),WishlistSideBarCloseButton=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){function onclick(e){e.preventDefault(),UIRouter.dispatch("/ui/nav/close")}self.$query("link").on("click",onclick)}(this)},_template:"button.rlx-nav__close@link{$text}"}}),WishlistSideBarDetailsButton=klass(WishlistSideBarLinkZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self._model.set("css","rlx-links__button")}(this)}}}),WishlistSideBarTitlesZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments)},_template:"p.rlx-nav__section-title.rlx-u-textCenter{$title} +                 p.rlx-nav__text.rlx-u-textCenter{$subtitle}"}}),WishlistSideBarItemZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self.query("img").appendChild(env.mobile?new WishlistSideBarImageMobileZView(self._model).borrow():new WishlistSideBarImageZView(self._model).borrow()),self.query("text").appendChild(new WishlistSideBarTextZView(self._model).borrow())}(this)},_template:"li.rlx-wishlist__sidebar-item.rlx-grid__cell.rlx-grid-watches__cell[data-rmc=$rmc] >                    a[href=$href] >                        figure@img +                        .rlx-wishlist__item-titles.rlx-grid-watches__heading@text"}}),WishlistEmptyZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self){self.query("emptyLabel").innerHTML=locales.wishlist.sidebar.noItems}(this)},_template:"div.rlx-wishlist-container > p@emptyLabel"}}),WishlistSideBarImageZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,img){img=new Image,img.onload=function(){self.query("img").setAttribute},img.src=self._model.get("imagesrc")}(this)},_template:"img[src=$imagesrc][srcset=$imagesrc_r][alt=]@img"}}),WishlistSideBarImageMobileZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments),void function(self,img){img=new Image,img.onload=function(){self.query("img").setAttribute("src",self._model.get("imagesrc"))},img.src=self._model.get("imagesrc")}(this)},_template:"img[alt=]@img"}}),WishlistSideBarTextZView=klass(ZView,function(Super,statics){return{constructor:function(){Super.apply(this,arguments)},_template:".rlx-grid-watches__title{$modelName} +                 .rlx-grid-watches__subtitle{$description}"}})},{"../environment":3,"../locales":6,"../stylesheet":8}],15:[function(require,module,exports){var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,var:0},html4.URIEFFECTS={},html4.LOADERTYPES={},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=html4),exports.URI=html4):"undefined"!=typeof window&&(window.html4=html4)},{}],16:[function(require,module,exports){var URI=function(){function parse(uriStr){var m=(""+uriStr).match(URI_RE_);return m?new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7])):null}function create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));return query&&("string"==typeof query?uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne)):uri.setAllParameters(query)),uri}function encodeIfExists(unescapedPart){return"string"==typeof unescapedPart?encodeURIComponent(unescapedPart):null}function encodeIfExists2(unescapedPart,extra){return"string"==typeof unescapedPart?encodeURI(unescapedPart).replace(extra,encodeOne):null}function encodeOne(ch){var n=ch.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(n>>4&15)+"0123456789ABCDEF".charAt(15&n)}function normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function collapse_dots(path){var p,r,q;if(null===path)return null;for(p=normPath(path),r=PARENT_DIRECTORY_HANDLER_RE;(q=p.replace(r,"$1"))!=p;p=q);return p}function resolve(baseUri,relativeUri){var rawPath,simplifiedPath,absRawPath,slash,absoluteUri=baseUri.clone(),overridden=relativeUri.hasScheme();return overridden?absoluteUri.setRawScheme(relativeUri.getRawScheme()):overridden=relativeUri.hasCredentials(),overridden?absoluteUri.setRawCredentials(relativeUri.getRawCredentials()):overridden=relativeUri.hasDomain(),overridden?absoluteUri.setRawDomain(relativeUri.getRawDomain()):overridden=relativeUri.hasPort(),rawPath=relativeUri.getRawPath(),simplifiedPath=collapse_dots(rawPath),overridden?(absoluteUri.setPort(relativeUri.getPort()),simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,"")):(overridden=!!rawPath,overridden?47!==simplifiedPath.charCodeAt(0)&&(absRawPath=collapse_dots(absoluteUri.getRawPath()||"").replace(EXTRA_PARENT_PATHS_RE,""),slash=absRawPath.lastIndexOf("/")+1,simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):"")+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,"")):(simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,""),simplifiedPath!==rawPath&&absoluteUri.setRawPath(simplifiedPath))),overridden?absoluteUri.setRawPath(simplifiedPath):overridden=relativeUri.hasQuery(),overridden?absoluteUri.setRawQuery(relativeUri.getRawQuery()):overridden=relativeUri.hasFragment(),overridden&&absoluteUri.setRawFragment(relativeUri.getRawFragment()),absoluteUri}function URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme,this.credentials_=rawCredentials,this.domain_=rawDomain,this.port_=port,this.path_=rawPath,this.query_=rawQuery,this.fragment_=rawFragment,this.paramCache_=null}function nullIfAbsent(matchPart){return"string"==typeof matchPart&&matchPart.length>0?matchPart:null}var URI_RE_,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_,URI_DISALLOWED_IN_PATH_,PARENT_DIRECTORY_HANDLER=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),PARENT_DIRECTORY_HANDLER_RE=new RegExp(PARENT_DIRECTORY_HANDLER),EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;return URI.prototype.toString=function(){var out=[];return null!==this.scheme_&&out.push(this.scheme_,":"),null!==this.domain_&&(out.push("//"),null!==this.credentials_&&out.push(this.credentials_,"@"),out.push(this.domain_),null!==this.port_&&out.push(":",this.port_.toString())),null!==this.path_&&out.push(this.path_),null!==this.query_&&out.push("?",this.query_),null!==this.fragment_&&out.push("#",this.fragment_),out.join("")},URI.prototype.clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},URI.prototype.getRawScheme=function(){return this.scheme_},URI.prototype.setScheme=function(newScheme){return this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawScheme=function(newScheme){return this.scheme_=newScheme?newScheme:null,this},URI.prototype.hasScheme=function(){return null!==this.scheme_},URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},URI.prototype.getRawCredentials=function(){return this.credentials_},URI.prototype.setCredentials=function(newCredentials){return this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawCredentials=function(newCredentials){return this.credentials_=newCredentials?newCredentials:null,this},URI.prototype.hasCredentials=function(){return null!==this.credentials_},URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},URI.prototype.getRawDomain=function(){return this.domain_},URI.prototype.setDomain=function(newDomain){return this.setRawDomain(newDomain&&encodeURIComponent(newDomain))},URI.prototype.setRawDomain=function(newDomain){return this.domain_=newDomain?newDomain:null,this.setRawPath(this.path_)},URI.prototype.hasDomain=function(){return null!==this.domain_},URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},URI.prototype.setPort=function(newPort){if(newPort){if(newPort=Number(newPort),newPort!==(65535&newPort))throw new Error("Bad port number "+newPort);this.port_=""+newPort}else this.port_=null;return this},URI.prototype.hasPort=function(){return null!==this.port_},URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},URI.prototype.getRawPath=function(){return this.path_},URI.prototype.setPath=function(newPath){return this.setRawPath(encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_))},URI.prototype.setRawPath=function(newPath){return newPath?(newPath=String(newPath),this.path_=!this.domain_||/^\//.test(newPath)?newPath:"/"+newPath):this.path_=null,this},URI.prototype.hasPath=function(){return null!==this.path_},URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},URI.prototype.getRawQuery=function(){return this.query_},URI.prototype.setQuery=function(newQuery){return this.paramCache_=null,this.query_=encodeIfExists(newQuery),this},URI.prototype.setRawQuery=function(newQuery){return this.paramCache_=null,this.query_=newQuery?newQuery:null,this},URI.prototype.hasQuery=function(){return null!==this.query_},URI.prototype.setAllParameters=function(params){var newParams,i,k,v,queryBuf,separator,j;if("object"==typeof params&&!(params instanceof Array)&&(params instanceof Object||"[object Array]"!==Object.prototype.toString.call(params))){newParams=[],i=-1;for(k in params)v=params[k],"string"==typeof v&&(newParams[++i]=k,newParams[++i]=v);params=newParams}for(this.paramCache_=null,queryBuf=[],separator="",j=0;j<params.length;)k=params[j++],v=params[j++],queryBuf.push(separator,encodeURIComponent(k.toString())),separator="&",v&&queryBuf.push("=",encodeURIComponent(v.toString()));return this.query_=queryBuf.join(""),this},URI.prototype.checkParameterCache_=function(){var q,cgiParams,out,k,i,m;if(!this.paramCache_)if(q=this.query_){for(cgiParams=q.split(/[&\?]/),out=[],k=-1,i=0;i<cgiParams.length;++i)m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/),out[++k]=decodeURIComponent(m[1]).replace(/\+/g," "),out[++k]=decodeURIComponent(m[2]||"").replace(/\+/g," ");this.paramCache_=out}else this.paramCache_=[]},URI.prototype.setParameterValues=function(key,values){var newValueIndex,pc,params,i,k;for("string"==typeof values&&(values=[values]),this.checkParameterCache_(),newValueIndex=0,pc=this.paramCache_,params=[],i=0,k=0;i<pc.length;i+=2)key===pc[i]?newValueIndex<values.length&&params.push(key,values[newValueIndex++]):params.push(pc[i],pc[i+1]);for(;newValueIndex<values.length;)params.push(key,values[newValueIndex++]);return this.setAllParameters(params),this},URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[])},URI.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},URI.prototype.getParameterValues=function(paramNameUnescaped){var values,i;for(this.checkParameterCache_(),values=[],i=0;i<this.paramCache_.length;i+=2)paramNameUnescaped===this.paramCache_[i]&&values.push(this.paramCache_[i+1]);return values},URI.prototype.getParameterMap=function(paramNameUnescaped){var paramMap,i,key,value;for(this.checkParameterCache_(),paramMap={},i=0;i<this.paramCache_.length;i+=2)key=this.paramCache_[i++],value=this.paramCache_[i++],key in paramMap?paramMap[key].push(value):paramMap[key]=[value];return paramMap},URI.prototype.getParameterValue=function(paramNameUnescaped){this.checkParameterCache_();for(var i=0;i<this.paramCache_.length;i+=2)if(paramNameUnescaped===this.paramCache_[i])return this.paramCache_[i+1];return null},URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},URI.prototype.getRawFragment=function(){return this.fragment_},URI.prototype.setFragment=function(newFragment){return this.fragment_=newFragment?encodeURIComponent(newFragment):null,this},URI.prototype.setRawFragment=function(newFragment){return this.fragment_=newFragment?newFragment:null,this},URI.prototype.hasFragment=function(){return null!==this.fragment_},URI_RE_=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g,URI_DISALLOWED_IN_PATH_=/[\#\?]/g,URI.parse=parse,URI.create=create,URI.resolve=resolve,URI.collapse_dots=collapse_dots,URI.utils={mimeTypeOf:function(uri){var uriObj=parse(uri);return/\.html$/.test(uriObj.getPath())?"text/html":"application/javascript"},resolve:function(base,uri){return base?resolve(parse(base),parse(uri)).toString():""+uri}},URI}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=URI),exports.URI=URI):"undefined"!=typeof window&&(window.URI=URI)},{}],17:[function(require,module,exports){var html,html_sanitize,Sanitizer,html4=require("./lib/html4.js"),URI=require("./lib/uri.js");if("i"!=="I".toLowerCase())throw"I/i problem";html=function(html4){function lookupEntity(name){var m,text;return ENTITIES.hasOwnProperty(name)?ENTITIES[name]:(m=name.match(decimalEscapeRe),m?String.fromCharCode(parseInt(m[1],10)):(m=name.match(hexEscapeRe))?String.fromCharCode(parseInt(m[1],16)):entityLookupElement&&safeEntityNameRe.test(name)?(entityLookupElement.innerHTML="&"+name+";",text=entityLookupElement.textContent,ENTITIES[name]=text,text):"&"+name+";")}function decodeOneEntity(_,name){return lookupEntity(name)}function stripNULs(s){return s.replace(nulRe,"")}function unescapeEntities(s){return s?s.replace(ENTITY_RE_1,decodeOneEntity):s}function escapeAttrib(s){return s?(""+s).replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;").replace(quotRe,"&#34;"):s}function normalizeRCData(rcdata){return rcdata?rcdata.replace(looseAmpRe,"&amp;$1").replace(ltRe,"&lt;").replace(gtRe,"&gt;"):rcdata}function makeSaxParser(handler){var hcopy={cdata:handler.cdata||handler.cdata,comment:handler.comment||handler.comment,endDoc:handler.endDoc||handler.endDoc,endTag:handler.endTag||handler.endTag,pcdata:handler.pcdata||handler.pcdata,rcdata:handler.rcdata||handler.rcdata,startDoc:handler.startDoc||handler.startDoc,startTag:handler.startTag||handler.startTag};return function(htmlText,param){return parse(htmlText,hcopy,param)}}function parse(htmlText,handler,param){var parts=htmlSplit(htmlText),state={noMoreGT:!1,noMoreEndComments:!1};parseCPS(handler,parts,0,state,param)}function continuationMaker(h,parts,initial,state,param){return function(){parseCPS(h,parts,initial,state,param)}}function parseCPS(h,parts,initial,state,param){var m,p,tagName,pos,end,current,next,eflags,tag,comment;try{for(h.startDoc&&0==initial&&h.startDoc(param),pos=initial,end=parts.length;pos<end;)switch(current=parts[pos++],next=parts[pos],current){case"&":ENTITY_RE_2.test(next)?(h.pcdata&&h.pcdata("&"+next,param,continuationMarker,continuationMaker(h,parts,pos,state,param)),pos++):h.pcdata&&h.pcdata("&amp;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"</":(m=/^([-\w:]+)[^\'\"]*/.exec(next))?m[0].length===next.length&&">"===parts[pos+1]?(pos+=2,tagName=m[1].toLowerCase(),h.endTag&&h.endTag(tagName,param,continuationMarker,continuationMaker(h,parts,pos,state,param))):pos=parseEndTag(parts,pos,h,param,continuationMarker,state):h.pcdata&&h.pcdata("&lt;/",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<":(m=/^([-\w:]+)\s*\/?/.exec(next))?m[0].length===next.length&&">"===parts[pos+1]?(pos+=2,tagName=m[1].toLowerCase(),h.startTag&&h.startTag(tagName,[],param,continuationMarker,continuationMaker(h,parts,pos,state,param)),eflags=html4.ELEMENTS[tagName],eflags&EFLAGS_TEXT&&(tag={name:tagName,next:pos,eflags:eflags},pos=parseText(parts,tag,h,param,continuationMarker,state))):pos=parseStartTag(parts,pos,h,param,continuationMarker,state):h.pcdata&&h.pcdata("&lt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"\x3c!--":if(!state.noMoreEndComments){for(p=pos+1;p<end&&(">"!==parts[p]||!/--$/.test(parts[p-1]));p++);p<end?(h.comment&&(comment=parts.slice(pos,p).join(""),h.comment(comment.substr(0,comment.length-2),param,continuationMarker,continuationMaker(h,parts,p+1,state,param))),pos=p+1):state.noMoreEndComments=!0}state.noMoreEndComments&&h.pcdata&&h.pcdata("&lt;!--",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<!":if(/^\w/.test(next)){if(!state.noMoreGT){for(p=pos+1;p<end&&">"!==parts[p];p++);p<end?pos=p+1:state.noMoreGT=!0}state.noMoreGT&&h.pcdata&&h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}else h.pcdata&&h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<?":if(!state.noMoreGT){for(p=pos+1;p<end&&">"!==parts[p];p++);p<end?pos=p+1:state.noMoreGT=!0}state.noMoreGT&&h.pcdata&&h.pcdata("&lt;?",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case">":h.pcdata&&h.pcdata("&gt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"":break;default:h.pcdata&&h.pcdata(current,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}h.endDoc&&h.endDoc(param)}catch(e){if(e!==continuationMarker)throw e}}function htmlSplit(str){var parts,lastPos,m,re=/(<\/|<\!--|<[!?]|[&<>])/g;if(str+="",splitWillCapture)return str.split(re);for(parts=[],lastPos=0;null!==(m=re.exec(str));)parts.push(str.substring(lastPos,m.index)),parts.push(m[0]),lastPos=m.index+m[0].length;return parts.push(str.substring(lastPos)),parts}function parseEndTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);return tag?(h.endTag&&h.endTag(tag.name,param,continuationMarker,continuationMaker(h,parts,pos,state,param)),tag.next):parts.length}function parseStartTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);return tag?(h.startTag&&h.startTag(tag.name,tag.attrs,param,continuationMarker,continuationMaker(h,parts,tag.next,state,param)),tag.eflags&EFLAGS_TEXT?parseText(parts,tag,h,param,continuationMarker,state):tag.next):parts.length}function parseText(parts,tag,h,param,continuationMarker,state){var re,first,p,buf,end=parts.length;for(endTagRe.hasOwnProperty(tag.name)||(endTagRe[tag.name]=new RegExp("^"+tag.name+"(?:[\\s\\/]|$)","i")),re=endTagRe[tag.name],first=tag.next,p=tag.next+1;p<end&&("</"!==parts[p-1]||!re.test(parts[p]));p++);if(p<end&&(p-=1),buf=parts.slice(first,p).join(""),tag.eflags&html4.eflags.CDATA)h.cdata&&h.cdata(buf,param,continuationMarker,continuationMaker(h,parts,p,state,param));else{
if(!(tag.eflags&html4.eflags.RCDATA))throw new Error("bug");h.rcdata&&h.rcdata(normalizeRCData(buf),param,continuationMarker,continuationMaker(h,parts,p,state,param))}return p}function parseTagAndAttrs(parts,pos){var buf,p,end,attrs,quote,sawQuote,abuf,aName,aValue,m=/^([-\w:]+)/.exec(parts[pos]),tag={};for(tag.name=m[1].toLowerCase(),tag.eflags=html4.ELEMENTS[tag.name],buf=parts[pos].substr(m[0].length),p=pos+1,end=parts.length;p<end&&">"!==parts[p];p++)buf+=parts[p];if(!(end<=p)){for(attrs=[];""!==buf;)if(m=ATTR_RE.exec(buf)){if(m[4]&&!m[5]||m[6]&&!m[7]){for(quote=m[4]||m[6],sawQuote=!1,abuf=[buf,parts[p++]];p<end;p++){if(sawQuote){if(">"===parts[p])break}else 0<=parts[p].indexOf(quote)&&(sawQuote=!0);abuf.push(parts[p])}if(end<=p)break;buf=abuf.join("");continue}aName=m[1].toLowerCase(),aValue=m[2]?decodeValue(m[3]):"",attrs.push(aName,aValue),buf=buf.substr(m[0].length)}else buf=buf.replace(/^[\s\S][^a-z\s]*/,"");return tag.attrs=attrs,tag.next=p+1,tag}}function decodeValue(v){var q=v.charCodeAt(0);return 34!==q&&39!==q||(v=v.substr(1,v.length-2)),unescapeEntities(stripNULs(v))}function makeHtmlSanitizer(tagPolicy){var stack,ignoring,emit=function(text,out){ignoring||out.push(text)};return makeSaxParser({startDoc:function(_){stack=[],ignoring=!1},startTag:function(tagNameOrig,attribs,out){var eflagsOrig,decision,eflagsRep,tagNameRep,onStack,i,n,attribName,value;if(!ignoring&&html4.ELEMENTS.hasOwnProperty(tagNameOrig)&&(eflagsOrig=html4.ELEMENTS[tagNameOrig],!(eflagsOrig&html4.eflags.FOLDABLE))){if(decision=tagPolicy(tagNameOrig,attribs),!decision)return void(ignoring=!(eflagsOrig&html4.eflags.EMPTY));if("object"!=typeof decision)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in decision))throw new Error("tagPolicy gave no attribs");attribs=decision.attribs,"tagName"in decision?(tagNameRep=decision.tagName,eflagsRep=html4.ELEMENTS[tagNameRep]):(tagNameRep=tagNameOrig,eflagsRep=eflagsOrig),eflagsOrig&html4.eflags.OPTIONAL_ENDTAG&&(onStack=stack[stack.length-1],!onStack||onStack.orig!==tagNameOrig||onStack.rep===tagNameRep&&tagNameOrig===tagNameRep||out.push("</",onStack.rep,">")),eflagsOrig&html4.eflags.EMPTY||stack.push({orig:tagNameOrig,rep:tagNameRep}),out.push("<",tagNameRep);for(i=0,n=attribs.length;i<n;i+=2)attribName=attribs[i],value=attribs[i+1],null!==value&&void 0!==value&&out.push(" ",attribName,'="',escapeAttrib(value),'"');out.push(">"),eflagsOrig&html4.eflags.EMPTY&&!(eflagsRep&html4.eflags.EMPTY)&&out.push("</",tagNameRep,">")}},endTag:function(tagName,out){var eflags,index,stackElOrigTag,i,stackElRepTag;if(ignoring)return void(ignoring=!1);if(html4.ELEMENTS.hasOwnProperty(tagName)&&(eflags=html4.ELEMENTS[tagName],!(eflags&(html4.eflags.EMPTY|html4.eflags.FOLDABLE)))){if(eflags&html4.eflags.OPTIONAL_ENDTAG){for(index=stack.length;--index>=0&&(stackElOrigTag=stack[index].orig,stackElOrigTag!==tagName);)if(!(html4.ELEMENTS[stackElOrigTag]&html4.eflags.OPTIONAL_ENDTAG))return}else for(index=stack.length;--index>=0&&stack[index].orig!==tagName;);if(index<0)return;for(i=stack.length;--i>index;)stackElRepTag=stack[i].rep,html4.ELEMENTS[stackElRepTag]&html4.eflags.OPTIONAL_ENDTAG||out.push("</",stackElRepTag,">");index<stack.length&&(tagName=stack[index].rep),stack.length=index,out.push("</",tagName,">")}},pcdata:emit,rcdata:emit,cdata:emit,endDoc:function(out){for(;stack.length;stack.length--)out.push("</",stack[stack.length-1].rep,">")}})}function safeUri(uri,effect,ltype,hints,naiveUriRewriter){var parsed,safe;if(!naiveUriRewriter)return null;try{if(parsed=URI.parse(""+uri),parsed&&(!parsed.hasScheme()||ALLOWED_URI_SCHEMES.test(parsed.getScheme())))return safe=naiveUriRewriter(parsed,effect,ltype,hints),safe?safe.toString():null}catch(e){return null}return null}function log(logger,tagName,attribName,oldValue,newValue){if(attribName||logger(tagName+" removed",{change:"removed",tagName:tagName}),oldValue!==newValue){var changed="changed";oldValue&&!newValue?changed="removed":!oldValue&&newValue&&(changed="added"),logger(tagName+"."+attribName+" "+changed,{change:changed,tagName:tagName,attribName:attribName,oldValue:oldValue,newValue:newValue})}}function lookupAttribute(map,tagName,attribName){var attribKey;return attribKey=tagName+"::"+attribName,map.hasOwnProperty(attribKey)?map[attribKey]:(attribKey="*::"+attribName,map.hasOwnProperty(attribKey)?map[attribKey]:void 0)}function getLoaderType(tagName,attribName){return lookupAttribute(html4.LOADERTYPES,tagName,attribName)}function getUriEffect(tagName,attribName){return lookupAttribute(html4.URIEFFECTS,tagName,attribName)}function sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var i,attribName,value,oldValue,atype,attribKey,sanitizedDeclarations;for(i=0;i<attribs.length;i+=2){if(attribName=attribs[i],value=attribs[i+1],oldValue=value,atype=null,attribKey=tagName+"::"+attribName,(html4.ATTRIBS.hasOwnProperty(attribKey)||(attribKey="*::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey)))&&(atype=html4.ATTRIBS[attribKey]),null!==atype)switch(atype){case html4.atype.NONE:break;case html4.atype.SCRIPT:value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.STYLE:if("undefined"==typeof parseCssDeclarations){value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break}sanitizedDeclarations=[],parseCssDeclarations(value,{declaration:function(property,tokens){var normProp=property.toLowerCase();sanitizeCssProperty(normProp,tokens,opt_naiveUriRewriter?function(url){return safeUri(url,html4.ueffects.SAME_DOCUMENT,html4.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:normProp},opt_naiveUriRewriter)}:null),tokens.length&&sanitizedDeclarations.push(normProp+": "+tokens.join(" "))}}),value=sanitizedDeclarations.length>0?sanitizedDeclarations.join(" ; "):null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.ID:case html4.atype.IDREF:case html4.atype.IDREFS:case html4.atype.GLOBAL_NAME:case html4.atype.LOCAL_NAME:case html4.atype.CLASSES:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI:value=safeUri(value,getUriEffect(tagName,attribName),getLoaderType(tagName,attribName),{TYPE:"MARKUP",XML_ATTR:attribName,XML_TAG:tagName},opt_naiveUriRewriter),opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI_FRAGMENT:value&&"#"===value.charAt(0)?(value=value.substring(1),value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value,null!==value&&void 0!==value&&(value="#"+value)):value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;default:value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value)}else value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);attribs[i+1]=value}return attribs}function makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return function(tagName,attribs){return html4.ELEMENTS[tagName]&html4.eflags.UNSAFE?void(opt_logger&&log(opt_logger,tagName,void 0,void 0,void 0)):{attribs:sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger)}}}function sanitizeWithPolicy(inputHtml,tagPolicy){var outputArray=[];return makeHtmlSanitizer(tagPolicy)(inputHtml,outputArray),outputArray.join("")}function sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var tagPolicy=makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);return sanitizeWithPolicy(inputHtml,tagPolicy)}var parseCssDeclarations,sanitizeCssProperty,cssSchema,ENTITIES,decimalEscapeRe,hexEscapeRe,safeEntityNameRe,entityLookupElement,nulRe,ENTITY_RE_1,ENTITY_RE_2,ampRe,looseAmpRe,ltRe,gtRe,quotRe,ATTR_RE,splitWillCapture,EFLAGS_TEXT,continuationMarker,endTagRe,ALLOWED_URI_SCHEMES,html;return"undefined"!=typeof window&&(parseCssDeclarations=window.parseCssDeclarations,sanitizeCssProperty=window.sanitizeCssProperty,cssSchema=window.cssSchema),ENTITIES={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:"\xa0"},decimalEscapeRe=/^#(\d+)$/,hexEscapeRe=/^#x([0-9A-Fa-f]+)$/,safeEntityNameRe=/^[A-Za-z][A-za-z0-9]+$/,entityLookupElement="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,nulRe=/\0/g,ENTITY_RE_1=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,ENTITY_RE_2=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,ampRe=/&/g,looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,ltRe=/[<]/g,gtRe=/>/g,quotRe=/\"/g,ATTR_RE=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),splitWillCapture=3==="a,b".split(/(,)/).length,EFLAGS_TEXT=html4.eflags.CDATA|html4.eflags.RCDATA,continuationMarker={},endTagRe={},ALLOWED_URI_SCHEMES=/^(?:https?|mailto)$/i,html={},html.escapeAttrib=html.escapeAttrib=escapeAttrib,html.makeHtmlSanitizer=html.makeHtmlSanitizer=makeHtmlSanitizer,html.makeSaxParser=html.makeSaxParser=makeSaxParser,html.makeTagPolicy=html.makeTagPolicy=makeTagPolicy,html.normalizeRCData=html.normalizeRCData=normalizeRCData,html.sanitize=html.sanitize=sanitize,html.sanitizeAttribs=html.sanitizeAttribs=sanitizeAttribs,html.sanitizeWithPolicy=html.sanitizeWithPolicy=sanitizeWithPolicy,html.unescapeEntities=html.unescapeEntities=unescapeEntities,html}(html4),html_sanitize=html.sanitize,"undefined"!=typeof window&&(window.html=html,window.html_sanitize=html_sanitize),Sanitizer={},Sanitizer.escapeAttrib=html.escapeAttrib,Sanitizer.makeHtmlSanitizer=html.makeHtmlSanitizer,Sanitizer.makeSaxParser=html.makeSaxParser,Sanitizer.makeTagPolicy=html.makeTagPolicy,Sanitizer.normalizeRCData=html.normalizeRCData,Sanitizer.sanitizeAttribs=html.sanitizeAttribs,Sanitizer.sanitizeWithPolicy=html.sanitizeWithPolicy,Sanitizer.unescapeEntities=html.unescapeEntities,Sanitizer.escape=html.escapeAttrib,Sanitizer.sanitize=function(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return"string"==typeof inputHtml&&(inputHtml=inputHtml.replace(/<([a-zA-Z]+)([^>]*)\/>/g,"<$1$2></$1>")),inputHtml?html.sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger):inputHtml},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Sanitizer),exports.Sanitizer=Sanitizer):this.Sanitizer=Sanitizer},{"./lib/html4.js":15,"./lib/uri.js":16}]},{},[13]);